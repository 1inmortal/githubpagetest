<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <!-- Metadatos, Favicon, Fuentes -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
    <title>Cyberpunk 2077 - Evidencias (v3.4 - Hacker Terminal Load)</title>
    <meta name="author" content="Ing. Espinosa Martínez José Armando">
    <meta name="copyright" content="© 2025 Ing. Espinosa Martínez José Armando">
    <link rel="icon" href="IMG/FAVICON/LOGO.png" type="image/x-icon" />

    <!-- Fuentes Futuristas (del 2do archivo, complementando las del 1ero si es necesario) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"> <!-- Del original -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600&display=swap" rel="stylesheet"> <!-- Del original -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet"> <!-- Del 2do -->

    <!-- Font Awesome (del 1er archivo) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- ============================================================
         CSS Styles (Combinado de ambos archivos y adaptado)
         ------------------------------------------------------------
         TU BLOQUE CSS MASIVO - MANTENIDO TAL CUAL COMO PUNTO DE PARTIDA.
         Puede necesitar ajustes menores basados en la ESTRUCTURA FINAL.
         Agrego estilos básicos para las secciones placeholder (About, Skills, etc.).
    ============================================================ -->
    <style>
        /* ============================================================
           :root VARIABLES & THEMES (Del 2do archivo, con posible ajuste de HUE)
           ------------------------------------------------------------
        ============================================================ */
        :root {
          --hue: 160; /* Color principal (Cyan/Verde - típico Cyberpunk) */
          --saturation: 100%;
          --brightness-accent: 50%; /* Luminosidad color acento */
          --brightness-bg: 5%;      /* Luminosidad fondo muy oscuro */
          --brightness-text: 95%;   /* Luminosidad texto principal */
          --brightness-muted: 70%;  /* Luminosidad texto secundario */

          /* Colores Base (HSLA) */
          --color-bg: hsla(var(--hue), var(--saturation), var(--brightness-bg), 1);
          --color-accent: hsla(var(--hue), var(--saturation), var(--brightness-accent), 1);
          --color-accent-glow: hsla(var(--hue), var(--saturation), var(--brightness-accent), 0.5); /* para sombras y brillo */
          --color-accent-dark: hsla(var(--hue), var(--saturation), calc(var(--brightness-accent) - 15%), 1); /* Tono más oscuro del acento */
          --color-text: hsla(var(--hue), 10%, var(--brightness-text), 1); /* Texto ligeramente desaturado */
          --color-muted: hsla(var(--hue), 10%, var(--brightness-muted), 1); /* Texto apagado/grisáceo */
          --color-border: hsla(var(--hue), var(--saturation), calc(var(--brightness-accent) / 2), 0.3); /* Bordes semitransparentes */
          --color-glass-bg: hsla(var(--hue), 30%, 15%, 0.1); /* Fondo para glassmorphism - más transparente */
           /* Color Rojo/Error */
           --color-error: hsla(0, 100%, 60%, 1); /* Rojo Error */

          /* NUEVO: Colores RGB para rgba() en sombras (Aproximado) */
          --color-accent-rgb: 0, 255, 170; /* Aproximado para HSL(160, 100%, 50%) - Ajustar si el hue cambia drásticamente */
           --color-error-rgb: 255, 60, 60; /* Aproximado para HSL(0, 100%, 60%) */


          /* Transiciones */
          --transition-fast: 0.2s;
          --transition-medium: 0.4s;
          --transition-slow: 0.7s;

          /* Fuentes (Del 2do archivo, Rajdhani/Orbitron del 1er archivo pueden usarse para cosas específicas) */
          --font-main: 'Share Tech Mono', monospace; /* Cuerpo principal */
          --font-heading: 'VT323', monospace; /* Títulos, HUD */
          --font-alt: 'Orbitron', monospace; /* Alternativa para titulos clave/hero */
          --font-text-alt: 'Rajdhani', sans-serif; /* Alternativa para texto descriptivo */

          /* NUEVO: Variables HUD (Del 2do archivo) */
          --hud-border-width: 2px;
          --hud-corner-size: 20px;
          --hud-line-thickness: 1px;
          --hud-glow: 0 0 5px var(--color-accent-glow), 0 0 10px var(--color-accent-glow); /* Sombra brillante */

          /* Breakpoints */
          --mobile-break: 768px;
          --tablet-break: 1024px;
        }

        /* NUEVO: Tema Claro (Del 2do archivo) */
        [data-theme="light"] {
          --hue: 200; /* Azul claro */
          --brightness-bg: 95%;
          --brightness-accent: 55%;
          --brightness-text: 10%;
          --brightness-muted: 40%;

          /* Recalcular colores base */
          --color-bg: hsla(var(--hue), 20%, var(--brightness-bg), 1);
          --color-accent: hsla(var(--hue), 80%, var(--brightness-accent), 1);
          --color-accent-glow: hsla(var(--hue), 80%, var(--brightness-accent), 0.4);
          --color-accent-dark: hsla(var(--hue), 80%, calc(var(--brightness-accent) - 15%), 1);
          --color-text: hsla(var(--hue), 10%, var(--brightness-text), 1);
          --color-muted: hsla(var(--hue), 10%, var(--brightness-muted), 1);
          --color-border: hsla(var(--hue), 50%, calc(var(--brightness-accent)), 0.3);
          --color-glass-bg: hsla(var(--hue), 30%, 85%, 0.2);
          --color-accent-rgb: 0, 170, 255; /* Aproximado */
           --color-error: hsla(350, 80%, 50%, 1); /* Rojo diferente en tema claro */
           --color-error-rgb: 255, 80, 50; /* Aproximado */
        }

        /* ============================================================
           RESET BÁSICO Y ESTILOS GENERALES (Del 2do archivo)
           ------------------------------------------------------------
        ============================================================ */
        *, *::before, *::after {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        html {
          scroll-behavior: smooth;
          font-size: 16px; /* Base para REMs */
          scrollbar-width: thin; /* Scrollbar más fino */
          scrollbar-color: var(--color-accent) var(--color-bg); /* Color scrollbar */
        }
         /* Estilo para Webkit browsers */
        ::-webkit-scrollbar {
          width: 8px; /* Ancho del scrollbar */
        }
        ::-webkit-scrollbar-track {
          background: var(--color-bg); /* Fondo del track */
        }
        ::-webkit-scrollbar-thumb {
          background-color: var(--color-accent); /* Color del 'pulgar' */
          border-radius: 10px; /* Bordes redondeados */
          border: 1px solid var(--color-accent-dark); /* Borde */
        }
         ::-webkit-scrollbar-thumb:hover {
          background-color: var(--color-text); /* Cambio color hover */
        }


        body {
          font-family: var(--font-main);
          background-color: var(--color-bg);
          color: var(--color-text);
          overflow-x: hidden;
          position: relative;
          min-height: 100vh;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          /* Cursor personalizado (manteniendo el original si prefieres, o usar auto/default) */
          /* cursor: url("IMG/CURSORS/cursor1.cur"), auto;  -- Dejado como estaba en original -- */
          transition: background-color var(--transition-medium), color var(--transition-medium); /* Transición para cambio de tema */
        }

        /* Estilo de Selección (Del 2do archivo) */
        ::selection {
          background-color: var(--color-accent);
          color: var(--color-bg);
          text-shadow: none;
        }

        a, button {
          text-decoration: none;
          color: inherit;
          cursor: pointer;
          background: none;
          border: none;
          font-family: inherit;
        }

        img, video {
          max-width: 100%;
          height: auto;
          display: block;
          object-fit: cover; /* Asegura que cubran su contenedor */
        }

        /* NUEVO: Estilos para Lazy Loading de imágenes (Del 2do archivo) */
        img[data-src], video[data-src] { /* Apply to videos as well if they use data-src */
            opacity: 0; /* Oculto inicialmente */
            transition: opacity 0.5s ease-in-out; /* Transición suave */
        }
        img.loaded, video.loaded { /* Added video.loaded */
            opacity: 1; /* Mostrar cuando esté cargada */
        }

        ul, li {
          list-style: none;
        }

        /* Ocultar elementos inicialmente hasta que JS los revele (Del 2do archivo) */
        /* Removing opacity: 0 from here, will handle with .reveal class for specific sections */
        /* Header, main content, and HUD should be controlled by loader logic visibility */


        /* Video de fondo (Del 2do archivo) */
        #bg-video {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          object-fit: cover;
          z-index: -2; /* Detrás del contenido y del HUD */
          opacity: 0.15; /* Más sutil */
          filter: grayscale(50%) brightness(0.7); /* Efecto visual */
        }

        /* ============================================================
           LOADER AVANZADO ESTILOS (Del 2do archivo)
           ------------------------------------------------------------
           Integrando y estilyzando el loader del 2do archivo.
        ============================================================ */
         .loader-overlay { /* Usamos la clase original pero con estilos del 2do archivo */
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: var(--color-bg);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 99999;
          opacity: 1;
          visibility: visible;
          transition: opacity var(--transition-slow) ease-in-out, visibility var(--transition-slow) step-end;
          /* Removiendo overflow: hidden si no es necesario, para debug */
        }

        .loader-overlay:not(.active) {
          opacity: 0;
          visibility: hidden;
          transition: opacity var(--transition-slow) ease-in-out, visibility 0s var(--transition-slow);
        }

        .loader-hud-border { /* Nuevo elemento decorativo del loader */
          position: absolute;
          top: 20px;
          left: 20px;
          right: 20px;
          bottom: 20px;
          border: var(--hud-border-width) solid var(--color-border);
          pointer-events: none;
          box-shadow: inset 0 0 15px rgba(var(--color-accent-rgb), 0.1);
        }

        .loader-scanline { /* Efecto visual en el loader */
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 3px;
          background: var(--color-accent);
          box-shadow: var(--hud-glow);
          opacity: 0.7;
          animation: scan 3s linear infinite;
          z-index: 1;
        }

        @keyframes scan {
          0% { transform: translateY(0); }
          50% { transform: translateY(calc(100vh - 3px)); }
          100% { transform: translateY(0); }
        }

        .loader-content { /* Contenedor para los elementos de texto y barra */
          position: relative;
          z-index: 2;
          text-align: center;
          color: var(--color-accent);
          max-width: 90%; /* Más responsivo */
          width: 500px; /* Ancho fijo con max-width */
        }

        .loader-logo { /* Título del loader */
          font-family: var(--font-heading);
          font-size: 2rem;
          margin-bottom: 20px;
          letter-spacing: 4px;
          text-shadow: var(--hud-glow);
          animation: pulse-text 2s infinite alternate;
        }

        @keyframes pulse-text {
          from { opacity: 0.7; }
          to { opacity: 1; }
        }

        .loader-text { /* Texto principal del estado de carga */
          font-family: var(--font-main);
          font-size: 1.2rem;
          margin-bottom: 15px;
          text-transform: uppercase;
          letter-spacing: 1px;
          min-height: 1.2rem; /* Evitar salto */
        }

        .loader-bar-container { /* Contenedor de la barra de progreso */
          width: 100%;
          max-width: 400px;
          height: 10px;
          background: rgba(var(--color-accent-rgb), 0.1);
          border: 1px solid var(--color-border);
          border-radius: 2px;
          overflow: hidden;
          margin: 15px auto;
          box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .loader-bar { /* Barra de progreso dinámica */
          width: 0%;
          height: 100%;
          background: var(--color-accent);
          box-shadow: var(--hud-glow);
          transition: width 0.1s linear;
        }

        .loader-percentage { /* Porcentaje de carga */
          font-family: var(--font-main);
          font-size: 1rem;
          margin-bottom: 10px;
           min-height: 1rem; /* Evitar salto */
        }

        .loader-subtext { /* Subtexto informativo en el loader */
          font-family: var(--font-main);
          font-size: 0.8rem;
          color: var(--color-muted);
          letter-spacing: 1px;
           min-height: 0.8rem; /* Evitar salto */
        }

        /* ============================================================
           HUD OVERLAY ESTILOS (Heads-Up Display - Del 2do archivo)
           ------------------------------------------------------------
           Capas visuales fijas para dar la sensación de interfaz.
        ============================================================ */
        .hud-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none; /* No interfiere con clicks */
          z-index: 1000; /* Encima del contenido, debajo de modales/menús */
          overflow: hidden; /* Evita que elementos se salgan */
           opacity: 0; /* Controlado por JS al terminar la carga */
           transition: opacity var(--transition-slow) ease-in-out;
        }

        .hud-overlay.visible { opacity: 1; }


        /* Esquinas Decorativas (Del 2do archivo) */
        .hud-corner {
          position: absolute;
          width: var(--hud-corner-size);
          height: var(--hud-corner-size);
          border-style: solid;
          border-color: var(--color-accent);
          opacity: 0.7;
           /* Añadir un ligero glow a las esquinas */
           box-shadow: 0 0 5px rgba(var(--color-accent-rgb), 0.5);
        }
        .hud-corner.top-left { top: 15px; left: 15px; border-width: var(--hud-border-width) 0 0 var(--hud-border-width); }
        .hud-corner.top-right { top: 15px; right: 15px; border-width: var(--hud-border-width) var(--hud-border-width) 0 0; }
        .hud-corner.bottom-left { bottom: 15px; left: 15px; border-width: 0 0 var(--hud-border-width) var(--hud-border-width); }
        .hud-corner.bottom-right { bottom: 15px; right: 15px; border-width: 0 var(--hud-border-width) var(--hud-border-width) 0; }

        /* Líneas Decorativas (Del 2do archivo) */
        .hud-line {
          position: absolute;
          background-color: var(--color-border);
          box-shadow: 0 0 3px var(--color-border);
          opacity: 0.5;
        }
        .hud-line.top { top: calc(15px + var(--hud-corner-size)); left: calc(15px + var(--hud-corner-size)); right: calc(15px + var(--hud-corner-size)); height: var(--hud-line-thickness); }
        .hud-line.bottom { bottom: calc(15px + var(--hud-corner-size)); left: calc(15px + var(--hud-corner-size)); right: calc(15px + var(--hud-corner-size)); height: var(--hud-line-thickness); }
        .hud-line.left { left: calc(15px + var(--hud-corner-size)); top: calc(15px + var(--hud-corner-size)); bottom: calc(15px + var(--hud-corner-size)); width: var(--hud-line-thickness); }
        .hud-line.right { right: calc(15px + var(--hud-corner-size)); top: calc(15px + var(--hud-corner-size)); bottom: calc(15px + var(--hud-corner-size)); width: var(--hud-line-thickness); }

        /* Readouts de Información (Del 2do archivo) */
        .hud-readout {
          position: absolute;
          font-family: var(--font-main);
          font-size: 0.75rem;
          color: var(--color-muted);
          padding: 5px 10px;
          background: rgba(var(--color-bg), 0.5); /* Fondo semitransparente */
          text-transform: uppercase;
          letter-spacing: 1px;
          /* Border sutil */
          border: 1px solid var(--color-border);
           z-index: 10; /* Asegurar visibilidad sobre otros elementos */
           min-width: 80px; /* Mínimo para que no cambie de ancho bruscamente */
        }
        .hud-readout span:first-child { color: var(--color-accent); margin-right: 5px;}
        .hud-readout .hud-ok { color: hsla(120, 70%, 60%, 1); } /* Verde OK */
        .hud-readout .hud-warning { color: hsla(45, 100%, 60%, 1); } /* Amarillo Warning */
        .hud-readout .hud-error { color: var(--color-error); } /* Rojo Error */

        .top-left-readout { top: 30px; left: 30px; } /* Ajuste para no chocar con esquinas */
        .top-right-readout { top: 30px; right: 30px; text-align: right;}
        .bottom-left-readout { bottom: 30px; left: 30px; }
        .bottom-right-readout { bottom: 30px; right: 30px; text-align: right;}


        /* ============================================================
           HEADER MEJORADO (Del 2do archivo, adaptado de 'cyber-nav')
           ------------------------------------------------------------
        ============================================================ */
        /* Usamos el ID original del 1er archivo, pero los estilos del 2do */
         #mainHeader {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          padding: 10px 30px; /* Más padding */
          display: flex;
          justify-content: space-between;
          align-items: center;
          z-index: 1001; /* Encima del HUD overlay, pero debajo del panel filtro */
          background: rgba(var(--color-bg), 0.7); /* Fondo semitransparente más opaco */
          backdrop-filter: blur(15px);
          -webkit-backdrop-filter: blur(15px);
          border-bottom: var(--hud-line-thickness) solid var(--color-border);
           opacity: 0; /* Controlado por JS al terminar la carga */
           transition: opacity var(--transition-slow) ease-in-out;
        }

         #mainHeader.visible { opacity: 1; }

         .branding a { /* .nav-brand original, estilizado como .branding */
          font-family: var(--font-alt); /* Usar Orbitron/Rajdhani si prefieres */
          font-size: 1.5rem;
          color: var(--color-accent);
          text-shadow: var(--hud-glow);
          letter-spacing: 2px;
          transition: color var(--transition-fast), text-shadow var(--transition-fast);
        }
        .branding a:hover {
          color: var(--color-text);
          text-shadow: 0 0 10px var(--color-text); /* Resaltar con color principal */
        }

        .header-controls { /* Del 2do archivo */
          display: flex;
          align-items: center;
          gap: 10px;
        }

        /* Estilo Base para Botones HUD (Del 2do archivo) */
        .hud-button, .hud-link { /* Añadido hud-link para base */
          font-family: var(--font-main);
          padding: 8px 15px;
          border: 1px solid var(--color-border);
          background: rgba(var(--color-accent-rgb), 0.1);
          color: var(--color-accent);
          font-size: 0.8rem;
          text-transform: uppercase;
          letter-spacing: 1px;
          border-radius: 3px;
          transition: background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast); /* Añadido transform */
          position: relative;
          overflow: hidden;
           /* Alineación vertical para iconos */
           display: inline-flex;
           align-items: center;
           justify-content: center;
           gap: 5px; /* Espacio entre icono y texto si hay */
        }
        .hud-button:hover, .hud-link:hover { /* Añadido hud-link:hover */
          background: var(--color-accent);
          color: var(--color-bg);
          box-shadow: var(--hud-glow);
           transform: translateY(-2px); /* Ligero desplazamiento al hover */
        }
         .hud-button:active, .hud-link:active { /* Añadido hud-link:active */
           transform: translateY(0); /* Volver a posición normal al click */
         }
        .hud-button.small, .hud-link.small { padding: 5px 10px; font-size: 0.7rem; } /* Añadido hud-link.small */
        .hud-button.large, .hud-link.large { padding: 12px 25px; font-size: 1rem; } /* Añadido hud-link.large */

        /* Estilo Primario/Destacado para Botones (Del 2do archivo) */
        .hud-button.primary {
          background: var(--color-accent);
          color: var(--color-bg);
          border-color: var(--color-accent);
          box-shadow: var(--hud-glow);
        }
        .hud-button.primary:hover {
          background: var(--color-accent-dark);
          box-shadow: 0 0 15px var(--color-accent);
        }
         /* Link primario, si es necesario */
         .hud-link.primary { /* Ejemplo */
              background: rgba(var(--color-accent-rgb), 0.8);
              color: var(--color-bg);
              border-color: var(--color-accent-dark);
               box-shadow: 0 0 10px rgba(var(--color-accent-rgb), 0.4);
         }
         .hud-link.primary:hover {
              background: var(--color-accent-dark);
         }


        /* Efecto Scanline Hover para botones/links (Del 2do archivo) */
        .hud-button::after, .hud-link::after { /* Añadido hud-link */
          content: '';
          position: absolute;
          top: 0;
          left: -150%;
          width: 50%;
          height: 100%;
          background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
          transform: skewX(-25deg);
          transition: left var(--transition-medium) ease-in-out;
          pointer-events: none; /* Asegurar que el efecto no capture clicks */
        }
        .hud-button:hover::after, .hud-link:hover::after { /* Añadido hud-link:hover */
          left: 150%;
        }
         /* Estilo para enlaces sociales */
         .hud-link.social {
             border: none; /* No border */
             background: none; /* No background */
             padding: 0 5px; /* Adjust padding */
             font-size: 1.2rem; /* Larger icon */
             color: var(--color-muted);
             transition: color var(--transition-fast), transform var(--transition-fast);
              box-shadow: none; /* No initial shadow */
              position: relative; /* Needed for scanline */
               /* Reset default scanline styles */
               overflow: hidden;
               text-shadow: none;
         }
         .hud-link.social:hover {
             color: var(--color-accent);
             transform: scale(1.1); /* Slight scale */
             background: none;
              box-shadow: none;
              text-shadow: 0 0 8px rgba(var(--color-accent-rgb), 0.6);
         }
         /* Ensure scanline effect doesn't apply weirdly if using on socials - potentially disable ::after */
         .hud-link.social::after { content: none; } /* Remove scanline effect on socials */


        /* Botón Mute (Del 2do archivo) */
        #muteButton { padding: 8px; } /* Ajuste el padding */
        #muteButton svg { transition: opacity var(--transition-fast); }
        #muteButton svg.mute-slash { position: absolute; opacity: 0; color: var(--color-error); }
        #muteButton.muted svg:not(.mute-slash) { opacity: 0.3; }
        #muteButton.muted svg.mute-slash { opacity: 1; }
         #muteButton svg { width: 18px; height: 18px; } /* Tamaño del icono */
         #muteButton.muted svg.mute-slash { width: 24px; height: 24px; } /* Tamaño del slash puede ser mayor */


        /* Menú Filtro (Del 2do archivo, estilizado de filter-overlay) */
        .filter-container { position: static; } /* Contenedor no necesita ser relativo, el panel es fixed */
        .filter-panel { /* Estructura del panel del 2do archivo */
          position: fixed; /* Cambiado a fijo */
          top: 50%;      /* Centrado vertical */
          left: 50%;     /* Centrado horizontal */
          width: 90%;    /* Ancho responsivo */
          max-width: 400px; /* Ancho máximo */
          max-height: 80vh; /* Altura máxima con scroll */
          overflow-y: auto; /* Scroll si es necesario */
          background: rgba(var(--color-bg), 0.95);
          border: 1px solid var(--color-border);
          border-radius: 5px;
          padding: 25px; /* Más padding */
          z-index: 10001; /* MUY ALTO para estar sobre todo */
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
          /* Estado inicial (oculto) */
          transform: translate(-50%, -50%) scale(0.9); /* Centrado y escalado */
          opacity: 0;
          visibility: hidden;
          transition: transform var(--transition-medium) ease, opacity var(--transition-medium) ease, visibility 0s var(--transition-medium);
          transform-origin: center center; /* Origen de transformación */
           /* Estilo para scrollbar dentro del panel */
           scrollbar-width: thin;
           scrollbar-color: var(--color-accent) rgba(var(--color-bg), 0.95);
        }
        .filter-panel.open {
          transform: translate(-50%, -50%) scale(1); /* Estado abierto */
          opacity: 1;
          visibility: visible;
          transition: transform var(--transition-medium) ease, opacity var(--transition-medium) ease, visibility 0s 0s;
        }
         /* Estilo del UL y LI dentro del panel (Del 2do archivo, usando .navbar-nav) */
        .filter-panel ul { /* ul original dentro de filter-content, estilizado */
          display: flex;
          flex-direction: column;
          gap: 8px; /* Más espacio */
           padding-left: 0;
        }
        .filter-panel li { margin: 0; }
         /* Estilo de los links (Del 2do archivo, usando .nav-link) */
        .filter-panel .filter-link { /* .filter-link original, estilizado como .nav-link del 2do archivo */
          display: block;
          padding: 10px 15px; /* Padding más grande */
          color: var(--color-muted);
          font-family: var(--font-heading); /* Fuente HUD */
          font-size: 1.1rem; /* Fuente más grande */
          border-radius: 3px;
          transition: background var(--transition-fast), color var(--transition-fast), letter-spacing var(--transition-fast);
          position: relative;
          overflow: hidden;
          text-align: center; /* Texto centrado */
           letter-spacing: 0.5px;
           text-transform: uppercase; /* Added for style consistency */
        }
         /* Línea decorativa al hover (Del 2do archivo) */
        .filter-panel .filter-link::before {
          content: '';
          position: absolute;
          bottom: 0;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 2px;
          background: var(--color-accent);
          transition: width var(--transition-medium) ease;
           box-shadow: var(--hud-glow);
        }
        .filter-panel .filter-link:hover {
          background: rgba(var(--color-accent-rgb), 0.15); /* Fondo hover */
          color: var(--color-accent);
           letter-spacing: 3px; /* Espacio al hover */
        }
        .filter-panel .filter-link:hover::before {
          width: 80%; /* Ancho de la línea en hover */
        }
         /* Línea divisoria en el menú (Adaptado del 1er archivo) */
        .filter-panel ul li[style] { /* Apuntar al LI con estilo inline */
            margin-top: 2rem !important;
            border-top: 1px solid var(--color-border) !important;
            padding-top: 2rem !important;
        }

        /* Overlay para el menú filtro (fondo oscuro - Del 2do archivo) */
        .filter-overlay { /* Mantenemos el ID del 1er archivo, pero con estilos del 2do */
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0,0,0,0.85); /* Más oscuro */
          backdrop-filter: blur(8px); /* Más blur */
          -webkit-backdrop-filter: blur(8px);
          opacity: 0;
          visibility: hidden;
          transition: opacity var(--transition-medium) ease, visibility 0s var(--transition-medium);
          z-index: 10000; /* Debajo del panel, encima de todo lo demás */
        }
        .filter-overlay.open {
          opacity: 1;
          visibility: visible;
          transition: opacity var(--transition-medium) ease, visibility 0s 0s;
        }


        /* ============================================================
           Contenedor Notificaciones (Adaptado de 1er archivo)
           ------------------------------------------------------------
           Mantenemos la estructura original, adaptamos estilos.
        ============================================================ */
        .notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10005; /* Encima de todo lo demás */
            display: flex;
            flex-direction: column-reverse; /* Últimas notificaciones arriba */
            gap: 10px;
            pointer-events: none; /* Las notificaciones no deben capturar clicks */
        }
         .notification {
            background: rgba(var(--color-accent-rgb), 0.15); /* Fondo semi-transparente */
            border: 1px solid var(--color-accent);
            color: var(--color-text);
            padding: 12px 20px;
            border-radius: 4px;
            font-family: var(--font-main);
            font-size: 0.9rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateX(100%);
            /* Use keyframes that control both opacity and transform */
            animation: notification-show 0.5s ease-out forwards, notification-hide 0.5s ease-in forwards 4.5s; /* Example animation timing */
            pointer-events: all; /* Permite cerrar/interactuar si se añaden botones */
             max-width: 300px; /* Ancho máximo */
             overflow: hidden; /* Por si el texto es largo */
             text-overflow: ellipsis; /* Add ellipsis for long text */
             white-space: nowrap; /* Keep text in one line */
         }
        /* Pause animation on hover */
        .notification:hover { animation-play-state: paused; }
        /* Style variants for notification type */
        .notification.error {
            background: rgba(var(--color-error-rgb), 0.2); /* Usar color-error-rgb */
            border-color: var(--color-error);
             box-shadow: 0 4px 8px rgba(var(--color-error-rgb), 0.4); /* Usar color-error-rgb */
        }
        .notification.warning {
            background: hsla(45, 100%, 40%, 0.2);
            border-color: hsla(45, 100%, 60%, 1);
             box-shadow: 0 4px 8px hsla(45, 100%, 50%, 0.3);
             color: hsla(45, 10%, 90%, 1); /* Brighter text */
        }
         .notification.info {
             background: rgba(var(--color-accent-rgb), 0.15);
             border-color: var(--color-accent);
             color: var(--color-text);
         }


        /* New Keyframes for notifications */
        @keyframes notification-show {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes notification-hide {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); } /* Slide back out */
        }


       /* INTRO SECTION (Original del 1er archivo - Removed for simplicity as JS is missing) */
       /* .intro-section { display: none; } */


        /* ============================================================
           CONTENEDOR PRINCIPAL Y SECCIONES (Del 2do archivo)
           ------------------------------------------------------------
           Envolvemos el contenido existente aquí.
        ============================================================ */
        .main-content-wrapper {
          position: relative;
          z-index: 1; /* Encima del video de fondo */
          /* Añadimos padding para que el contenido no quede debajo del HUD fijo y el header */
          padding-top: 120px; /* Ajuste: Header (aprox 60px) + HUD Top (aprox 40px) + margen */
          padding-bottom: 80px; /* Espacio para HUD bottom + margen */
          opacity: 0; /* Controlado por JS al terminar la carga */
          transition: opacity var(--transition-slow) ease-in-out;
        }

         .main-content-wrapper.visible { opacity: 1; }

        .section-container { /* Clase añadida a la mayoría de SECTIONs originales */
          padding: 100px 5%; /* Padding lateral responsivo */
          max-width: 1400px; /* Ancho máximo del contenido */
          margin-left: auto;
          margin-right: auto;
          position: relative;
          /* Retirar o ajustar el margen y borde si se añaden separadores visuales de otro modo */
           margin-top: 0; /* Se gestiona el espacio con el padding-top de la sección */
           border-top: none; /* Se puede añadir un separador decorativo de otro modo si se desea */
        }

         /* Separador visual entre secciones si se necesita */
        .section-container:not(:first-child) {
           margin-top: 80px; /* Espacio entre secciones */
           border-top: 1px solid var(--color-border);
           padding-top: 80px; /* Padding después del borde */
        }

        /* Estilo base para cajas de contenido (cards, paneles, etc. - Del 2do archivo) */
        .content-box { /* Clase añadida a elementos internos de las secciones */
          background: var(--color-glass-bg);
          border: 1px solid var(--color-border);
          border-radius: 5px;
          padding: 25px;
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px); /* Safari */
          box-shadow: 0 5px 15px rgba(0,0,0,0.2);
          transition: transform var(--transition-medium), box-shadow var(--transition-medium), background-color var(--transition-medium);
          height: 100%; /* Make content boxes fill their grid cell if in a grid */
        }
        /* Add hover effect explicitly if not covered by generic button/link hover */
        /* .content-box:hover { ... inherited or defined specifically per type */
        /* Example: Remove general content-box hover if only links inside should animate */
         /* .content-box:hover {
           transform: none;
           box-shadow: 0 5px 15px rgba(0,0,0,0.2);
           background-color: var(--color-glass-bg);
         } */


         /* Estilo general para títulos H2 de sección */
         .section-title {
            font-family: var(--font-heading);
            font-size: clamp(2rem, 5vw, 3rem); /* Fluido */
            text-align: center;
            margin-bottom: 60px;
            position: relative;
            display: block;
            color: var(--color-accent);
            text-shadow: var(--hud-glow);
            letter-spacing: 2px;
            text-transform: uppercase;
        }
         /* Líneas decorativas para títulos (Del 2do archivo) */
        .section-title::before, .section-title::after {
          content: '';
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          height: 2px;
          background: var(--color-border);
          width: 50%; /* La línea inferior */
           box-shadow: 0 0 5px var(--color-border);
        }
        .section-title::before { top: -15px; width: 25%; /* La línea superior más corta */ }
        .section-title::after { bottom: -15px; }

         /* Styles for Project Search Input (Added) */
        .internal-search {
            margin-bottom: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
         .internal-search input[type="text"] {
             font-family: var(--font-main);
             font-size: 1rem;
             padding: 10px 15px;
             border: 1px solid var(--color-border);
             border-radius: 3px;
             background: rgba(var(--color-accent-rgb), 0.08);
             color: var(--color-text);
             width: 300px; /* Default width */
             transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background-color var(--transition-fast);
         }
         .internal-search input[type="text"]::placeholder {
             color: var(--color-muted);
             opacity: 0.7;
         }
         .internal-search input[type="text"]:focus {
             outline: none;
             border-color: var(--color-accent);
             box-shadow: 0 0 8px rgba(var(--color-accent-rgb), 0.5);
             background: rgba(var(--color-accent-rgb), 0.15);
         }


        /* ============================================================
           SECCIONES ESPECÍFICAS (Estilizadas del 2do archivo + NUEVAS)
           ------------------------------------------------------------
           Adaptando los estilos del 2do archivo al contenido del 1ero y añadiendo estructura.
        ============================================================ */

        /* --- HERO (Del 1er archivo, estilizado con el 2do) --- */
         .hero {
          min-height: calc(100vh - 120px); /* Ajustar a la altura de la ventana menos el espacio del header/HUD */
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          text-align: center;
          padding: 0 5%;
          position: relative;
          /* Retirar margen superior ya que main-content-wrapper tiene padding-top */
          margin-top: 0;
           /* Retirar background para usar el video o el del body */
          background: none;
           /* Asegurar que el hero sea siempre el primer elemento animado en el wrapper */
          z-index: 2;
        }
         /* Animaciones de aparición (del 1er archivo), usando la clase Reveal del 2do archivo */
         .hero-content { /* Contenedor original */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
         }
        /* The animation-trigger class is just for JS logic, the visible state in reveal class does the animation */


        .hero-title { /* Adaptado del 1er archivo, estilos glitch del 2do */
          font-family: var(--font-alt); /* Usar Orbitron para Hero */
          font-size: clamp(2.5rem, 8vw, 5rem);
          margin-bottom: 20px;
          letter-spacing: 0.05em;
          position: relative;
          color: var(--color-accent);
          text-shadow: 0 0 8px var(--color-accent-glow),
                       0 0 15px var(--color-accent-glow),
                       0 0 25px rgba(var(--color-accent-rgb), 0.3);
          animation: text-flicker 3s linear infinite alternate;
           /* Añadir color a data-text si no usa pseudoelementos*/
            /* For data-text glitch effect using pseudo-elements, remove color */
            color: transparent; /* Ensure the base text is invisible if using pseudo-elements for color */
        }
         /* Efecto Glitch (Del 2do archivo) */
        .hero-title::before,
        .hero-title::after {
          content: attr(data-text); /* Uses the data-text attribute */
          position: absolute; top: 0; left: 0; width: 100%; height: 100%;
          overflow: hidden; background: var(--color-bg); /* Use BG color as base */
          color: var(--color-accent); clip-path: inset(0);
        }
        .hero-title::before {
          left: 2px; text-shadow: -1px 0 var(--color-error); /* Color de error */
          animation: glitch-anim-1 2s infinite linear alternate-reverse;
        }
        .hero-title::after {
          left: -2px; text-shadow: -1px 0 cyan; /* Otro color para contraste glitch (example blue) */
          animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        /* Keyframes glitch - Usados del 2do archivo, aseguran consistencia */
        /* Keep the glitch animation keyframes as provided */
         @keyframes glitch-anim-1 { /* ... */ }
         @keyframes glitch-anim-2 { /* ... */ }
         @keyframes text-flicker { /* ... */ }


        .hero-subtitle { /* Del 1er archivo */
          font-size: clamp(1rem, 2.5vw, 1.3rem);
          max-width: 700px;
          line-height: 1.6;
          color: var(--color-muted); /* Usar color muted del tema HUD */
          margin-top: 20px;
          font-family: var(--font-text-alt); /* Usar Rajdhani */
        }

        .btn-hero { /* Del 1er archivo, estilizado como hud-button primary */
            font-family: var(--font-heading); /* Usar VT323 para botones */
            font-size: 1.2rem;
            margin-top: 40px;
            padding: 12px 30px;
             /* Inherits styles from .hud-button.primary via JS applying classes */
        }
         /* Added the button style replication manually here just in case JS misses applying the classes initially */
        .btn-hero {
             /* Based on .hud-button.primary */
             padding: 12px 25px; /* Usar padding del large hud-button */
             font-size: 1.2rem;
             text-transform: uppercase;
             letter-spacing: 1px;
             border-radius: 3px;
             transition: background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast);
             position: relative;
             overflow: hidden;

             /* Primary styles */
             background: var(--color-accent);
             color: var(--color-bg);
             border: 1px solid var(--color-accent);
             box-shadow: var(--hud-glow);
         }
        .btn-hero:hover {
             background: var(--color-accent-dark);
             box-shadow: 0 0 15px var(--color-accent);
             transform: translateY(-3px);
         }
        .btn-hero::after { /* Scanline effect */
             content: '';
             position: absolute;
             top: 0;
             left: -150%;
             width: 50%;
             height: 100%;
             background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
             transform: skewX(-25deg);
             transition: left var(--transition-medium) ease-in-out;
             pointer-events: none;
         }
        .btn-hero:hover::after { left: 150%; }


        /* Scroll down indicator (Añadido desde la referencia del 2do archivo) */
        .scroll-down-indicator {
          position: absolute;
          bottom: 40px; /* Ajusta según espacio del HUD */
          left: 50%;
          transform: translateX(-50%);
          color: var(--color-accent);
          font-size: 1.8rem; /* un poco más grande */
          animation: bounce 2s infinite;
          opacity: 0.7;
          transition: opacity var(--transition-fast);
           z-index: 1; /* Asegurar que esté sobre el video/fondo */
        }
        .scroll-down-indicator:hover {
            opacity: 1;
        }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); } 40% { transform: translateX(-50%) translateY(-10px); } 60% { transform: translateX(-50%) translateY(-5px); } }


         /* ABOUT SECTION (Example of a new section structure) */
         #about .about-content {
             display: grid;
             grid-template-columns: 2fr 1fr; /* Text wider than image */
             gap: 30px;
             align-items: start;
         }
          #about .about-text p {
              line-height: 1.6;
              margin-bottom: 15px;
              color: var(--color-muted);
               font-size: 0.95rem;
          }
          #about .about-image {
              position: relative;
               display: flex;
               flex-direction: column;
               align-items: center;
               text-align: center;
          }
         #about .about-image img {
              border: 1px solid var(--color-border);
              border-radius: 5px;
               box-shadow: 0 5px 15px rgba(0,0,0,0.2);
               margin-bottom: 10px;
         }
         .image-hud-overlay { /* Text overlay for image, if needed */
             font-family: var(--font-heading);
             font-size: 0.8rem;
             color: var(--color-accent);
             text-transform: uppercase;
             letter-spacing: 1px;
              text-shadow: var(--hud-glow);
         }

          /* SKILLS SECTION (Example with progress bars) */
          .skills-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
              gap: 20px;
          }
         .skill-item {
             /* inherits content-box */
             display: flex;
             flex-direction: column;
             gap: 8px;
         }
          .skill-item h4 {
              font-family: var(--font-main); /* Use main or alt font for skill names */
              font-size: 1rem;
              color: var(--color-text);
               margin-bottom: 5px;
               display: flex;
               justify-content: space-between;
               align-items: center;
               padding-bottom: 5px;
               border-bottom: 1px dashed var(--color-border);
          }
          .skill-level-text {
               font-family: var(--font-heading); /* HUD style for percentage */
               color: var(--color-accent);
               font-size: 1.1rem;
          }
          .progress-bar-container {
              width: 100%;
              height: 8px;
              background: rgba(var(--color-accent-rgb), 0.05);
              border: 1px solid var(--color-border);
              border-radius: 2px;
              overflow: hidden;
          }
         .progress-bar-fill {
             height: 100%;
             width: 0%; /* Starts at 0, JS animates to data-skill-level */
             background: var(--color-accent);
             transition: width 0.8s cubic-bezier(0.645, 0.045, 0.355, 1); /* Easing matches reveal */
              box-shadow: 0 0 5px var(--color-accent-glow);
         }

         /* CERTIFICATIONS SECTION (Example with modal triggers) */
          .certifications-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
              gap: 20px;
          }
          .certificate-card {
               /* inherits content-box */
              text-align: center;
              display: flex;
              flex-direction: column;
              align-items: center;
          }
         .certificate-card h4 {
             font-family: var(--font-main);
             font-size: 1rem;
             color: var(--color-accent);
             margin-bottom: 10px;
         }
          .certificate-card p {
              font-size: 0.9rem;
              color: var(--color-muted);
               margin-bottom: 15px;
               flex-grow: 1; /* Push button to bottom */
          }
          .certificate-card .hud-button {
              margin-top: auto; /* Push button to bottom */
          }

         /* DOWNLOADS SECTION (Example) */
          .downloads-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
              gap: 20px;
          }
          .download-item {
               /* inherits content-box */
              display: flex;
              flex-direction: column;
              align-items: flex-start;
          }
         .download-item h4 {
             font-family: var(--font-main);
             font-size: 1rem;
             color: var(--color-accent);
             margin-bottom: 5px;
         }
         .download-item p {
             font-size: 0.9rem;
             color: var(--color-muted);
              margin-bottom: 15px;
              flex-grow: 1; /* Push button to bottom */
         }
          .download-item .hud-button {
               margin-top: auto;
               width: auto; /* Auto width for button */
          }


         /* FAQs SECTION (Example) */
         .faqs-container {
             max-width: 800px; /* Keep FAQs centralized */
             margin: 0 auto;
         }
          .faq-item {
              /* inherits content-box */
              margin-bottom: 20px; /* Space between FAQ items */
              cursor: pointer;
               padding: 20px; /* Adjust padding */
          }
          .faq-question {
              font-family: var(--font-heading);
              font-size: 1.1rem;
              color: var(--color-accent);
              margin-bottom: 10px;
               position: relative;
               padding-right: 30px; /* Space for icon */
               transition: color var(--transition-fast);
          }
           .faq-question:hover {
               color: var(--color-text);
           }
           .faq-question i { /* Icon for toggle */
               position: absolute;
               top: 50%;
               right: 0;
               transform: translateY(-50%) rotate(0deg);
               transition: transform var(--transition-fast);
               color: var(--color-muted);
           }
          .faq-item.open .faq-question i {
               transform: translateY(-50%) rotate(90deg); /* Rotate icon when open */
               color: var(--color-accent);
          }
          .faq-answer {
              font-family: var(--font-main);
              font-size: 0.9rem;
              color: var(--color-text);
              line-height: 1.5;
              max-height: 0; /* Hidden by default */
              overflow: hidden;
              transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
              padding-top: 0;
              border-top: none;
          }
           .faq-item.open .faq-answer {
               max-height: 500px; /* Adjust as needed for max content */
               padding-top: 15px; /* Add padding when open */
               border-top: 1px dashed var(--color-border); /* Add border when open */
           }


        /* PROYECTO X SECTION (Del 1er archivo, estilizado) */
        /* Reemplazar .projectx-section por .section-container#proyectoX y añadir reveal */
         #proyectoX {
             /* Adding section-container base styles here directly as it's the first explicit use */
             padding: 100px 5%;
             max-width: 1400px;
             margin: 0 auto;
              /* Space is handled by section-container:not(:first-child) IF it's not the first. */
              /* If #proyectoX is the first after hero, no margin-top/border-top needed here. */
             position: relative;
         }
        #proyectoX h2 {
            /* Already has section-title, inheriting styles */
        }
         #proyectoX h2 i { margin-right: 10px; color: var(--color-border); opacity: 0.8;}
         /* ::before/::after styles inherited from .section-title */


        .projectx-container {
          display: grid; /* Usamos grid para controlar el layout */
          gap: 30px; /* Espacio entre elementos */
           grid-template-areas:
                "details visuals"
                "details video";
           grid-template-columns: 1.2fr 1fr; /* Ajustamos tamaño de columnas */
           align-items: start; /* Alinea arriba los elementos */
        }
         @media (max-width: 1024px) {
             .projectx-container {
                 grid-template-areas:
                     "visuals"
                     "details"
                     "video";
                  grid-template-columns: 1fr; /* Una columna en tablet */
             }
         }
          @media (max-width: 768px) {
              .projectx-container {
                  grid-template-areas:
                      "details"
                      "visuals"
                      "video";
                   grid-template-columns: 1fr; /* Una columna en movil */
              }
          }

        .projectx-details { grid-area: details; }
        .projectx-visuals { grid-area: visuals; }
        .projectx-video { grid-area: video; }

         /* Añadimos la clase content-box a los elementos internos del project X */
        .projectx-details,
        .projectx-visuals,
        .projectx-video {
             /* Inheriting from .content-box base style */
        }
         /* Removed specific hover for projectx inner elements if generic content-box hover is removed */
        /*
        .projectx-details:hover,
        .projectx-visuals:hover,
        .projectx-video:hover { }
        */


        .projectx-details h3,
        .projectx-visuals h3,
        .projectx-video h3 {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            color: var(--color-text); /* Titulo de bloque con color de texto principal */
            margin-bottom: 20px;
             text-shadow: 0 0 5px rgba(var(--color-accent-rgb), 0.1);
             border-bottom: 1px dashed var(--color-border); /* Separador subtitulo */
             padding-bottom: 10px;
        }
        .projectx-details h3 i,
        .projectx-visuals h3 i,
        .projectx-video h3 i { color: var(--color-accent); margin-right: 8px;}

        .projectx-details p {
            color: var(--color-muted);
            line-height: 1.6;
            margin-bottom: 20px;
             font-size: 0.95rem;
        }
        .projectx-details ul {
            list-style: none;
            padding-left: 0;
            display: grid; /* Layout grid para los items de lista */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* columnas adaptativas */
            gap: 10px; /* Espacio entre items */
        }
        .projectx-details li {
             font-family: var(--font-main);
             font-size: 0.85rem;
             color: var(--color-text);
             border: 1px solid var(--color-border);
             padding: 8px;
             border-radius: 3px;
             background: rgba(var(--color-accent-rgb), 0.05);
              box-shadow: inset 0 0 3px rgba(var(--color-accent-rgb), 0.1);
        }
        .projectx-details li strong {
             color: var(--color-accent);
             margin-right: 5px;
             letter-spacing: 0.5px;
        }

        .projectx-visuals .gallery { /* Layout para imágenes en el visualizador */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Grid adaptativo para miniaturas */
            gap: 10px; /* Espacio entre imágenes */
        }
        .projectx-visuals img {
            border: 1px solid var(--color-border);
            border-radius: 3px;
            opacity: 0.8;
            transition: opacity var(--transition-fast), transform var(--transition-fast), border-color var(--transition-fast); /* Added border-color */
             object-fit: cover; /* Cubrir el área asignada */
             height: 100px; /* Altura fija para las miniaturas */
        }
        .projectx-visuals img:hover {
            opacity: 1;
             transform: scale(1.05);
             border-color: var(--color-accent);
        }

        .projectx-video video {
            border: 1px solid var(--color-border);
            border-radius: 5px;
             box-shadow: 0 0 10px rgba(var(--color-accent-rgb), 0.2);
        }


        /* VISUALIZADOR MUSICA (Del 1er archivo, adaptado) */
         .music-visualizer { /* Mantenemos la clase y estructura, adaptamos estilo */
            position: fixed; /* Fijo */
            bottom: 15px; /* Alinear con el HUD */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: flex-end;
            height: 30px; /* Altura */
            gap: 3px; /* Espacio entre barras */
            z-index: 1000; /* Por encima del contenido, debajo del HUD fijo */
             pointer-events: none; /* No capturar clicks */
         }
         .music-visualizer .bar {
            width: 4px; /* Ancho barra */
            height: 2px; /* Altura inicial */
            background: var(--color-accent);
            transition: height 0.2s ease-out; /* Animacion de altura */
            box-shadow: var(--hud-glow); /* Glow */
            /* Animacion base para darle vida incluso sin audio data */
            animation: wave 1.5s ease-in-out infinite;
         }
         /* Delay en la animacion base */
         .music-visualizer .bar:nth-child(1) { animation-delay: 0s; }
         .music-visualizer .bar:nth-child(2) { animation-delay: 0.1s; } /* Adjusted delays */
         .music-visualizer .bar:nth-child(3) { animation-delay: 0.2s; }
         .music-visualizer .bar:nth-child(4) { animation-delay: 0.3s; }
         .music-visualizer .bar:nth-child(5) { animation-delay: 0.4s; }

         @keyframes wave {
            0%, 100% { height: 2px; }
            50% { height: 20px; }
         }
        /* Si JS actualizara las alturas, esta animación base sería override */


         /* PANEL PREFERENCIAS (Del 1er archivo, adaptado) */
        .preferences-panel { /* Mantenemos clase, adaptamos estilo */
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%) translateX(calc(100% - 30px)); /* Default state is closed visually */
            width: 200px; /* Ancho */
            background: rgba(var(--color-bg), 0.9); /* Fondo opaco */
            border: 1px solid var(--color-border);
            border-right: none; /* Sin borde derecho */
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            padding: 15px;
            z-index: 1003; /* Por encima del header */
            transition: transform 0.3s ease-in-out;
            box-shadow: -5px 0 15px rgba(0,0,0,0.3), -5px 0 10px var(--color-accent-glow); /* Sombra y glow hacia la izquierda */
             /* Add check for JS controlled visibility class */
             /* transform is used for the transition state, closed/open controlled via JS */
        }

        .preferences-panel.open { /* Use 'open' class controlled by JS toggle */
             transform: translateY(-50%) translateX(0%); /* State when open */
        }


        .preferences-toggle { /* Boton de toggle */
            position: absolute;
            left: -30px; /* Superpone 30px del panel */
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 50px;
            background: rgba(var(--color-bg), 0.9);
            border: 1px solid var(--color-border);
            border-right: none;
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-accent);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1004; /* Asegurar que este clickable */
             box-shadow: -3px 0 8px rgba(0,0,0,0.3);
        }
        .preferences-toggle:hover {
            background: rgba(var(--color-bg), 0.95);
            color: var(--color-text);
        }
         .preferences-toggle i { transition: transform 0.3s ease-in-out; }
         /* Rotate icon based on the panel's state */
         .preferences-panel.open .preferences-toggle i { transform: translateY(-50%) rotate(180deg); }
          /* Reset rotation for mobile breakpoint later if needed */


        .preferences-panel h4 {
            font-family: var(--font-heading);
            font-size: 1.2rem;
            color: var(--color-accent);
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--color-border);
        }
        .preferences-panel h4 i { margin-right: 5px; color: var(--color-text); }

        /* Estilo para checkboxes y labels (form-check) - Adaptado de estilos genéricos o originales */
        .form-check {
            display: flex; /* Usar flex para alinear */
            align-items: center;
            margin-bottom: 10px;
            color: var(--color-text);
            font-family: var(--font-main);
            font-size: 0.9rem;
        }

        .form-check-input {
            /* Ocultar input nativo y usar CSS para el diseño */
            appearance: none;
            -webkit-appearance: none;
            width: 16px; /* Tamaño custom */
            height: 16px;
            border: 1px solid var(--color-border);
            border-radius: 3px;
            background-color: rgba(var(--color-accent-rgb), 0.1); /* Fondo */
            margin-right: 8px;
            cursor: pointer;
            position: relative;
            transition: background-color var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
             flex-shrink: 0; /* Evitar que se encoja */
        }
        .form-check-input:checked {
            background-color: var(--color-accent); /* Fondo al check */
            border-color: var(--color-accent);
             box-shadow: var(--hud-glow); /* Glow al check */
        }
        .form-check-input:focus { /* Estilo focus para accesibilidad */
            outline: none;
            box-shadow: 0 0 5px var(--color-accent-glow);
        }
        /* Crear el checkmark con pseudo-elemento */
        .form-check-input::after {
            content: '';
            position: absolute;
            top: 2px; left: 5px;
            width: 4px;
            height: 8px;
            border: solid var(--color-bg); /* Color del checkmark */
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            display: none; /* Oculto por defecto */
        }
        .form-check-input:checked::after {
            display: block; /* Mostrar al check */
        }


        .form-check-label {
            cursor: pointer;
            color: var(--color-muted);
            transition: color var(--transition-fast);
             flex-grow: 1; /* Permitir que ocupe espacio */
        }
         .form-check-input:checked + .form-check-label {
             color: var(--color-text); /* Texto principal si está checked */
         }
         .form-check:hover .form-check-label {
             color: var(--color-accent); /* Texto acentuado al hover de la línea */
         }
         .form-check:hover .form-check-input {
              border-color: var(--color-text);
         }

        /* Testimonials (Example) - Needs full HTML Structure */
         /* Testimonial container/grid might inherit section-container or have own grid layout */
        /* .testimonial-grid { ... display: grid or flex } */
         /* .testimonial { /* inherits content-box */
             /* text-align: center;
             opacity: 0; /* For carousel display logic */
            /* transition: opacity var(--transition-medium) ease; */
             /* position: absolute or related for stacking */
         /* } */
         /* .testimonial.active { opacity: 1; z-index: 1; } /* Or simply control visibility/position */

        /* Apply .section-container class to all logical sections */
         #about, #skills, #certifications, #downloads, #faqs {
            padding: 100px 5%;
             max-width: 1400px;
             margin: 0 auto;
             margin-top: 80px; /* Use standard section spacing */
             border-top: 1px solid var(--color-border); /* Use standard separator */
             padding-top: 80px;
             position: relative;
         }


        /* Estilo del footer (Del 1er archivo, adaptado con estilos del 2do) */
         #contact { /* Footer original, con ID #contact, pero con estilos del 2do archivo */
            /* Remove original flex and full width for footer */
             /* Position absolute/relative needs careful consideration depending on layout */
             position: relative;
             z-index: 5; /* Above background video/overlay */
         }
         /* Utilizamos la clase main-footer del 2do archivo en lugar del ID #contact para los estilos */
         .main-footer {
            background: rgba(var(--color-bg), 0.7);
            border-top: 1px solid var(--color-border);
            padding: 20px 5%;
            text-align: center;
            font-size: 0.8rem;
            color: var(--color-muted);
            position: relative; /* or static/relative según la estructura */
            z-index: 5;
            width: 100%;
             /* Asegurarse de que quede al final si mainContent tiene suficiente altura */
             /* bottom: 0; left: 0; */ /* solo si position fixed/absolute */
             margin-top: 80px; /* Space above footer */
             padding-top: 20px; /* Space inside footer after potential margin-top */
        }
         .main-footer p { margin-bottom: 10px; }
         .footer-links { margin-bottom: 10px; }
         .footer-links a.hud-link { /* Ensure styles are applied */
              /* inherited styles from hud-link small, may override padding/margin slightly */
              padding: 0 5px;
              margin: 0 5px; /* Add space between links */
              display: inline-block;
         }
        .social-links { margin-top: 15px; } /* Space above social icons */
         .social-links a.hud-link.social i { font-size: 1.2rem; } /* Inherited from social style */


         /* EASTER EGG (Del 1er archivo, adaptado) */
         .easter-egg-msg {
             position: fixed;
             bottom: 70px; /* Ajustar posición para no chocar con footer/HUD/Visualizer */
             left: 20px;
             z-index: 1004;
             background: rgba(var(--color-accent-rgb), 0.2);
             border: 1px solid var(--color-accent);
             padding: 10px 15px;
             color: var(--color-text);
             font-family: var(--font-main);
             font-size: 0.9rem;
             border-radius: 4px;
             opacity: 0; /* Controlado por JS (si se implementa) */
             transition: opacity 0.5s ease-out, transform 0.5s ease-out;
             pointer-events: none; /* No interactivo */
             box-shadow: 0 0 8px rgba(var(--color-accent-rgb), 0.4);
             transform: translateX(-20px); /* Slight starting position for animation */
         }
         .easter-egg-msg.visible {
             opacity: 1;
              transform: translateX(0);
         }
        /* If no JS, maintain hidden or style="display: none;" */


         /* Modales (Del 2do archivo) */
        .modal {
          display: none; /* Controlled by JS */
          position: fixed;
          z-index: 10002; /* On top of filter panel */
          left: 0; top: 0; width: 100%; height: 100%;
          background: rgba(0, 0, 0, 0.8);
          backdrop-filter: blur(8px);
          -webkit-backdrop-filter: blur(8px);
          align-items: center; justify-content: center;
           /* Ensure they start off-screen slightly for animation */
            opacity: 0;
            transition: opacity var(--transition-medium) ease;
            padding: 20px; /* Allow padding on smaller screens */
        }
        .modal.open {
            display: flex; /* Change to flex to show and center */
            opacity: 1;
        }

        .modal-content { /* Applies content-box styles implicitly or explicitly */
          position: relative;
          padding: 30px;
          width: 95%; /* Slightly larger max width on smaller screens */
          max-width: 600px;
          border-radius: 5px;
          /* animation: modal-fadein var(--transition-medium) ease forwards; */ /* Removed animation on the content box itself, modal container class handles fadein */

           /* Ensure inheriting/applying content-box styles */
           background: var(--color-glass-bg);
           border: 1px solid var(--color-border);
           backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
           box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            /* Removed transform, relying on modal.open state opacity+display transition */
            /* Or add back a specific transition on modal-content itself if desired */
             transition: transform var(--transition-medium) ease, opacity var(--transition-medium) ease; /* Add transitions */
              transform: scale(0.9); /* Initial state */
        }
        /* Re-add transition triggered by modal parent's class change */
         .modal.open .modal-content {
             transform: scale(1);
         }


        /* Removed animation keyframes on content box itself */
        /* @keyframes modal-fadein { } */


        .close-modal {
          position: absolute;
          top: 10px; right: 15px;
          font-size: 2rem;
          color: var(--color-muted);
          cursor: pointer;
          transition: color var(--transition-fast);
          line-height: 1;
          z-index: 1;
        }
        .close-modal:hover { color: var(--color-accent); }
        .modal-content h3 { color: var(--color-accent); margin-bottom: 15px; font-size: 1.4rem; font-family: var(--font-heading); }
        .modal-content p { color: var(--color-text); line-height: 1.6; margin-bottom: 10px; font-size: 0.9rem; font-family: var(--font-main); }
         .modal-content p strong { color: var(--color-accent); }
        .modal-content p:last-of-type { margin-bottom: 0; }
        .modal-content a.hud-link { display: inline-block; margin-top: 15px; font-size: 0.9rem; } /* Style download/verification link */

         /* Styles for .reveal animation - Already copied from 2nd file */
        .reveal {
          opacity: 0;
          transform: translateY(40px); /* Un poco más de desplazamiento */
          transition: opacity 0.8s cubic-bezier(0.645, 0.045, 0.355, 1), /* Ease-in-out */
                      transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
           /* Optional: transition delay for staggered reveal */
           transition-delay: var(--reveal-delay, 0s);
        }
         /* Adding data-reveal-delay to sections will set --reveal-delay variable */
         /* section.reveal { transition-delay: attr(data-reveal-delay calc) } Needs advanced CSS features */
         /* Easier: Control staggered delays with JS or apply distinct classes */
         /* .reveal:nth-child(odd) { transition-delay: 0.1s; } .reveal:nth-child(even) { transition-delay: 0.2s; } */ /* Simple example, needs refinement based on layout */
         /* Let JS manage staggered delay on element level */


        .reveal.visible {
          opacity: 1;
          transform: translateY(0);
           transition-delay: 0s; /* Remove delay once visible */
        }
        /* Reset visibility when hidden for repeat animation */
        /* .reveal:not(.visible) { transition: none; } Needs IntersectionObserver to remove visible on exit */


        /* MEDIA QUERIES - Copiado y ligeramente ajustado del 2do archivo */
        @media (max-width: var(--tablet-break)) {
          html { font-size: 15px; } /* Ajustar base */
          .hud-readout { font-size: 0.7rem; padding: 4px 8px; }
          .top-left-readout { top: 70px; left: 15px; } /* Reposicionar readouts */
          .top-right-readout { top: 70px; right: 15px; }
          .bottom-left-readout { bottom: 60px; left: 15px; }
          .bottom-right-readout { bottom: 60px; right: 15px; }
          .section-container { padding: 80px 4%; }
          .main-content-wrapper { padding-top: 100px; padding-bottom: 60px; } /* Ajuste padding por header+HUD */
          #mainHeader { padding: 10px 20px; }
          .branding a { font-size: 1.4rem; }
          .projectx-container { grid-template-columns: 1fr; grid-template-areas: "visuals" "details" "video"; } /* Una columna */
           #about .about-content { grid-template-columns: 1fr; grid-template-areas: "image" "text"; } /* About grid */
            #about .about-image { grid-area: image; }
             #about .about-text { grid-area: text; }
           .skills-grid, .certifications-grid, .downloads-grid, .faqs-container { /* Added placeholder sections */
               grid-template-columns: 1fr; /* Single column */
           }

        }

        @media (max-width: var(--mobile-break)) {
          html { font-size: 14px; }
          body { cursor: default; } /* Quitar cursor custom en móvil */
          .hud-corner { display: none; } /* Ocultar esquinas */
          .hud-line { display: none; } /* Ocultar líneas */
          .hud-readout { display: none; } /* Ocultar readouts */
          .main-content-wrapper { padding-top: 70px; padding-bottom: 20px; } /* Menos padding */
          #mainHeader { padding: 8px 15px; }
          .branding a { font-size: 1.3rem; }
          .header-controls { gap: 5px; }
          .hud-button, .hud-link { padding: 6px 10px; font-size: 0.7rem; } /* Combined */
          #muteButton { padding: 6px; }
           #muteButton svg { width: 16px; height: 16px;} /* Adjust size */
            #muteButton.muted svg.mute-slash { width: 20px; height: 20px; } /* Adjust slash size */
          .filter-panel { width: 95%; max-width: none; max-height: 85vh; padding: 20px;} /* Ajuste panel filtro movil */
          .filter-panel .filter-link { font-size: 1rem; padding: 8px 10px;} /* Adjust menu link style */

           .hero { min-height: auto; padding: 100px 5% 50px 5%; } /* Allow shorter hero on small screens */
          .hero h1 { font-size: clamp(2rem, 7vw, 4rem); letter-spacing: 0.02em; } /* Adjust hero title size */
           .hero-subtitle { font-size: 0.9rem; }
          .scroll-down-indicator { bottom: 20px; font-size: 1.2rem; }
          .section-container { padding: 60px 5%; margin-top: 60px; padding-top: 60px;} /* Adjust section padding/spacing */
          .section-container:not(:first-child) { margin-top: 60px; padding-top: 60px;}
          .section-title { margin-bottom: 40px; font-size: clamp(1.8rem, 6vw, 2.5rem); }
           .internal-search { flex-direction: column; gap: 10px; margin-bottom: 30px;} /* Adjust search layout */
           .internal-search input { width: 100%; max-width: 280px; font-size: 0.9rem;} /* Adjust search input */
           .internal-search button { font-size: 0.8rem; padding: 8px 15px;} /* Adjust search button */

           /* Project X Layout Adjust */
           .projectx-container { grid-template-areas: "details" "visuals" "video"; grid-template-columns: 1fr; gap: 20px; }
            .projectx-details, .projectx-visuals, .projectx-video { padding: 20px; }
            .projectx-details h3, .projectx-visuals h3, .projectx-video h3 { font-size: 1.3rem; margin-bottom: 15px; padding-bottom: 8px; }
             .projectx-details ul { grid-template-columns: 1fr; } /* List one per line */

           /* Adjust placeholder section layouts on mobile */
           #about .about-content { grid-template-columns: 1fr; gap: 20px;}
           .skills-grid, .certifications-grid, .downloads-grid, .faqs-container { gap: 15px; }
            .skill-item, .certificate-card, .download-item, .faq-item { padding: 15px; }
            .skill-item h4, .faq-question { font-size: 1rem; }

           /* Music Visualizer on mobile - maybe hide or reposition */
           .music-visualizer { display: none; /* Hide on small screens */ }

           /* Adapt preferences panel on smaller screens */
           .preferences-panel {
               top: auto; bottom: 0; transform: translateY(calc(100% - 40px)); /* Hide all but 40px at bottom by default */
               width: 100%; max-width: none;
               border-right: 1px solid var(--color-border); /* Add border back */
               border-top-left-radius: 5px; border-top-right-radius: 5px; /* Rounded top corners */
               border-bottom-left-radius: 0; border-bottom-right-radius: 0; /* Straight bottom edge */
               padding: 15px; padding-bottom: 50px; /* Space above bottom edge to clear toggle */
               box-shadow: 0 -5px 15px rgba(0,0,0,0.3), 0 -5px 10px var(--color-accent-glow); /* Shadow/glow upwards */
           }
            /* Mobile open state */
           .preferences-panel.open { transform: translateY(0%); }

           .preferences-toggle {
               position: absolute; /* Position relative to panel for mobile */
               left: 50%; /* Center bottom */
               transform: translateX(-50%) translateY(0%);
               bottom: 10px; top: auto; /* Position at the bottom edge */
               width: 80px; height: 30px; /* Wider, shorter button for mobile */
               background: rgba(var(--color-bg), 0.95);
               border: 1px solid var(--color-border);
               border-left: 1px solid var(--color-border); /* Add all borders back */
                border-radius: 5px; /* Fully rounded */
               box-shadow: 0 3px 8px rgba(0,0,0,0.3);
               z-index: 1; /* Relative z-index inside panel */
               padding: 0;
           }
           /* Icon rotation on mobile: rotate up/down */
           .preferences-panel.open .preferences-toggle i { transform: none; } /* No rotate icon on open */
           .preferences-panel.closed .preferences-toggle i { transform: rotate(180deg); } /* Rotate icon when closed (down arrow) */


           .modal-content { width: 95%; padding: 20px; }
           .close-modal { top: 5px; right: 10px; font-size: 1.5rem;} /* Adjust close button */

            .main-footer { padding: 15px 5%; font-size: 0.7rem; margin-top: 60px; padding-top: 15px;} /* Footer on mobile */
            .main-footer p { margin-bottom: 8px; }
             .social-links { margin-top: 10px; }
             .social-links a.hud-link.social i { font-size: 1rem;}
        }

      /* Aquí termina el CSS puro. El JS de efectos visuales y menú lateral se moverá a <script> al final del <body> */
      </style>
       <style>    
      /* ACCESIBILIDAD */
      :focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; }
      button, [tabindex]:not([tabindex="-1"]) { outline: none; }

      .modal[role="dialog"] { outline: none; }
      .modal { role: dialog; aria-modal: true; }
      .notification-container { role: status; aria-live: polite; }

      /* Contraste mejorado para textos secundarios */
      [data-theme="light"] .section-title, [data-theme="light"] .hud-readout, [data-theme="light"] .skill-level-text, [data-theme="light"] .certificate-card p, [data-theme="light"] .download-item p {
        color: #222 !important;
      }

      /* PERFORMANCE Y BUENAS PRÁCTICAS */
      img:not([loading]), video:not([loading]) { loading: lazy; }
      @media (prefers-color-scheme: dark) {
        html[data-theme="dark"] { background: var(--color-bg); color: var(--color-text); }
      }
      @media (prefers-color-scheme: light) {
        html[data-theme="light"] { background: var(--color-bg); color: var(--color-text); }
      }

      /* DISEÑO VISUAL AVANZADO */
      .reveal { transition-delay: var(--reveal-delay, 0s); }
      .reveal.visible { box-shadow: 0 0 24px 4px var(--color-accent-glow), 0 0 0 2px var(--color-accent-dark); }
      .content-box, .hud-button, .hud-link { box-shadow: 0 2px 16px 0 rgba(var(--color-accent-rgb), 0.15), 0 0 8px 0 var(--color-accent-glow); }
      .hud-button:active, .hud-link:active { filter: brightness(1.2); }
      .content-box { background: rgba(var(--color-bg), 0.25); backdrop-filter: blur(18px); }
      @keyframes microRipple { 0% { box-shadow: 0 0 0 0 var(--color-accent-glow); } 100% { box-shadow: 0 0 0 12px rgba(0,0,0,0); } }
      .hud-button:active::after, .hud-link:active::after { animation: microRipple 0.4s; }

      /* NAVEGACIÓN Y USABILIDAD */
      #scrollTopBtn { position: fixed; right: 20px; bottom: 80px; z-index: 2000; background: var(--color-accent); color: var(--color-bg); border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 2px 8px #0008; cursor: pointer; transition: background 0.2s; }
      #scrollTopBtn:hover { background: var(--color-accent-dark); }
      @media (max-width: 900px) { .side-nav-compact { left: -60px; } .side-nav-compact.open { left: 0; } .side-nav-toggle-btn { display: block; } }
      @media (max-width: 600px) { .side-nav-compact { top: auto; bottom: 70px; left: 0; flex-direction: row; border-radius: 0 0 8px 8px; padding: 4px 8px; } }
      html { scroll-behavior: smooth; }

      /* ORGANIZACIÓN Y ESCALABILIDAD */
      /* Ejemplo de BEM para sección skills */
      .skills__grid {}
      .skills__item {}
      .skills__bar {}
      .skills__level {}
      /* Repite para otras secciones si lo deseas */
      
     </style>
     
</head>

<body id="bodyElement">

  <!-- ============================================================
       PANTALLA DE CARGA AVANZADA (Del 2do archivo)
       ------------------------------------------------------------
       Reemplaza el loader simple del 1er archivo. Agregamos las decoraciones.
  ============================================================ -->
  <div class="loader-overlay active" id="loaderOverlay">
      <!-- Añadido: Elementos decorativos para el loader avanzado -->
      <div class="loader-hud-border"></div>
      <div class="loader-scanline"></div>
    <div class="loader-content">
      <div class="loader-logo">[ CYBER_INIT ]</div>
      <!-- Mantienen IDs del HTML original que coinciden con los del 2do archivo conceptual -->
      <div class="loader-text" id="loaderText">BOOTING SYSTEM...</div>
      <div class="loader-bar-container">
        <div class="loader-bar" id="loaderBar"></div>
      </div>
      <div class="loader-percentage" id="loaderPercentage">0%</div>
      <div class="loader-subtext" id="loaderSubtext">Verifying integrity...</div>
    </div>
  </div>

    <!-- Video de Fondo (Del 2do archivo) -->
    <!-- Asegúrate de tener este video y la ruta correcta -->
    <video autoplay muted loop playsinline id="bg-video">
        <source src="Proyecto x/src/video/videoplayback (2).mp4" type="video/mp4">
        Tu navegador no soporta videos.
    </video>


  <!-- ============================================================
       ELEMENTOS DEL HUD (Heads-Up Display - Del 2do archivo)
       ------------------------------------------------------------
       Capas visuales fijas para dar la sensación de interfaz. AÑADIDO.
  ============================================================ -->
  <!-- La clase 'visible' se añadirá por JS cuando el loader termine -->
  <div class="hud-overlay" id="hudOverlay">
    <!-- Esquinas Decorativas -->
    <div class="hud-corner top-left"></div>
    <div class="hud-corner top-right"></div>
    <div class="hud-corner bottom-left"></div>
    <div class="hud-corner bottom-right"></div>

    <!-- Líneas Decorativas -->
    <div class="hud-line top"></div>
    <div class="hud-line bottom"></div>
    <div class="hud-line left"></div>
    <div class="hud-line right"></div>

    <!-- Readouts de Información (Con IDs para JS si se usan) -->
    <!-- Mantienen la estructura del CSS conceptual, ajustados los IDs si es necesario -->
    <div class="hud-readout top-left-readout">
      <span>STATUS:</span> <span class="hud-ok">ONLINE</span>
    </div>
    <div class="hud-readout top-right-readout" id="hudClock"> <!-- Usado por JS -->
      --:--:--
    </div>
     <!-- Idea: Readout de usuario/sistema ID. Puede ser estático. -->
    <div class="hud-readout bottom-left-readout">
       <span>SYS_ID:</span> JAE.M_2077_v3.4
    </div>
     <!-- Indicador de scroll, usado por JS -->
    <div class="hud-readout bottom-right-readout" id="hudScrollIndicator">
      <span>SCROLL:</span> 0%
    </div>
      <!-- Ideas adicionales de readouts -->
      <!-- <div class="hud-readout" style="position: absolute; top: calc(15px + var(--hud-corner-size)); left: calc(15px + var(--hud-corner-size));">NET: STABLE</div> -->
      <!-- <div class="hud-readout" style="position: absolute; bottom: calc(15px + var(--hud-corner-size)); right: calc(15px + var(--hud-corner-size));">SECTOR: NIGHTCITY</div> -->
  </div>


  <!-- NAVEGACIÓN SUPERIOR (Del 1er archivo, reestructurado con estilos del 2do) -->
  <!-- La clase 'visible' se añadirá por JS cuando el loader termine -->
  <header id="mainHeader"> <!-- Usando el ID original, JS añadirá 'visible' -->
    <div class="branding"> <!-- Usando la estructura del 2do archivo -->
       <!-- Enlace al inicio, llama playSound al click (funcionalidad via JS) -->
       <a href="../index.html" onclick="playSound('uiClickAudio')">[ EVIDENCE // 2077 ]</a>
    </div>

    <div class="header-controls"> <!-- Controles del header, del 2do archivo -->
         <!-- Botón Mute (Del 2do archivo), con ID y íconos correctos -->
         <!-- Iconos SVGs simplificados para compatibilidad/inline -->
         <button class="hud-button small" id="muteButton" aria-label="Silenciar Sonidos">
           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 10.759v2.5c0 .553.448 1 .999 1H4.999c.552 0 1-.447 1-1v-2.5c0-.552-.448-1-1-1H4c-.552 0-1 .448-1 1zM7.06 7.303v9.415c0 .552.448 1 1 1h.001c.552 0 1-.448 1-1V7.303c0-.552-.448-1-1-1h-.001c-.552 0-1 .448-1 1zM10.999 3.759v16.49c0 .553.448 1 1 1h.002c.552 0 1-.447 1-1V3.759c0-.552-.448-1-1-1h-.002c-.552 0-1 .448-1 1zM15.06 7.303v9.415c0 .552.448 1 1 1h.001c.552 0 1-.448 1-1V7.303c0-.552-.448-1-1-1h-.001c-.552 0-1 .448-1 1zM19 10.759v2.5c0 .553.448 1 1 1h.001c.552 0 1-.447 1-1v-2.5c0-.552-.448-1-1-1h-.001c-.552 0-1 .448-1 1z"/>
           </svg>
           <!-- SVG para la barra de mute, visible cuando está muteado -->
           <svg class="mute-slash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
               <path d="M4.75736 3.34315L3.34315 4.75736L19.2426 20.6569L20.6569 19.2426L4.75736 3.34315Z" />
           </svg>
         </button>
         <!-- Botones de Tema e Idioma (Del 2do archivo) - Elimina "Ciclar Tema Matrix" -->
         <button class="hud-button small" id="themeToggle" aria-label="Cambiar Tema">LGT</button> <!-- Texto inicial controlado por JS -->
         <button class="hud-button small" id="langToggle" aria-label="Cambiar Idioma">EN</button> <!-- Texto inicial controlado por JS -->

         <!-- Botón Menú/Filtro (Del 2do archivo) -->
         <div class="filter-container">
           <button class="hud-button" id="filter-btn" aria-label="Abrir menú de navegación">
             NAV_MENU
           </button>
         </div>
      </div>
  </header>

    <!-- Contenedor Notificaciones (Del 1er archivo) - Estilizado -->
    <!-- Mantiene la estructura original y el ID -->
   <div id="notificationContainer" class="notification-container" aria-live="polite">
        <!-- Notificaciones se añadirán aquí dinámicamente con JS (implementación básica en JS) -->
   </div>


   <!-- INTRO SECTION (Del 1er archivo - Removido HTML) -->
   <!-- Sección INTRO (pre-scroll) eliminada como se insinúa que ya no se usa -->


  <!-- ============================================================
       CONTENEDOR PRINCIPAL DEL CONTENIDO (Del 2do archivo)
       ------------------------------------------------------------
       Todo el contenido del portafolio va dentro de este wrapper.
       Excluye elementos fijos como loader, HUD, Header, Modales. AÑADIDO.
  ============================================================ -->
   <!-- La clase 'visible' se añadirá por JS cuando el loader termine -->
   <div class="main-content-wrapper" id="mainContent">

      <!-- HERO (Del 1er archivo, estilizado con el 2do) -->
      <!-- Añadidas clases 'section-container' (opcional si quieres que el padding lo defina el wrapper o esta sección) y 'reveal' para la animación -->
      <section class="hero reveal" id="hero">
         <!-- Mantenido contenedor original, añadida clase para posible animación/selector JS -->
         <div class="hero-content animation-trigger">
             <!-- Mantienen IDs originales, añade data-text para el glitch CSS -->
             <h1 class="hero-title animation-trigger" data-text="EVIDENCIAS // 2077" id="heroTitle">EVIDENCIAS // 2077</h1>
             <!-- Mantiene ID original -->
             <p class="hero-subtitle animation-trigger" id="heroSubtitle">
                 Navega a través de los fragmentos de código y diseño recuperados. La Red es vasta, la información espera. Cuidado con el Black ICE.
             </p>
             <!-- Mantiene clase original, añade clases de estilo HUD por JS, añade playSound -->
             <button class="btn-hero" onclick="document.getElementById('proyectoX').scrollIntoView({ behavior: 'smooth' }); playSound('click')">Explorar Archivos</button>
         </div>
         <!-- Scroll Down Indicator (Añadido desde 2do archivo) -->
         <a href="#proyectoX" class="scroll-down-indicator" aria-label="Scroll a Proyecto X">▼</a>
      </section>

      <!-- Idea de SECCION: ABOUT ME -->
       <section id="about" class="section-container reveal">
           <h2 class="section-title animation-trigger"><i class="fas fa-user"></i> Sobre Mí /// User_Profile</h2>
           <div class="about-content content-box animation-trigger">
                <div class="about-text">
                    <h3><i class="fas fa-info-circle"></i> Registro Personal</h3>
                    <p>Desde las calles iluminadas con neón, opero como un puente entre el hardware recalcitrante y la sinergia de software elegante. Mi pasión por la codificación, el diseño y la gestión de proyectos es mi armamento principal en el laberíntico terreno digital de 2077. Busco nodos para reestructurar, datos para optimizar y conexiones para asegurar.</p>
                     <p>Mi historial operativo incluye el despliegue exitoso de simulaciones de redes seguras y el desarrollo de interfaces que combinan la estética futurista con la eficiencia implacable.</p>
                     <!-- Puedes añadir más párrafos o una lista de intereses clave -->
                </div>
                <div class="about-image content-box animation-trigger">
                     <h3><i class="fas fa-id-card-alt"></i> Acceso Verificado</h3>
                     <!-- Usar data-src para lazy load -->
                     <img data-src="assets/img/gato.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Avatar de perfil Cyberpunk" loading="lazy">
                     <div class="image-hud-overlay">ID_SCAN: JOSE.ESPINOSA_MX</div>
                </div>
           </div>
       </section>

      <!-- Idea de SECCION: SKILLS -->
       <section id="skills" class="section-container reveal">
            <h2 class="section-title animation-trigger"><i class="fas fa-wrench"></i> Habilidades /// Cybernetic_Enhancements</h2>
            <div class="skills-grid animation-trigger">
                <!-- Ejemplo de ítem de habilidad con barra de progreso (Usará JS) -->
                <div class="skill-item content-box reveal">
                    <h4>JAVASCRIPT <span class="skill-level-text" data-skill-level="90">90%</span></h4>
                    <div class="progress-bar-container"><div class="progress-bar-fill" data-skill-level="90"></div></div>
                </div>
                 <div class="skill-item content-box reveal">
                     <h4>HTML5 / CSS3 <span class="skill-level-text" data-skill-level="95">95%</span></h4>
                     <div class="progress-bar-container"><div class="progress-bar-fill" data-skill-level="95"></div></div>
                 </div>
                 <div class="skill-item content-box reveal">
                     <h4>GIT / GITHUB <span class="skill-level-text" data-skill-level="85">85%</span></h4>
                     <div class="progress-bar-container"><div class="progress-bar-fill" data-skill-level="85"></div></div>
                 </div>
                 <div class="skill-item content-box reveal">
                     <h4>UI/UX Design <span class="skill-level-text" data-skill-level="75">75%</span></h4>
                     <div class="progress-bar-container"><div class="progress-bar-fill" data-skill-level="75"></div></div>
                 </div>
                  <!-- Añadir más habilidades según sea necesario -->
                 <div class="skill-item content-box reveal">
                     <h4>NODE.JS <span class="skill-level-text" data-skill-level="70">70%</span></h4>
                     <div class="progress-bar-container"><div class="progress-bar-fill" data-skill-level="70"></div></div>
                 </div>
                 <div class="skill-item content-box reveal">
                     <h4>RESPONSIVE <span class="skill-level-text" data-skill-level="90">90%</span></h4>
                     <div class="progress-bar-container"><div class="progress-bar-fill" data-skill-level="90"></div></div>
                 </div>
            </div>
       </section>

      <!-- Idea de SECCION: CERTIFICACIONES / CREDENCIALES -->
       <section id="certifications" class="section-container reveal">
            <h2 class="section-title animation-trigger"><i class="fas fa-award"></i> Credenciales /// Verification_Keys</h2>
            <div class="certifications-grid animation-trigger">
                 <!-- Ejemplo de tarjeta de certificado con un trigger para modal -->
                 <div class="certificate-card content-box reveal">
                     <h4>IBM Web Dev Foundations</h4>
                     <p>Curso base sobre tecnologías web esenciales.</p>
                     <!-- Usa clase modal-trigger y data-modal-id para abrir el modal. Asegura el id del modal coincida. -->
                     <button class="hud-button small modal-trigger" data-modal-id="modal-cert1">Detalles & ID</button>
                 </div>
                 <div class="certificate-card content-box reveal">
                      <h4>IBM Generative AI</h4>
                      <p>Capacitación en IA generativa aplicada a desarrollo.</p>
                     <button class="hud-button small modal-trigger" data-modal-id="modal-cert2">Detalles & ID</button>
                 </div>
                 <div class="certificate-card content-box reveal">
                     <h4>IBM Git & GitHub</h4>
                     <p>Maestría en control de versiones con Git/GitHub.</p>
                     <button class="hud-button small modal-trigger" data-modal-id="modal-cert3">Detalles & ID</button>
                 </div>
                 <div class="certificate-card content-box reveal">
                      <h4>Google Cybersecurity</h4>
                      <p>Fundamentos de ciberseguridad y protección.</p>
                      <button class="hud-button small modal-trigger" data-modal-id="modal-cert4">Detalles & ID</button>
                 </div>
                 <!-- Añadir más tarjetas de certificados si tienes -->
            </div>
       </section>


      <!-- PROYECTO X (Del 1er archivo, estilizado con clases del 2do archivo) -->
      <!-- Añadidas clases section-container y reveal -->
      <section class="section-container reveal" id="proyectoX">
        <!-- Añadida clase section-title y animation-trigger -->
        <h2 class="section-title animation-trigger"><i class="fas fa-project-diagram"></i> Proyecto X // Classified</h2>

        <!-- Añadida área de búsqueda interna - Idealmente para una lista de proyectos, pero puesta aquí como ejemplo -->
         <div class="internal-search animation-trigger reveal">
             <input type="text" id="searchProjectInput" placeholder="SEARCH: File ID, Description, Tag...">
              <button class="hud-button" id="searchProjectBtn">EXECUTE_SEARCH</button>
         </div>
          <!-- Nota: La lógica de búsqueda añadida buscará elementos con clase '.project-item' dentro de un contenedor con ID 'projectGrid'. Tendrás que añadir esta estructura si tienes más proyectos listados de forma repetitiva, o adaptar la lógica de búsqueda para buscar dentro de las .content-box si eso es lo que quieres filtrar. Actualmente, el Proyecto X es una sola sección compleja. El script buscará elementos con `.project-item` - asume que tendrás más, y #proyectoX quizás NO sea #projectGrid completo. Adapta esto si necesitas filtrar *dentro* de los divs de ProyectoX. Por ahora, el script está configurado para buscar en items listados repetitivamente. Si solo tienes ProyectoX, esta búsqueda no hará nada por defecto sobre el contenido de ProyectoX a menos que se adapte la función `filterProjects`. Voy a añadir el ID #projectGrid a .projectx-container temporalmente para demostrar cómo podría funcionar si ProjectX fuera un grid de items. BORRA ESTO y ADAPTA SI PROYECTOX NO ES UNA LISTA REPETIDA. -->

        <div class="projectx-container" id="projectGrid"> <!-- Añadido ID para el JS de búsqueda de ejemplo, ADAPTAR/BORRAR si #proyectoX no es el contenedor de la lista de proyectos a buscar -->
          <!-- Añadidas clases content-box y animation-trigger para el estilo y animación -->
          <div class="projectx-details content-box animation-trigger reveal animate-slide-in-left">
            <h3><i class="fas fa-microchip"></i> Core Logic & Data</h3>
            <p>Simulación neural avanzada para análisis predictivo de flujos de datos en la Red. Implementa algoritmos de cifrado cuántico y evasión de ICE.</p>
            <ul>
              <li><strong>Motor:</strong> Quantum Weaver X</li> <li><strong>IA:</strong> Cerebrus v7.1</li>
              <li><strong>Red:</strong> GhostNet Secure Channel</li> <li><strong>Defensa:</strong> Chimera ICE Breaker Suite</li>
            </ul>
              <!-- Ejemplo de un link interno a otra sección o un hud-link general -->
              <a href="#about" class="hud-link small">View Related Protocols</a>
          </div>
          <!-- Añadidas clases content-box y animation-trigger para el estilo y animación -->
          <div class="projectx-visuals content-box animation-trigger reveal animate-fade-scale-up">
            <h3><i class="fas fa-palette"></i> Interface Visuals</h3>
            <div class="gallery">
                <!-- Usar data-src para lazy load -->
              <img data-src="assets/img/cyberpunk.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Interfaz Holográfica" />
              <img data-src="assets/img/panel2.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Esquema Neural" />
              <img data-src="assets/img/panel3.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Visualización Datos" />
              <img data-src="assets/img/gotic.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Esquema Hardware" />
              <img data-src="assets/img/blanca como la nieve.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Acceso Biométrico"/>
              <img data-src="assets/img/celestial.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Núcleo Energía"/>
            </div>
          </div>
          <!-- Añadidas clases content-box y animation-trigger para el estilo y animación -->
          <div class="projectx-video content-box animation-trigger reveal animate-slide-in-right">
            <h3><i class="fas fa-play-circle"></i> Operational Demo</h3>
            <!-- Puedes usar data-src o mantener src. Lazy load para video requiere JS extra. -->
            <video controls preload="metadata" poster="src/img/panel_video_poster.jpg">
              <source src="Proyecto x/src/video/videoplayback (2).mp4" type="video/mp4" /> <!-- Asegura que esta ruta sea accesible -->
              Tu navegador no soporta la etiqueta de video.
            </video>
             <!-- Ejemplo de un trigger de modal si hubiera más detalles del video en un modal -->
             <!-- <button class="hud-button small modal-trigger" data-modal-id="modal-video-details">Ver Ficha Técnica</button> -->
          </div>
        </div>
           <!-- NOTA: Si tienes una sección con múltiples proyectos repetidos, deberían usar la estructura de `.project-item content-box` y un ID general `#projectGrid` envolviéndolos, y `.internal-search` podría ir al inicio de esa sección. Adapta según tu contenido. -->
      </section>

        <!-- Idea de SECCION: DESCARGAS -->
       <section id="downloads" class="section-container reveal">
            <h2 class="section-title animation-trigger"><i class="fas fa-download"></i> Descargas /// Data_Packages</h2>
            <div class="downloads-grid animation-trigger">
                 <!-- Ejemplo de ítem de descarga con trigger (Usará JS) -->
                 <div class="download-item content-box reveal">
                     <h4>System Analysis Report v1.2</h4>
                     <p>Informe detallado sobre la salud del sistema y vulnerabilidades detectadas.</p>
                     <button class="hud-button small download-trigger" data-file="docs/analysis-report-v1.2.pdf">Descargar</button>
                 </div>
                  <div class="download-item content-box reveal">
                      <h4>API Schema // NetSec-01</h4>
                      <p>Diagrama de esquema para la interfaz de seguridad de red.</p>
                     <button class="hud-button small download-trigger" data-file="docs/netsec-api-schema.zip">Descargar</button>
                  </div>
                 <!-- Añadir más ítems si tienes -->
            </div>
       </section>

        <!-- Idea de SECCION: FAQ -->
       <section id="faqs" class="section-container reveal">
           <h2 class="section-title animation-trigger"><i class="fas fa-question-circle"></i> FAQ /// Knowledge_Base</h2>
           <div class="faqs-container animation-trigger">
                <!-- Ejemplo de FAQ item con toggle (Usará JS) -->
                <div class="faq-item content-box reveal">
                    <div class="faq-question">
                        ¿Está este sistema conectado directamente a la Red global? <i class="fas fa-chevron-right"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Protocolos de seguridad avanzados mantienen una conexión limitada y cifrada para la recuperación de datos autorizada. Se evita la interacción directa con la Red incontrolada para prevenir intrusiones.</p>
                    </div>
                </div>
                <div class="faq-item content-box reveal">
                     <div class="faq-question">
                         ¿Cómo puedo solicitar una conexión segura? <i class="fas fa-chevron-right"></i>
                     </div>
                     <div class="faq-answer">
                         <p>Las solicitudes para nuevas conexiones o protocolos de acceso se procesan a través de un canal encriptado. Se requiere verificación biométrica y autorización de nivel Delta. Usa el enlace de contacto al final.</p>
                     </div>
                 </div>
                 <div class="faq-item content-box reveal">
                      <div class="faq-question">
                          ¿Se monitoriza la actividad del usuario? <i class="fas fa-chevron-right"></i>
                      </div>
                      <div class="faq-answer">
                          <p>Todos los accesos y actividades dentro de este terminal son registrados para análisis forense de seguridad y mejora continua de la interfaz. Tu sesión es temporal y anónima, a menos que inicies verificación manual.</p>
                      </div>
                  </div>
                <!-- Añadir más FAQs si tienes -->
           </div>
       </section>


      <!-- MUSICA VISUALIZADOR (Del 1er archivo) - Estilizado -->
      <!-- Mantiene la estructura original y el ID -->
      <div class="music-visualizer" id="musicVisualizer">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      </div>

      <!-- PANEL PREFERENCIAS (Del 1er archivo) - Estilizado y Añadido control 'open' -->
      <!-- Mantiene la estructura original y los IDs. La clase 'closed' la gestiona el JS -->
      <div class="preferences-panel" id="preferencesPanel">
        <button class="preferences-toggle" id="preferencesToggleBtn" aria-label="Toggle Preferences Panel">
          <i class="fas fa-chevron-left"></i>
        </button>
        <h4><i class="fas fa-cog"></i> Interface Config</h4>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="particlesToggle"><label class="form-check-label" for="particlesToggle">Data Particles</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="scanlinesToggle"><label class="form-check-label" for="scanlinesToggle">Scanlines FX</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="soundsToggle"><label class="form-check-label" for="soundsToggle">Auditory Feedback</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="animationsToggle"><label class="form-check-label" for="animationsToggle">Panel Animations</label></div>
        <!-- NUEVOS TOGGLES Y SECCIONES AVANZADAS -->
        <hr>
        <h4><i class="fas fa-palette"></i> Temas y Accesibilidad</h4>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="highContrastToggle"><label class="form-check-label" for="highContrastToggle">Modo Alto Contraste</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="hudMinimalToggle"><label class="form-check-label" for="hudMinimalToggle">HUD Minimalista</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="hudCustomToggle"><label class="form-check-label" for="hudCustomToggle">HUD Personalizado</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="themeMatrixToggle"><label class="form-check-label" for="themeMatrixToggle">Tema Matrix</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="themeRedAlertToggle"><label class="form-check-label" for="themeRedAlertToggle">Tema Red Alert</label></div>
        <hr>
        <h4><i class="fas fa-gamepad"></i> Gamificación</h4>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="showAchievementsToggle"><label class="form-check-label" for="showAchievementsToggle">Mostrar Logros</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="showProgressToggle"><label class="form-check-label" for="showProgressToggle">Mostrar Progreso</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="showTipsToggle"><label class="form-check-label" for="showTipsToggle">Mostrar Tips de Uso</label></div>
        <hr>
        <h4><i class="fas fa-universal-access"></i> Accesibilidad</h4>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="keyboardNavToggle"><label class="form-check-label" for="keyboardNavToggle">Navegación por Teclado</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="showShortcutsToggle"><label class="form-check-label" for="showShortcutsToggle">Mostrar Atajos</label></div>
        <hr>
        <h4><i class="fas fa-map"></i> Navegación</h4>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="sideNavToggle"><label class="form-check-label" for="sideNavToggle">Mini-mapa Lateral</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="historyNavToggle"><label class="form-check-label" for="historyNavToggle">Historial de Navegación</label></div>
        <hr>
        <h4><i class="fas fa-bolt"></i> Efectos Cyberpunk</h4>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="glitchEffectsToggle"><label class="form-check-label" for="glitchEffectsToggle">Efectos Glitch</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="bgReactiveToggle"><label class="form-check-label" for="bgReactiveToggle">Fondo Reactivo</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="musicVisualizerToggle"><label class="form-check-label" for="musicVisualizerToggle">Visualizador de Música Avanzado</label></div>
        <hr>
        <h4><i class="fas fa-trophy"></i> Logros Desbloqueados</h4>
        <ul id="achievementsList" class="hud-list">
          <!-- Aquí se mostrarán los logros desbloqueados dinámicamente -->
        </ul>
        <hr>
        <h4><i class="fas fa-tasks"></i> Progreso de Exploración</h4>
        <div id="progressBarContainer" class="progress-bar-container">
          <div id="progressBar" class="progress-bar-fill" style="width:0%"></div>
        </div>
        <div id="progressText" class="hud-readout" style="margin-top:8px; text-align:center;">0% explorado</div>
      </div>

        <!-- FOOTER (Del 1er archivo) - Estilizado con clase .main-footer del 2do archivo -->
       <!-- Mantiene el ID original, añade la clase .main-footer para estilos -->
        <footer class="main-footer" id="contact">
             <!-- Usa un título H2 si lo quieres como sección (necesitaría section-container alrededor) -->
             <!-- <h2 class="section-title section-title-small">CONNECT // >contact_me</h2> -->
            <p id="footerCopy">© 2077 J.A.E.M. // Data Cache Archived // Secure Connection</p>
            <!-- Estilizados con clase hud-link y small -->
             <div class="footer-links">
                 <a href="#" class="hud-link small">Privacy_Protocol</a> | <a href="#" class="hud-link small">Terms_Of_Service</a>
             </div>
             <!-- Enlaces sociales estilizados con hud-link social -->
             <div class="social-links">
                 <a href="https://www.linkedin.com/in/joseaem" target="_blank" rel="noopener" class="hud-link social" aria-label="LinkedIn Profile"><i class="fab fa-linkedin-in"></i></a>
                 <a href="https://github.com/yourusername" target="_blank" rel="noopener" class="hud-link social" aria-label="GitHub Profile"><i class="fab fa-github"></i></a>
                 <!-- Ejemplo Dribbble, adaptar si es necesario -->
                 <a href="https://dribbble.com/yourusername" target="_blank" rel="noopener" class="hud-link social" aria-label="Dribbble Profile"><i class="fab fa-dribbble"></i></a>
                  <!-- Puedes añadir más iconos sociales -->
             </div>
        </footer>
   </div> <!-- Fin de .main-content-wrapper -->

   <!-- PANEL DE FILTRO/NAVEGACIÓN (Del 1er archivo, reestructurado con el 2do) -->
   <!-- Overlay oscuro del 2do archivo, mantiene el ID del 1ero -->
  <div class="filter-overlay" id="filterOverlay"></div>
   <!-- Panel del menú del 2do archivo, ahora fuera del flujo principal del contenido. Añadido. -->
   <!-- Mantiene el ID original del panel del 1er archivo -->
  <div class="filter-panel" id="filter-panel">
    <!-- Contenido del menú original del 1er archivo (antes dentro de #filterOverlay) -->
    <div class="filter-content">
      <ul>
         <!-- Mantiene clases y href originales -->
         <li><a class="filter-link" data-text="DISEÑO" href="diseños/Menu.html">DISEÑO</a></li>
         <li><a class="filter-link" data-text="PRESENTACION" href="presentacion/presentacion.html">PRESENTACIÓN</a></li>
         <!-- Enlace interno al #proyectoX, usa hash y el JS para scroll suave -->
         <li><a class="filter-link" data-text="PROYECTO X" href="proyecto x/main.html">PROYECTO X</a></li>
         <li><a class="filter-link" data-text="LABORATORIO" href="laboratorio/index.html">LABORATORIO</a></li>
         

      </ul>
        <!-- Puede añadir opciones de idioma/tema si no están en header, o una línea divisoria -->
         <ul style="margin-top: 2rem; border-top: 1px solid var(--color-border); padding-top: 2rem;">
              <!-- Podrías duplicar Theme/Lang toggle aquí si lo prefieres -->
         </ul>
    </div>
  </div>


   <!-- EASTER EGG (Del 1er archivo) - Estilizado, funcionalidad via JS (implementación básica) -->
  <!-- Mantiene estructura y ID original -->
  <div class="easter-egg-msg" id="easterEggMsg">Ice bypassed! Deep Network Access granted. Welcome, Ghost.</div>


  <!-- ============================================================
       MODALES (Del 2do archivo - HTML de ejemplo). AÑADIDO.
       ------------------------------------------------------------
       Añadir si necesitas mostrar certificados u otra info en popups.
       Requiere que el HTML de la referencia exista para que el JS funcione.
       Vamos a añadir la estructura base y 4 modales de ejemplo como en el 2do archivo.
  ============================================================ -->
   <!-- Estas estructuras deben estar fuera del main-content-wrapper para estar por encima de todo -->
  <div id="modal-cert1" class="modal">
      <div class="modal-content content-box">
          <span class="close-modal" aria-label="Cerrar modal">&times;</span>
          <h3>[IBM] Web Dev Foundations</h3>
          <p>Curso introductorio completo a HTML, CSS, & JavaScript por IBM. Fundamentos esenciales para desarrollo web moderno.</p>
          <p>Emitido: <strong>IBM</strong> // Fecha: <strong>05/03/2025</strong></p>
          <!-- Link con clase hud-link para estilo -->
          <p><a href="https://coursera.org/verify/CZ47JIW4L9Y" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p>
      </div>
  </div>
  <div id="modal-cert2" class="modal">
      <div class="modal-content content-box">
          <span class="close-modal" aria-label="Cerrar modal">&times;</span>
          <h3>[IBM] Generative AI Dev</h3>
          <p>Capacitación en IA Generativa aplicada al desarrollo de software para optimización y automatización de procesos.</p>
          <p>Emitido: <strong>IBM</strong> // Fecha: <strong>10/04/2025</strong></p>
          <p><a href="https://coursera.org/verify/F046N23FJU08" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p>
      </div>
  </div>
  <div id="modal-cert3" class="modal">
      <div class="modal-content content-box">
          <span class="close-modal" aria-label="Cerrar modal">&times;</span>
          <h3>[IBM] Git & GitHub Mastery</h3>
          <p>Curso intensivo sobre control de versiones con Git y GitHub. Best practices para colaboración eficiente en proyectos.</p>
          <p>Emitido: <strong>IBM</strong> // Fecha: <strong>15/04/2025</strong></p>
          <p><a href="https://www.coursera.org/account/accomplishments/verify/CWRQOJ19Z102" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p>
      </div>
  </div>
  <div id="modal-cert4" class="modal">
      <div class="modal-content content-box">
          <span class="close-modal" aria-label="Cerrar modal">&times;</span>
          <h3>[Google] Cybersecurity Foundations</h3>
          <p>Curso especializado en fundamentos de ciberseguridad. Estrategias y herramientas para protección de datos digitales.</p>
          <p>Emitido: <strong>Google</strong> // Fecha: <strong>28/03/2025</strong></p>
          <p><a href="https://www.coursera.org/account/accomplishments/verify/F046JNZ3FUO9" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p>
      </div>
  </div>
  <!-- Necesitarás botones/links (Ej. en la sección Certificaciones) que tengan la clase "modal-trigger" y data-modal-id="modal-certX" para abrir estos modales -->


  <!-- ============================================================
       ELEMENTOS DE AUDIO (Unificado y con IDs para JS)
       ------------------------------------------------------------
       Copiamo IDs y rutas desde el 2do archivo (referencia JS), adaptando si es necesario.
  ============================================================ -->

  <!-- Sonido de "terminal" o proceso en curso durante la pantalla de carga inicial. -->
  <!-- Usa ID y ruta del 2do archivo conceptual (o las rutas que tú uses) -->
  <audio id="loadingAudio" loop preload="auto">
    <source src="Audio/Sound-mp3/terminal.mp3" type="audio/mpeg">
      <source src="Audio/Sound-ogg/terminal.ogg" type="audio/ogg"> <!-- Optional: Add Ogg source for wider compatibility -->
  </audio>

  <!-- Sonido corto de "aviso" o "sistema listo" que suena al finalizar la carga (100%). -->
  <!-- Usa ID y ruta del 2do archivo conceptual -->
  <audio id="loadCompleteAudio" preload="auto">
    <source src="Audio/Sound-mp3/aviso.mp3" type="audio/mpeg">
      <source src="Audio/Sound-ogg/aviso.ogg" type="audio/ogg">
  </audio>

  <!-- Música de fondo principal que se reproduce en bucle una vez cargada la página. -->
  <!-- Usa ID del 1er archivo, ruta de tu música. Asegura autoplay funcione o sea triggereado por JS -->
   <!-- Asegurarte que backgroundAudio.play() sea llamado después de un gesto de usuario para iOS/Chrome autoplay políticas -->
  <audio id="backgroundAudio" loop>
      <source src="Audio/Stardust_ Relaxing Ambient Sci Fi Music.mp3" type="audio/mpeg">
      <source src="Audio/Stardust_ Relaxing Ambient Sci Fi Music.ogg" type="audio/ogg">
  </audio>

  <!-- Sonido genérico para clics en botones, enlaces y otros elementos interactivos de la UI. -->
  <!-- Usa ID y ruta del 2do archivo conceptual -->
  <audio id="uiClickAudio" preload="auto">
    <source src="Audio/Sound-mp3/click 2.mp3" type="audio/mpeg">
      <source src="Audio/Sound-ogg/click 2.ogg" type="audio/ogg">
  </audio>

  <!-- Sonido genérico para el efecto hover sobre elementos interactivos. -->
  <!-- Usa ID y ruta del 2do archivo conceptual (click ligero) -->
  <audio id="uiHoverAudio" preload="auto">
    <source src="Audio/botones/botón UI haga clic en 1.mp3" type="audio/mpeg">
      <source src="Audio/Sound-ogg/click 1.ogg" type="audio/ogg">
  </audio>

  <!-- Sonido específico para los enlaces dentro del menú de navegación/filtrado. -->
   <!-- Usa ID y ruta del 2do archivo conceptual (puede ser igual al click general o diferente) -->
  <audio id="filterHoverAudio" preload="auto">
    <source src="Audio/Sound-mp3/click 2.mp3" type="audio/mpeg"> <!-- Usar click 2 o uno distinto -->
      <source src="Audio/Sound-ogg/click 2.ogg" type="audio/ogg">
  </audio>

   <!-- Audio de notificación (Original del 1er archivo - Mantenido si se añade JS después) -->
   <!-- Si no se usa JS para esto, podría removerse. Mantengo el del 1er archivo original si lo tenías -->
   <audio id="audio-notification" src="Audio/ui-notification.wav" preload="auto"></audio>
   <!-- Otros audios del 1er archivo (terminal-keypress-sound) si no tienen lógica, se pueden quitar -->
    <!-- Removidos IDs de audio no usados si existían -->


  <!-- ============================================================ -->
  <!-- JavaScript Logic (Combinado de ambos archivos, adaptado)     -->
  <!-- ============================================================ -->
   <!-- Pongo el script aquí para que pueda acceder a los elementos HTML del DOM -->
  <script>
    "use strict"; // Modo estricto

    // Usar un evento para asegurar que el DOM esté completamente cargado antes de intentar acceder a los elementos
    document.addEventListener('DOMContentLoaded', () => {

        // ============================================================
        // SELECTORES DE ELEMENTOS FRECUENTES (Adaptado para HTML final)
        // Definir todas las referencias a elementos DOM usadas en el script.
        // ============================================================
        const loaderOverlayEl = document.getElementById('loaderOverlay'); // Usa el ID del loader final
        const loaderBar = document.getElementById('loaderBar'); // Usa el ID del loader final
        const loaderPercentage = document.getElementById('loaderPercentage'); // Usa el ID del loader final
        const loaderText = document.getElementById('loaderText'); // Usa el ID del loader final
        const loaderSubtext = document.getElementById('loaderSubtext'); // Usa el ID del loader final
        const mainHeader = document.getElementById('mainHeader'); // Usa el ID del header final
        const mainContent = document.getElementById('mainContent'); // Usa el ID del wrapper principal
        const hudOverlay = document.getElementById('hudOverlay'); // Usa el ID del HUD Overlay (lo agregué con ID)
        const hudClock = document.getElementById('hudClock'); // Usa el ID del reloj del HUD
        const hudScrollIndicator = document.getElementById('hudScrollIndicator'); // Usa el ID del indicador de scroll
        const filterBtn = document.getElementById('filter-btn'); // Usa el ID del botón del menú
        const filterPanel = document.getElementById('filter-panel'); // Usa el ID del panel del menú (ahora diferente al overlay)
        const filterOverlay = document.getElementById('filterOverlay'); // Usa el ID del overlay de fondo
        const themeToggle = document.getElementById('themeToggle'); // Usa el ID del botón de tema
        const langToggle = document.getElementById('langToggle'); // Usa el ID del botón de idioma
        const muteButton = document.getElementById('muteButton'); // Usa el ID del botón mute
        const preferencesPanel = document.getElementById('preferencesPanel'); // Usa el ID del panel de preferencias
        const preferencesToggleBtn = document.getElementById('preferencesToggleBtn'); // Usa el ID del botón toggle preferencias

        const htmlEl = document.documentElement;
        const bodyEl = document.body; // Added body reference
        const heroTitleEl = document.getElementById('heroTitle'); // Usa ID del título del hero
        const heroSubtitleEl = document.getElementById('heroSubtitle'); // Usa ID del subtitulo del hero
        const heroButtonEl = document.querySelector('.btn-hero'); // Usa selector del botón del hero
        const footerCopyEl = document.getElementById('footerCopy'); // Usa ID del footer text

        // Selecciones para elementos que quizás agregaste
         const searchProjectInput = document.getElementById('searchProjectInput');
         const searchProjectBtn = document.getElementById('searchProjectBtn');
         // Nota: projectGrid apunta al contenedor de ítems, NO a la sección. Puede que necesites otro ID.
         // O si solo tienes el Proyecto X, adaptar la búsqueda a él.
         const projectGrid = document.getElementById('projectGrid'); // Contenedor de los project items
         const allProjectItems = projectGrid ? Array.from(projectGrid.querySelectorAll('.project-item')) : []; // Obtener items de proyecto SI existen


         const faqItems = document.querySelectorAll('.faq-item'); // Elementos de FAQ si existen
         const downloadButtons = document.querySelectorAll('.download-trigger'); // Botones de descarga si existen
         const modalTriggers = document.querySelectorAll('.modal-trigger'); // Botones/links para abrir modales si existen
         const modals = document.querySelectorAll('.modal'); // Los contenedores modales si existen
         const closeModals = document.querySelectorAll('.close-modal'); // Botones cerrar modal si existen

         const skillFills = document.querySelectorAll('.progress-bar-fill'); // Barras de habilidad si existen

         // Selecciona elementos a animar con 'reveal' - ¡Añadidos al HTML!
         const revealElements = document.querySelectorAll('.reveal');


        // ============================================================
        // MANEJO DE SONIDOS (Centralizado y con Mute - Del 2do archivo)
        // Adaptado a los IDs de los elementos Audio finales.
        // ============================================================
        // Objeto con referencias a los elementos audio. Usa los IDs del HTML final.
        const sounds = {
            loading: document.getElementById('loadingAudio'), // Match final HTML ID
            complete: document.getElementById('loadCompleteAudio'), // Match final HTML ID
            background: document.getElementById('backgroundAudio'), // Match final HTML ID
            click: document.getElementById('uiClickAudio'), // Match final HTML ID
            hover: document.getElementById('uiHoverAudio'), // Match final HTML ID
            filterHover: document.getElementById('filterHoverAudio'), // Match final HTML ID
            notification: document.getElementById('audio-notification') // Match final HTML ID (if keeping notifications)
             // Removed original audio IDs and linked to the new ones
        };

        // Recuperar estado de mute desde localStorage, default false
        let isMuted = localStorage.getItem('portfolioMuted') === 'true';


        // Función para actualizar el aspecto del botón de mute
        function updateMuteButton() {
            if (!muteButton) return; // Salir si el botón no existe

            if (isMuted) {
                muteButton.classList.add('muted');
                muteButton.setAttribute('aria-label', 'Activar Sonidos');
                 // Detener sonidos actualmente reproduciéndose (excepto quizás la música de fondo que se controla por separado)
                Object.keys(sounds).forEach(key => {
                    const audio = sounds[key];
                    // Stop specific sounds, perhaps leave background music handled elsewhere?
                     // For now, stop all sounds immediately when muted.
                    if(audio) {
                       try {
                           audio.pause();
                           audio.currentTime = 0; // Reset to start
                        } catch(e){}
                    }
                });
                 // Special check for background audio which might be looping
                if(sounds.background) {
                    try { sounds.background.pause(); } catch(e){}
                }


            } else { // If not muted
                muteButton.classList.remove('muted');
                muteButton.setAttribute('aria-label', 'Silenciar Sonidos');

                 // Optional: Resume background music AFTER loading is complete and main content is visible
                 // This is better handled within the loader completion logic.
                 // If page is already loaded and loader is not active, try resuming BG.
                 if (loaderOverlayEl && !loaderOverlayEl.classList.contains('active') && sounds.background) {
                      // Use a short timeout to help with play() restrictions
                     setTimeout(() => {
                          sounds.background.volume = 0.2; // Ensure background volume is low
                         sounds.background.play().catch(e => {
                             console.warn("Playback prevented (user interaction required to resume BG audio).", e);
                             // Show a temporary prompt maybe?
                              showNotification('Click anywhere to enable audio', 'info', 5000); // Simple notification prompt
                         });
                     }, 100);
                 } else if (sounds.loading && loaderOverlayEl && loaderOverlayEl.classList.contains('active')) {
                      // If loading is active, resume loading sound
                       setTimeout(() => {
                           sounds.loading.play().catch(e => console.warn("Playback prevented for loading audio:", e));
                       }, 100);
                 }
            }
        }


        // Función para reproducir un sonido dado su nombre clave.
        function playSound(soundName, volume = 0.5) {
            // No reproducir si está muteado, si el sonido no existe, o si ya está reproduciéndose y no es repetible (click/hover)
            if (isMuted || !sounds[soundName]) {
                 //console.log(`Sound ${soundName} blocked (muted or not found).`);
                 return;
             }

            const audio = sounds[soundName];

            try {
                // Stop and reset for non-looping sounds like clicks/hovers/notifications
                if (!audio.loop) {
                    // Optional: Use a slightly more complex method for click/hover
                    // to allow multiple fast clicks (e.g., check if current audio is over 50ms played)
                     if (audio.currentTime > 0 && !audio.paused && soundName !== 'click' && soundName !== 'hover' && soundName !== 'filterHover' && soundName !== 'notification') {
                         // If it's a long, non-looping sound playing, don't restart on accidental re-trigger
                          // console.log(`Sound ${soundName} is already playing.`);
                          return; // Don't restart sounds like load complete or notification
                     }

                     audio.pause(); // Stop any current playback of the same sound
                    audio.currentTime = 0; // Reset to beginning

                     // For click/hover/filterHover, if played very fast, maybe don't reset currentTime immediately?
                     // audio.play().catch(...) already handles sequence fairly well in most modern browsers.
                }

                audio.volume = volume; // Set volume before playing

                // Play the sound. Use catch to handle promises and errors (like user gesture requirement).
                audio.play().catch(e => {
                     // Ignore NotAllowedError (user hasn't interacted yet) or AbortError (replaced by new sound)
                     if (e.name !== 'NotAllowedError' && e.name !== 'AbortError') {
                         console.warn(`Error playing sound (${soundName}):`, e);
                     } else {
                        // console.log(`Playback prevented for ${soundName}:`, e.name);
                     }
                 });

            } catch (e) {
                console.warn(`Error handling play sound (${soundName}):`, e);
            }
        }


        // Función para detener un sonido específico y resetear su tiempo
        function stopSound(soundName) {
            if (sounds[soundName] && !sounds[soundName].paused) {
                try {
                    sounds[soundName].pause();
                    sounds[soundName].currentTime = 0; // Reset time
                } catch(e) {
                     console.warn(`Error stopping sound (${soundName}):`, e);
                }
            }
        }

         // Implementar lógica básica para mostrar notificaciones (llamada por JS)
         // Necesita el contenedor #notificationContainer en el HTML (ya agregado)
         function showNotification(message, type = 'info', duration = 5000) {
             const container = document.getElementById('notificationContainer');
             if (!container) {
                  console.warn('Notification container not found.');
                 return; // Salir si el contenedor no existe
             }

             const notificationEl = document.createElement('div');
             notificationEl.classList.add('notification');
             if (type) notificationEl.classList.add(type); // Añade clase CSS como 'error', 'warning'
             notificationEl.textContent = message; // Usa textContent por seguridad
             notificationEl.setAttribute('role', 'alert'); // Rol ARIA para accesibilidad

              container.appendChild(notificationEl);

             // Trigger animation using class list or direct style manipulation
             // CSS keyframes 'notification-show' and 'notification-hide' are designed for this structure and timing.
             // No need for separate JS animation trigger if using CSS keyframes like done in the style block.
             // The CSS `animation: fadeInSlideLeft... fadeOut...` was removed and replaced with `notification-show` and `notification-hide`.
             // The notification-hide animation will trigger automatically after the duration via the 'forwards' keyword and the second part of the animation property.

             // Remove the notification after the specified duration (matching CSS animation duration+delay for fadeOut)
             // The CSS animation handles hiding. This timeout just handles element removal from the DOM.
             const totalAnimationTime = 0.5 + 0.5; // show + hide durations
              setTimeout(() => {
                 // Ensure it's not somehow still transitioning before removal, or user paused animation
                 // Simple removal:
                  if (notificationEl && notificationEl.parentElement === container) { // Check if it's still in the container
                      // Optional: Fade it out explicitly if CSS animation was somehow paused
                       /* if(!notificationEl.style.animationPlayState || notificationEl.style.animationPlayState === 'running') {
                             // Let CSS handle fade out. Remove after animation end.
                             notificationEl.addEventListener('animationend', (event) => {
                                 if (event.animationName === 'notification-hide') {
                                     notificationEl.remove();
                                 }
                             });
                         } else { // If animation was paused (e.g. by hover) or css animation doesn't handle removal automatically
                             // Explicitly fade out and remove
                             notificationEl.style.opacity = 0;
                             notificationEl.style.transition = `opacity ${totalAnimationTime / 2}s ease-out`;
                             setTimeout(() => notificationEl.remove(), totalAnimationTime / 2 * 1000 + 50); // Remove after transition + buffer
                         } */
                     // Simpler approach relying solely on CSS keyframes timing and browser garbage collection later
                      // Add a class that ensures final removal state
                      // Or simply set opacity/transform to final state after CSS animation delay+duration
                     setTimeout(() => {
                          // Check if still there before removing
                           if(notificationEl.parentElement === container) notificationEl.remove();
                     }, (duration / 1000 + totalAnimationTime) * 1000); // Total time including display duration + fadeout duration


                  } else {
                       // console.log("Notification element removed already?"); // Debug if needed
                   }
              }, duration);

              // Play notification sound if available and not muted
             playSound('notification', 0.7);
         }


        // Inicializar estado del botón mute basado en local storage y añadir listener
        updateMuteButton(); // Aplica el estado guardado al cargar

        // Event listener para el botón mute
         if (muteButton) {
             muteButton.addEventListener('click', () => {
                 isMuted = !isMuted; // Cambia el estado
                 localStorage.setItem('portfolioMuted', isMuted); // Guarda en local storage
                 updateMuteButton(); // Actualiza el UI del botón y detiene/reanuda sonidos si es necesario
                 playSound('click'); // Siempre intentar sonar el click DEL BOTÓN en sí, incluso si está muteado, o quizás usar un sonido diferente? Let's stick to the sound system. This click might be blocked if muted. Let's make mute button click exempt. Or use a browser native beep. For now, playSound('click') will be blocked if muted.
                 // A workaround could be a separate audio element specifically for the mute button that ignores `isMuted` but has a low volume. Or check `isMuted` status *before* calling `playSound`. The `playSound` function itself checks `isMuted`, so this is fine.
             });
         }


        // Añadir sonidos hover y click a elementos interactivos principales (Adaptar selectores si se añaden muchos tipos nuevos)
        document.querySelectorAll('button, a[href]:not(.social), .projectx-visuals img, .skill-item, .faq-question').forEach(el => { // Añadidas clases para habilidades y FAQs, excluir links sociales

            // Excluir elementos específicos si su hover o click debe ser silencioso o manejado diferente
             if (el === muteButton) return;
             // .filter-link are handled below separately because they are inside the menu panel logic.
            if (el.classList.contains('filter-link')) return;
            // Download triggers are handled separately below.
             if (el.classList.contains('download-trigger')) return;
            // Modal triggers are handled separately below.
            if (el.classList.contains('modal-trigger')) return;
             // If ProjectX visuals or Skill items have links/buttons *inside* them, target those specifically, not the container div hover/click.
             // If the whole .skill-item should click/hover, it's fine. If it's just elements inside, adjust selector.


            // Hover sound (on mouseenter)
            el.addEventListener('mouseenter', () => {
                // For elements that open things (like FAQ question), maybe use a click sound?
                // Stick to hover for visual feedback for now.
                 if(el.classList.contains('faq-question')) {
                      playSound('hover', 0.2); // Lighter sound for question hover
                 } else if (el.tagName === 'IMG') { // Images in galleries etc
                      playSound('hover', 0.15); // Even lighter for images
                 }
                 else {
                    playSound('hover', 0.3); // Default hover sound volume
                }
            });

             // Click sound (on click) - Ensure it doesn't conflict with more specific handlers below.
            el.addEventListener('click', () => {
                 // Only play generic click if not handled by a specific handler below (e.g., filter link, modal trigger, download trigger)
                 // The specific handlers *already* call playSound('click'). So this is mostly for other buttons/links.
                 // We could add a 'data-sound="click"' attribute and filter here.
                // For simplicity, ensure specific handlers prevent propagation or check.
                 // A safe approach: use a generic attribute, like `data-play-click`
                 // Let's rely on the separate handlers below to play sound and filter *them* out here.
                /* Example of specific elements handled below: */
                 // Filter links are handled separately below.
                 // Download triggers are handled separately below.
                // Modal triggers are handled separately below.
                 // FAQ questions are handled below and play click on toggle.

                 // Let's add specific handlers below, and *remove* this generic click handler,
                 // or add it only to *specific* non-categorized buttons/links.
                 // Removing this generic click listener for now, and ensuring all specific interactive elements play a sound.
            });
        });
         // Re-adding a targeted click listener for common buttons/links *not* covered by special handlers
         document.querySelectorAll('.hud-button, .hud-link').forEach(btn => {
              // Exclude ones already handled
              if (btn === muteButton) return;
              if (btn.closest('#mainHeader')) return; // Exclude header buttons handled below
               if (btn.classList.contains('modal-trigger')) return; // Exclude modal triggers
              if (btn.classList.contains('download-trigger')) return; // Exclude download triggers
              if (btn.classList.contains('btn-hero')) return; // Exclude hero button, click handled inline for now.

              btn.addEventListener('click', () => { playSound('click', 0.6); });
         });


        // Specific handlers for elements within the Header
         if (filterBtn) filterBtn.addEventListener('click', () => playSound('click')); // Click handled with menu toggle

         // specific handler for hero button click (sound added inline already, keeping for completeness if JS adds event)
         // if (heroButtonEl) heroButtonEl.addEventListener('click', () => playSound('click')); // Already added inline.


        // ============================================================
        // PANTALLA DE CARGA AVANZADA (Del 2do archivo, adaptado)
        // Integra la lógica con los nuevos IDs del loader.
        // Usa IDs y estructura añadida al HTML.
        // ============================================================
         // Only execute if the loader HTML exists
        if (loaderOverlayEl && loaderBar && loaderPercentage && loaderText && loaderSubtext) {
            let progress = 0;
            const loadingSteps = [
                { percent: 15, text: "ACCESSING MATRIX...", subtext: "Initializing protocols..." },
                { percent: 30, text: "LOADING HUD INTERFACE...", subtext: "Calibrating displays..." },
                { percent: 55, text: "DECRYPTING ASSET CACHE...", subtext: "Retrieving portfolio data..." },
                { percent: 75, text: "ESTABLISHING SECURE CHANNEL...", subtext: "Connecting to comms link..." },
                { percent: 90, text: "SYSTEM INTEGRITY CHECK...", subtext: "Final diagnostics..." },
                { percent: 100, text: "SYSTEM ONLINE", subtext: "Access Granted." } // Updated text
            ];
            let currentStep = 0;
            let lastProgress = 0; // Track last integer progress

            // Start loading sound only if not muted and element exists
             if (sounds.loading && !isMuted) {
                 try { sounds.loading.play().catch(e => console.warn("Loading audio play error:", e)); } catch(e){}
             }

             console.log("Starting loader simulation...");


            const simulateLoading = setInterval(() => {
                // Increase progress, faster initially, slower as it reaches later steps
                // Make the end more certain and faster once it gets close
                 if (progress < 80) {
                     progress += Math.random() * 4 + 1; // Faster up to 80
                 } else if (progress < 95) {
                     progress += Math.random() * 2 + 0.5; // Slower from 80 to 95
                 } else {
                     progress += Math.random() * 0.5 + 0.1; // Very slow towards 100
                 }

                progress = Math.min(progress, 100.01); // Allow slight overshoot to ensure 100%


                const currentProgress = Math.floor(progress);

                // Update loader bar width
                if(loaderBar) loaderBar.style.width = progress + '%';

                // Update percentage text only on integer change
                if(loaderPercentage && currentProgress !== lastProgress) {
                     loaderPercentage.textContent = currentProgress + '%';
                 }

                lastProgress = currentProgress;

                // Update loading texts based on integer progress
                if (currentStep < loadingSteps.length && currentProgress >= loadingSteps[currentStep].percent) {
                     // Small delay before text updates for effect
                     const stepData = loadingSteps[currentStep];
                     // Check if the step text is different from the current text before applying delay and sound
                     if (loaderText.textContent !== stepData.text) {
                         setTimeout(() => {
                            if(loaderText) loaderText.textContent = stepData.text;
                             if(loaderSubtext) loaderSubtext.textContent = stepData.subtext;
                             // Play sound for step change, unless it's the final 100% step.
                             if (currentStep < loadingSteps.length - 1) {
                                 playSound('hover', 0.2); // Use hover sound for tick/advance
                             } else {
                                  // This is the 100% step, play the complete sound.
                                 playSound('complete', 0.6); // Play load complete sound at the end
                             }
                            currentStep++; // Move to the next step only after the delay and sound trigger
                         }, 50); // Delay the text update and associated sound slightly
                     } else {
                          // If text is the same but percentage reached, still advance step logic
                           if (currentStep < loadingSteps.length -1 ) currentStep++; // Only advance if not already at the last step's text
                     }
                }


                // Completion condition
                if (progress >= 100) {
                    clearInterval(simulateLoading); // Stop the simulation interval
                    stopSound('loading'); // Stop the loading sound (if still playing)
                    // loadCompleteAudio sound is triggered by the text update to 100% status

                    console.log("Loading complete.");

                    // Delay before starting the transition out of the loader overlay
                    setTimeout(() => {
                        if(loaderOverlayEl) {
                             loaderOverlayEl.classList.remove('active'); // Starts CSS fade-out transition
                             console.log("Starting loader fade-out transition...");

                             // After loader CSS transition finishes
                             // Use addEventListener to accurately detect the end of the CSS transition
                             loaderOverlayEl.addEventListener('transitionend', function handler(event) {
                                 // Ensure this handler only runs for the 'opacity' transition of the loader overlay
                                 if (event.propertyName === 'opacity' && !loaderOverlayEl.classList.contains('active')) {
                                      loaderOverlayEl.removeEventListener('transitionend', handler); // Remove listener to prevent running again
                                      loaderOverlayEl.style.display = 'none'; // Hide completely after fade out
                                      console.log("Loader hidden. Revealing content...");

                                     // Reveal main content, header, and HUD using the 'visible' class (which the CSS animates)
                                     // Add 'visible' class only after loader is fully hidden
                                      if(mainHeader) mainHeader.classList.add('visible');
                                      if(mainContent) mainContent.classList.add('visible');
                                      if(hudOverlay) hudOverlay.classList.add('visible');


                                     // Start background music only if not muted (using playSound checks mute)
                                     if (sounds.background && !isMuted) {
                                          setTimeout(() => { // Small delay might still be needed for iOS/Chrome policies
                                             sounds.background.volume = 0.2; // Keep BG volume low
                                             sounds.background.play().catch(e => {
                                                 console.warn("Background audio autoplay prevented (user gesture required).", e);
                                                  // Could show a message: "Click to enable background audio"
                                                   showNotification('Click anywhere to enable full audio experience', 'info', 5000);
                                              });
                                          }, 200); // Adjust delay if needed
                                     } else if (!isMuted) { // If BG element wasn't found but sound is not muted
                                         // Show the prompt if audio was expected but blocked, even without BG sound
                                         // showNotification('Click anywhere to enable audio', 'info', 5000); // Maybe this is too generic?
                                     }


                                     // Trigger initial animations/effects for elements now visible in viewport
                                     triggerVisibleReveals(); // Assumes sections have .reveal class and JS handles visibility
                                      triggerVisibleSkillBars(); // Trigger skill bar animations for initially visible ones (checks if skills exist)


                                     startClock(); // Start HUD clock (checks if element exists)
                                      updateScrollIndicator(); // Set initial scroll indicator value
                                     // Ensure scroll handler is added already.

                                     // Show a "System Online" notification after everything is ready
                                     showNotification('System Online. Access Granted.', 'info', 6000);

                                     console.log("Initialization complete.");

                                 }
                             });
                        } else { // Fallback if loaderOverlayEl was not found
                             console.warn("Loader overlay element not found, revealing content immediately (fallback).");
                             if(mainHeader) mainHeader.classList.add('visible');
                             if(mainContent) mainContent.classList.add('visible');
                             if(hudOverlay) hudOverlay.classList.add('visible');

                              // Start background music immediately (if not muted and element exists)
                             if (sounds.background && !isMuted) {
                                 setTimeout(() => { // Use timeout anyway for potential play() issues
                                     sounds.background.volume = 0.2;
                                     sounds.background.play().catch(e => console.warn("Background audio autoplay prevented (fallback):", e));
                                 }, 100);
                             } else if (!isMuted) { /* prompt here too if desired */ }

                             // Trigger animations/HUD immediately
                             triggerVisibleReveals();
                             triggerVisibleSkillBars();
                             startClock();
                             updateScrollIndicator();
                             showNotification('System initialized.', 'info', 3000);
                             console.log("Initialization complete (fallback mode).");

                        }


                    }, 700); // Small pause at 100% *before* loader fade-out starts
                }
            }, 30); // Interval frequency in milliseconds - 30ms feels relatively smooth

        } else {
            // Fallback if crucial loader elements are missing in HTML - show content directly
             console.warn("Loader elements not found (IDs missing?), showing content directly.");
             if(loaderOverlayEl) loaderOverlayEl.style.display = 'none'; // Ensure any partial loader is hidden
             if(mainHeader) mainHeader.classList.add('visible');
             if(mainContent) mainContent.classList.add('visible');
             if(hudOverlay) hudOverlay.classList.add('visible');
             // Play background music immediately (if not muted and element exists)
             if (sounds.background && !isMuted) {
                 setTimeout(() => {
                      sounds.background.volume = 0.2;
                     sounds.background.play().catch(e => console.warn("Background audio autoplay prevented (fast fallback):", e));
                 }, 50); // Very short delay
             } else if (!isMuted) { /* prompt here too if desired */ }

             // Trigger animations/HUD immediately
             triggerVisibleReveals();
             triggerVisibleSkillBars();
             startClock();
             updateScrollIndicator(); // Set initial indicator value
             showNotification('System initialized (fallback).', 'info', 3000);
              console.log("Initialization complete (fast fallback mode).");

        }


        // ============================================================
        // FUNCIONALIDAD DEL MENÚ FILTRO (Overlay Centrado - Del 2do archivo)
        // Adapta la lógica a los IDs/Clases del HTML final que se han agregado.
        // ============================================================
        if (filterBtn && filterPanel && filterOverlay) {
             console.log("Filter menu logic initialized.");
             // Función para abrir el menú
             function openFilterMenu() {
                 filterPanel.classList.add('open');
                 filterOverlay.classList.add('open');
                  // Evitar scroll en el body cuando el menú está abierto
                  bodyEl.style.overflow = 'hidden';
                 playSound('click', 0.6); // Sonido al abrir
             }
             // Función para cerrar el menú
             function closeFilterMenu() {
                 filterPanel.classList.remove('open');
                 filterOverlay.classList.remove('open');
                  // Habilitar scroll después de un pequeño retraso para la animación de cierre
                 setTimeout(() => {
                      // Verificar si NO hay modales abiertos antes de re-habilitar scroll
                     const anyModalOpen = document.querySelector('.modal.open');
                      if (!anyModalOpen) {
                        bodyEl.style.overflow = '';
                     }
                 }, 300); // Ajustar este delay si la animación del panel es más larga
                 // playSound('click', 0.4); // Sonido al cerrar, quizás un poco más bajo o diferente? Usa click general por ahora.
             }


            // Event listener para abrir el menú con el botón en el header
            filterBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Previene que el click se propague inmediatamente al overlay o body
                openFilterMenu();
            });

            // Event listener para cerrar el menú al hacer click en el overlay de fondo
            filterOverlay.addEventListener('click', () => {
                closeFilterMenu();
                 playSound('click', 0.4); // Sonido de cierre en overlay
            });

             // Close menu on Escape key press
            document.addEventListener('keydown', (e) => {
                 if (e.key === 'Escape' && filterPanel.classList.contains('open')) {
                     closeFilterMenu();
                      playSound('click', 0.4);
                 }
             });


            // Close menu and navigate on clicking a link in the menu (uses class 'filter-link' from original HTML)
            const filterLinks = filterPanel.querySelectorAll('.filter-link'); // Select using the original class
            filterLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // Obtiene el href del enlace
                    const targetHref = link.getAttribute('href');

                     // Siempre reproducir sonido y cerrar el menú inmediatamente
                    playSound('click');
                    closeFilterMenu(); // Usa la función de cierre centralizada

                    // Determinar si es un enlace interno con hash
                    if (targetHref && targetHref.startsWith('#')) {
                        e.preventDefault(); // Prevenir el comportamiento por defecto (salto rápido) solo para enlaces hash
                        // Usar scroll suave para enlaces hash, después de un breve delay para que el menú se cierre visualmente.
                        setTimeout(() => {
                            // Si el href es solo '#', ir al principio de la página.
                            if (targetHref === '#') {
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                            } else {
                                // Usar la función smoothScrollTo para otros enlaces hash
                                smoothScrollTo(targetHref);
                            }
                        }, 100); // Ajustar el delay si es necesario
                    }
                    // Para enlaces externos (sin '#'), deja que el comportamiento por defecto ocurra (navegación normal) - NO prevenir default.

                });
                // Add hover sound specifically for menu links (using original class 'filter-link')
                link.addEventListener('mouseenter', () => {
                    // Verificar si el menú está abierto antes de reproducir sonido hover
                    if(filterPanel.classList.contains('open')) {
                        playSound('filterHover', 0.5); // Usar el sonido específico para el menú filtro
                    }
                });
            });
        } else {
            console.warn("Filter menu elements (button, panel, or overlay) not found, menu functionality disabled.");
             // Ocultar el botón de menú si los elementos no se encuentran para evitar clicks no funcionales
            if(filterBtn) filterBtn.style.display = 'none';
        }


        // ============================================================
        // SCROLL SUAVE PARA ENLACES INTERNOS (Del 2do archivo)
        // Asegura que el header fijo no oculte el destino.
        // Adaptado para usar #mainHeader para calcular el offset.
        // ============================================================
        function smoothScrollTo(targetSelector) {
            try {
                 const targetElement = document.querySelector(targetSelector);
                 if (targetElement) {
                     // Obtener la altura del header fijo para compensar la posición de scroll
                     // Si el header no se encuentra, o no tiene offsetHeight, usa un offset por defecto o 0
                    const headerOffset = (mainHeader ? mainHeader.offsetHeight : 0) + 20; // Añadir un margen extra después del header

                     // Calcula la posición a la que scrollar
                     const elementPosition = targetElement.getBoundingClientRect().top; // Posición del elemento respecto al viewport
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset; // Posición absoluta - offset

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                     console.log(`Smooth scrolling to: ${targetSelector}`);

                 } else {
                      console.warn(`SmoothScrollTo: target element "${targetSelector}" not found.`);
                     // Fallback: si el elemento no se encuentra, no hacer nada o dar feedback
                 }
            } catch (error) {
                console.error("Error in smoothScrollTo:", error);
            }
        }

        // Apply smooth scroll to internal hash links across the page (excluding specific elements handled differently)
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            // Excluir enlaces dentro del panel de filtro, ya manejados arriba (con cierre del menú primero)
            // Excluir links dentro de elementos manejados diferente (e.g., carousels, modales, tabs) si existen.
            if (!anchor.closest('#filter-panel') && !anchor.closest('.modal-content') && !anchor.classList.contains('scroll-down-indicator')) { // Added scroll-down-indicator
                anchor.addEventListener('click', function (e) {
                     const targetHref = this.getAttribute('href');
                     // Excluir si el target es solo '#' o vacío, que generalmente significa scroll al top o permanecer en la página
                    if (targetHref === '#' || targetHref === '') {
                        e.preventDefault(); // Previene el comportamiento por defecto
                        if (targetHref === '#') {
                             window.scrollTo({ top: 0, behavior: 'smooth' }); // Ir al principio si es solo '#'
                        }
                         playSound('click', 0.6); // Sonido al click en enlaces internos simples
                    } else {
                       // Solo prevenir el comportamiento por defecto para enlaces hash válidos que maneja smoothScrollTo
                        e.preventDefault();
                        // La función smoothScrollTo incluye el scroll
                        playSound('click', 0.6); // Sonido al click en enlaces internos suaves
                        smoothScrollTo(targetHref);
                    }
                });
                // Add hover sound to these internal links (using generic hover sound) - Filter links already handled
                 // Check it's not already getting a hover sound from the generic button/link listener earlier
                // To avoid double handlers, could add a class like 'js-handle-scroll' and use that selector, or specifically exclude classes.
                 // Let's rely on the earlier general listeners for hover sounds for now.

            }
        });

        // Add specific listener for the hero scroll-down indicator link
         const scrollDownLink = document.querySelector('.scroll-down-indicator');
         if (scrollDownLink) {
              scrollDownLink.addEventListener('click', function (e) {
                  e.preventDefault();
                   const targetHref = this.getAttribute('href');
                  if (targetHref && targetHref.startsWith('#')) {
                       smoothScrollTo(targetHref);
                       // No sound here, maybe different from general click? Or add one: playSound('click', 0.6);
                  }
              });
               // Optional: Hover sound for scroll-down indicator
              scrollDownLink.addEventListener('mouseenter', () => playSound('hover', 0.2));
         }



        // ============================================================
        // ANIMACIONES AL HACER SCROLL (REVEAL - Del 2do archivo)
        // Se activa cuando los elementos con la clase 'reveal' entran al viewport.
        // Agregada a elementos relevantes en el HTML.
        // ============================================================
         console.log(`Found ${revealElements.length} elements with .reveal class.`);

        if (typeof IntersectionObserver !== 'undefined' && revealElements.length > 0) {
            console.log("IntersectionObserver supported. Reveal animations active.");
             const revealObserver = new IntersectionObserver((entries, observer) => {
                 entries.forEach(entry => {
                     if (entry.isIntersecting) {
                         // Adding 'visible' class triggers the CSS transition
                         entry.target.classList.add('visible');

                          // Check if the target element has immediate children that should be staggered
                         // Apply a slight delay to immediate children of a revealed element for a ripple effect
                          const delayableChildren = entry.target.querySelectorAll('.animation-trigger'); // Or define a specific class like .stagger-animate-child
                           delayableChildren.forEach((child, index) => {
                                // Only apply delay if it hasn't been revealed yet
                                 if (!child.classList.contains('visible')) {
                                    child.style.transitionDelay = `${index * 0.1}s`; // Example: 100ms delay per child
                                    // Force a reflow before adding the 'visible' class
                                     void child.offsetWidth;
                                    child.classList.add('visible'); // Apply the animation state
                                }
                           });


                         // Optional: Stop observing the element after it has animated once
                          // observer.unobserve(entry.target); // Uncomment if you only want to animate once


                         // If this revealed element contains skill bars, trigger their animation too
                          // This assumes reveal might trigger other animations once their container is visible
                           if (entry.target.id === 'skills' || entry.target.querySelector('.skills-grid')) { // Or a specific class on the container
                              triggerVisibleSkillBars(entry.target); // Pass the container element
                          }
                          // Similarly, trigger FAQ toggle appearance or any other element that needs a check *after* its container is visible

                     } else {
                          // Optional: If you want to animate each time they come into view (resets animation when leaving viewport)
                         // entry.target.classList.remove('visible');
                         // Remove delays too
                          // entry.target.querySelectorAll('.animation-trigger').forEach(child => {
                           //   child.classList.remove('visible'); // If container reset happens
                            //   child.style.transitionDelay = ''; // Remove explicit delay
                           //});

                     }
                 });
             }, {
                root: null, // Observe against the viewport
                threshold: 0.1, // Percentage of target visible (adjust as needed, lower for elements entering early)
                rootMargin: '0px 0px -80px 0px' // Grow or shrink the viewport box (top, right, bottom, left)
                                               // -80px from bottom means trigger when 80px from the bottom is showing
                                               // Adjust based on footer/bottom elements
            });

            // Start observing all elements with the 'reveal' class
            revealElements.forEach(el => {
                 // Reset initial state (CSS handles opacity: 0 and transform initially)
                 // Set the initial transition property to include a potential delay.
                 // el.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out, transition-delay 0s'; // Ensure default transition state without delay initially unless specified


                revealObserver.observe(el);
            });

             // Note: `triggerVisibleReveals()` function is defined below and is called *once* by the loader logic after page load
             // to check for and animate elements that are already in the initial viewport BEFORE any scrolling happens.

        } else {
            // Fallback if IntersectionObserver not supported (show all elements immediately)
            console.warn("IntersectionObserver not supported, scroll animations disabled.");
            revealElements.forEach(el => {
                el.classList.add('visible'); // Just show it immediately
                 // If you used staggered animation-trigger, you might need to add visible to them too
                el.querySelectorAll('.animation-trigger').forEach(child => child.classList.add('visible'));
            });
             // In fallback, trigger skill bars immediately
             triggerVisibleSkillBars(); // Call the function (it checks for elements)
        }


         // Function to manually trigger 'visible' class for elements already in view on load (called once by loader)
         // This checks if an element is within the initial viewport area right after the loader hides.
         function triggerVisibleReveals() {
             if (revealElements.length === 0 || typeof IntersectionObserver !== 'undefined') {
                 // If no elements to reveal OR IntersectionObserver is available (it handles things from now on), just exit.
                 // Except, we still need to trigger the *initial* reveals for elements ALREADY in view on load if using the Observer.
                 // So this function *specifically* handles those initially visible elements when IO *is* supported.
             }
              console.log("Checking for initially visible elements to reveal...");

             revealElements.forEach(el => {
                  // Use IntersectionObserver's polyfill 'observe' logic manually or a simplified check.
                  // A simplified check: Is any part of the element within the initial viewport rectangle?
                 const rect = el.getBoundingClientRect();
                  // Define initial viewport check area (e.g., slight inset)
                  const viewportTop = 50; // pixels from top
                 const viewportBottom = window.innerHeight - 50; // pixels from bottom
                 const viewportLeft = 0; // Assuming no horizontal scroll initially
                 const viewportRight = window.innerWidth;

                 const isIntersectingOnLoad = !(rect.bottom < viewportTop || rect.top > viewportBottom || rect.right < viewportLeft || rect.left > viewportRight);


                 // If element is intersecting (at least partially) with the initial viewport
                 if (isIntersectingOnLoad) {
                     // Manually add the 'visible' class to trigger its CSS animation
                      el.classList.add('visible');

                      // Apply staggered delay to direct children with animation-trigger class *immediately*
                     el.querySelectorAll('.animation-trigger').forEach((child, index) => {
                         if (!child.classList.contains('visible')) {
                             // Small base delay + stagger
                            child.style.transitionDelay = `${50 + index * 50}ms`; // Example: 50ms base + 50ms stagger per child
                            // Force reflow to apply transitionDelay before adding visible class
                             void child.offsetWidth;
                            child.classList.add('visible');
                         }
                     });

                     // Check and trigger related animations (like skill bars) for THIS element/section if it contains them
                     if (el.id === 'skills' || el.querySelector('.skills-grid')) {
                         triggerVisibleSkillBars(el); // Trigger skills for this container
                     }
                      // Similarly, trigger other animations here if needed.
                      // e.g. if(el.id === 'faqs') initFaqs(el); // If FAQ needs JS init on visibility
                      // if(el.id === 'projects-grid-section') initProjectSearch(el); // If search needs init when its section is visible


                 }
                  // Note: Elements that are NOT visible initially are handled by the IntersectionObserver's later 'isIntersecting' callbacks.
                  // This function is primarily a patch for the elements already in the viewport on page load.
             });
         }


        // ============================================================
        // BARRAS DE PROGRESO DINÁMICAS (SKILLS) (Del 2do archivo)
        // Anima las barras de progreso cuando son visibles.
        // Necesita sección de Habilidades con .progress-bar-fill y data-skill-level (Añadidas como ejemplo)
        // La animación es vía CSS `transition` cuando JS cambia `width`.
        // ============================================================

         // Esta función ahora es llamada por el revealObserver O triggerVisibleReveals.
         // Debe buscar barras de habilidad *dentro* del elemento contenedor que se reveló.
         function triggerVisibleSkillBars(containerElement = document) { // Default to whole document if container not specified (fallback/manual call)
             // Seleccionar solo las barras dentro del contenedor dado que NO tengan ya el width establecido
             // Esto evita re-animar si el reveal se repite
             const fillsToAnimate = containerElement.querySelectorAll('.progress-bar-fill[data-skill-level]:not([style*="width:"])');
              console.log(`Attempting to trigger skill bars. Found ${fillsToAnimate.length} fills in container.`, containerElement);

             if (fillsToAnimate.length > 0) {
                 fillsToAnimate.forEach(fillEl => {
                     const level = fillEl.getAttribute('data-skill-level');
                     if (level !== null && level !== '') {
                         // Small delay before setting the width to make the animation noticeable
                          // Add a random factor for a less sterile feel
                          setTimeout(() => {
                             fillEl.style.width = level + '%';
                             // Optional: Add a class like 'animated' or remove data-skill-level
                             // fillEl.setAttribute('data-animated', 'true');
                          }, 100 + (Math.random() * 100)); // Example: 100ms base delay + up to 100ms random
                     }
                 });
                  console.log("Triggered animation for visible skill bars.");
             } else {
                // console.log("No new skill bars found to trigger in this container.");
             }
         }
         // La función triggerVisibleSkillBars es definida aquí, pero se llama desde el loader (para elementos inicialmente visibles)
         // y opcionalmente desde el IntersectionObserver (si se quiere animar cada vez que aparecen, comentado).
         // En el fallback sin IntersectionObserver, también se llamaría después del loader/inicio.

        // Initial call to triggerVisibleSkillBars should be in the loader's completion logic for initial visible ones.
        // The IO listener would handle subsequent scrolls.

        // --- Original code used observer for skills ---
        /* const skillFills = document.querySelectorAll('.progress-bar-fill'); // Redefine/ensure this exists
         if (skillFills.length > 0) {
              if (typeof IntersectionObserver !== 'undefined') {
                 // Define skillObserver here if you want it specific to skill fills
                 // The `triggerVisibleSkillBars` approach triggered by the section reveal is perhaps cleaner
                 // Re-implement the skill observer logic if needed, targeting *only* .skill-item or .progress-bar-fill directly
                 // ... Observer code targeting skillFills ...
             } else {
                 // Fallback trigger - Already handled by main fallback or triggerVisibleReveals fallback.
             }
         } else {
              console.log("No skill bars found in HTML. Skill bar JS inactive.");
              // Define triggerVisibleSkillBars as a no-op function if elements are not found.
              window.triggerVisibleSkillBars = () => {}; // Simple fallback, better would be in the module pattern or a dedicated init function
         } */
         // Moved the `triggerVisibleSkillBars` definition out and calls it when a containing element is revealed or on load.

        // Let's ensure triggerVisibleSkillBars exists even if no skill bars are initially in HTML
         if (!window.triggerVisibleSkillBars) window.triggerVisibleSkillBars = () => {}; // Safety check


        // ============================================================
        // FAQ INTERACTIVO (Del 2do archivo)
        // Toggle answer visibility on question click.
        // Needs FAQ section HTML (.faq-item > .faq-question + .faq-answer) (Añadidas como ejemplo)
        // ============================================================
        if (faqItems.length > 0) {
             console.log(`Found ${faqItems.length} FAQ items. Initializing FAQ toggle.`);

             faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                const answer = item.querySelector('.faq-answer'); // Get the answer element

                if(question && answer) { // Ensure both question and answer elements exist in the item
                     // Initially hide the answer content using max-height trick and padding top
                     // This might be handled by CSS if .faq-answer has `max-height: 0` and `padding-top: 0` initially
                     // CSS now has these initial states.

                    question.addEventListener('click', () => {
                        playSound('click', 0.4); // Sound on toggle click

                        // Toggle 'open' class on the parent .faq-item
                        const wasOpen = item.classList.contains('open');
                        // Close all other FAQs first (accordion behavior) - optional
                        /*
                         faqItems.forEach(otherItem => {
                             if (otherItem !== item && otherItem.classList.contains('open')) {
                                 otherItem.classList.remove('open');
                                  // Reset height explicitly if necessary (css transition should handle it)
                                 // otherItem.querySelector('.faq-answer').style.maxHeight = null; // Or '0px'
                             }
                         });
                        */
                         // Toggle the clicked item
                         item.classList.toggle('open', !wasOpen); // Toggle open state. If it was open, make it closed.

                        // Optional: Adjust max-height for smooth toggle (CSS transition handles this now)
                        /*
                        if (!wasOpen) {
                            // Temporarily set height to scroll height to animate FROM its current size to auto or large value
                             answer.style.maxHeight = answer.scrollHeight + "px"; // Animates to scroll height
                            // Once animation finishes (or immediately after timeout), set max-height to a fixed large value
                             // or remove it, so content changes later don't get cut off.
                             // Needs a small timeout if setting from 0 to scrollHeight + then to large number
                             setTimeout(() => {
                                 answer.style.maxHeight = '500px'; // Sufficiently large max-height or set to null for 'auto' if needed
                             }, 500); // Match transition time

                        } else {
                             // Setting to scrollHeight before setting to 0 makes closing animation work
                             answer.style.maxHeight = answer.scrollHeight + "px"; // Set explicitly to current height first
                             setTimeout(() => {
                                answer.style.maxHeight = '0'; // Then animate to 0
                            }, 10); // Very small delay

                        } */ // --- Logic is simpler when controlled purely by CSS transitions on max-height+padding on the 'open' class


                    });
                     // Optional: Add hover sound to questions
                    question.addEventListener('mouseenter', () => {
                         if (!item.classList.contains('open')) { // Play hover sound only if not currently open
                            playSound('hover', 0.2); // Light hover sound
                        }
                    });

                } else {
                     console.warn("FAQ item found, but missing .faq-question or .faq-answer child:", item);
                }
            });
        } else {
            console.log("No elements with class '.faq-item' found. FAQ functionality inactive.");
        }


        // ============================================================
        // LAZY LOADING PARA IMÁGENES y VIDEOS (data-src) (Del 2do archivo)
        // Load images and videos only when they are about to enter the viewport.
        // Targets img[data-src] and potentially video elements or their sources/posters with data-src
        // Uses elements already added to the HTML.
        // ============================================================
        // Select elements that need lazy loading: images with data-src, video sources with data-src, video posters set via data attribute on video tag.
        const lazyElements = document.querySelectorAll('img[data-src], video[data-src]'); // Simplify selection - target video directly if it uses data-src attribute (e.g., for poster)


         console.log(`Found ${lazyElements.length} potential lazy elements.`);

         if (typeof IntersectionObserver !== 'undefined' && lazyElements.length > 0) {
             console.log("IntersectionObserver supported. Lazy loading active.");
             const lazyObserver = new IntersectionObserver((entries, observer) => {
                 entries.forEach(entry => {
                     if (entry.isIntersecting) {
                         const lazyEl = entry.target;
                         const isVideo = lazyEl.tagName === 'VIDEO';
                         const isImage = lazyEl.tagName === 'IMG';

                         if (isImage) {
                             const imgSrc = lazyEl.dataset.src;
                             if (imgSrc) {
                                 // Set the actual source, will trigger load
                                  lazyEl.src = imgSrc;
                                 // Handle loaded state
                                  lazyEl.onload = () => {
                                     lazyEl.classList.add('loaded');
                                     lazyEl.removeAttribute('data-src'); // Clean up attribute
                                      if (lazyEl.hasAttribute('loading')) lazyEl.removeAttribute('loading'); // Remove loading="lazy" if present
                                  };
                                 // Handle error state
                                  lazyEl.onerror = () => {
                                     console.error("Error loading lazy image:", imgSrc);
                                      lazyEl.classList.add('error'); // Add a class for error styling
                                      lazyEl.removeAttribute('data-src');
                                  };
                             } else {
                                 console.warn("Lazy image element missing data-src:", lazyEl);
                                  lazyEl.classList.add('error');
                             }
                         } else if (isVideo) {
                              const videoSrc = lazyEl.dataset.src; // Could store video source here
                              const videoPoster = lazyEl.dataset.poster; // Or poster
                             const videoSources = lazyEl.querySelectorAll('source[data-src]'); // Or sources within

                             if (videoPoster) {
                                 lazyEl.poster = videoPoster;
                                 lazyEl.removeAttribute('data-poster'); // Remove data-poster
                             }

                             if (videoSrc) { // If primary source is on the video tag itself
                                lazyEl.src = videoSrc;
                                lazyEl.removeAttribute('data-src');
                             }

                              // Update source tags if they use data-src
                             videoSources.forEach(source => {
                                 const src = source.dataset.src;
                                 if (src) {
                                     source.src = src;
                                     source.removeAttribute('data-src');
                                 }
                             });


                            // Now tell the video element to load its sources if preload='none'
                            if (lazyEl.getAttribute('preload') === 'none') {
                                 lazyEl.load(); // Trigger loading
                                 lazyEl.setAttribute('preload', 'auto'); // Or remove the attribute
                            }


                            // Video doesn't have a single 'onload' event reliably indicating it's ready to play fully,
                            // but we can add a class once it starts buffering or metadata is loaded.
                             lazyEl.addEventListener('loadedmetadata', () => lazyEl.classList.add('loaded')); // Class when metadata is loaded
                            // lazyEl.addEventListener('loadeddata', () => console.log('Video data loaded')); // Class when first frame data loads
                            // lazyEl.addEventListener('canplay', () => console.log('Video can play')); // Class when it can play

                             lazyEl.onerror = () => {
                                console.error("Error loading lazy video:", lazyEl.currentSrc || lazyEl.dataset.src);
                                 lazyEl.classList.add('error');
                             }

                         } else {
                            console.warn("Lazy load triggered on non-image/video element with data-src:", lazyEl);
                             // Ensure element becomes visible even if not handled as image/video?
                             // If its opacity was 0 initially (controlled by .reveal for containers or other CSS)
                              // It might be better to add the .loaded class to its parent or grandparent container
                              // if opacity:0 was applied there for lazy loading effect.
                              // For now, just remove data-src attribute as a fallback cleanup.
                             if (lazyEl.hasAttribute('data-src')) lazyEl.removeAttribute('data-src');
                             // If a source tag was matched directly:
                             if (lazyEl.tagName === 'SOURCE' && lazyEl.parentElement.tagName === 'VIDEO') {
                                 const videoParent = lazyEl.parentElement;
                                  if (lazyEl.hasAttribute('data-src')) lazyEl.src = lazyEl.dataset.src;
                                 lazyEl.removeAttribute('data-src');
                                 if (videoParent.getAttribute('preload') === 'none') videoParent.load();
                             }

                         }


                         // Stop observing the element once it has loaded (or loading has been initiated for videos)
                          // Small delay before unobserve to allow image onload to potentially finish?
                         setTimeout(() => { observer.unobserve(lazyEl); }, 500); // Wait a bit before unobserving

                     }
                 });
             }, { rootMargin: "0px 0px 200px 0px" }); // Start loading when element is 200px away from viewport bottom


             lazyElements.forEach(el => lazyObserver.observe(el)); // Start observing all potential lazy elements

         } else {
              // Fallback: If IntersectionObserver not supported, load all elements immediately
              console.warn("IntersectionObserver not supported, lazy loading disabled. Loading all assets.");
              lazyElements.forEach(el => {
                  const isVideo = el.tagName === 'VIDEO';
                  const isImage = el.tagName === 'IMG';

                  if (isImage) {
                      if (el.dataset.src) el.src = el.dataset.src;
                      el.removeAttribute('data-src');
                       if (el.hasAttribute('loading')) el.removeAttribute('loading'); // Remove loading="lazy" if present
                      el.classList.add('loaded'); // Add loaded class even if no animation relies on it
                  } else if (isVideo) {
                       if (el.dataset.poster) el.poster = el.dataset.poster;
                       el.removeAttribute('data-poster');

                       // Find source tags within the video and load them
                       el.querySelectorAll('source[data-src]').forEach(source => {
                            if (source.dataset.src) source.src = source.dataset.src;
                           source.removeAttribute('data-src');
                       });
                        if (el.dataset.src) el.src = el.dataset.src; // If primary source on video tag
                        el.removeAttribute('data-src');

                       // Trigger video load if preload is 'none' or similar
                       if (el.getAttribute('preload') === 'none') el.load();
                        el.classList.add('loaded'); // Add loaded class (e.g., opacity transition)
                  } else if (el.tagName === 'SOURCE' && el.parentElement.tagName === 'VIDEO') { // Source tag detected directly
                      const videoParent = el.parentElement;
                       if (el.dataset.src) el.src = el.dataset.src;
                      el.removeAttribute('data-src');
                       if (videoParent.getAttribute('preload') === 'none') videoParent.load();
                      videoParent.classList.add('loaded'); // Mark the parent video as loaded
                  }
                   // For any other element type matched by the selector, just remove data-src
                  if (el.hasAttribute('data-src')) el.removeAttribute('data-src');

              });
         }


        // ============================================================
        // FILTRO/BÚSQUEDA INTERNA PROYECTOS (Del 2do archivo)
        // Filters project items based on input text.
        // Needs search input (#searchProjectInput), button (#searchProjectBtn),
        // a container for items (#projectGrid), and the items themselves (.project-item).
        // Using .projectx-container as #projectGrid and divs inside it as project items for demonstration.
        // --- WARNING: This implementation is based on a simple flat list of repeatable `.project-item` divs inside `#projectGrid`.
        // Your ProyectoX is complex. Adapt `filterProjects` function if you want to filter the content *within* `.projectx-details`, `.projectx-visuals`, `.projectx-video`
        // instead of hiding/showing a list of repeated items. ---
        // For now, the code assumes a structure like: <div id="projectGrid"><div class="project-item">...</div> ... </div>
        // And your #proyectoX section is containing the projectGrid div.
        // To make it work with ProyectoX, the allProjectItems variable would need to select
        // the content divs instead, or the filter logic would need to search different elements.
        // Temporarily using #projectGrid = .projectx-container for demonstration.

         // Only enable search logic if search input, button, AND at least one project item container are found
        if (searchProjectInput && searchProjectBtn && projectGrid && allProjectItems.length > 0) {

             console.log("Project search logic initialized.");
             function filterProjects() {
                 const term = searchProjectInput.value.toLowerCase().trim();
                 let visibleCount = 0;

                 allProjectItems.forEach(item => {
                     // Get text content from relevant parts of the project item
                     // Adapt these selectors if your repeatable project items have different structures
                     const title = item.querySelector('h3')?.textContent.toLowerCase() || ''; // Assuming each item has an H3
                     const description = item.querySelector('p')?.textContent.toLowerCase() || ''; // Assuming each item has a P
                     // Assuming tech tags are spans within a .tech-tags container (or similar) inside the item
                     const tags = Array.from(item.querySelectorAll('.tech-tags span')).map(span => span.textContent.toLowerCase()).join(' '); // Join all tech tag text

                     const itemText = `${title} ${description} ${tags}`; // Combine all searchable text into a single string

                     // Check if the combined text includes the search term
                     const isMatch = itemText.includes(term);

                      // Apply display style
                      // Using style.display = 'none' removes it from layout
                     item.style.display = isMatch ? '' : 'none';

                      if (isMatch) {
                         visibleCount++;
                         // If you had staggered reveal animation inside the grid, you might need to re-trigger it here,
                         // e.g. add 'visible' class back with a delay or trigger a new reveal sequence just for shown items.
                         // This is complex, simple show/hide via display is sufficient for basic filtering.
                      }

                 });

                 // Optional: Show a message if no results found
                 // Need an element to display messages, e.g., <div id="noResultsMsg" style="display: none;">No results found.</div>
                  const noResultsMsgEl = document.getElementById('noResultsMsg'); // Needs this ID in HTML
                  if(noResultsMsgEl) {
                       noResultsMsgEl.style.display = visibleCount === 0 && term !== '' ? '' : 'none';
                  }
                 // Or use a notification:
                  if (visibleCount === 0 && term !== '' && !document.querySelector('.notification.no-results')) { // Prevent multiple no-results notifications
                       showNotification(`No items found matching "${term}".`, 'info', 3000);
                  }
             }

            // Event listeners for search input (trigger filter on Enter key) and button click
            searchProjectBtn.addEventListener('click', () => { playSound('click', 0.6); filterProjects(); });

             searchProjectInput.addEventListener('keyup', (e) => {
                 if (e.key === 'Enter') { // Trigger filter on Enter key
                     filterProjects();
                      playSound('click', 0.6); // Sound on pressing enter
                 }
                 // Optional: Filter instantly as user types *only if the input is not empty*
                  // This can be heavy on performance for large lists. Enable if list is small.
                  // If input is empty, clear filter.
                  /* if (searchProjectInput.value.trim() === '') {
                      filterProjects(); // Show all items
                  } */
             });

            // Event listener to reset filter if the input is cleared using backspace/delete or clipboard cut
             searchProjectInput.addEventListener('input', () => {
                 if (searchProjectInput.value.trim() === '') {
                     filterProjects(); // Show all items when input is empty
                 }
             });


             // Initial filter on load to ensure everything is visible (if input is initially empty)
             // This will run immediately if search elements are found on DOMContentLoaded.
             // It's better to call this *after* reveal animations, when elements are actually laid out.
             // Let's assume filterProjects is called manually once content is fully loaded and displayed.
             // For now, call it here if loader fallback is active. If loader runs, call after.
             // A simple solution: Call filterProjects from within the loader's completion logic, or the initial triggerVisibleReveals().
              // Calling it within triggerVisibleReveals or from a dedicated post-load init function is safer.
              // For now, keeping it here ensures it runs, but its impact on hidden elements might be odd if run before display.
              // Assuming for now this will work OK or will be refined based on full page load state.
             // filterProjects(); // Let's disable this call here and assume it's called later (e.g. by triggerVisibleReveals on its section or by loader).


        } else {
             console.log("Project search elements not fully found (input, button, #projectGrid, or .project-item items). Project search disabled.");
             // Hide the search container if elements are missing to avoid a non-functional UI part
              const searchContainer = document.querySelector('.internal-search'); // Select using the class
             if (searchContainer) searchContainer.style.display = 'none';
              // Define filterProjects as a no-op function if elements are not found, to avoid errors
              window.filterProjects = () => { console.log("filterProjects (no-op): Search elements missing."); };
        }

        // Need to ensure filterProjects is callable from outside its block (e.g. from init func)
        // Let's export or attach to window for simplicity if needed from loader
        // window.filterProjects = filterProjects; // If needed globally


        // ============================================================
        // DESCARGAS (Del 2do archivo)
        // Trigger file download on button click.
        // Targets elements with class 'download-trigger' and data-file attribute.
        // Uses elements added as example in HTML.
        // ============================================================
        if (downloadButtons.length > 0) {
             console.log(`Found ${downloadButtons.length} download triggers. Initializing download logic.`);
            downloadButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                     e.preventDefault(); // Prevent default link/button behavior first
                    playSound('click', 0.6); // Sound on download click

                    const fileUrl = btn.getAttribute('data-file'); // Use data-file attribute
                    if (fileUrl) {
                         // Optional: Check if the file path is relative and make it absolute if necessary
                         // Example: If starts with /docs, ensure it's /your-portfolio-root/docs/...

                        // Create a temporary anchor element programmatically
                        const link = document.createElement('a');
                        link.href = fileUrl;
                        // Suggest a filename (take the last part of the URL, or a specified data-filename)
                         link.download = btn.getAttribute('data-filename') || fileUrl.split('/').pop() || 'download'; // data-filename overrides URL name
                         link.target = '_blank'; // Open in new tab is often required by browser security for download prompts

                        // Programmatically click the link
                        document.body.appendChild(link); // Required for some browsers (e.g., Firefox)
                         // Use a small delay to ensure element is attached and link.click() works reliably
                         setTimeout(() => {
                             try {
                                  link.click();
                                  console.log(`Initiated download for: ${fileUrl}`);
                                   showNotification(`Download started: ${link.download}`, 'info', 4000); // User feedback
                             } catch (clickError) {
                                 console.error("Error triggering programmatic click for download:", clickError);
                                  showNotification('Download failed (browser restriction?).', 'error', 5000);
                                 // Provide the link for manual download as a fallback
                                  console.warn(`Manual download link (copy/paste): ${link.href}`);
                             } finally {
                                  // Remove the temporary link element after a slight delay
                                 setTimeout(() => {
                                      if (link.parentElement) link.parentElement.removeChild(link);
                                 }, 100); // Short delay for link.click() to potentially register

                             }
                         }, 10); // Small delay before clicking


                    } else {
                        console.error("Download trigger clicked but no 'data-file' attribute found:", btn);
                         showNotification('Download failed: File path missing from trigger.', 'error', 5000); // Notify user
                    }
                });
                 // Optional: Add hover sound
                btn.addEventListener('mouseenter', () => playSound('hover', 0.3));
            });
        } else {
            console.log("No elements with class '.download-trigger' found. Download functionality inactive.");
        }


        // ============================================================
        // MODALES DE CERTIFICADOS (Del 2do archivo)
        // Logic to open and close modals.
        // Needs modal HTML structure (.modal) and trigger buttons/links (.modal-trigger, data-modal-id) (Añadidos como ejemplo)
        // Uses elements added to the HTML.
        // ============================================================

        // Only set up modal logic if any triggers or modals are found
        if (modalTriggers.length > 0 || modals.length > 0) {
             console.log(`Modal logic initialized. Found ${modals.length} modals and ${modalTriggers.length} triggers.`);

            // Function to open a modal by its ID
            function openModal(modalId) {
                 // Close any currently open modals first (accordion style or just clean up)
                 const currentlyOpenModal = document.querySelector('.modal.open');
                 if (currentlyOpenModal && currentlyOpenModal.id !== modalId) {
                      console.log(`Closing currently open modal: ${currentlyOpenModal.id}`);
                     closeModal(currentlyOpenModal, false); // Close without sound to avoid sound conflicts
                 }

                 const modalToOpen = document.getElementById(modalId);
                 if (modalToOpen) {
                    modalToOpen.classList.add('open'); // Trigger CSS transition (display & opacity/transform)
                    // Disable body scroll when modal is open
                    bodyEl.style.overflow = 'hidden';
                    console.log(`Opened modal: #${modalId}`);
                     playSound('click', 0.5); // Sound on opening modal
                     modalToOpen.setAttribute('aria-hidden', 'false'); // ARIA: indicates visible state
                     // Focus the modal for accessibility (e.g., focus the first focusable element inside or the modal container itself)
                      // For simplicity, focusing the modal content or modal overlay
                      // Use setTimeout to allow display transition to complete
                     setTimeout(() => { modalToOpen.focus(); }, 50); // Attempt to focus the modal div itself

                 } else {
                    console.error("Attempted to open modal but modal not found with ID:", modalId);
                     showNotification(`Error: Target modal "${modalId}" not found.`, 'error', 4000); // Notify user
                 }
            }

            // Function to close a specific modal element
            function closeModal(modal, withSound = true) {
                 if (modal && modal.classList.contains('open')) {
                     modal.classList.remove('open'); // Trigger CSS transition to hide
                      modal.setAttribute('aria-hidden', 'true'); // ARIA: indicates hidden state

                     // Re-enable body scroll after a slight delay to allow closing animation
                     setTimeout(() => {
                          // Only re-enable scroll if NO other modals are currently open
                          const anyModalStillOpen = document.querySelector('.modal.open');
                         if (!anyModalStillOpen) { // Check if *any* modal still has the 'open' class
                             bodyEl.style.overflow = '';
                              // If returning focus from a modal, ideally restore focus to the element that opened it
                              // (Requires storing the triggering element's reference on open)
                              // For simplicity, maybe just focus the body or a known element (e.g., first link in header)
                              // Or rely on browser's default focus handling after element removal/hide.
                         }
                         // Ensure modal is completely hidden (display: none) after transition to prevent interaction
                         // This is handled by the CSS transition + `visibility` property transition
                         // No need to manually set display:none if CSS handles visibility.
                          // If using JS for display: none, need to wait longer.

                     }, 300); // Match transition duration of modal's opacity/visibility

                      console.log(`Closed modal: #${modal.id}`);
                      if (withSound) playSound('click', 0.4); // Sound on closing modal

                 }
            }

            // Event listeners for modal triggers (buttons, links, etc.)
            modalTriggers.forEach(button => {
                // Add click event to open the corresponding modal
                button.addEventListener('click', () => {
                    const modalId = button.dataset.modalId; // Get target modal ID from data-modal-id attribute
                    if (modalId) {
                       openModal(modalId);
                    } else {
                       console.warn("Modal trigger clicked without data-modal-id:", button);
                       showNotification('Error: Target modal ID missing from trigger.', 'error', 4000);
                    }
                });
                 // Optional: Add hover sound to modal triggers
                button.addEventListener('mouseenter', () => playSound('hover', 0.3));
            });

            // Event listeners for modal close buttons (inside modals)
            closeModals.forEach(button => {
                button.addEventListener('click', () => {
                    // Find the closest parent modal element by traversing up the DOM
                    const modal = button.closest('.modal');
                    closeModal(modal); // Pass the actual modal element to closeModal
                });
                 // Optional: Add hover sound for close button
                 button.addEventListener('mouseenter', () => playSound('hover', 0.3));
            });

            // Event listeners to close modal by clicking outside the modal-content area, on the modal overlay itself
            modals.forEach(modal => {
                modal.addEventListener('click', (e) => {
                    // Check if the click target is the modal container element itself (the background overlay part)
                    // This relies on the event bubbling up from the content being stopped, OR checking event.target directly
                    // Stopping propagation inside modal-content on click is needed OR check e.target carefully
                     if (e.target === modal) { // If the direct click target IS the modal background div
                        closeModal(modal); // Close that specific modal
                    }
                });
                // Ensure clicks inside the modal-content DON'T close the modal by stopping propagation
                 const modalContent = modal.querySelector('.modal-content');
                if(modalContent) {
                     modalContent.addEventListener('click', (e) => {
                         e.stopPropagation(); // Stop the click event from bubbling up to the modal overlay
                     });
                }
                 // Optional: Add keydown listener specifically to open modals for Escape key?
                 // Or use a global keydown listener and find the active modal.
                 // A global listener for Escape is implemented below.
            });

             // Global Event listener to close the top-most (last opened) modal on Escape key press
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    // Find all modals currently open
                    const openModals = document.querySelectorAll('.modal.open');
                    if (openModals.length > 0) {
                         // Close the last one found in the NodeList (assumed to be the top-most)
                        const topModal = openModals[openModals.length - 1];
                        closeModal(topModal); // Close with sound (default)
                    }
                }
            });

        } else {
            console.log("No modal triggers or modal elements found. Modal functionality inactive.");
        }


        // ============================================================
        // ACTUALIZACIONES DEL HUD (Reloj y Scroll - Del 2do archivo)
        // Live clock and scroll percentage display on the HUD.
        // Needs hudClock and hudScrollIndicator elements with IDs (Añadidos).
        // ============================================================

        // Función para actualizar el reloj del HUD
        function updateClock() {
            if (!hudClock) return; // Salir si el elemento del reloj no existe

            const now = new Date();
            // Format hours, minutes, and seconds with leading zeros
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
             const currentTimeString = `${hours}:${minutes}:${seconds}`;

             // Update the text content only if it has changed to minimize DOM writes
            if (hudClock.textContent !== currentTimeString) {
                hudClock.textContent = currentTimeString;
            }
        }

        // Función para iniciar el reloj del HUD
        function startClock() {
            if (hudClock) {
                 console.log("HUD Clock initialized.");
                updateClock(); // Establecer la hora inicial inmediatamente al iniciar
                // Actualizar el reloj cada segundo (1000 ms)
                setInterval(updateClock, 1000);
            } else {
                console.warn("HUD Clock element (#hudClock) not found.");
            }
        }

        // Función para actualizar el indicador de scroll del HUD
        function updateScrollIndicator() {
            if (!hudScrollIndicator) return; // Salir si el elemento no existe

            // Get the total height of the body content that can be scrolled
            const bodyHeight = document.body.scrollHeight;
            const windowHeight = window.innerHeight;

             // Calculate the maximum scrollable distance
            // This is the total height of the document MINUS the visible height of the viewport.
            const scrollableHeight = bodyHeight - windowHeight;

            // If the document is not scrollable (content height is less than or equal to window height)
             if (scrollableHeight <= 0) {
                 // Ensure the indicator shows 100% or a message like 'End'
                  const currentValueEl = hudScrollIndicator.querySelector('span:last-child');
                  const endText = '100%'; // Or 'END'
                 if (currentValueEl && currentValueEl.textContent !== endText) {
                     currentValueEl.textContent = endText; // Set to 100% when no scroll is possible
                 }
                 return; // Exit if not scrollable
             }

            // Get the current vertical scroll position (how much has been scrolled down from the top)
            const currentScrollY = window.scrollY;

            // Calculate the scroll percentage: (current scroll position / total scrollable distance) * 100
            // Ensure it's between 0% and 100% in case of browser quirks or overscroll.
            const scrollPercent = Math.min(100, Math.max(0, (currentScrollY / scrollableHeight) * 100));

             // Format the percentage (e.g., to 0 decimal places) and add the '%' symbol.
             const scrollPercentString = `${scrollPercent.toFixed(0)}%`;

            // Update the text content of the second span in the HUD readout element
             const percentageTextElement = hudScrollIndicator.querySelector('span:last-child');
             if (percentageTextElement && percentageTextElement.textContent !== scrollPercentString) { // Update only if the text has changed
                 percentageTextElement.textContent = scrollPercentString;
             }
        }

        // Event listener for scroll events to update the indicator
        let scrollTimeout; // Variable para optimizar las llamadas a updateScrollIndicator (throttle/debounce)
        window.addEventListener('scroll', () => {
             // requestAnimationFrame ensures the function runs before the next paint, optimizing for smooth scrolling
            if (scrollTimeout) {
                 window.cancelAnimationFrame(scrollTimeout); // Cancel any pending frame request
             }
             // Request a new frame to update the scroll indicator
             scrollTimeout = window.requestAnimationFrame(updateScrollIndicator);
        }, { passive: true }); // Use passive event listener for better scroll performance, signals listener won't call preventDefault()

        // Call updateScrollIndicator initially to set the correct value on page load
        // This call is now placed inside the loader's completion logic or fallback to ensure elements are ready.


        // Implementar lógica para el panel de preferencias (Añadido al HTML)
        if (preferencesPanel && preferencesToggleBtn) {
             console.log("Preferences panel toggle initialized.");

            // Función para abrir/cerrar el panel
             function togglePreferencesPanel() {
                 // Toggle the 'open' class to trigger the CSS transition
                 preferencesPanel.classList.toggle('open');

                  // Check if the panel is now open
                  const isOpen = preferencesPanel.classList.contains('open');

                 // Optionally, play sound on toggle
                 playSound('click', 0.5); // Use a moderate click sound


                 // Save the state to localStorage (optional, depends on requirement)
                 // localStorage.setItem('preferencesPanelOpen', isOpen);
             }


            // Add event listener to the toggle button
            preferencesToggleBtn.addEventListener('click', togglePreferencesPanel);

            // Optional: Close panel if clicking anywhere outside the panel (delegation)
            /*
             document.addEventListener('click', (e) => {
                 const isOpen = preferencesPanel.classList.contains('open');
                 // If the panel is open and the click was NOT inside the panel itself
                 // and NOT on the toggle button, then close the panel.
                 if (isOpen && !preferencesPanel.contains(e.target) && !preferencesToggleBtn.contains(e.target)) {
                      closePreferencesPanel(); // Define a close function if toggle does open/close
                 }
             });
            */
            // Note: Clicking the toggle button again closes it, clicking on filter overlay/modals also closes.
            // Maybe just the button toggle is sufficient.

            // Optional: Add initial state load from localStorage (e.g. is panel open on load?)
            /*
             const savedPanelState = localStorage.getItem('preferencesPanelOpen') === 'true';
             if (savedPanelState) {
                  // Need a function to specifically open (not just toggle) if loading state
                 // preferencesPanel.classList.add('open');
             } else {
                 // Ensure it starts closed - default CSS state should handle this
                 // preferencesPanel.classList.remove('open'); // Or just rely on initial HTML/CSS state
             }
            */
            // Current setup starts closed visually via transform: translateY/X in CSS, open class overrides it.
             // JS will add the 'open' class on click, effectively initializing state from HTML.
        } else {
             console.log("Preferences panel elements not found. Panel functionality inactive.");
             // Ocultar el toggle button si el panel no se encuentra
            if(preferencesToggleBtn) preferencesToggleBtn.style.display = 'none';
        }


        // Optional: Implement Music Visualizer JS (requires AudioContext API)
        // This requires advanced browser APIs and significant code. The CSS provides a basic placeholder animation.
        // Skipping full implementation as it wasn't in the JS snippets.


        // Optional: Easter Egg JS (listen for key combination or event)
        // Example: Show message on a specific key press sequence (e.g., KONAMI code, or simple sequence)
         const easterEggMsgEl = document.getElementById('easterEggMsg');
         if (easterEggMsgEl) {
              console.log("Easter egg message element found. Add trigger logic.");
             // Simple example: Listen for specific key combination 'alt+shift+D' (Data)
             const triggerKeys = { key: 'd', ctrlKey: false, shiftKey: true, altKey: true }; // Example combo

             document.addEventListener('keydown', (e) => {
                 // console.log(`Key Down: ${e.key}, Ctrl: ${e.ctrlKey}, Shift: ${e.shiftKey}, Alt: ${e.altKey}`);
                 if (e.key.toLowerCase() === triggerKeys.key.toLowerCase() &&
                     e.ctrlKey === triggerKeys.ctrlKey &&
                     e.shiftKey === triggerKeys.shiftKey &&
                     e.altKey === triggerKeys.altKey)
                 {
                      console.log("Easter egg trigger sequence matched!");
                     // Prevent browser default action for the key combination if any
                     e.preventDefault();
                      // Show the message if not already visible
                     if (!easterEggMsgEl.classList.contains('visible')) {
                         easterEggMsgEl.classList.add('visible');
                         // Optional: Play a special sound
                          // playSound('secret', 0.8); // Need a 'secret' audio element
                         // Hide the message after a few seconds
                         setTimeout(() => {
                             easterEggMsgEl.classList.remove('visible');
                         }, 7000); // Message visible for 7 seconds
                     }
                 }
             });

         } else {
            console.log("Easter egg message element not found.");
         }



        // ============================================================
        // FUNCIONES DE INICIALIZACIÓN FINAL POST-CARGA
        // Estas se llaman UNA VEZ después de que el loader ha terminado.
        // ============================================================
        // No hay una sección específica aquí, las llamadas se integraron
        // en la lógica del loader al detectar el evento 'transitionend'.

        // ensure initial visibility state for header, content, hud is set AFTER loader is done,
        // either via JS adding 'visible' or if they are initially hidden by CSS and revealed by JS.
        // The provided CSS has: `#mainHeader, .main-content-wrapper, .hud-overlay { opacity: 0; transition: ...}`
        // and `#mainHeader.visible, .main-content-wrapper.visible, .hud-overlay.visible { opacity: 1; }`
        // So, adding the 'visible' class via JS is the intended way.

        console.log("DOMContentLoaded finished.");
        // Initial functions like startClock, updateScrollIndicator, triggerVisibleReveals are called
        // by the loader completion logic.


        // Fallback check: If DOMContentLoaded somehow fires and the loader is already inactive or missing
        // AND mainHeader/mainContent aren't visible, force their visibility.
        // This guards against situations where loader JS might not execute properly.
         if (loaderOverlayEl && !loaderOverlayEl.classList.contains('active')) {
             // Loader finished or never started. Ensure content is visible if it isn't already.
             if (mainHeader && !mainHeader.classList.contains('visible')) {
                  console.log("Loader finished/skipped, forcing main elements visible (fallback safety).");
                  mainHeader.classList.add('visible');
                  if(mainContent) mainContent.classList.add('visible');
                 if(hudOverlay) hudOverlay.classList.add('visible');
                 // Ensure post-load functions run if not already via loader callback
                  if (!window.__postLoadFunctionsRun) { // Use a flag to run only once
                      window.__postLoadFunctionsRun = true;
                     startClock();
                      updateScrollIndicator(); // Set initial indicator value
                      triggerVisibleReveals(); // Trigger reveals for elements in initial viewport
                      triggerVisibleSkillBars(); // Trigger skills for elements in initial viewport
                      console.log("Post-load safety functions executed.");
                      // Maybe show a different notification for skipped loader?
                      // showNotification('System operational (quickstart).', 'info', 3000);
                  }

             }
         }


    }); // Fin de DOMContentLoaded
  </script>

  <!-- Inyección dinámica de estilos para menú lateral y efectos visuales avanzados -->
  <script>
    // ...
    // (Coloca aquí el bloque de estilos JS que antes estaba dentro de <style>)
    const style = document.createElement('style');
    style.innerHTML = `
    .side-nav-compact { position:fixed; left:0; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.7); border-radius:0 8px 8px 0; z-index:1200; display:flex; flex-direction:column; gap:10px; padding:8px 4px; box-shadow:2px 0 10px #0006; transition:left 0.3s, box-shadow 0.3s; }
    .side-nav-compact a { color:var(--color-accent); font-size:1.3rem; margin:2px 0; display:flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; transition:background 0.2s; }
    .side-nav-compact a:hover { background:var(--color-accent); color:var(--color-bg); }
    .side-nav-toggle-btn { position:fixed; left:10px; bottom:20px; z-index:1300; background:var(--color-accent); color:var(--color-bg); border:none; border-radius:50%; width:44px; height:44px; font-size:1.5rem; box-shadow:0 2px 8px #0008; display:none; }
    @media (max-width: 900px) { .side-nav-compact { left:-60px; } .side-nav-compact.open { left:0; box-shadow:2px 0 20px #000a; } .side-nav-toggle-btn { display:block; } }
    @media (max-width: 600px) { .side-nav-compact { top:auto; bottom:70px; left:0; flex-direction:row; border-radius:0 0 8px 8px; padding:4px 8px; } }
    .glitch-anim { animation:glitch-anim 1.2s infinite linear alternate; }
    @keyframes glitch-anim { 0%{text-shadow:2px 0 #0ff, -2px 0 #f0f, 0 2px #fff;} 20%{text-shadow:-2px 0 #0ff,2px 0 #f0f,0 -2px #fff;} 40%{text-shadow:2px 2px #0ff,-2px -2px #f0f;} 60%{text-shadow:-2px 2px #0ff,2px -2px #f0f;} 80%{text-shadow:0 0 8px #fff;} 100%{text-shadow:2px 0 #0ff, -2px 0 #f0f, 0 2px #fff;} }
    .music-visualizer.advanced .bar { animation:wave 0.7s infinite alternate !important; background:linear-gradient(90deg,#0ff,#f0f,#fff); }
    body.high-contrast { filter:contrast(1.5) brightness(1.1); }
    body.hud-minimal .hud-readout, body.hud-minimal .hud-corner, body.hud-minimal .hud-line { display:none!important; }
    #particles-bg { pointer-events:none; z-index:0; }
    body.bg-reactive { transition:background 0.5s; }
    `;
    document.head.appendChild(style);
    
  </script>

  <!-- El bloque de funciones JS de efectos visuales y menú lateral se mueve aquí, dentro de <script> -->
  <script>
  // =============================
  // EFECTOS VISUALES AVANZADOS Y HOOKS
  // =============================
  // (Pega aquí todo el bloque de funciones JS de efectos visuales, menú lateral y la inyección dinámica de estilos)
  // ...
  // (El código JS que antes estaba dentro de <style> va aquí, después de DOMContentLoaded o donde corresponda)
  // ...
  </script>

</body>
</html>