<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <!-- Metadatos, Favicon, Fuentes -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
  <title>Cyberpunk 2077 - Evidencias (v3.4 - Hacker Terminal Load)</title>
  <meta name="author" content="Ing. Espinosa Martínez José Armando">
  <meta name="copyright" content="© 2025 Ing. Espinosa Martínez José Armando">
  <link rel="icon" href="IMG/FAVICON/LOGO.png" type="image/x-icon" />

  <!-- Fuentes Futuristas (del 2do archivo, complementando las del 1ero si es necesario) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"> <!-- Del original -->
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600&display=swap" rel="stylesheet"> <!-- Del original -->
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet"> <!-- Del 2do -->

  <!-- Font Awesome (del 1er archivo) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- ============================================================
       CSS Styles (Combinado de ambos archivos y adaptado)
       ------------------------------------------------------------
  ============================================================ -->
  <style>
    /* ============================================================
       :root VARIABLES & THEMES (Del 2do archivo, con posible ajuste de HUE)
       ------------------------------------------------------------
    ============================================================ */
    :root {
      --hue: 160; /* Color principal (Cyan/Verde - típico Cyberpunk) */
      --saturation: 100%;
      --brightness-accent: 50%; /* Luminosidad color acento */
      --brightness-bg: 5%;      /* Luminosidad fondo muy oscuro */
      --brightness-text: 95%;   /* Luminosidad texto principal */
      --brightness-muted: 70%;  /* Luminosidad texto secundario */

      /* Colores Base (HSLA) */
      --color-bg: hsla(var(--hue), var(--saturation), var(--brightness-bg), 1);
      --color-accent: hsla(var(--hue), var(--saturation), var(--brightness-accent), 1);
      --color-accent-glow: hsla(var(--hue), var(--saturation), var(--brightness-accent), 0.5); /* para sombras y brillo */
      --color-accent-dark: hsla(var(--hue), var(--saturation), calc(var(--brightness-accent) - 15%), 1); /* Tono más oscuro del acento */
      --color-text: hsla(var(--hue), 10%, var(--brightness-text), 1); /* Texto ligeramente desaturado */
      --color-muted: hsla(var(--hue), 10%, var(--brightness-muted), 1); /* Texto apagado/grisáceo */
      --color-border: hsla(var(--hue), var(--saturation), calc(var(--brightness-accent) / 2), 0.3); /* Bordes semitransparentes */
      --color-glass-bg: hsla(var(--hue), 30%, 15%, 0.1); /* Fondo para glassmorphism - más transparente */
       /* Color Rojo/Error */
       --color-error: hsla(0, 100%, 60%, 1); /* Rojo Error */

      /* NUEVO: Colores RGB para rgba() en sombras (Aproximado) */
      --color-accent-rgb: 0, 255, 170; /* Aproximado para HSL(160, 100%, 50%) - Ajustar si el hue cambia drásticamente */

      /* Transiciones */
      --transition-fast: 0.2s;
      --transition-medium: 0.4s;
      --transition-slow: 0.7s;

      /* Fuentes (Del 2do archivo, Rajdhani/Orbitron del 1er archivo pueden usarse para cosas específicas) */
      --font-main: 'Share Tech Mono', monospace; /* Cuerpo principal */
      --font-heading: 'VT323', monospace; /* Títulos, HUD */
      --font-alt: 'Orbitron', monospace; /* Alternativa para titulos clave/hero */
      --font-text-alt: 'Rajdhani', sans-serif; /* Alternativa para texto descriptivo */

      /* NUEVO: Variables HUD (Del 2do archivo) */
      --hud-border-width: 2px;
      --hud-corner-size: 20px;
      --hud-line-thickness: 1px;
      --hud-glow: 0 0 5px var(--color-accent-glow), 0 0 10px var(--color-accent-glow); /* Sombra brillante */

      /* Breakpoints */
      --mobile-break: 768px;
      --tablet-break: 1024px;
    }

    /* NUEVO: Tema Claro (Del 2do archivo) */
    [data-theme="light"] {
      --hue: 200; /* Azul claro */
      --brightness-bg: 95%;
      --brightness-accent: 55%;
      --brightness-text: 10%;
      --brightness-muted: 40%;

      /* Recalcular colores base */
      --color-bg: hsla(var(--hue), 20%, var(--brightness-bg), 1);
      --color-accent: hsla(var(--hue), 80%, var(--brightness-accent), 1);
      --color-accent-glow: hsla(var(--hue), 80%, var(--brightness-accent), 0.4);
      --color-accent-dark: hsla(var(--hue), 80%, calc(var(--brightness-accent) - 15%), 1);
      --color-text: hsla(var(--hue), 10%, var(--brightness-text), 1);
      --color-muted: hsla(var(--hue), 10%, var(--brightness-muted), 1);
      --color-border: hsla(var(--hue), 50%, calc(var(--brightness-accent)), 0.3);
      --color-glass-bg: hsla(var(--hue), 30%, 85%, 0.2);
      --color-accent-rgb: 0, 170, 255; /* Aproximado */
       --color-error: hsla(350, 80%, 50%, 1); /* Rojo diferente en tema claro */
    }

    /* ============================================================
       RESET BÁSICO Y ESTILOS GENERALES (Del 2do archivo)
       ------------------------------------------------------------
    ============================================================ */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      font-size: 16px; /* Base para REMs */
      scrollbar-width: thin; /* Scrollbar más fino */
      scrollbar-color: var(--color-accent) var(--color-bg); /* Color scrollbar */
    }
     /* Estilo para Webkit browsers */
    ::-webkit-scrollbar {
      width: 8px; /* Ancho del scrollbar */
    }
    ::-webkit-scrollbar-track {
      background: var(--color-bg); /* Fondo del track */
    }
    ::-webkit-scrollbar-thumb {
      background-color: var(--color-accent); /* Color del 'pulgar' */
      border-radius: 10px; /* Bordes redondeados */
      border: 1px solid var(--color-accent-dark); /* Borde */
    }
     ::-webkit-scrollbar-thumb:hover {
      background-color: var(--color-text); /* Cambio color hover */
    }


    body {
      font-family: var(--font-main);
      background-color: var(--color-bg);
      color: var(--color-text);
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      /* Cursor personalizado (manteniendo el original si prefieres, o usar auto/default) */
      /* cursor: url("IMG/CURSORS/cursor1.cur"), auto;  -- Dejado como estaba en original -- */
      transition: background-color var(--transition-medium), color var(--transition-medium); /* Transición para cambio de tema */
    }

    /* Estilo de Selección (Del 2do archivo) */
    ::selection {
      background-color: var(--color-accent);
      color: var(--color-bg);
      text-shadow: none;
    }

    a, button {
      text-decoration: none;
      color: inherit;
      cursor: pointer;
      background: none;
      border: none;
      font-family: inherit;
    }

    img, video {
      max-width: 100%;
      height: auto;
      display: block;
      object-fit: cover; /* Asegura que cubran su contenedor */
    }

    /* NUEVO: Estilos para Lazy Loading de imágenes (Del 2do archivo) */
    img[data-src] {
        opacity: 0; /* Oculto inicialmente */
        transition: opacity 0.5s ease-in-out; /* Transición suave */
    }
    img.loaded {
        opacity: 1; /* Mostrar cuando esté cargada */
    }

    ul, li {
      list-style: none;
    }

    /* Ocultar elementos inicialmente hasta que JS los revele (Del 2do archivo) */
    #mainHeader, .main-content-wrapper, .hud-overlay {
      opacity: 0;
      transition: opacity var(--transition-slow) ease-in-out;
    }
    #mainHeader.visible, .main-content-wrapper.visible, .hud-overlay.visible {
      opacity: 1;
    }

    /* Video de fondo (Del 2do archivo) */
    #bg-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -2; /* Detrás del contenido y del HUD */
      opacity: 0.15; /* Más sutil */
      filter: grayscale(50%) brightness(0.7); /* Efecto visual */
    }

    /* ============================================================
       LOADER AVANZADO ESTILOS (Del 2do archivo)
       ------------------------------------------------------------
       Integrando y estilyzando el loader del 2do archivo.
    ============================================================ */
     .loader-overlay { /* Usamos la clase original pero con estilos del 2do archivo */
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: var(--color-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      opacity: 1;
      visibility: visible;
      transition: opacity var(--transition-slow) ease-in-out, visibility var(--transition-slow) step-end;
      /* Removiendo overflow: hidden si no es necesario, para debug */
    }

    .loader-overlay:not(.active) {
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-slow) ease-in-out, visibility 0s var(--transition-slow);
    }

    .loader-hud-border { /* Nuevo elemento decorativo del loader */
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      bottom: 20px;
      border: var(--hud-border-width) solid var(--color-border);
      pointer-events: none;
      box-shadow: inset 0 0 15px rgba(var(--color-accent-rgb), 0.1);
    }

    .loader-scanline { /* Efecto visual en el loader */
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--color-accent);
      box-shadow: var(--hud-glow);
      opacity: 0.7;
      animation: scan 3s linear infinite;
      z-index: 1;
    }

    @keyframes scan {
      0% { transform: translateY(0); }
      50% { transform: translateY(calc(100vh - 3px)); }
      100% { transform: translateY(0); }
    }

    .loader-content { /* Contenedor para los elementos de texto y barra */
      position: relative;
      z-index: 2;
      text-align: center;
      color: var(--color-accent);
      max-width: 90%; /* Más responsivo */
      width: 500px; /* Ancho fijo con max-width */
    }

    .loader-logo { /* Título del loader */
      font-family: var(--font-heading);
      font-size: 2rem;
      margin-bottom: 20px;
      letter-spacing: 4px;
      text-shadow: var(--hud-glow);
      animation: pulse-text 2s infinite alternate;
    }

    @keyframes pulse-text {
      from { opacity: 0.7; }
      to { opacity: 1; }
    }

    .loader-text { /* Texto principal del estado de carga */
      font-family: var(--font-main);
      font-size: 1.2rem;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-height: 1.2rem; /* Evitar salto */
    }

    .loader-bar-container { /* Contenedor de la barra de progreso */
      width: 100%;
      max-width: 400px;
      height: 10px;
      background: rgba(var(--color-accent-rgb), 0.1);
      border: 1px solid var(--color-border);
      border-radius: 2px;
      overflow: hidden;
      margin: 15px auto;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    }

    .loader-bar { /* Barra de progreso dinámica */
      width: 0%;
      height: 100%;
      background: var(--color-accent);
      box-shadow: var(--hud-glow);
      transition: width 0.1s linear;
    }

    .loader-percentage { /* Porcentaje de carga */
      font-family: var(--font-main);
      font-size: 1rem;
      margin-bottom: 10px;
       min-height: 1rem; /* Evitar salto */
    }

    .loader-subtext { /* Subtexto informativo en el loader */
      font-family: var(--font-main);
      font-size: 0.8rem;
      color: var(--color-muted);
      letter-spacing: 1px;
       min-height: 0.8rem; /* Evitar salto */
    }

    /* ============================================================
       HUD OVERLAY ESTILOS (Del 2do archivo)
       ------------------------------------------------------------
    ============================================================ */
    .hud-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none; /* No interfiere con clicks */
      z-index: 1000; /* Encima del contenido, debajo de modales/menús */
      overflow: hidden; /* Evita que elementos se salgan */
       opacity: 0; /* Controlado por JS al terminar la carga */
       transition: opacity var(--transition-slow) ease-in-out;
    }

    .hud-overlay.visible { opacity: 1; }


    /* Esquinas Decorativas (Del 2do archivo) */
    .hud-corner {
      position: absolute;
      width: var(--hud-corner-size);
      height: var(--hud-corner-size);
      border-style: solid;
      border-color: var(--color-accent);
      opacity: 0.7;
       /* Añadir un ligero glow a las esquinas */
       box-shadow: 0 0 5px rgba(var(--color-accent-rgb), 0.5);
    }
    .hud-corner.top-left { top: 15px; left: 15px; border-width: var(--hud-border-width) 0 0 var(--hud-border-width); }
    .hud-corner.top-right { top: 15px; right: 15px; border-width: var(--hud-border-width) var(--hud-border-width) 0 0; }
    .hud-corner.bottom-left { bottom: 15px; left: 15px; border-width: 0 0 var(--hud-border-width) var(--hud-border-width); }
    .hud-corner.bottom-right { bottom: 15px; right: 15px; border-width: 0 var(--hud-border-width) var(--hud-border-width) 0; }

    /* Líneas Decorativas (Del 2do archivo) */
    .hud-line {
      position: absolute;
      background-color: var(--color-border);
      box-shadow: 0 0 3px var(--color-border);
      opacity: 0.5;
    }
    .hud-line.top { top: calc(15px + var(--hud-corner-size)); left: calc(15px + var(--hud-corner-size)); right: calc(15px + var(--hud-corner-size)); height: var(--hud-line-thickness); }
    .hud-line.bottom { bottom: calc(15px + var(--hud-corner-size)); left: calc(15px + var(--hud-corner-size)); right: calc(15px + var(--hud-corner-size)); height: var(--hud-line-thickness); }
    .hud-line.left { left: calc(15px + var(--hud-corner-size)); top: calc(15px + var(--hud-corner-size)); bottom: calc(15px + var(--hud-corner-size)); width: var(--hud-line-thickness); }
    .hud-line.right { right: calc(15px + var(--hud-corner-size)); top: calc(15px + var(--hud-corner-size)); bottom: calc(15px + var(--hud-corner-size)); width: var(--hud-line-thickness); }

    /* Readouts de Información (Del 2do archivo) */
    .hud-readout {
      position: absolute;
      font-family: var(--font-main);
      font-size: 0.75rem;
      color: var(--color-muted);
      padding: 5px 10px;
      background: rgba(var(--color-bg), 0.5); /* Fondo semitransparente */
      text-transform: uppercase;
      letter-spacing: 1px;
      /* Border sutil */
      border: 1px solid var(--color-border);
       z-index: 10; /* Asegurar visibilidad sobre otros elementos */
    }
    .hud-readout span:first-child { color: var(--color-accent); margin-right: 5px;}
    .hud-readout .hud-ok { color: hsla(120, 70%, 60%, 1); } /* Verde OK */
    .hud-readout .hud-warning { color: hsla(45, 100%, 60%, 1); } /* Amarillo Warning */
    .hud-readout .hud-error { color: var(--color-error); } /* Rojo Error */

    .top-left-readout { top: 30px; left: 30px; } /* Ajuste para no chocar con esquinas */
    .top-right-readout { top: 30px; right: 30px; text-align: right;}
    .bottom-left-readout { bottom: 30px; left: 30px; }
    .bottom-right-readout { bottom: 30px; right: 30px; text-align: right;}


    /* ============================================================
       HEADER MEJORADO (Del 2do archivo, adaptado de 'cyber-nav')
       ------------------------------------------------------------
    ============================================================ */
    /* Usamos el ID original del 1er archivo, pero los estilos del 2do */
     #mainHeader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 10px 30px; /* Más padding */
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1001; /* Encima del HUD overlay, pero debajo del panel filtro */
      background: rgba(var(--color-bg), 0.7); /* Fondo semitransparente más opaco */
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-bottom: var(--hud-line-thickness) solid var(--color-border);
       opacity: 0; /* Controlado por JS al terminar la carga */
       transition: opacity var(--transition-slow) ease-in-out;
    }

     #mainHeader.visible { opacity: 1; }

     .branding a { /* .nav-brand original, estilizado como .branding */
      font-family: var(--font-alt); /* Usar Orbitron/Rajdhani si prefieres */
      font-size: 1.5rem;
      color: var(--color-accent);
      text-shadow: var(--hud-glow);
      letter-spacing: 2px;
      transition: color var(--transition-fast), text-shadow var(--transition-fast);
    }
    .branding a:hover {
      color: var(--color-text);
      text-shadow: 0 0 10px var(--color-text); /* Resaltar con color principal */
    }

    .header-controls { /* Del 2do archivo */
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Estilo Base para Botones HUD (Del 2do archivo) */
    .hud-button {
      font-family: var(--font-main);
      padding: 8px 15px;
      border: 1px solid var(--color-border);
      background: rgba(var(--color-accent-rgb), 0.1);
      color: var(--color-accent);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-radius: 3px;
      transition: background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast); /* Añadido transform */
      position: relative;
      overflow: hidden;
       /* Alineación vertical para iconos */
       display: inline-flex;
       align-items: center;
       justify-content: center;
       gap: 5px; /* Espacio entre icono y texto si hay */
    }
    .hud-button:hover {
      background: var(--color-accent);
      color: var(--color-bg);
      box-shadow: var(--hud-glow);
       transform: translateY(-2px); /* Ligero desplazamiento al hover */
    }
     .hud-button:active {
       transform: translateY(0); /* Volver a posición normal al click */
     }
    .hud-button.small { padding: 5px 10px; font-size: 0.7rem; }
    .hud-button.large { padding: 12px 25px; font-size: 1rem; }

    /* Estilo Primario/Destacado para Botones (Del 2do archivo) */
    .hud-button.primary {
      background: var(--color-accent);
      color: var(--color-bg);
      border-color: var(--color-accent);
      box-shadow: var(--hud-glow);
    }
    .hud-button.primary:hover {
      background: var(--color-accent-dark);
      box-shadow: 0 0 15px var(--color-accent);
    }

    /* Efecto Scanline Hover para botones (Del 2do archivo) */
    .hud-button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -150%;
      width: 50%;
      height: 100%;
      background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
      transform: skewX(-25deg);
      transition: left var(--transition-medium) ease-in-out;
      pointer-events: none; /* Asegurar que el efecto no capture clicks */
    }
    .hud-button:hover::after {
      left: 150%;
    }

    /* Botón Mute (Del 2do archivo) */
    #muteButton { padding: 8px; } /* Ajuste el padding */
    #muteButton svg { transition: opacity var(--transition-fast); }
    #muteButton svg.mute-slash { position: absolute; opacity: 0; color: var(--color-error); }
    #muteButton.muted svg:not(.mute-slash) { opacity: 0.3; }
    #muteButton.muted svg.mute-slash { opacity: 1; }
     #muteButton svg { width: 18px; height: 18px; } /* Tamaño del icono */
     #muteButton.muted svg.mute-slash { width: 24px; height: 24px; } /* Tamaño del slash puede ser mayor */

    /* Menú Filtro (Del 2do archivo, estilizado de filter-overlay) */
    .filter-container { position: static; } /* Contenedor no necesita ser relativo, el panel es fixed */
    .filter-panel { /* Estructura del panel del 2do archivo */
      position: fixed; /* Cambiado a fijo */
      top: 50%;      /* Centrado vertical */
      left: 50%;     /* Centrado horizontal */
      width: 90%;    /* Ancho responsivo */
      max-width: 400px; /* Ancho máximo */
      max-height: 80vh; /* Altura máxima con scroll */
      overflow-y: auto; /* Scroll si es necesario */
      background: rgba(var(--color-bg), 0.95);
      border: 1px solid var(--color-border);
      border-radius: 5px;
      padding: 25px; /* Más padding */
      z-index: 10001; /* MUY ALTO para estar sobre todo */
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      /* Estado inicial (oculto) */
      transform: translate(-50%, -50%) scale(0.9); /* Centrado y escalado */
      opacity: 0;
      visibility: hidden;
      transition: transform var(--transition-medium) ease, opacity var(--transition-medium) ease, visibility 0s var(--transition-medium);
      transform-origin: center center; /* Origen de transformación */
    }
    .filter-panel.open {
      transform: translate(-50%, -50%) scale(1); /* Estado abierto */
      opacity: 1;
      visibility: visible;
      transition: transform var(--transition-medium) ease, opacity var(--transition-medium) ease, visibility 0s 0s;
    }
     /* Estilo del UL y LI dentro del panel (Del 2do archivo, usando .navbar-nav) */
    .filter-panel ul { /* ul original dentro de filter-content, estilizado */
      display: flex;
      flex-direction: column;
      gap: 8px; /* Más espacio */
    }
    .filter-panel li { margin: 0; }
     /* Estilo de los links (Del 2do archivo, usando .nav-link) */
    .filter-panel .filter-link { /* .filter-link original, estilizado como .nav-link del 2do archivo */
      display: block;
      padding: 10px 15px; /* Padding más grande */
      color: var(--color-muted);
      font-family: var(--font-heading); /* Fuente HUD */
      font-size: 1.1rem; /* Fuente más grande */
      border-radius: 3px;
      transition: background var(--transition-fast), color var(--transition-fast), letter-spacing var(--transition-fast);
      position: relative;
      overflow: hidden;
      text-align: center; /* Texto centrado */
       letter-spacing: 0.5px;
    }
     /* Línea decorativa al hover (Del 2do archivo) */
    .filter-panel .filter-link::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 2px;
      background: var(--color-accent);
      transition: width var(--transition-medium) ease;
       box-shadow: var(--hud-glow);
    }
    .filter-panel .filter-link:hover {
      background: rgba(var(--color-accent-rgb), 0.15); /* Fondo hover */
      color: var(--color-accent);
       letter-spacing: 3px; /* Espacio al hover */
    }
    .filter-panel .filter-link:hover::before {
      width: 80%; /* Ancho de la línea en hover */
    }
     /* Línea divisoria en el menú (Adaptado del 1er archivo) */
    .filter-panel ul li[style] { /* Apuntar al LI con estilo inline */
        margin-top: 2rem !important;
        border-top: 1px solid var(--color-border) !important;
        padding-top: 2rem !important;
    }

    /* Overlay para el menú filtro (fondo oscuro - Del 2do archivo) */
    .filter-overlay { /* Mantenemos el ID del 1er archivo, pero con estilos del 2do */
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.85); /* Más oscuro */
      backdrop-filter: blur(8px); /* Más blur */
      -webkit-backdrop-filter: blur(8px);
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-medium) ease, visibility 0s var(--transition-medium);
      z-index: 10000; /* Debajo del panel, encima de todo lo demás */
    }
    .filter-overlay.open {
      opacity: 1;
      visibility: visible;
      transition: opacity var(--transition-medium) ease, visibility 0s 0s;
    }


    /* ============================================================
       Contenedor Notificaciones (Adaptado de 1er archivo)
       ------------------------------------------------------------
       Mantenemos la estructura original, adaptamos estilos.
    ============================================================ */
    .notification-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 10005; /* Encima de todo lo demás */
        display: flex;
        flex-direction: column-reverse; /* Últimas notificaciones arriba */
        gap: 10px;
        pointer-events: none; /* Las notificaciones no deben capturar clicks */
    }
     .notification {
        background: rgba(var(--color-accent-rgb), 0.15); /* Fondo semi-transparente */
        border: 1px solid var(--color-accent);
        color: var(--color-text);
        padding: 12px 20px;
        border-radius: 4px;
        font-family: var(--font-main);
        font-size: 0.9rem;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        opacity: 0;
        transform: translateX(100%);
        animation: fadeInSlideLeft 0.5s ease-out forwards, fadeOut 0.5s ease-in forwards 4.5s; /* Animación de entrada y salida */
        pointer-events: all; /* Permite cerrar/interactuar si se añaden botones */
         max-width: 300px; /* Ancho máximo */
         overflow: hidden; /* Por si el texto es largo */
     }
    /* Variante de color para notificaciones de error */
    .notification.error {
        background: rgba(var(--color-error), 0.15);
        border-color: var(--color-error);
         box-shadow: 0 4px 8px rgba(var(--color-error), 0.3);
    }

    @keyframes fadeInSlideLeft {
        to { opacity: 1; transform: translateX(0); }
    }
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }


   /* INTRO SECTION (Original del 1er archivo - Removed for simplicity as JS is missing) */
   /* .intro-section { display: none; } */


    /* ============================================================
       CONTENEDOR PRINCIPAL Y SECCIONES (Del 2do archivo)
       ------------------------------------------------------------
       Envolvemos el contenido existente aquí.
    ============================================================ */
    .main-content-wrapper {
      position: relative;
      z-index: 1; /* Encima del video de fondo */
      /* Añadimos padding para que el contenido no quede debajo del HUD fijo y el header */
      padding-top: 120px; /* Ajuste: Header (aprox 60px) + HUD Top (aprox 40px) + margen */
      padding-bottom: 80px; /* Espacio para HUD bottom + margen */
      opacity: 0; /* Controlado por JS al terminar la carga */
      transition: opacity var(--transition-slow) ease-in-out;
    }

     .main-content-wrapper.visible { opacity: 1; }

    .section-container { /* Clase añadida a la mayoría de SECTIONs originales */
      padding: 100px 5%; /* Padding lateral responsivo */
      max-width: 1400px; /* Ancho máximo del contenido */
      margin-left: auto;
      margin-right: auto;
      position: relative;
      /* Retirar o ajustar el margen y borde si se añaden separadores visuales de otro modo */
       margin-top: 0; /* Se gestiona el espacio con el padding-top de la sección */
       border-top: none; /* Se puede añadir un separador decorativo de otro modo si se desea */
    }

     /* Separador visual entre secciones si se necesita */
    .section-container:not(:first-child) {
       margin-top: 50px; /* Espacio entre secciones */
       border-top: 1px solid var(--color-border);
       padding-top: 50px; /* Padding después del borde */
    }

    /* Estilo base para cajas de contenido (cards, paneles, etc. - Del 2do archivo) */
    .content-box { /* Clase añadida a elementos internos de las secciones */
      background: var(--color-glass-bg);
      border: 1px solid var(--color-border);
      border-radius: 5px;
      padding: 25px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px); /* Safari */
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      transition: transform var(--transition-medium), box-shadow var(--transition-medium), background-color var(--transition-medium);
    }
    .content-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 15px var(--color-accent-glow);
      background-color: hsla(var(--hue), 30%, 15%, 0.3); /* Más opaco en hover */
    }

     /* Estilo general para títulos H2 de sección */
     .section-title {
        font-family: var(--font-heading);
        font-size: clamp(2rem, 5vw, 3rem); /* Fluido */
        text-align: center;
        margin-bottom: 60px;
        position: relative;
        display: block;
        color: var(--color-accent);
        text-shadow: var(--hud-glow);
        letter-spacing: 2px;
        text-transform: uppercase;
    }
     /* Líneas decorativas para títulos (Del 2do archivo) */
    .section-title::before, .section-title::after {
      content: '';
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      height: 2px;
      background: var(--color-border);
      width: 50%; /* La línea inferior */
       box-shadow: 0 0 5px var(--color-border);
    }
    .section-title::before { top: -15px; width: 25%; /* La línea superior más corta */ }
    .section-title::after { bottom: -15px; }


    /* ============================================================
       SECCIONES ESPECÍFICAS (Estilizadas del 2do archivo)
       ------------------------------------------------------------
       Adaptando los estilos del 2do archivo al contenido del 1ero.
    ============================================================ */

    /* --- HERO (Del 1er archivo, estilizado con el 2do) --- */
     .hero {
      min-height: calc(100vh - 120px); /* Ajustar a la altura de la ventana menos el espacio del header/HUD */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0 5%;
      position: relative;
      /* Retirar margen superior ya que main-content-wrapper tiene padding-top */
      margin-top: 0;
       /* Retirar background para usar el video o el del body */
      background: none;
    }
     /* Animaciones de aparición (del 1er archivo), usando la clase Reveal del 2do archivo */
     .hero-content { /* Contenedor original */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
     }
    .hero-content.animation-trigger { opacity: 0; } /* Reiniciamos si había una animación js */
    .hero-content.animate-slide-in-bottom.visible {
        opacity: 1;
        transform: translateY(0);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .hero-title { /* Adaptado del 1er archivo, estilos glitch del 2do */
      font-family: var(--font-alt); /* Usar Orbitron para Hero */
      font-size: clamp(2.5rem, 8vw, 5rem);
      margin-bottom: 20px;
      letter-spacing: 0.05em;
      position: relative;
      color: var(--color-accent);
      text-shadow: 0 0 8px var(--color-accent-glow),
                   0 0 15px var(--color-accent-glow),
                   0 0 25px rgba(var(--color-accent-rgb), 0.3);
      animation: text-flicker 3s linear infinite alternate;
    }
     /* Efecto Glitch (Del 2do archivo) */
    .hero-title::before,
    .hero-title::after {
      content: attr(data-text);
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      overflow: hidden; background: var(--color-bg);
      color: var(--color-accent); clip-path: inset(0);
    }
    .hero-title::before {
      left: 2px; text-shadow: -1px 0 var(--color-error); /* Color de error */
      animation: glitch-anim-1 2s infinite linear alternate-reverse;
    }
    .hero-title::after {
      left: -2px; text-shadow: -1px 0 blue; /* Otro color para contraste glitch */
      animation: glitch-anim-2 3s infinite linear alternate-reverse;
    }
    /* Keyframes glitch - Usados del 2do archivo, aseguran consistencia */
    @keyframes glitch-anim-1 {
      0%, 100% { clip-path: inset(45% 0 50% 0); } 5% { clip-path: inset(10% 0 85% 0); } 10% { clip-path: inset(90% 0 5% 0); } 15% { clip-path: inset(30% 0 60% 0); } 20% { clip-path: inset(70% 0 10% 0); } 25% { clip-path: inset(50% 0 45% 0); } 30% { clip-path: inset(20% 0 75% 0); } 35% { clip-path: inset(80% 0 15% 0); } 40% { clip-path: inset(40% 0 55% 0); } 45% { clip-path: inset(60% 0 35% 0); } 50% { clip-path: inset(25% 0 70% 0); } 55% { clip-path: inset(85% 0 10% 0); } 60% { clip-path: inset(35% 0 60% 0); } 65% { clip-path: inset(75% 0 20% 0); } 70% { clip-path: inset(48% 0 48% 0); } 75% { clip-path: inset(15% 0 80% 0); } 80% { clip-path: inset(95% 0 2% 0); } 85% { clip-path: inset(33% 0 63% 0); } 90% { clip-path: inset(68% 0 28% 0); } 95% { clip-path: inset(55% 0 40% 0); }
    }
    @keyframes glitch-anim-2 {
      0%, 100% { clip-path: inset(80% 0 15% 0); } 5% { clip-path: inset(30% 0 65% 0); } 10% { clip-path: inset(5% 0 90% 0); } 15% { clip-path: inset(60% 0 30% 0); } 20% { clip-path: inset(10% 0 70% 0); } 25% { clip-path: inset(45% 0 50% 0); } 30% { clip-path: inset(75% 0 20% 0); } 35% { clip-path: inset(20% 0 80% 0); } 40% { clip-path: inset(55% 0 40% 0); } 45% { clip-path: inset(35% 0 60% 0); } 50% { clip-path: inset(70% 0 25% 0); } 55% { clip-path: inset(10% 0 85% 0); } 60% { clip-path: inset(60% 0 33% 0); } 65% { clip-path: inset(20% 0 78% 0); } 70% { clip-path: inset(49% 0 49% 0); } 75% { clip-path: inset(80% 0 18% 0); } 80% { clip-path: inset(2% 0 95% 0); } 85% { clip-path: inset(63% 0 33% 0); } 90% { clip-path: inset(28% 0 68% 0); } 95% { clip-path: inset(40% 0 55% 0); }
    }
    @keyframes text-flicker {
      0%, 18%, 22%, 25%, 53%, 57%, 100% { text-shadow: 0 0 8px var(--color-accent-glow), 0 0 15px var(--color-accent-glow), 0 0 25px rgba(var(--color-accent-rgb), 0.3), 0 2px 2px rgba(0,0,0,0.5); }
      20%, 24%, 55% { text-shadow: none; }
    }


    .hero-subtitle { /* Del 1er archivo */
      font-size: clamp(1rem, 2.5vw, 1.3rem);
      max-width: 700px;
      line-height: 1.6;
      color: var(--color-muted); /* Usar color muted del tema HUD */
      margin-top: 20px;
      font-family: var(--font-text-alt); /* Usar Rajdhani */
    }

    .btn-hero { /* Del 1er archivo, estilizado como hud-button primary */
        font-family: var(--font-heading); /* Usar VT323 para botones */
        font-size: 1.2rem;
        margin-top: 40px;
        padding: 12px 30px;
        /* Hereda estilos .hud-button */
    }
    .btn-hero { /* Añadimos clases del 2do archivo para aplicar su estilo */
        @extend .hud-button; /* Placeholder/idea - copiar estilos */
        @extend .hud-button.primary;
    }
    /* Copiamos los estilos relevantes del .hud-button.primary */
     .btn-hero {
         font-family: var(--font-heading);
         padding: 12px 25px; /* Usar padding del large hud-button */
         font-size: 1.2rem;
         text-transform: uppercase;
         letter-spacing: 1px;
         border-radius: 3px;
         transition: background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast);
         position: relative;
         overflow: hidden;

         /* Primary styles */
         background: var(--color-accent);
         color: var(--color-bg);
         border: 1px solid var(--color-accent);
         box-shadow: var(--hud-glow);
     }
    .btn-hero:hover {
         background: var(--color-accent-dark);
         box-shadow: 0 0 15px var(--color-accent);
         transform: translateY(-3px);
     }
    .btn-hero::after { /* Scanline effect */
         content: '';
         position: absolute;
         top: 0;
         left: -150%;
         width: 50%;
         height: 100%;
         background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
         transform: skewX(-25deg);
         transition: left var(--transition-medium) ease-in-out;
         pointer-events: none;
     }
    .btn-hero:hover::after { left: 150%; }


    /* Scroll down indicator (Añadido desde la referencia del 2do archivo) */
    .scroll-down-indicator {
      position: absolute;
      bottom: 40px; /* Ajusta según espacio del HUD */
      left: 50%;
      transform: translateX(-50%);
      color: var(--color-accent);
      font-size: 1.8rem; /* un poco más grande */
      animation: bounce 2s infinite;
      opacity: 0.7;
      transition: opacity var(--transition-fast);
       z-index: 1; /* Asegurar que esté sobre el video/fondo */
    }
    .scroll-down-indicator:hover {
        opacity: 1;
    }
    @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); } 40% { transform: translateX(-50%) translateY(-10px); } 60% { transform: translateX(-50%) translateY(-5px); } }


     /* PROYECTO X SECTION (Del 1er archivo, estilizado) */
     /* Reemplazar .projectx-section por .section-container#proyectoX y añadir reveal */
     #proyectoX {
        /* Añade estilos base de section-container si no se aplica la clase */
         padding: 100px 5%;
         max-width: 1400px;
         margin: 0 auto;
         margin-top: 50px; /* Espacio del anterior */
         border-top: 1px solid var(--color-border);
         padding-top: 50px;
         position: relative;
     }
    #proyectoX h2 {
        /* Ya tiene section-title por JS, solo asegurar que coincida el ID */
        font-family: var(--font-heading);
        font-size: clamp(2rem, 5vw, 3rem);
        text-align: center;
        margin-bottom: 60px;
        position: relative;
        display: block;
        color: var(--color-accent);
        text-shadow: var(--hud-glow);
        letter-spacing: 2px;
        text-transform: uppercase;
    }
     #proyectoX h2 i { margin-right: 10px; color: var(--color-border); opacity: 0.8;}
     #proyectoX h2::before, #proyectoX h2::after {
         content: '';
         position: absolute;
         left: 50%;
         transform: translateX(-50%);
         height: 2px;
         background: var(--color-border);
         width: 50%;
          box-shadow: 0 0 5px var(--color-border);
     }
     #proyectoX h2::before { top: -15px; width: 25%; }
     #proyectoX h2::after { bottom: -15px; }

    .projectx-container {
      display: grid; /* Usamos grid para controlar el layout */
      gap: 30px; /* Espacio entre elementos */
       grid-template-areas:
            "details visuals"
            "details video";
       grid-template-columns: 1.2fr 1fr; /* Ajustamos tamaño de columnas */
       align-items: start; /* Alinea arriba los elementos */
    }
     @media (max-width: 1024px) {
         .projectx-container {
             grid-template-areas:
                 "visuals"
                 "details"
                 "video";
              grid-template-columns: 1fr; /* Una columna en tablet */
         }
     }
      @media (max-width: 768px) {
          .projectx-container {
              grid-template-areas:
                  "details"
                  "visuals"
                  "video";
               grid-template-columns: 1fr; /* Una columna en movil */
          }
      }

    .projectx-details { grid-area: details; }
    .projectx-visuals { grid-area: visuals; }
    .projectx-video { grid-area: video; }

     /* Añadimos la clase content-box a los elementos internos del project X */
    .projectx-details,
    .projectx-visuals,
    .projectx-video {
         background: var(--color-glass-bg);
         border: 1px solid var(--color-border);
         border-radius: 5px;
         padding: 25px;
         backdrop-filter: blur(10px);
         -webkit-backdrop-filter: blur(10px);
         box-shadow: 0 5px 15px rgba(0,0,0,0.2);
         transition: transform var(--transition-medium), box-shadow var(--transition-medium), background-color var(--transition-medium);
    }
    .projectx-details:hover,
    .projectx-visuals:hover,
    .projectx-video:hover { /* Efecto hover heredado */
         transform: translateY(-5px);
         box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 15px var(--color-accent-glow);
         background-color: hsla(var(--hue), 30%, 15%, 0.3);
    }


    .projectx-details h3,
    .projectx-visuals h3,
    .projectx-video h3 {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        color: var(--color-text); /* Titulo de bloque con color de texto principal */
        margin-bottom: 20px;
         text-shadow: 0 0 5px rgba(var(--color-accent-rgb), 0.1);
         border-bottom: 1px dashed var(--color-border); /* Separador subtitulo */
         padding-bottom: 10px;
    }
    .projectx-details h3 i,
    .projectx-visuals h3 i,
    .projectx-video h3 i { color: var(--color-accent); margin-right: 8px;}

    .projectx-details p {
        color: var(--color-muted);
        line-height: 1.6;
        margin-bottom: 20px;
         font-size: 0.95rem;
    }
    .projectx-details ul {
        list-style: none;
        padding-left: 0;
        display: grid; /* Layout grid para los items de lista */
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* columnas adaptativas */
        gap: 10px; /* Espacio entre items */
    }
    .projectx-details li {
         font-family: var(--font-main);
         font-size: 0.85rem;
         color: var(--color-text);
         border: 1px solid var(--color-border);
         padding: 8px;
         border-radius: 3px;
         background: rgba(var(--color-accent-rgb), 0.05);
          box-shadow: inset 0 0 3px rgba(var(--color-accent-rgb), 0.1);
    }
    .projectx-details li strong {
         color: var(--color-accent);
         margin-right: 5px;
         letter-spacing: 0.5px;
    }

    .projectx-visuals .gallery { /* Layout para imágenes en el visualizador */
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Grid adaptativo para miniaturas */
        gap: 10px; /* Espacio entre imágenes */
    }
    .projectx-visuals img {
        border: 1px solid var(--color-border);
        border-radius: 3px;
        opacity: 0.8;
        transition: opacity var(--transition-fast), transform var(--transition-fast);
         object-fit: cover; /* Cubrir el área asignada */
         height: 100px; /* Altura fija para las miniaturas */
    }
    .projectx-visuals img:hover {
        opacity: 1;
         transform: scale(1.05);
         border-color: var(--color-accent);
    }

    .projectx-video video {
        border: 1px solid var(--color-border);
        border-radius: 5px;
         box-shadow: 0 0 10px rgba(var(--color-accent-rgb), 0.2);
    }


    /* VISUALIZADOR MUSICA (Del 1er archivo, adaptado) */
     .music-visualizer { /* Mantenemos la clase y estructura, adaptamos estilo */
        position: fixed; /* Fijo */
        bottom: 15px; /* Alinear con el HUD */
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: flex-end;
        height: 30px; /* Altura */
        gap: 3px; /* Espacio entre barras */
        z-index: 1000; /* Por encima del contenido, debajo del HUD fijo */
         pointer-events: none; /* No capturar clicks */
     }
     .music-visualizer .bar {
        width: 4px; /* Ancho barra */
        height: 2px; /* Altura inicial */
        background: var(--color-accent);
        transition: height 0.2s ease-out; /* Animacion de altura */
        box-shadow: var(--hud-glow); /* Glow */
        /* Animacion base para darle vida incluso sin audio data */
        animation: wave 1.5s ease-in-out infinite;
     }
     /* Delay en la animacion base */
     .music-visualizer .bar:nth-child(1) { animation-delay: 0s; }
     .music-visualizer .bar:nth-child(2) { animation-delay: 0.2s; }
     .music-visualizer .bar:nth-child(3) { animation-delay: 0.4s; }
     .music-visualizer .bar:nth-child(4) { animation-delay: 0.6s; }
     .music-visualizer .bar:nth-child(5) { animation-delay: 0.8s; }

     @keyframes wave {
        0%, 100% { height: 2px; }
        50% { height: 20px; }
     }
    /* Si JS actualizara las alturas, esta animación base sería override */


     /* PANEL PREFERENCIAS (Del 1er archivo, adaptado) */
    .preferences-panel { /* Mantenemos clase, adaptamos estilo */
        position: fixed;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 200px; /* Ancho */
        background: rgba(var(--color-bg), 0.9); /* Fondo opaco */
        border: 1px solid var(--color-border);
        border-right: none; /* Sin borde derecho */
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
        padding: 15px;
        z-index: 1003; /* Por encima del header */
        transition: transform 0.3s ease-in-out;
        box-shadow: -5px 0 15px rgba(0,0,0,0.3), -5px 0 10px var(--color-accent-glow); /* Sombra y glow hacia la izquierda */
    }

    .preferences-panel.closed {
        transform: translateY(-50%) translateX(calc(100% - 30px)); /* Oculta excepto el toggle */
    }

    .preferences-toggle { /* Boton de toggle */
        position: absolute;
        left: -30px; /* Superpone 30px del panel oculto */
        top: 50%;
        transform: translateY(-50%);
        width: 30px;
        height: 50px;
        background: rgba(var(--color-bg), 0.9);
        border: 1px solid var(--color-border);
        border-right: none;
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-accent);
        font-size: 1.2rem;
        cursor: pointer;
        z-index: 1004; /* Asegurar que este clickable */
         box-shadow: -3px 0 8px rgba(0,0,0,0.3);
    }
    .preferences-toggle:hover {
        background: rgba(var(--color-bg), 0.95);
        color: var(--color-text);
    }
     .preferences-toggle i { transition: transform 0.3s ease-in-out; }
     .preferences-panel.closed .preferences-toggle i { transform: rotate(180deg); }


    .preferences-panel h4 {
        font-family: var(--font-heading);
        font-size: 1.2rem;
        color: var(--color-accent);
        margin-bottom: 15px;
        text-align: center;
        padding-bottom: 10px;
        border-bottom: 1px dashed var(--color-border);
    }
    .preferences-panel h4 i { margin-right: 5px; color: var(--color-text); }

    /* Estilo para checkboxes y labels (form-check) - Adaptado de estilos genéricos o originales */
    .form-check {
        display: flex; /* Usar flex para alinear */
        align-items: center;
        margin-bottom: 10px;
        color: var(--color-text);
        font-family: var(--font-main);
        font-size: 0.9rem;
    }

    .form-check-input {
        /* Ocultar input nativo y usar CSS para el diseño */
        appearance: none;
        -webkit-appearance: none;
        width: 16px; /* Tamaño custom */
        height: 16px;
        border: 1px solid var(--color-border);
        border-radius: 3px;
        background-color: rgba(var(--color-accent-rgb), 0.1); /* Fondo */
        margin-right: 8px;
        cursor: pointer;
        position: relative;
        transition: background-color var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
         flex-shrink: 0; /* Evitar que se encoja */
    }
    .form-check-input:checked {
        background-color: var(--color-accent); /* Fondo al check */
        border-color: var(--color-accent);
         box-shadow: var(--hud-glow); /* Glow al check */
    }
    .form-check-input:focus { /* Estilo focus para accesibilidad */
        outline: none;
        box-shadow: 0 0 5px var(--color-accent-glow);
    }
    /* Crear el checkmark con pseudo-elemento */
    .form-check-input::after {
        content: '';
        position: absolute;
        top: 2px; left: 5px;
        width: 4px;
        height: 8px;
        border: solid var(--color-bg); /* Color del checkmark */
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
        display: none; /* Oculto por defecto */
    }
    .form-check-input:checked::after {
        display: block; /* Mostrar al check */
    }


    .form-check-label {
        cursor: pointer;
        color: var(--color-muted);
        transition: color var(--transition-fast);
         flex-grow: 1; /* Permitir que ocupe espacio */
    }
     .form-check-input:checked + .form-check-label {
         color: var(--color-text); /* Texto principal si está checked */
     }
     .form-check:hover .form-check-label {
         color: var(--color-accent); /* Texto acentuado al hover de la línea */
     }
     .form-check:hover .form-check-input {
          border-color: var(--color-text);
     }


    /* Adaptaciones para las otras secciones del 1er archivo usando las clases del 2do */

    /* Secciones base como About, Skills, Projects, Timeline, Achievements, etc. */
    /* Todas tendrán la clase .section-container y .reveal */

     /* Estilo del footer (Del 1er archivo, adaptado con estilos del 2do) */
     #contact { /* Footer original, con ID #contact, pero con estilos del 2do archivo */
        /* Remove original flex and full width for footer */
         position: relative; /* Puede ser absoluto al final del main-content-wrapper si este tiene min-height: 100vh */
         z-index: 5;
     }
     /* Utilizamos la clase main-footer del 2do archivo en lugar del ID #contact para los estilos */
     .main-footer {
        background: rgba(var(--color-bg), 0.7);
        border-top: 1px solid var(--color-border);
        padding: 20px 5%;
        text-align: center;
        font-size: 0.8rem;
        color: var(--color-muted);
        position: relative; /* o static/relative según la estructura */
        z-index: 5;
        width: 100%;
         /* Asegurarse de que quede al final si mainContent tiene suficiente altura */
         /* bottom: 0; left: 0; */ /* solo si position fixed/absolute */
    }
     .main-footer p { margin-bottom: 10px; }
    /* Las links y social links se estilizarán con hud-link */

     /* EASTER EGG (Del 1er archivo, adaptado) */
     .easter-egg-msg {
         position: fixed;
         bottom: 70px; /* Ajustar posición para no chocar con footer/HUD/Visualizer */
         left: 20px;
         z-index: 1004;
         background: rgba(var(--color-accent-rgb), 0.2);
         border: 1px solid var(--color-accent);
         padding: 10px 15px;
         color: var(--color-text);
         font-family: var(--font-main);
         font-size: 0.9rem;
         border-radius: 4px;
         opacity: 0; /* Controlado por JS (si se implementa) */
         transition: opacity 0.5s ease-out;
         pointer-events: none; /* No interactivo */
         box-shadow: 0 0 8px rgba(var(--color-accent-rgb), 0.4);
     }
    /* Si no hay JS, mantener hidden o style="display: none;" */


     /* Modales (Del 2do archivo) */
    .modal {
      display: none; /* Controlled by JS */
      position: fixed;
      z-index: 10002; /* On top of filter panel */
      left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      align-items: center; justify-content: center;
       /* Ensure they start off-screen slightly for animation */
        opacity: 0;
        transition: opacity var(--transition-medium) ease;
        padding: 20px; /* Allow padding on smaller screens */
    }
    .modal.open {
        display: flex; /* Change to flex to show and center */
        opacity: 1;
    }

    .modal-content { /* Applies content-box styles implicitly or explicitly */
      position: relative;
      padding: 30px;
      width: 95%; /* Slightly larger max width on smaller screens */
      max-width: 600px;
      border-radius: 5px;
      animation: modal-fadein var(--transition-medium) ease forwards;

       /* Ensure inheriting/applying content-box styles */
       background: var(--color-glass-bg);
       border: 1px solid var(--color-border);
       backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
       box-shadow: 0 5px 15px rgba(0,0,0,0.2);

       /* Animation keyframes */
       transform: scale(0.9); /* Initial state */
    }
    @keyframes modal-fadein {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
     /* Hide modal-content if modal is not open */
     .modal:not(.open) .modal-content {
         animation: none; /* Stop animation */
         transform: scale(0.9); /* Reset scale */
     }

    .close-modal {
      position: absolute;
      top: 10px; right: 15px;
      font-size: 2rem;
      color: var(--color-muted);
      cursor: pointer;
      transition: color var(--transition-fast);
      line-height: 1;
      z-index: 1;
    }
    .close-modal:hover { color: var(--color-accent); }
    .modal-content h3 { color: var(--color-accent); margin-bottom: 15px; font-size: 1.4rem; font-family: var(--font-heading); }
    .modal-content p { color: var(--color-text); line-height: 1.6; margin-bottom: 10px; font-size: 0.9rem; font-family: var(--font-main); }
     .modal-content p strong { color: var(--color-accent); }
    .modal-content p:last-of-type { margin-bottom: 0; }
    .modal-content a.hud-link { display: inline-block; margin-top: 15px; font-size: 0.9rem; } /* Style download/verification link */

     /* Styles for .reveal animation - Already copied from 2nd file */
    .reveal {
      opacity: 0;
      transform: translateY(40px); /* Un poco más de desplazamiento */
      transition: opacity 0.8s cubic-bezier(0.645, 0.045, 0.355, 1), /* Ease-in-out */
                  transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }


    /* MEDIA QUERIES - Copiado y ligeramente ajustado del 2do archivo */
    @media (max-width: var(--tablet-break)) {
      html { font-size: 15px; } /* Ajustar base */
      .hud-readout { font-size: 0.7rem; padding: 4px 8px; }
      .top-left-readout { top: 70px; left: 15px; } /* Reposicionar readouts */
      .top-right-readout { top: 70px; right: 15px; }
      .bottom-left-readout { bottom: 60px; left: 15px; }
      .bottom-right-readout { bottom: 60px; right: 15px; }
      .section-container { padding: 80px 4%; }
      .main-content-wrapper { padding-top: 100px; padding-bottom: 60px; } /* Ajuste padding por header+HUD */
      #mainHeader { padding: 10px 20px; }
      .branding a { font-size: 1.4rem; }
      .projectx-container { grid-template-columns: 1fr; grid-template-areas: "visuals" "details" "video"; } /* Una columna */
    }

    @media (max-width: var(--mobile-break)) {
      html { font-size: 14px; }
      body { cursor: default; } /* Quitar cursor custom en móvil */
      .hud-corner { display: none; } /* Ocultar esquinas */
      .hud-line { display: none; } /* Ocultar líneas */
      .hud-readout { display: none; } /* Ocultar readouts */
      .main-content-wrapper { padding-top: 70px; padding-bottom: 20px; } /* Menos padding */
      #mainHeader { padding: 8px 15px; }
      .branding a { font-size: 1.3rem; }
      .header-controls { gap: 5px; }
      .hud-button { padding: 6px 10px; font-size: 0.7rem; }
      #muteButton { padding: 6px; }
      .filter-panel { width: 85%; max-width: 300px; max-height: 70vh;} /* Ajuste panel filtro movil */
       /* .hero sections may need individual padding adjustments if too tight */
       .hero { min-height: auto; padding: 100px 5% 50px 5%; } /* Allow shorter hero on small screens */
      .hero h1 { letter-spacing: 0.02em; }
      .scroll-down-indicator { bottom: 20px; font-size: 1.2rem; }
      .section-container { padding: 60px 5%; }
      .section-title { margin-bottom: 40px; }
       /* Ensure about-content, skills-grid, project-grid, timeline-list, etc flow vertically if they don't already with grid/flex auto-fit */
       .projectx-container { grid-template-areas: "details" "visuals" "video"; grid-template-columns: 1fr; } /* For clarity */
       .internal-search { flex-direction: column; align-items: center; }
       .internal-search input { width: 100%; max-width: 300px; }
       .timeline-list { padding-left: 20px; }
       .timeline-item { padding-left: 25px; }
       .timeline-item::before { left: 0px; /* Ajuste para que el círculo quede al borde izquierdo */ }
       .skills-grid, .achievements-grid, .certifications-grid, .process-steps, .services-grid, .downloads-grid, .blog-grid {
           grid-template-columns: 1fr; /* Single column layout for small screens */
           gap: 20px; /* Slightly less gap */
       }
       .service-card.featured { transform: none; } /* No scale on mobile */
       .featured-tag { right: -30px; font-size: 0.6rem; padding: 4px 30px; }
       .faqs-container { max-width: 100%; }
       .modal-content { width: 95%; padding: 20px; }
       .close-modal { top: 5px; right: 10px; font-size: 1.5rem;} /* Adjust close button */

       /* Adapt preferences panel on smaller screens */
       .preferences-panel {
           top: auto; bottom: 0; transform: none; width: 100%;
           border-right: 1px solid var(--color-border); /* Add border back */
           border-bottom-left-radius: 0; border-bottom-right-radius: 0;
           padding-bottom: 60px; /* Space for mobile navigation if any, or general bottom padding */
            /* Reajustar cuando cerrado en móvil */
           transform: translateY(calc(100% - 30px)); /* Hide all but 30px at bottom */
       }
        .preferences-panel.closed { transform: translateY(calc(100% - 30px)); }

       .preferences-toggle {
           position: fixed; /* Fixed bottom left */
           left: 10px; bottom: 10px; top: auto; transform: none;
           width: 50px; height: 30px; /* Different size for mobile */
           border: 1px solid var(--color-border); border-right-radius: 5px; border-left: none; /* Adjusted borders */
           background: rgba(var(--color-bg), 0.95);
           box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            z-index: 1004;
            padding: 0; /* Remove padding */
       }
        .preferences-toggle i { transform: none !important; } /* Override toggle icon rotation on mobile */
        /* Ensure preferences toggle appears clickable when panel is closed on mobile */
       .preferences-panel.closed .preferences-toggle { left: 10px; bottom: 10px; }

       /* Music Visualizer on mobile - maybe hide or reposition */
       .music-visualizer { display: none; /* Hide on small screens */ }
    }


  </style>

</head>

<body id="bodyElement">

  <!-- ============================================================
       PANTALLA DE CARGA AVANZADA (Del 2do archivo)
       ------------------------------------------------------------
       Reemplaza el loader simple del 1er archivo.
  ============================================================ -->
  <div class="loader-overlay active" id="loaderOverlay">
    <div class="loader-hud-border"></div>
    <div class="loader-scanline"></div>
    <div class="loader-content">
      <div class="loader-logo">[ CYBER_INIT ]</div>
      <div class="loader-text" id="loaderText">BOOTING SYSTEM...</div> <!-- Usando el ID del 2do archivo -->
      <div class="loader-bar-container">
        <div class="loader-bar" id="loaderBar"></div> <!-- Usando el ID del 2do archivo -->
      </div>
      <div class="loader-percentage" id="loaderPercentage">0%</div> <!-- Usando el ID del 2do archivo -->
      <div class="loader-subtext" id="loaderSubtext">Verifying integrity...</div> <!-- Usando el ID del 2do archivo -->
    </div>
  </div>

    <!-- Video de Fondo (Del 2do archivo) -->
    <video autoplay muted loop playsinline id="bg-video">
        <source src="Proyecto x/src/video/videoplayback (2).mp4" type="video/mp4"> <!-- Asegúrate de tener este video y la ruta correcta -->
        Tu navegador no soporta videos.
    </video>


  <!-- ============================================================
       ELEMENTOS DEL HUD (Heads-Up Display - Del 2do archivo)
       ------------------------------------------------------------
       Capas visuales fijas para dar la sensación de interfaz.
  ============================================================ -->
  <div class="hud-overlay visible" id="hudOverlay"> <!-- Added visible initially, JS will handle visibility -->
    <!-- Esquinas Decorativas -->
    <div class="hud-corner top-left"></div>
    <div class="hud-corner top-right"></div>
    <div class="hud-corner bottom-left"></div>
    <div class="hud-corner bottom-right"></div>

    <!-- Líneas Decorativas -->
    <div class="hud-line top"></div>
    <div class="hud-line bottom"></div>
    <div class="hud-line left"></div>
    <div class="hud-line right"></div>

    <!-- Readouts de Información -->
    <div class="hud-readout top-left-readout">
      <span>STATUS:</span> <span class="hud-ok">ONLINE</span>
    </div>
    <div class="hud-readout top-right-readout" id="hudClock"> <!-- Usando el ID del 2do archivo -->
      --:--:--
    </div>
    <div class="hud-readout bottom-left-readout">
       <span>SYS_ID:</span> JAE.M_2077_v3.4
    </div>
    <div class="hud-readout bottom-right-readout" id="hudScrollIndicator"> <!-- Usando el ID del 2do archivo -->
      <span>SCROLL:</span> 0%
    </div>
  </div>


  <!-- NAVEGACIÓN SUPERIOR (Del 1er archivo, reestructurado con estilos del 2do) -->
  <header id="mainHeader" class="visible"> <!-- Usando el ID del 2do archivo y clase visible -->
    <div class="branding"> <!-- Usando la estructura del 2do archivo -->
       <a href="../index.html" onclick="playSound('uiClickAudio')">[ EVIDENCE // 2077 ]</a> <!-- Usando nueva función playSound -->
    </div>

    <div class="header-controls"> <!-- Controles del header, del 2do archivo -->
         <!-- Botón Mute (Del 2do archivo) -->
         <button class="hud-button small" id="muteButton" aria-label="Silenciar Sonidos">
           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                <path d="M12 2.75903C11.4477 2.75903 11 3.20674 11 3.75903V20.259C11 20.8113 11.4477 21.259 12 21.259C12.5523 21.259 13 20.8113 13 20.259V3.75903C13 3.20674 12.5523 2.75903 12 2.75903Z" />
                <path d="M8.06005 6.30287C7.50776 6.30287 7.06005 6.75058 7.06005 7.30287V16.7152C7.06005 17.2675 7.50776 17.7152 8.06005 17.7152C8.61234 17.7152 9.06005 17.2675 9.06005 16.7152V7.30287C9.06005 6.75058 8.61234 6.30287 8.06005 6.30287Z" />
                <path d="M15.9399 6.30287C15.3877 6.30287 14.9399 6.75058 14.9399 7.30287V16.7152C14.9399 17.2675 15.3877 17.7152 15.9399 17.7152C16.4922 17.7152 16.9399 17.2675 16.9399 16.7152V7.30287C16.9399 6.75058 16.4922 6.30287 15.9399 6.30287Z" />
                <path d="M4 9.75903C3.44772 9.75903 3 10.2067 3 10.759V13.259C3 13.8113 3.44772 14.259 4 14.259C4.55228 14.259 5 13.8113 5 13.259V10.759C5 10.2067 4.55228 9.75903 4 9.75903Z" />
                <path d="M20 9.75903C19.4477 9.75903 19 10.2067 19 10.759V13.259C19 13.8113 19.4477 14.259 20 14.259C20.5523 14.259 21 13.8113 21 13.259V10.759C21 10.2067 20.5523 9.75903 20 9.75903Z" />
           </svg>
           <svg class="mute-slash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
               <path d="M4.75736 3.34315L3.34315 4.75736L19.2426 20.6569L20.6569 19.2426L4.75736 3.34315Z" />
           </svg>
         </button>
         <!-- Botones de Tema e Idioma (Del 2do archivo) - Elimina "Ciclar Tema Matrix" -->
         <button class="hud-button small" id="themeToggle" aria-label="Cambiar Tema">LGT</button> <!-- Texto inicial controlado por JS -->
         <button class="hud-button small" id="langToggle" aria-label="Cambiar Idioma">EN</button> <!-- Texto inicial controlado por JS -->

         <!-- Botón Menú/Filtro (Del 2do archivo) -->
         <div class="filter-container">
           <button class="hud-button" id="filter-btn" aria-label="Abrir menú de navegación">
             NAV_MENU
           </button>
         </div>
      </div>
  </header>

    <!-- Contenedor Notificaciones (Del 1er archivo) - Estilizado -->
   <div id="notificationContainer" class="notification-container" aria-live="polite">
        <!-- Notificaciones se añadirán aquí dinámicamente con JS -->
   </div>


   <!-- INTRO SECTION (Del 1er archivo - Removing HTML as original JS logic isn't included) -->
   <!-- Removing intro-section HTML -->


  <!-- ============================================================
       CONTENEDOR PRINCIPAL DEL CONTENIDO (Del 2do archivo)
       ------------------------------------------------------------
       Todo el contenido del portafolio va dentro de este wrapper.
       Excluye elementos fijos como loader, HUD, Header, Modales.
  ============================================================ -->
   <div class="main-content-wrapper visible" id="mainContent"> <!-- Usando ID y clase visible del 2do archivo -->

      <!-- HERO (Del 1er archivo, estilizado con el 2do) -->
      <section class="hero reveal" id="hero"> <!-- Añadidas clases reveal -->
         <div class="hero-content animation-trigger animate-slide-in-bottom"> <!-- Mantenido contenedor, animación via JS+CSS -->
             <h1 class="hero-title" data-text="EVIDENCIAS // 2077" id="heroTitle">EVIDENCIAS // 2077</h1> <!-- Usando ID del 2do archivo -->
             <p class="hero-subtitle" id="heroSubtitle">
                 Navega a través de los fragmentos de código y diseño recuperados. La Red es vasta, la información espera. Cuidado con el Black ICE.
             </p>
             <button class="btn-hero hud-button primary" onclick="document.getElementById('proyectoX').scrollIntoView({ behavior: 'smooth' }); playSound('uiClickAudio')">Explorar Archivos</button>
         </div>
         <!-- Scroll Down Indicator (Añadido desde 2do archivo) -->
         <a href="#proyectoX" class="scroll-down-indicator" aria-label="Scroll a Proyecto X">▼</a>
      </section>

      <!-- PROYECTO X (Del 1er archivo, estilizado) -->
      <section class="projectx-section section-container reveal" id="proyectoX"> <!-- Añadidas clases section-container y reveal -->
        <h2 class="section-title animation-trigger animate-fade-scale-up"><i class="fas fa-project-diagram"></i> Proyecto X // Classified</h2> <!-- Añadida clase section-title -->
        <div class="projectx-container">
          <div class="projectx-details content-box animation-trigger animate-slide-in-left"> <!-- Añadidas clases content-box y animation-trigger -->
            <h3><i class="fas fa-microchip"></i> Core Logic & Data</h3>
            <p>Simulación neural avanzada para análisis predictivo de flujos de datos en la Red. Implementa algoritmos de cifrado cuántico y evasión de ICE.</p>
            <ul>
              <li><strong>Motor:</strong> Quantum Weaver X</li> <li><strong>IA:</strong> Cerebrus v7.1</li>
              <li><strong>Red:</strong> GhostNet Secure Channel</li> <li><strong>Defensa:</strong> Chimera ICE Breaker Suite</li>
            </ul>
          </div>
          <div class="projectx-visuals content-box animation-trigger animate-fade-scale-up"> <!-- Añadidas clases content-box y animation-trigger -->
            <h3><i class="fas fa-palette"></i> Interface Visuals</h3>
            <div class="gallery">
              <img data-src="src/img/cyberpunk.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Interfaz Holográfica" /> <!-- Añadido data-src -->
              <img data-src="src/img/panel2.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Esquema Neural" /> <!-- Añadido data-src -->
              <img data-src="src/img/panel3.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Visualización Datos" /> <!-- Añadido data-src -->
              <img data-src="src/img/gotic.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Esquema Hardware" /> <!-- Añadido data-src -->
              <img data-src="src/img/blanca como la nieve.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Acceso Biométrico"/> <!-- Añadido data-src -->
              <img data-src="src/img/celestial.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="Núcleo Energía"/> <!-- Añadido data-src -->
            </div>
          </div>
          <div class="projectx-video content-box animation-trigger animate-slide-in-right"> <!-- Añadidas clases content-box y animation-trigger -->
            <h3><i class="fas fa-play-circle"></i> Operational Demo</h3>
            <!-- Nota: Puedes añadir data-src y src placeholder aquí también si el navegador soporta lazy loading de video posters/sources -->
            <video controls preload="metadata" poster="src/img/panel_video_poster.jpg">
              <source src="Proyecto x/src/video/videoplayback (2).mp4" type="video/mp4" /> <!-- Asegura que esta ruta sea accesible -->
              Tu navegador no soporta la etiqueta de video.
            </video>
          </div>
        </div>
      </section>

      <!-- MUSICA VISUALIZADOR (Del 1er archivo) - Estilizado -->
      <div class="music-visualizer" id="musicVisualizer">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      </div>

      <!-- PANEL PREFERENCIAS (Del 1er archivo) - Estilizado -->
      <div class="preferences-panel closed" id="preferencesPanel">
        <button class="preferences-toggle" id="preferencesToggleBtn" aria-label="Toggle Preferences Panel">
          <i class="fas fa-chevron-left"></i>
        </button>
        <h4><i class="fas fa-cog"></i> Interface Config</h4>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="particlesToggle"><label class="form-check-label" for="particlesToggle">Data Particles</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="scanlinesToggle"><label class="form-check-label" for="scanlinesToggle">Scanlines FX</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="soundsToggle"><label class="form-check-label" for="soundsToggle">Auditory Feedback</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="animationsToggle"><label class="form-check-label" for="animationsToggle">Panel Animations</label></div>
      </div>

        <!-- Add Other Sections from Second HTML if desired here... e.g., About, Skills, etc.
             This request focuses on the UI integration into the FIRST file's content structure.
             Assuming "Proyecto X" is representative of the other sections you want to keep
             and they will also get the .section-container, .reveal, and inner .content-box. -->
        <!-- If you have other sections from the reference or original you want to add/transfer: -->
        <!-- Example: If you want to add the About section structure from the 2nd file: -->
        <!--
        <section class="about section-container reveal" id="about">
            <h2 class="section-title">Sobre Mí /// User_Profile</h2>
            <div class="about-content">
                 <div class="about-text content-box">...</div>
                 <div class="about-image content-box">
                      <img data-src="path/to/your/about-img.jpg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAIBRAA7" alt="About Me Image" loading="lazy">
                      <div class="image-hud-overlay">ID_SCAN: JAEspinosa</div>
                 </div>
            </div>
        </section>
        -->
        <!-- Ensure IDs and structure match the JS selectors for sections, etc. -->

        <!-- FOOTER (Del 1er archivo) - Estilizado con clase .main-footer del 2do archivo -->
       <!-- Using the class main-footer from the 2nd file CSS -->
        <footer class="main-footer" id="contact">
            <p id="footerCopy">© 2077 J.A.E.M. // Data Cache Archived // Secure Connection</p>
            <!-- Assuming these links might get .hud-link classes if JS handles them or CSS is updated -->
             <div class="footer-links">
                 <a href="#" class="hud-link small">Privacy_Protocol</a> | <a href="#" class="hud-link small">Terms_Of_Service</a>
             </div>
             <div class="social-links">
                 <a href="https://www.linkedin.com" target="_blank" rel="noopener" class="hud-link social" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                 <a href="https://github.com" target="_blank" rel="noopener" class="hud-link social" aria-label="GitHub"><i class="fab fa-github"></i></a>
                 <!-- Assuming Dribbble, etc. from original file/concept -->
                 <a href="https://dribbble.com" target="_blank" rel="noopener" class="hud-link social" aria-label="Dribbble"><i class="fab fa-dribbble"></i></a>
             </div>
        </footer>
   </div> <!-- Fin de .main-content-wrapper -->

   <!-- PANEL DE FILTRO/NAVEGACIÓN (Del 1er archivo, reestructurado con el 2do) -->
   <!-- Overlay oscuro del 2do archivo, mantiene el ID del 1ero -->
  <div class="filter-overlay" id="filterOverlay"></div>
   <!-- Panel del menú del 2do archivo, ahora fuera del flujo principal del contenido -->
  <div class="filter-panel" id="filter-panel">
    <!-- Content original from filter-overlay in file 1 -->
    <div class="filter-content">
      <ul>
         <!-- Estilizar estos links con clase .filter-link (nombre original en 1er archivo) -->
         <li><a class="filter-link" data-text="DISEÑO" href="diseños/Menu.html">DISEÑO</a></li>
         <li><a class="filter-link" data-text="PRESENTACION" href="presentacion/presentacion.html">PRESENTACIÓN</a></li>
         <li><a class="filter-link" data-text="PROYECTO X" href="#proyectoX">PROYECTO X</a></li> <!-- Link interno -->
         <li><a class="filter-link" data-text="LABORATORIO" href="laboratorio/index.html">LABORATORIO</a></li>
         <!-- Botón de tema matrix removido, ya hay theme toggle en header -->
      </ul>
        <!-- Add the language toggle here if desired -->
         <ul style="margin-top: 2rem; border-top: 1px solid var(--border-color); padding-top: 2rem;">
             <!-- Removed Theme Toggle Menu -->
         </ul>
    </div>
  </div>


   <!-- EASTER EGG (Del 1er archivo) - Estilizado, funcionalidad via JS (if added) -->
  <div class="easter-egg-msg" id="easterEggMsg">Ice bypassed! Deep Network Access granted. Welcome, Ghost.</div>


  <!-- ============================================================
       MODALES (Del 2do archivo - HTML de ejemplo)
       ------------------------------------------------------------
       Añadir si necesitas mostrar certificados u otra info en popups.
       Requiere que el HTML de la referencia exista para que el JS funcione.
       Vamos a añadir la estructura base y 4 modales de ejemplo como en el 2do archivo.
  ============================================================ -->
  <div id="modal-cert1" class="modal"><div class="modal-content content-box"><span class="close-modal">&times;</span><h3>[IBM] Web Dev Foundations</h3><p>Curso introductorio completo a HTML, CSS, & JavaScript por IBM. Fundamentos esenciales para desarrollo web moderno.</p><p>Emitido: <strong>IBM</strong> // Fecha: <strong>05/03/2025</strong></p><p><a href="https://coursera.org/verify/CZ47JIW4L9Y" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p></div></div>
  <div id="modal-cert2" class="modal"><div class="modal-content content-box"><span class="close-modal">&times;</span><h3>[IBM] Generative AI Dev</h3><p>Capacitación en IA Generativa aplicada al desarrollo de software para optimización y automatización de procesos.</p><p>Emitido: <strong>IBM</strong> // Fecha: <strong>10/04/2025</strong></p><p><a href="https://coursera.org/verify/F046N23FJU08" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p></div></div>
  <div id="modal-cert3" class="modal"><div class="modal-content content-box"><span class="close-modal">&times;</span><h3>[IBM] Git & GitHub Mastery</h3><p>Curso intensivo sobre control de versiones con Git y GitHub. Best practices para colaboración eficiente en proyectos.</p><p>Emitido: <strong>IBM</strong> // Fecha: <strong>15/04/2025</strong></p><p><a href="https://www.coursera.org/account/accomplishments/verify/CWRQOJ19Z102" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p></div></div>
  <div id="modal-cert4" class="modal"><div class="modal-content content-box"><span class="close-modal">&times;</span><h3>[Google] Cybersecurity Foundations</h3><p>Curso especializado en fundamentos de ciberseguridad. Estrategias y herramientas para protección de datos digitales.</p><p>Emitido: <strong>Google</strong> // Fecha: <strong>28/03/2025</strong></p><p><a href="https://www.coursera.org/account/accomplishments/verify/F046JNZ3FUO9" target="_blank" class="hud-link">Verificar Credencial [Ext]</a></p></div></div>
  <!-- Necesitarás botones para abrir estos modales, que tengan la clase "modal-trigger" y data-modal-id="modal-certX" -->


  <!-- ============================================================
       ELEMENTOS DE AUDIO (Unificado y con IDs para JS)
       ------------------------------------------------------------
       Copiamo IDs y rutas desde el 2do archivo (referencia JS), adaptando.
  ============================================================ -->

  <!-- Sonido de "terminal" o proceso en curso durante la pantalla de carga inicial. -->
  <!-- Usamos ID y ruta del 2do archivo -->
  <audio id="loadingAudio" loop preload="auto">
    <source src="Audio/Sound-mp3/terminal.mp3" type="audio/mpeg">
  </audio>

  <!-- Sonido corto de "aviso" o "sistema listo" que suena al finalizar la carga (100%). -->
  <!-- Usamos ID y ruta del 2do archivo -->
  <audio id="loadCompleteAudio" preload="auto">
    <source src="Audio/Sound-mp3/aviso.mp3" type="audio/mpeg">
  </audio>

  <!-- Música de fondo principal que se reproduce en bucle una vez cargada la página. -->
  <!-- Usamos ID del 1er archivo pero ruta del 2do archivo si la prefieres (Hybrid) -->
  <audio id="backgroundAudio" loop><source src="Audio/Stardust_ Relaxing Ambient Sci Fi Music.mp3" type="audio/mpeg"></audio> <!-- Usando Hybrid & Dark del 2do -->

  <!-- Sonido genérico para clics en botones, enlaces y otros elementos interactivos de la UI. -->
  <!-- Usamos ID y ruta del 2do archivo -->
  <audio id="uiClickAudio" preload="auto">
    <source src="Audio/Sound-mp3/click 2.mp3" type="audio/mpeg">
  </audio>

  <!-- Sonido genérico para el efecto hover sobre elementos interactivos. -->
  <!-- Usamos ID y ruta del 2do archivo (uiHoverAudio con botón UI haga click) -->
  <audio id="uiHoverAudio" preload="auto">
    <source src="Audio/botones/botón UI haga clic en 1.mp3" type="audio/mpeg">
  </audio>

  <!-- Sonido específico para los enlaces dentro del menú de navegación/filtrado. -->
   <!-- Usamos ID y ruta del 2do archivo (filterHoverAudio con click 2) -->
  <audio id="filterHoverAudio" preload="auto">
    <source src="Audio/Sound-mp3/click 2.mp3" type="audio/mpeg">
  </audio>

   <!-- Audio de notificación (Original del 1er archivo - Mantenido si se añade JS después) -->
   <!-- Si no se usa JS para esto, podría removerse -->
   <audio id="audio-notification" src="Audio/ui-notification.wav" preload="auto"></audio>
   <!-- Otros audios del 1er archivo (terminal-keypress-sound) si no tienen lógica, se pueden quitar -->
    <!-- Removed terminal-keypress-sound -->


  <!-- ============================================================ -->
  <!-- JavaScript Logic (Combinado de ambos archivos, adaptado)     -->
  <!-- ============================================================ -->
  <script>
    "use strict"; // Modo estricto

    document.addEventListener('DOMContentLoaded', () => {

        // ============================================================
        // SELECTORES DE ELEMENTOS FRECUENTES (Adaptado para HTML final)
        // ============================================================
        const loaderOverlayEl = document.getElementById('loaderOverlay'); // Usa el ID del loader final
        const loaderBar = document.getElementById('loaderBar'); // Usa el ID del loader final
        const loaderPercentage = document.getElementById('loaderPercentage'); // Usa el ID del loader final
        const loaderText = document.getElementById('loaderText'); // Usa el ID del loader final
        const loaderSubtext = document.getElementById('loaderSubtext'); // Usa el ID del loader final
        const mainHeader = document.getElementById('mainHeader'); // Usa el ID del header final
        const mainContent = document.getElementById('mainContent'); // Usa el ID del wrapper principal
        const hudOverlay = document.querySelector('.hud-overlay'); // Clase del HUD Overlay
        const hudClock = document.getElementById('hudClock'); // Usa el ID del reloj del HUD
        const hudScrollIndicator = document.getElementById('hudScrollIndicator'); // Usa el ID del indicador de scroll
        const filterBtn = document.getElementById('filter-btn'); // Usa el ID del botón del menú
        const filterPanel = document.getElementById('filter-panel'); // Usa el ID del panel del menú (ahora diferente al overlay)
        const filterOverlay = document.getElementById('filterOverlay'); // Usa el ID del overlay de fondo
        const themeToggle = document.getElementById('themeToggle'); // Usa el ID del botón de tema
        const langToggle = document.getElementById('langToggle'); // Usa el ID del botón de idioma
        const muteButton = document.getElementById('muteButton'); // Usa el ID del botón mute
        const htmlEl = document.documentElement;
        const bodyEl = document.body; // Added body reference


        // ============================================================
        // MANEJO DE SONIDOS (Centralizado y con Mute - Del 2do archivo)
        // Adaptado a los IDs de los elementos Audio finales.
        // ============================================================
        const sounds = {
            loading: document.getElementById('loadingAudio'), // Match final HTML ID
            complete: document.getElementById('loadCompleteAudio'), // Match final HTML ID
            background: document.getElementById('backgroundAudio'), // Match final HTML ID
            click: document.getElementById('uiClickAudio'), // Match final HTML ID
            hover: document.getElementById('uiHoverAudio'), // Match final HTML ID
            filterHover: document.getElementById('filterHoverAudio'), // Match final HTML ID
            notification: document.getElementById('audio-notification') // Match final HTML ID (if keeping notifications)
             // Removed original audio IDs and linked to the new ones
        };

        let isMuted = localStorage.getItem('portfolioMuted') === 'true'; // Recuperar estado de mute

        function updateMuteButton() {
            if (!muteButton) return;
            if (isMuted) {
                muteButton.classList.add('muted');
                muteButton.setAttribute('aria-label', 'Activar Sonidos');
                 // Ensure sounds are stopped when muted is toggled on
                Object.values(sounds).forEach(audio => {
                    if(audio && audio !== sounds.background) { // Don't stop background yet if it's handled separately after load
                       try { audio.pause(); audio.currentTime = 0; } catch(e){} // Handle potential errors
                    }
                });
                 // Handle background sound stop separately as its start is delayed
                 if(sounds.background) try { sounds.background.pause(); } catch(e){}
                 if(sounds.loading && loaderOverlayEl && loaderOverlayEl.classList.contains('active')) { // Stop loading sound if still active
                    try { sounds.loading.pause(); } catch(e){}
                 }

            } else {
                muteButton.classList.remove('muted');
                muteButton.setAttribute('aria-label', 'Silenciar Sonidos');
                // Optionally, could resume ambient sounds here if page is loaded
                if (!loaderOverlayEl.classList.contains('active') && sounds.background) {
                     try { sounds.background.play().catch(e => console.warn("BG resume error", e)); } catch(e){}
                } else if (sounds.loading && loaderOverlayEl.classList.contains('active')) { // If loading is still active
                     try { sounds.loading.play().catch(e => console.warn("Loading resume error", e)); } catch(e){}
                }
            }
        }

        function playSound(soundName, volume = 0.5) {
            if (isMuted || !sounds[soundName]) {
                 //console.log(`Sound ${soundName} blocked (muted or not found).`);
                 return;
             }
            try {
                const audio = sounds[soundName];
                audio.volume = volume;
                // Stop and reset for non-looping sounds like clicks/hovers
                if (!audio.loop) audio.currentTime = 0;
                // Pequeño delay antes de play para evitar errores o bugs de múltiples plays
                // Solo aplica un pequeño delay para sonidos cortos y frecuentes
                 const playDelay = (soundName === 'click' || soundName === 'hover' || soundName === 'filterHover' || soundName === 'notification') ? 10 : 0;

                setTimeout(() => {
                    audio.play().catch(e => {
                         // Suppress common play() rejected by user gesture error unless it's not due to that
                         if (e.name === 'NotAllowedError' || e.name === 'AbortError') {
                            // console.log(`Playback prevented for ${soundName}. User interaction required.`, e);
                            // Optionally, show a message asking user to click to enable audio
                         } else {
                             console.warn(`Error playing sound (${soundName}):`, e);
                         }
                     });
                }, playDelay);

            } catch (e) {
                console.warn(`Error handling play sound (${soundName}):`, e);
            }
        }


        function stopSound(soundName) {
            if (sounds[soundName]) {
                try {
                    sounds[soundName].pause();
                    sounds[soundName].currentTime = 0;
                } catch(e) {
                     console.warn(`Error stopping sound (${soundName}):`, e);
                }
            }
        }

         // Optional: Implement notification display logic
         function showNotification(message, type = 'info', duration = 5000) {
             if (!document.getElementById('notificationContainer')) return; // Exit if container not found
             // Removed sound logic from here, now handled by showNotification or just playSound('notification') externally if desired

             const notificationEl = document.createElement('div');
             notificationEl.classList.add('notification');
             if (type) notificationEl.classList.add(type); // Add type like 'error', 'warning', etc.
             notificationEl.textContent = message;
             notificationEl.setAttribute('role', 'alert'); // ARIA live region role

              document.getElementById('notificationContainer').appendChild(notificationEl);

             // Trigger animation
             setTimeout(() => notificationEl.style.opacity = 1, 10); // Small delay to allow element to be in DOM

             // Auto-remove after duration + animation time
             const animationDuration = 500; // Match CSS animation duration
              setTimeout(() => {
                 notificationEl.style.opacity = 0;
                  notificationEl.style.transform = 'translateX(100%)'; // Start fade-out animation (if not using keyframes with delay)
                 setTimeout(() => notificationEl.remove(), animationDuration);
              }, duration);

              // Play notification sound if available and not muted
             playSound('notification', 0.7);
         }
         // Example Usage: showNotification('System status: ONLINE', 'info'); showNotification('Warning: Data anomalies detected', 'warning');


        // Initialize mute button status based on local storage
        updateMuteButton();


        // Add hover sounds to interactable elements - need to adjust selectors based on final HTML
        document.querySelectorAll('button, a:not(.hud-link), .hud-button, .filter-link, .projectx-visuals img, .skill-item').forEach(el => {
            // Exclude specific elements if their hover should be silent or handled differently
            if (el === muteButton) return; // Mute button handled internally or by click sound only
            // if (el.closest('.preferences-panel')) return; // Maybe handle preferences hover differently

            el.addEventListener('mouseenter', () => {
                // Use different sound for filter menu links if specified
                if (el.classList.contains('filter-link')) {
                    playSound('filterHover', 0.5);
                } else {
                    playSound('hover', 0.3); // Less volume for generic hover
                }
            });
             el.addEventListener('click', () => {
                 // Filter menu links already have click sound handler below, exclude here
                 if (el.classList.contains('filter-link')) return;
                 // exclude download triggers as they have their own handler
                 if (el.classList.contains('download-trigger')) return;
                 // exclude modal triggers as they have their own handler
                  if (el.classList.contains('modal-trigger')) return;
                 // exclude mute button click
                  if (el === muteButton) return;


                playSound('click', 0.6);
             });
        });


        // ============================================================
        // PANTALLA DE CARGA AVANZADA (Del 2do archivo, adaptado)
        // Integra la lógica con los nuevos IDs del loader.
        // ============================================================
         // Only execute if the loader HTML exists
        if (loaderOverlayEl && loaderBar && loaderPercentage && loaderText && loaderSubtext) {
            let progress = 0;
            const loadingSteps = [
                { percent: 15, text: "ACCESSING MATRIX...", subtext: "Initializing protocols..." },
                { percent: 30, text: "LOADING HUD INTERFACE...", subtext: "Calibrating displays..." },
                { percent: 55, text: "DECRYPTING ASSET CACHE...", subtext: "Retrieving portfolio data..." },
                { percent: 75, text: "ESTABLISHING SECURE CHANNEL...", subtext: "Connecting to comms link..." },
                { percent: 90, text: "SYSTEM INTEGRITY CHECK...", subtext: "Final diagnostics..." },
                { percent: 100, text: "SYSTEM ONLINE", subtext: "Access Granted." } // Updated text
            ];
            let currentStep = 0;
            let lastProgress = 0; // Track last integer progress

            // Start loading sound only if not muted
             if (!isMuted) {
                 try { sounds.loading.play().catch(e => console.warn("Loading audio play error:", e)); } catch(e){}
             }


            const simulateLoading = setInterval(() => {
                // Increase progress, faster initially, slower as it reaches later steps
                let stepIncrease = (100 - progress) / 40; // Calculate based on remaining progress
                progress += Math.random() * stepIncrease + 0.1; // Random factor for feel
                progress = Math.min(progress, 100.01); // Allow slight overshoot to ensure 100%

                const currentProgress = Math.floor(progress);

                if(loaderBar) loaderBar.style.width = progress + '%';
                if(loaderPercentage && currentProgress !== lastProgress) loaderPercentage.textContent = currentProgress + '%'; // Update only on integer change

                lastProgress = currentProgress;

                // Update loading texts based on integer progress
                if (currentStep < loadingSteps.length && currentProgress >= loadingSteps[currentStep].percent) {
                     // Small delay before text updates for effect
                     setTimeout(() => {
                         if(loaderText) loaderText.textContent = loadingSteps[currentStep].text;
                         if(loaderSubtext) loaderSubtext.textContent = loadingSteps[currentStep].subtext;
                          // Play a small click/advance sound if desired on text update
                          if(currentStep < loadingSteps.length - 1) playSound('hover', 0.2); // Use hover sound for tick
                          else playSound('loadCompleteAudio', 0.6); // Use complete sound for final step

                         currentStep++;
                     }, 50); // Delay
                }


                if (progress >= 100) {
                    clearInterval(simulateLoading);
                    stopSound('loading'); // Stop loading sound
                    // Completion sound is now played via text update logic

                    // Delay before transition out
                    setTimeout(() => {
                        loaderOverlayEl.classList.remove('active'); // Starts fade-out CSS transition

                        // After loader transition finishes
                        setTimeout(() => {
                            loaderOverlayEl.style.display = 'none'; // Hide completely

                            // Reveal main content and HUD (uses visible class and CSS transitions)
                             if(mainHeader) mainHeader.classList.add('visible');
                             if(mainContent) mainContent.classList.add('visible');
                             if(hudOverlay) hudOverlay.classList.add('visible');
                            // The JS starts hidden, we want them visible when the loader is done


                            // Start background music after content is visible (only if not muted)
                             if(!isMuted && sounds.background) {
                                 try { sounds.background.volume = 0.2; sounds.background.play().catch(e => console.warn("BG play error:", e)); } catch(e) {}
                             }

                            // Trigger initial animations/effects on visible elements
                            triggerVisibleReveals(); // Assumes sections have .reveal class
                             triggerVisibleSkillBars(); // Trigger skill bar animations


                            startClock(); // Start HUD clock

                             // Show a "System Online" notification after content loads
                             showNotification('System Online. Access granted.', 'info', 6000);


                        }, 800); // Must match the duration of transition in .loader-overlay CSS
                    }, 700); // Small pause at 100%
                }
            }, 30); // Interval for speed and feel

        } else {
            // Fallback if no loader elements found - show content directly
             console.warn("Loader elements not found, showing content directly.");
             if(loaderOverlayEl) loaderOverlayEl.style.display = 'none';
             if(mainHeader) mainHeader.classList.add('visible');
             if(mainContent) mainContent.classList.add('visible');
             if(hudOverlay) hudOverlay.classList.add('visible');
             // Play background music immediately (if not muted)
             if(!isMuted && sounds.background) {
                 try { sounds.background.volume = 0.2; sounds.background.play().catch(e => console.warn("BG autoplay error:", e)); } catch(e){}
             }
             triggerVisibleReveals();
             triggerVisibleSkillBars();
             startClock();
             showNotification('System initialized.', 'info', 3000); // Simpler fallback notification
        }


        // ============================================================
        // FUNCIONALIDAD DEL MENÚ FILTRO (Overlay Centrado - Del 2do archivo)
        // Adaptado a los IDs/Clases del HTML final.
        // ============================================================
        if (filterBtn && filterPanel && filterOverlay) {
             // Add click sound and toggle function to filter button
            filterBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent clicks inside panel from propagating immediately
                playSound('click');
                filterPanel.classList.toggle('open');
                filterOverlay.classList.toggle('open');
                 bodyEl.style.overflow = filterPanel.classList.contains('open') ? 'hidden' : ''; // Prevent scroll when menu is open
            });

            // Add click sound and close function to overlay
            filterOverlay.addEventListener('click', () => {
                // Play a slightly different sound for closing or less volume
                playSound('click', 0.4);
                filterPanel.classList.remove('open');
                filterOverlay.classList.remove('open');
                bodyEl.style.overflow = ''; // Re-enable scroll
            });

             // Close menu if clicking outside the panel itself (delegated to overlay)
            /* document.addEventListener('click', (e) => {
                // This is effectively handled by clicking the overlay which is behind the panel but fullscreen
                 if (filterPanel.classList.contains('open') && !filterPanel.contains(e.target) && !filterBtn.contains(e.target) && !filterOverlay.contains(e.target)) {
                    filterPanel.classList.remove('open');
                    filterOverlay.classList.remove('open');
                    bodyEl.style.overflow = ''; // Re-enable scroll
                }
            }); */ // Commented out - click on overlay handles this

            // Close menu on Escape key press
            document.addEventListener('keydown', (e) => {
                 if (e.key === 'Escape' && filterPanel.classList.contains('open')) {
                     playSound('click', 0.4);
                     filterPanel.classList.remove('open');
                     filterOverlay.classList.remove('open');
                     bodyEl.style.overflow = ''; // Re-enable scroll
                 }
             });


            // Close menu and navigate on clicking a link in the menu (uses class 'filter-link' from original HTML)
            const filterLinks = filterPanel.querySelectorAll('.filter-link'); // Select using the original class
            filterLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // Handle internal vs external links
                    const targetHref = link.getAttribute('href');

                     // Always play sound and close menu immediately
                    playSound('click');
                    filterPanel.classList.remove('open');
                    filterOverlay.classList.remove('open');
                    bodyEl.style.overflow = ''; // Re-enable scroll

                    // Use smooth scroll for hash links
                    if (targetHref && targetHref.startsWith('#')) {
                        e.preventDefault(); // Prevent default only for hash links
                        // Scroll is handled inside the setTimeout to ensure menu is closed first visually
                        setTimeout(() => smoothScrollTo(targetHref), 100); // Small delay for visual effect
                    }
                    // For external links, let the default navigation happen

                });
                // Add hover sound specifically for menu links (uses original class 'filter-link')
                link.addEventListener('mouseenter', () => {
                    playSound('filterHover', 0.5);
                });
            });
        }


        // ============================================================
        // SCROLL SUAVE PARA ENLACES INTERNOS (Del 2do archivo)
        // Asegura que el header fijo no oculte el destino.
        // ============================================================
        function smoothScrollTo(targetSelector) {
            const targetElement = document.querySelector(targetSelector);
            if (targetElement && mainHeader) {
                // Get the fixed header's height to offset the scroll position
                const headerOffset = mainHeader.offsetHeight + 20; // Add some extra margin
                const elementPosition = targetElement.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            } else if (targetElement) {
                 // Fallback if header or mainHeader ID not found
                 targetElement.scrollIntoView({ behavior: 'smooth'});
                 console.warn(`smoothScrollTo: targetElement found, but mainHeader missing for offset.`);
            } else {
                 console.warn(`smoothScrollTo: target element "${targetSelector}" not found.`);
            }
        }

        // Apply smooth scroll to internal hash links across the page (excluding specific elements)
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            // Exclude links inside elements handled differently (e.g., carousels, modals, filter panel)
            // Note: Filter panel links are handled separately above to close the menu first
            if (!anchor.closest('.carousel-controls') && !anchor.closest('.modal-content') && !anchor.closest('#filter-panel')) { // Adjusted selector for panel
                anchor.addEventListener('click', function (e) {
                     const targetHref = this.getAttribute('href');
                     // Exclude if target is just '#' or empty hash, which usually means scroll to top or stays on page
                    if (targetHref === '#' || targetHref === '') {
                        e.preventDefault(); // Prevent default if only '#'
                        if (targetHref === '#') {
                            // Scroll to top if it's just '#'
                             window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                        playSound('click');
                    } else {
                       // Only prevent default for non-empty hash links handled by smoothScrollTo
                        e.preventDefault();
                        // Scroll is handled inside smoothScrollTo
                        playSound('click');
                        smoothScrollTo(targetHref);
                    }
                });
                // Add hover sound to these internal links (using generic hover sound)
                 anchor.addEventListener('mouseenter', () => playSound('hover', 0.3));
            }
        });


        // ============================================================
        // ANIMACIONES AL HACER SCROLL (REVEAL - Del 2do archivo)
        // Se activa cuando los elementos con la clase 'reveal' entran al viewport.
        // ============================================================
        const revealElements = document.querySelectorAll('.reveal');

        if (typeof IntersectionObserver !== 'undefined') {
            const revealObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        // If you want to animate only once: observer.unobserve(entry.target);
                    } else {
                        // If you want to animate each time they come into view:
                        // entry.target.classList.remove('visible');
                    }
                });
            }, {
                root: null, // Observe against the viewport
                threshold: 0.15, // Percentage of target visible
                rootMargin: '0px 0px -50px 0px' // Grow or shrink the viewport box (top, right, bottom, left)
            });

            // Start observing all elements with the 'reveal' class
            revealElements.forEach(el => revealObserver.observe(el));
        } else {
            // Fallback if IntersectionObserver not supported (show all elements immediately)
            revealElements.forEach(el => el.classList.add('visible'));
            console.warn("IntersectionObserver not supported, scroll animations disabled.");
        }

        // Function to manually trigger 'visible' class for elements already in view on load (called after loader)
        function triggerVisibleReveals() {
             revealElements.forEach(el => {
                 const rect = el.getBoundingClientRect();
                 // Check if the element is within the viewport on load
                 const isPartiallyVisible = rect.top < window.innerHeight && rect.bottom >= 0 && rect.left < window.innerWidth && rect.right >= 0;
                  // Add some extra check for the top portion that is visible on load
                  const isAboveViewportBottom = rect.top < window.innerHeight - 50; // Adjusted to reveal elements slightly higher
                  const isBelowViewportTop = rect.bottom > 50; // Adjusted to reveal elements slightly lower

                 if (isPartiallyVisible && isAboveViewportBottom && isBelowViewportTop) {
                     el.classList.add('visible');
                 }
             });
             // Now that elements might be visible, trigger skill bars for the visible ones
              triggerVisibleSkillBars(); // Call AFTER initial reveals might have occurred
        }


        // ============================================================
        // CARRUSEL DE TESTIMONIOS (Del 2do archivo)
        // Lógica simple para mostrar un testimonio a la vez.
        // Need to ensure HTML for testimonials (class 'testimonial') and controls ('carousel-controls', buttons inside) is present.
        // Original HTML doesn't have this structure, so need to add it or skip this JS part.
        // The original HTML *did not* have a testimonial section.
        // Let's assume we add the basic testimonial structure from the 2nd file examples.
        // This part of JS won't do anything if the HTML is not added.

        const testimonials = document.querySelectorAll('.testimonial'); // Select elements with class 'testimonial'
        const carouselButtons = document.querySelectorAll('.carousel-controls button'); // Select buttons inside controls
        let currentTestimonialIndex = 0;

        // Only enable testimonial logic if elements are found
        if(testimonials.length > 0 && carouselButtons.length > 0 && testimonials.length === carouselButtons.length) {
             function changeTestimonial(index) {
                if (index < 0 || index >= testimonials.length || index === currentTestimonialIndex) return;

                 playSound('click', 0.4); // Sound on changing slide

                 // Hide current
                if (testimonials[currentTestimonialIndex]) testimonials[currentTestimonialIndex].classList.remove('active');
                if (carouselButtons[currentTestimonialIndex]) carouselButtons[currentTestimonialIndex].classList.remove('active');

                 // Show new
                currentTestimonialIndex = index;
                 if (testimonials[currentTestimonialIndex]) testimonials[currentTestimonialIndex].classList.add('active');
                 if (carouselButtons[currentTestimonialIndex]) carouselButtons[currentTestimonialIndex].classList.add('active');
             }

            carouselButtons.forEach((btn, i) => {
                btn.addEventListener('click', () => changeTestimonial(i));
            });

             // Optional: Auto-advance carousel
             let autoAdvanceInterval = setInterval(() => {
                 const nextIndex = (currentTestimonialIndex + 1) % testimonials.length;
                 changeTestimonial(nextIndex);
             }, 7000); // Change every 7 seconds

            // Pause auto-advance on user interaction
             carouselButtons.forEach(btn => btn.addEventListener('click', () => {
                 clearInterval(autoAdvanceInterval);
                 autoAdvanceInterval = setInterval(() => {
                    const nextIndex = (currentTestimonialIndex + 1) % testimonials.length;
                    changeTestimonial(nextIndex);
                }, 7000);
             }));


            // Initialize the first testimonial state
            // testimonials[0].classList.add('active'); // This might be handled by initial HTML or reveal logic
             // Assumes first one might already be visible, but ensure button state matches
            if (testimonials.length > 0) {
                // Find the initially active one, or default to first
                let initialActiveIndex = 0;
                 testimonials.forEach((t, i) => { if(t.classList.contains('active')) initialActiveIndex = i; });
                 // Ensure correct button is active
                 if(carouselButtons[initialActiveIndex]) carouselButtons[initialActiveIndex].classList.add('active');
                 currentTestimonialIndex = initialActiveIndex;
            }


        } else {
            console.warn("Testimonial carousel elements not found or count mismatch, carousel disabled.");
             testimonials.forEach(t => t.classList.add('active')); // Show all testimonials if carousel disabled
             if(document.querySelector('.carousel-controls')) document.querySelector('.carousel-controls').style.display = 'none'; // Hide controls
        }


        // ============================================================
        // THEME TOGGLE (Light/Dark - Del 2do archivo)
        // Replaces the matrix cycle logic from the 1st file.
        // ============================================================
        // Use translations object for button text update
        const translationsForThemeToggle = {
             '#themeToggle': { // Target the button by its ID
                 es: { light: 'DRK', dark: 'LGT' }, // When theme becomes 'light', button text is 'DRK' (option to go dark), vice-versa
                 en: { light: 'DRK', dark: 'LGT' }
             }
        };


        function applyTheme(theme) {
            htmlEl.setAttribute('data-theme', theme);

             // Update theme toggle button text based on the *new* theme and current language
             const currentLangForTheme = localStorage.getItem('portfolioLang') || 'es';
              // Text shown on button suggests the *next* theme. If theme is 'dark', button should say 'LGT' (light).
              // The `translationsForThemeToggle` structure maps NEW theme to BUTTON text.
              // This mapping seems reversed? If current theme is dark, button text should allow switching to light.
              // Let's map CURRENT theme to NEXT theme text on the button.
             const nextThemeTextKey = (theme === 'dark' ? 'light' : 'dark'); // If current is dark, next is light.

             if (themeToggle && translationsForThemeToggle['#themeToggle']?.[currentLangForTheme]?.[nextThemeTextKey]) {
                 themeToggle.textContent = translationsForThemeToggle['#themeToggle'][currentLangForTheme][nextThemeTextKey];
             }

            localStorage.setItem('portfolioTheme', theme);
             console.log(`Theme set to: ${theme}`);
        }

        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                playSound('click');
                const currentTheme = htmlEl.getAttribute('data-theme') || 'dark';
                // Toggle between 'dark' and 'light'
                applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
            });
        }

        // Apply saved theme or default to dark on load
        const savedTheme = localStorage.getItem('portfolioTheme');
        applyTheme(savedTheme || 'dark');


        // ============================================================
        // INTERNACIONALIZACIÓN BÁSICA (i18n - Del 2do archivo)
        // Translate text content based on stored preference or default.
        // ============================================================
        const translations = {
            // Selectors map to objects containing language texts
            '#heroTitle': { es: 'EVIDENCIAS // 2077', en: 'EVIDENCE // 2077' }, // Use the ID from HTML final
            '#heroSubtitle': {
                 es: 'Navega a través de los fragmentos de código y diseño recuperados. La Red es vasta, la información espera. Cuidado con el Black ICE.',
                 en: 'Navigate through recovered code and design fragments. The Network is vast, information awaits. Beware of Black ICE.'
            }, // Use the ID from HTML final
            '#proyectoX h2': { es: '<i class="fas fa-project-diagram"></i> Proyecto X // Classified', en: '<i class="fas fa-project-diagram"></i> Project X // Classified'}, // Selector
            '.btn-hero': {es: 'Explorar Archivos', en: 'Explore Files'}, // Selector for the hero button

             // Filter Menu Links (uses original class and href)
             '.filter-panel .filter-link[href="diseños/Menu.html"]': { es: 'DISEÑO', en: 'DESIGN' },
             '.filter-panel .filter-link[href="presentacion/presentacion.html"]': { es: 'PRESENTACIÓN', en: 'PRESENTATION' },
             '.filter-panel .filter-link[href="#proyectoX"]': { es: 'PROYECTO X', en: 'PROJECT X' }, // Link interno, selector with href
             '.filter-panel .filter-link[href="laboratorio/index.html"]': { es: 'LABORATORIO', en: 'LABORATORY' },


            // Preferences Panel - H4 title only from this set
             '#preferencesPanel h4': {es: '<i class="fas fa-cog"></i> Interface Config', en: '<i class="fas fa-cog"></i> Interface Config'},

            // Preferences checkboxes/labels - Assuming text will stay in HTML, or need to add selectors/logic
            /* '.form-check-label[for="particlesToggle"]': { es: 'Partículas de Datos', en: 'Data Particles'}, // Example if adding */

            // Footer
             '#footerCopy': { es: '© 2077 J.A.E.M. // Data Cache Archived // Secure Connection', en: '© 2077 J.A.E.M. // Data Cache Archived // Secure Connection' }, // Use the ID from HTML final


            // Example Modal Text - Need to select h3, p within specific modals.
            // This is getting complex, focus on main UI elements and key content titles for now.
             // Simplified modal translations based on assumed HTML structure with H3 and P
            /*
            '#modal-cert1 h3': { es: '[IBM] Fundamentos Dev Web', en: '[IBM] Web Dev Foundations' },
             '#modal-cert1 p:nth-of-type(1)': { es: 'Curso introductorio completo a HTML, CSS, & JavaScript por IBM. Fundamentos esenciales para desarrollo web moderno.', en: 'Complete introductory course to HTML, CSS, & JavaScript by IBM. Essential fundamentals for modern web development.'},
             '#modal-cert2 h3': { es: '[IBM] IA Generativa Dev SW', en: '[IBM] Generative AI Dev SW'},
            */
            // Let's assume basic translation of modal content or handle separately

        };

        let currentLang = localStorage.getItem('portfolioLang') || 'es'; // Default to Spanish


        function applyLanguage(lang) {
            currentLang = lang; // Update global variable
            localStorage.setItem('portfolioLang', lang);

            // Update language toggle button text
             if (langToggle) langToggle.textContent = lang === 'es' ? 'EN' : 'ES';

            // Apply translations across selected elements
            for (const selector in translations) {
                let mainSelector = selector;
                let attribute = null;

                // Handle specific attributes like placeholder
                if (selector.includes('::placeholder')) {
                     mainSelector = selector.split('::')[0];
                     attribute = 'placeholder';
                }
                 // Handle data-text for filter links
                 if (selector.includes('[data-text]')) {
                      // Special handling, perhaps not needed if only content changes?
                      // Or modify the translation structure:
                      // 'filter-link-diseño': {es: 'DISEÑO', en: 'DESIGN', selector: '.filter-link[href="diseños/Menu.html"]', dataText: true}
                     // Let's stick to the simple selector: textcontent approach first. The data-text is mostly for effects, keep it.
                     mainSelector = selector.split('[')[0].trim(); // Example if we want to select the base element
                     // For filter links, the text content is what changes. The data-text can remain consistent for the effect.
                 }


                const elements = document.querySelectorAll(mainSelector); // Select elements based on selector
                if (elements.length > 0) {
                    elements.forEach(element => {
                        const translationText = translations[selector]?.[lang];
                        if (translationText !== undefined) {
                            // Apply text translation
                             if (attribute === 'placeholder') {
                                element.placeholder = translationText;
                             } else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                                element.value = translationText; // Use value for inputs
                            }
                            else {
                                // For other elements (headings, paragraphs, links)
                                // Use innerHTML only if the translation contains HTML tags (like the icon in section titles)
                                if (translationText.includes('<') && translationText.includes('>')) {
                                    element.innerHTML = translationText;
                                } else {
                                    element.textContent = translationText; // Safest for plain text
                                }
                            }
                        }
                    });
                }
            }
             // Re-apply theme to update the theme toggle button text based on new language
            applyTheme(htmlEl.getAttribute('data-theme') || 'dark');

            console.log(`Language set to: ${lang}`);
        }

        // Event listener for the language toggle button
        if (langToggle) {
            langToggle.addEventListener('click', () => {
                playSound('click');
                // Toggle between Spanish ('es') and English ('en')
                applyLanguage(currentLang === 'es' ? 'en' : 'es');
            });
        }

        // Apply the initial language or saved language setting when the page loads
        applyLanguage(currentLang);


        // ============================================================
        // BARRAS DE PROGRESO DINÁMICAS (SKILLS) (Del 2do archivo)
        // Anima las barras de progreso cuando son visibles.
        // Needs Skill section HTML with elements like .progress-bar-fill and data-skill-level
        // This part of JS won't do anything if the HTML is not added.
        // Assuming a Skills section with structure from the 2nd file is added.

         const skillFills = document.querySelectorAll('.progress-bar-fill');

         // Only set up observer if skill fills are found
         if (skillFills.length > 0) {
             if (typeof IntersectionObserver !== 'undefined') {
                 const skillsObserver = new IntersectionObserver((entries) => {
                     entries.forEach(entry => {
                         const fillEl = entry.target;
                         const level = fillEl.getAttribute('data-skill-level');
                         if (entry.isIntersecting) {
                              // Set the width to the data-skill-level percentage when it becomes visible
                             // Adding a slight delay makes the animation noticeable as you scroll down
                              setTimeout(() => {
                                  fillEl.style.width = level + '%';
                              }, 150); // Small delay after becoming visible
                              // If you want the animation to happen only ONCE per page load per element:
                              // observer.unobserve(fillEl); // Stop observing after animation starts
                         } else {
                             // Optional: Reset the width to 0% when the element leaves the viewport (animates on reentry)
                              // This can make the animation repeatable as you scroll up and down
                             // fillEl.style.width = '0%';
                         }
                     });
                 }, { threshold: 0.5 }); // Trigger when at least 50% of the element is visible

                 // Function to trigger the animation for skill bars already visible on page load
                 function triggerVisibleSkillBars() {
                      skillFills.forEach(el => {
                         const rect = el.getBoundingClientRect();
                         // Check if element is within the initial viewport
                         const isVisible = (rect.top < window.innerHeight) && (rect.bottom >= 0);

                         if (isVisible) {
                             // Manually trigger the animation
                             const level = el.getAttribute('data-skill-level');
                              setTimeout(() => {
                                  el.style.width = level + '%';
                             }, 150 + (Math.random() * 200)); // Slight randomized delay for effect
                             // If animating only once, might also unobserve here
                             // skillsObserver.unobserve(el); // Uncomment if animating only once
                         }
                         // Always observe the element regardless of initial visibility
                          skillsObserver.observe(el);
                      });
                  }
                  // The actual call to triggerVisibleSkillBars is within the loader logic, after mainContent is visible.

             } else {
                  // Fallback if IntersectionObserver is not supported
                  function triggerVisibleSkillBars() {
                      console.warn("IntersectionObserver not supported, skill bar animations disabled.");
                      skillFills.forEach(el => {
                          const level = el.getAttribute('data-skill-level');
                          el.style.width = level + '%'; // Set width directly
                      });
                  }
                   // In fallback mode, call the function immediately after DOM load
                   triggerVisibleSkillBars(); // This fallback call happens even before the loader might finish, which isn't ideal.
                   // A better fallback would check if the loader exists and run this after a timeout.
                   // However, since IntersectionObserver is widely supported, the main path is preferred.
             }
         } else {
            // Define the function but make it do nothing if no skill fills are found
            console.warn("No elements with class '.progress-bar-fill' found. Skill bar animations disabled.");
             function triggerVisibleSkillBars() { /* Do nothing */ }
         }


        // ============================================================
        // FAQ INTERACTIVO (Del 2do archivo)
        // Toggle answer visibility on question click.
        // Needs FAQ section HTML with structure .faq-item > .faq-question + .faq-answer
        // This part of JS won't do anything if the HTML is not added.
        // Assuming a FAQ section with structure from the 2nd file is added.
        const faqItems = document.querySelectorAll('.faq-item');

        if (faqItems.length > 0) {
             faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                if(question) {
                    question.addEventListener('click', () => {
                        playSound('click', 0.4); // Sound on toggle
                        // Toggle 'open' class on the parent .faq-item
                        item.classList.toggle('open');
                        // Optional: Close other FAQs when one opens
                        /*
                        faqItems.forEach(otherItem => {
                            if (otherItem !== item && otherItem.classList.contains('open')) {
                                otherItem.classList.remove('open');
                            }
                        });
                        */
                    });
                     // Optional: Add hover sound to questions
                    question.addEventListener('mouseenter', () => playSound('hover', 0.2));
                } else {
                     console.warn("FAQ item found without a .faq-question:", item);
                }
            });
        } else {
            console.warn("No elements with class '.faq-item' found. FAQ functionality disabled.");
        }


        // ============================================================
        // LAZY LOADING PARA IMÁGENES (data-src) (Del 2do archivo)
        // Load images only when they are about to enter the viewport.
        // Targets img[data-src]
        // ============================================================
        const lazyImages = document.querySelectorAll('img[data-src], video[data-src] source, video[data-src] poster'); // Also include videos/posters if using data-src

         if (typeof IntersectionObserver !== 'undefined') {
             const lazyObserver = new IntersectionObserver((entries, observer) => {
                 entries.forEach(entry => {
                     if (entry.isIntersecting) {
                         const lazyEl = entry.target;
                         const isVideoSource = lazyEl.tagName === 'SOURCE';
                         const isVideoPoster = lazyEl.tagName === 'VIDEO'; // Or handle specific poster attribute on VIDEO

                         if (isVideoSource) {
                             // For <source> tags, find the parent <video> and load
                              const videoParent = lazyEl.closest('video');
                             if (videoParent) {
                                 // Remove preload="none" or other restrictions if any
                                  videoParent.preload = 'auto'; // Or 'metadata'
                                 videoParent.load(); // Tell video element to load sources
                                  // Note: This will load ALL sources in the video tag once ANY source enters view
                             }
                             lazyEl.removeAttribute('data-src'); // Remove attribute to avoid double-loading
                         } else if (lazyEl.tagName === 'IMG' || isVideoPoster) {
                              // For <img> tags or video posters set via data attribute
                              const srcAttr = isVideoPoster ? 'poster' : 'src';
                             // Attach load/error handlers BEFORE setting the src
                             lazyEl.onload = () => {
                                 lazyEl.classList.add('loaded'); // Add a class for styling/visibility transition
                                 // For images, you can potentially remove the loading attribute after it's done
                                 if (lazyEl.tagName === 'IMG') lazyEl.removeAttribute('loading');
                              };
                              lazyEl.onerror = () => {
                                 console.error("Error loading lazy image/video source:", lazyEl.dataset.src);
                                  lazyEl.classList.add('error'); // Add an error class for visual feedback
                              };

                              // Set the actual source or poster from data-src attribute
                             lazyEl[srcAttr] = lazyEl.dataset[srcAttr] || lazyEl.dataset.src; // Use dataset[srcAttr] first, fallback to dataset.src
                             if (lazyEl.dataset[srcAttr]) lazyEl.removeAttribute(`data-${srcAttr}`);
                             else lazyEl.removeAttribute('data-src'); // Remove attribute after transferring


                             // For <video> poster, ensure video itself might load later
                              if (isVideoPoster) {
                                 // The poster is set, the video itself might still have preload='none' or need load() called separately
                                  // Or relies on the IntersectionObserver firing for a source element as above.
                              }


                         } else {
                            console.warn("Lazy load triggered on element without data-src or unexpected type:", lazyEl);
                            // Ensure element becomes visible even if not handled as image/video?
                             if (lazyEl.style.opacity === '0') lazyEl.style.opacity = 1;
                         }


                         // Stop observing the element once it's loaded (or loading has been initiated for video parent)
                         observer.unobserve(lazyEl); // Assuming load/animation happens quickly once visible
                     }
                 });
             }, { rootMargin: "0px 0px 200px 0px" }); // Start loading when element is 200px away from viewport bottom


             lazyImages.forEach(el => lazyObserver.observe(el)); // Start observing all potential lazy elements

         } else {
              // Fallback: If IntersectionObserver not supported, load all images immediately
              console.warn("IntersectionObserver not supported, lazy loading disabled.");
              lazyImages.forEach(el => {
                  const isVideoSource = el.tagName === 'SOURCE';
                  const isVideoPoster = el.tagName === 'VIDEO';

                  if (isVideoSource) {
                     const videoParent = el.closest('video');
                      if (videoParent) {
                          videoParent.preload = 'auto'; // Or 'metadata'
                          videoParent.load();
                          el.removeAttribute('data-src');
                      }
                  } else if (el.tagName === 'IMG' || isVideoPoster) {
                       const srcAttr = isVideoPoster ? 'poster' : 'src';
                       el[srcAttr] = el.dataset[srcAttr] || el.dataset.src;
                       if (el.dataset[srcAttr]) el.removeAttribute(`data-${srcAttr}`);
                       else el.removeAttribute('data-src');
                      el.classList.add('loaded');
                       if (el.tagName === 'IMG') el.removeAttribute('loading');
                  } else {
                      // Ensure element becomes visible even if lazy loading isn't handled
                       if (el.style.opacity === '0') el.style.opacity = 1;
                       if (el.hasAttribute('data-src')) el.removeAttribute('data-src'); // Clean up
                  }

              });
         }


        // ============================================================
        // FILTRO/BÚSQUEDA INTERNA PROYECTOS (Del 2do archivo)
        // Filters project items based on input text.
        // Needs Project section HTML with input#searchProjectInput, button#searchProjectBtn, and .project-item elements containing h3, p, .tech-tags span.
        // This part of JS won't do anything if the HTML is not matching.
        // Assumes a Project section from the 2nd file is used or the existing one is updated.
        const searchProjectInput = document.getElementById('searchProjectInput');
        const searchProjectBtn = document.getElementById('searchProjectBtn');
        const projectGrid = document.getElementById('projectGrid');
        const allProjectItems = projectGrid ? Array.from(projectGrid.querySelectorAll('.project-item')) : []; // Get all items on load

        // Only enable search if necessary elements are found
        if (searchProjectInput && searchProjectBtn && projectGrid && allProjectItems.length > 0) {

             function filterProjects() {
                 const term = searchProjectInput.value.toLowerCase().trim();

                 allProjectItems.forEach(item => {
                     // Get text content from relevant parts of the project item
                     const title = item.querySelector('h3')?.textContent.toLowerCase() || '';
                     const description = item.querySelector('p')?.textContent.toLowerCase() || '';
                     // Get text from tech tags if they exist
                     const tags = Array.from(item.querySelectorAll('.tech-tags span')).map(span => span.textContent.toLowerCase()).join(' ');

                     const itemText = `${title} ${description} ${tags}`; // Combine all searchable text

                     // Show or hide item based on whether the combined text includes the search term
                     const isMatch = itemText.includes(term);

                      // Apply display style
                     item.style.display = isMatch ? '' : 'none';

                     // Optional: Re-trigger reveal animation or check visibility if desired after filtering
                     // This can be complex, simply showing/hiding is fine for now.
                     if (isMatch && typeof IntersectionObserver !== 'undefined') {
                         // If animating each time they appear, may need to re-observe/add .reveal.visible if hidden then shown
                         // Or ensure reveal observer isn't unobserving if you want re-entry animation
                     }
                 });
             }

            // Event listeners for button click and input keyup (enter key)
            searchProjectBtn.addEventListener('click', () => { playSound('click'); filterProjects(); });

             searchProjectInput.addEventListener('keyup', (e) => {
                 if (e.key === 'Enter') { // Trigger filter on Enter key
                     filterProjects();
                     playSound('click'); // Sound on pressing enter
                 }
                 // Optional: Filter instantly as user types if the input field is empty
                  if (searchProjectInput.value.trim() === '') {
                      filterProjects(); // Reset filter when clearing input
                  }
             });

            // Optional: Reset filter if the input is cleared using backspace/delete
             searchProjectInput.addEventListener('input', () => {
                 if (searchProjectInput.value.trim() === '') {
                     filterProjects(); // Show all items when input is empty
                 }
             });

             // Initial filter on load to ensure everything is visible (if input is initially empty)
             filterProjects();

        } else {
             console.warn("Project search elements (input, button, or items) not found. Project search disabled.");
             // Hide the search container if elements are missing
              const searchContainer = document.querySelector('.internal-search');
             if (searchContainer) searchContainer.style.display = 'none';
        }


        // ============================================================
        // DESCARGAS (Del 2do archivo)
        // Trigger file download on button click.
        // Targets elements with class 'download-trigger' and data-file attribute.
        // Needs relevant HTML buttons/links with these attributes.
        // ============================================================
        const downloadButtons = document.querySelectorAll('.download-trigger');

        if (downloadButtons.length > 0) {
            downloadButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    playSound('click'); // Sound on download click
                    const fileUrl = btn.getAttribute('data-file'); // Use data-file attribute
                    if (fileUrl) {
                        // Create a temporary anchor element
                        const link = document.createElement('a');
                        link.href = fileUrl;
                        // Suggest a filename (take the last part of the URL)
                         link.download = fileUrl.split('/').pop() || 'download';
                         // Add target="_blank" maybe? Or just trigger download.
                         link.target = '_blank'; // Open in new tab is safer often, browser may download directly

                        // Programmatically click the link
                        document.body.appendChild(link); // Needed for Firefox
                        link.click();
                        document.body.removeChild(link);

                         console.log(`Initiated download for: ${fileUrl}`);

                    } else {
                        console.error("Download button clicked but no 'data-file' attribute found:", btn);
                         showNotification('Download failed: File path missing.', 'error'); // Notify user
                    }
                });
                 // Optional: Add hover sound
                btn.addEventListener('mouseenter', () => playSound('hover', 0.3));
            });
        } else {
            console.log("No elements with class '.download-trigger' found. Download functionality inactive.");
        }


        // ============================================================
        // MODALES DE CERTIFICADOS (Del 2do archivo)
        // Logic to open and close modals.
        // Needs modal HTML structure and buttons with classes/attributes to trigger them.
        // Assumes modal HTML structures from the 2nd file are present with IDs modal-cert1, etc.
        const modalTriggers = document.querySelectorAll('.modal-trigger'); // Buttons/elements to open modals
        const modals = document.querySelectorAll('.modal'); // The modal containers
        const closeModals = document.querySelectorAll('.close-modal'); // Close buttons within modals


        // Only set up modal logic if any triggers or modals are found
        if (modalTriggers.length > 0 || modals.length > 0) {

            // Function to open a modal by its ID
            function openModal(modalId) {
                 // Close any currently open modals first (optional but good practice)
                 const openModal = document.querySelector('.modal.open');
                 if (openModal) closeModal(openModal, false); // Close without sound to avoid conflict

                 const modal = document.getElementById(modalId);
                 if (modal) {
                    modal.classList.add('open'); // Trigger CSS transition to display: flex and fade in
                    // Optional: Disable body scroll when modal is open
                    bodyEl.style.overflow = 'hidden';
                    console.log(`Opened modal: #${modalId}`);
                     playSound('click', 0.5); // Sound on opening modal
                 } else {
                    console.error("Attempted to open modal but modal not found with ID:", modalId);
                     showNotification(`Error: Modal "${modalId}" not found.`, 'error'); // Notify user
                 }
            }

            // Function to close a specific modal element
            function closeModal(modal, withSound = true) {
                 if (modal && modal.classList.contains('open')) {
                     modal.classList.remove('open'); // Trigger CSS transition to hide

                     // Re-enable body scroll after a slight delay to allow closing animation
                     setTimeout(() => {
                          const anyModalStillOpen = document.querySelector('.modal.open');
                         if (!anyModalStillOpen) { // Only re-enable if NO modals are open
                             bodyEl.style.overflow = '';
                         }
                     }, 300); // Match transition duration if needed

                      console.log(`Closed modal: #${modal.id}`);
                      if (withSound) playSound('click', 0.4); // Sound on closing modal
                 }
            }

            // Event listeners for modal triggers (buttons, links, etc.)
            modalTriggers.forEach(button => {
                button.addEventListener('click', () => {
                    const modalId = button.dataset.modalId; // Get target modal ID from data-modal-id attribute
                    if (modalId) {
                       openModal(modalId);
                    } else {
                       console.warn("Modal trigger clicked without data-modal-id:", button);
                       showNotification('Error: Target modal not specified.', 'error');
                    }
                });
                 // Optional: Add hover sound to modal triggers
                button.addEventListener('mouseenter', () => playSound('hover', 0.3));
            });

            // Event listeners for modal close buttons (inside modals)
            closeModals.forEach(button => {
                button.addEventListener('click', () => {
                    // Find the closest parent modal element
                    const modal = button.closest('.modal');
                    closeModal(modal);
                });
            });

            // Event listeners to close modal by clicking outside the modal-content
            modals.forEach(modal => {
                modal.addEventListener('click', (e) => {
                    // Check if the click target is the modal container itself, not the content inside
                     if (e.target === modal) {
                        closeModal(modal);
                    }
                });
            });

            // Event listener to close the top-most open modal on Escape key press
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    // Find the last opened (top-most) modal that is currently open
                    const openModals = document.querySelectorAll('.modal.open');
                    if (openModals.length > 0) {
                         // Close the last one in the list (simplistic approach for top-most)
                         // A more robust solution might manage a stack of open modals
                        closeModal(openModals[openModals.length - 1]);
                    }
                }
            });

             console.log(`Modal logic initialized. Found ${modals.length} modals.`);

        } else {
            console.log("No modal triggers or modal elements found. Modal functionality inactive.");
        }


        // ============================================================
        // ACTUALIZACIONES DEL HUD (Reloj y Scroll - Del 2do archivo)
        // Live clock and scroll percentage display on the HUD.
        // Needs hudClock and hudScrollIndicator elements with IDs.
        // ============================================================
        function updateClock() {
            if (!hudClock) return; // Ensure element exists
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
             const currentTimeString = `${hours}:${minutes}:${seconds}`;

             // Check if text content actually changed before updating the DOM
            if (hudClock.textContent !== currentTimeString) {
                hudClock.textContent = currentTimeString;
            }
        }

        function startClock() {
            if (hudClock) {
                 console.log("HUD Clock initialized.");
                updateClock(); // Set initial time immediately
                setInterval(updateClock, 1000); // Update every second
            } else {
                console.warn("HUD Clock element (#hudClock) not found.");
            }
        }

        function updateScrollIndicator() {
            if (!hudScrollIndicator) return; // Ensure element exists

            // Get the total height of the body content that can be scrolled
            // body.scrollHeight is total height
            // window.innerHeight is visible height
            const bodyHeight = document.body.scrollHeight;
            const windowHeight = window.innerHeight;

             // Calculate the maximum scrollable distance
            const scrollableHeight = bodyHeight - windowHeight;

            // If the document is not scrollable (body height <= window height)
             if (scrollableHeight <= 0) {
                 // Check if text is not already 100% to avoid unnecessary updates
                  const currentValue = hudScrollIndicator.querySelector('span:last-child')?.textContent || '';
                 if (currentValue !== '100%') {
                    if(hudScrollIndicator.querySelector('span:last-child')) {
                        hudScrollIndicator.querySelector('span:last-child').textContent = '100%';
                    } else {
                         console.warn("HUD Scroll Indicator span not found.");
                    }
                 }
                 return; // Exit if not scrollable
             }

            // Get the current vertical scroll position
            const currentScrollY = window.scrollY;

            // Calculate the scroll percentage
            // Ensure it's between 0% and 100%
            const scrollPercent = Math.min(100, Math.max(0, (currentScrollY / scrollableHeight) * 100));
             const scrollPercentString = `${scrollPercent.toFixed(0)}%`; // Format to 0 decimal places

            // Update the text content only if it has changed
            if (hudScrollIndicator.querySelector('span:last-child') && hudScrollIndicator.querySelector('span:last-child').textContent !== scrollPercentString) {
                 hudScrollIndicator.querySelector('span:last-child').textContent = scrollPercentString;
             }
        }

        // Event listener for scroll events to update the indicator
        let scrollTimeout; // To throttle the scroll update calls
        window.addEventListener('scroll', () => {
            // Use requestAnimationFrame for performance optimization during scroll
            if (scrollTimeout) {
                 window.cancelAnimationFrame(scrollTimeout);
             }
             scrollTimeout = window.requestAnimationFrame(updateScrollIndicator);
        }, { passive: true }); // Use passive event listener for better scroll performance

        // Call updateScrollIndicator initially to set the correct value on page load
        // Delay slightly if loader is present, or call directly otherwise.
        // This call is now handled as part of the loader completion sequence.


        // Optional: Implement Preferences Panel Toggle Logic
        const preferencesPanel = document.getElementById('preferencesPanel');
        const preferencesToggleBtn = document.getElementById('preferencesToggleBtn');
        if (preferencesPanel && preferencesToggleBtn) {
            preferencesToggleBtn.addEventListener('click', () => {
                preferencesPanel.classList.toggle('closed');
                 // You might want a sound or visual feedback here too
                 playSound('click', 0.5);
            });
             console.log("Preferences panel toggle initialized.");

             // Optional: Load/save preferences from local storage (JS for checkboxes not included here)
        } else {
             console.log("Preferences panel elements not found. Panel functionality inactive.");
        }

        // Optional: Implement Music Visualizer JS (requires audio analysis library or browser API)
        // Not included in the provided scripts, requires significant additional code.
        // The CSS provides a basic placeholder animation.

        // Optional: Easter Egg JS (if it triggers appearance or sound)
        // The HTML is present, but JS to trigger it is missing. Add event listeners here if needed.
        // For example, listen for a key combination.

        // Ensure updateScrollIndicator is called after loader/content visibility change
        // Moved inside loader completion and called immediately after content becomes visible


         // Final check and logging
        console.log("DOMContentLoaded finished.");
        // Note: Initial calls to triggerVisibleReveals, startClock, updateScrollIndicator, etc.,
        // should happen *after* the loader sequence finishes and content is made visible,
        // as orchestrated in the loader simulation logic.
        // If no loader, the else block in the loader logic handles these initial calls.


    }); // End of DOMContentLoaded

  </script>

</body>
</html>