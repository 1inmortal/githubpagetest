#!/bin/bash

# Variables con detalles del commit
COMMIT_HASH=$(git log -1 --pretty=format:"%H")
COMMIT_AUTHOR=$(git log -1 --pretty=format:"%an")
COMMIT_DATE=$(git log -1 --pretty=format:"%ad")
COMMIT_MESSAGE=$(git log -1 --pretty=format:"%s")
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)

# URL de la imagen desde GitHub
IMAGE_URL="https://raw.githubusercontent.com/1inmortal/1inmortal/main/IMG/F86AD18C-9FFB-401E-8409-1888D0A3C32F.jpeg"

# Generar contenido HTML del correo
EMAIL_HTML="<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>NotificaciÃ³n de Commit</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; background-color: #f9f9f9; }
        h1 { color: #333; text-align: center; }
        .commit-details { margin-top: 20px; }
        .commit-details p { margin: 5px 0; }
        img { display: block; margin: 20px auto; max-width: 100%; border-radius: 10px; }
        footer { text-align: center; margin-top: 20px; color: #777; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class='container'>
        <h1>ðŸš€ Nuevo Commit Realizado</h1>
        <div class='commit-details'>
            <p><strong>Hash del Commit:</strong> $COMMIT_HASH</p>
            <p><strong>Autor:</strong> $COMMIT_AUTHOR</p>
            <p><strong>Fecha:</strong> $COMMIT_DATE</p>
            <p><strong>Rama:</strong> $BRANCH_NAME</p>
            <p><strong>Mensaje:</strong> $COMMIT_MESSAGE</p>
        </div>
        <img src='$IMAGE_URL' alt='Imagen Representativa'>
        <footer>
            Este correo fue generado automÃ¡ticamente por Git Hooks.
        </footer>
    </div>
</body>
</html>"

# Enviar el correo con `sendmail` o `msmtp`
(
echo "From: tu-correo@dominio.com"
echo "To: destinatario@dominio.com"
echo "Subject: NotificaciÃ³n de Nuevo Commit en $BRANCH_NAME"
echo "MIME-Version: 1.0"
echo "Content-Type: text/html; charset=UTF-8"
echo ""
echo "$EMAIL_HTML"
) | sendmail -t
