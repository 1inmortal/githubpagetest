<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Portfolio HUD — Tech Pipeline v2</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>

<style>
  :root {
    --bg: #040508;
    --ink: rgba(240, 245, 255, 0.9);
    --ink-sub: rgba(240, 245, 255, 0.65);
    --ink-header: #ffffff;
    --edge: rgba(220, 225, 235, 0.25);
    --edge-light: rgba(220, 225, 235, 0.5);
    --accent: #89f5ff;
    --accent-glow: rgba(137, 245, 255, 0.25);
    --status-online: #33ff99;
    --status-active: #89f5ff;
    --status-standby: #607090;
  }

  * { box-sizing: border-box; user-select: none; outline-offset: 4px; }
  *:focus-visible { outline: 2px solid var(--accent); }

  html, body {
    height: 100%; margin: 0;
    background: var(--bg); color: var(--ink);
    font-family: 'Inter', system-ui, sans-serif;
    overflow: hidden; cursor: default;
  }

  /* --- Escena y Tarjetas --- */
  .environment-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
  .floor-grid {
    position: absolute; width: 200%; height: 200%; left: -50%; top: -50%;
    transform: rotateX(90deg) translateZ(-280px);
    background-image:
      linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 60px 60px;
    animation: flow 25s linear infinite;
  }
  @keyframes flow { from { background-position: 0 0; } to { background-position: -600px 0; } }

  .viewport { position: fixed; inset: 0; display: grid; place-items: center; perspective: 1500px; perspective-origin: 50% 45%; z-index: 1; }
  .scene { position: relative; width: min(1400px, 95vw); height: min(700px, 80vh); transform-style: preserve-3d; transform: rotateX(25deg) rotateY(-20deg); will-change: transform; }
  .pipeline { position: absolute; inset: 0; transform-style: preserve-3d; will-change: transform; }

  .card {
    position: absolute; width: 280px; height: 400px;
    background: rgba(15, 18, 25, 0.3); backdrop-filter: blur(12px);
    border-radius: 12px; border: 1px solid var(--edge);
    transform-style: preserve-3d; transition: transform 0.4s ease-out, opacity 0.4s ease, filter 0.4s ease;
    cursor: pointer; overflow: hidden; will-change: transform, opacity, filter;
  }
  .card-fader { opacity: 0; }

  .scene:not(.is-card-hovered) .card:not(.is-active),
  .scene.is-card-hovered .card:not(:hover):not(.is-active) { opacity: 0.15; filter: blur(2px) saturate(0.5); }
  .scene.is-panel-open .card:not(.is-active) { opacity: 0.08; filter: blur(4px) saturate(0); }
  
  .card:hover { transform: translateY(-15px) translateZ(30px) scale(1.05); z-index: 100; }
  .card.is-active { z-index: 50; }

  /* --- MEJORA #1: INDICADORES DE PROGRESO VISUAL --- */
  .card.is-active::before {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 14px;
    background: linear-gradient(45deg, var(--accent), transparent, var(--accent));
    background-size: 200% 200%;
    animation: pulse-glow 2s ease-in-out infinite;
    z-index: -1;
  }
  
  @keyframes pulse-glow {
    0%, 100% { background-position: 0% 50%; opacity: 0.3; }
    50% { background-position: 100% 50%; opacity: 0.6; }
  }

  .card.is-active .status-ACTIVE {
    animation: status-pulse 1.5s ease-in-out infinite;
  }

  @keyframes status-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* --- NUEVAS MEJORAS: MINI-CHIPS Y SPARKLINES --- */
  .mini-metrics {
    position: absolute;
    top: 8px;
    left: 8px;
    display: flex;
    gap: 6px;
    align-items: center;
    z-index: 3;
  }

  .chip {
    background: rgba(137, 245, 255, 0.1);
    border: 1px solid var(--accent);
    color: var(--accent);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    font-family: 'Roboto Mono', monospace;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .chip:hover {
    background: var(--accent);
    color: var(--bg);
    transform: translateY(-1px);
  }

  .spark {
    width: 60px;
    height: 16px;
    opacity: 0.7;
  }

  .spark path {
    fill: none;
    stroke: var(--accent);
    stroke-width: 1.5;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  /* --- ÓRBITAS DE ENERGÍA --- */
  .tech-icon-container {
    position: relative;
    display: grid;
    place-items: center;
  }

  .energy-orbit {
    position: absolute;
    inset: -20px;
    border-radius: 50%;
    border: 1px dashed var(--accent);
    opacity: 0.25;
    animation: orbit 6s linear infinite;
  }

  .energy-orbit::after {
    content: "";
    position: absolute;
    inset: -10px;
    border-radius: 50%;
    border: 1px solid var(--accent);
    opacity: 0.15;
    animation: orbit 10s linear infinite reverse;
  }

  .energy-orbit::before {
    content: "";
    position: absolute;
    inset: -5px;
    border-radius: 50%;
    border: 1px dotted var(--accent);
    opacity: 0.1;
    animation: orbit 8s linear infinite;
  }

  @keyframes orbit {
    to { transform: rotate(360deg); }
  }

  /* --- BLOOM ESPECTRAL --- */
  .tech-icon-container img {
    width: 90px;
    height: 90px;
    opacity: 0.3;
    object-fit: contain;
    filter: drop-shadow(0 0 15px var(--accent-glow));
    position: relative;
    z-index: 2;
  }

  .tech-icon-container::after {
    content: "";
    position: absolute;
    inset: 0;
    width: 90px;
    height: 90px;
    background: var(--accent-glow);
    filter: blur(10px);
    mix-blend-mode: screen;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1;
  }

  .card:hover .tech-icon-container::after {
    opacity: 0.6;
  }

  /* --- CORONA DE STACK --- */
  .stack-corona {
    position: absolute;
    inset: -30px;
    border-radius: 50%;
    opacity: 0.3;
    animation: corona-rotate 12s linear infinite;
  }

  .stack-icon {
    position: absolute;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--accent);
    opacity: 0.6;
    animation: corona-pulse 3s ease-in-out infinite;
  }

  @keyframes corona-rotate {
    to { transform: rotate(360deg); }
  }

  @keyframes corona-pulse {
    0%, 100% { opacity: 0.3; transform: scale(0.8); }
    50% { opacity: 0.8; transform: scale(1.2); }
  }

  /* --- MINI-BARRAS DE PROGRESO --- */
  .mini-progress {
    position: absolute;
    bottom: 8px;
    left: 8px;
    right: 8px;
    display: flex;
    gap: 4px;
    z-index: 3;
  }

  .mini-bar {
    flex: 1;
    height: 4px;
    background: var(--edge);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
  }

  .mini-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--status-online));
    border-radius: 2px;
    transition: width 0.3s ease;
  }

  /* --- TILT MAGNÉTICO Y HOLO-SCAN --- */
  .card {
    transform-style: preserve-3d;
    transition: transform 0.4s ease-out, opacity 0.4s ease, filter 0.4s ease;
  }

  .card:hover {
    transform: translateY(-15px) translateZ(30px) scale(1.05) rotateX(var(--tilt-x, 0deg)) rotateY(var(--tilt-y, 0deg));
    z-index: 100;
  }

  .holo-scan {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, var(--accent-glow), transparent);
    opacity: 0;
    z-index: 1;
    pointer-events: none;
  }

  .card:hover .holo-scan {
    animation: holo-scan 0.8s ease-out;
  }

  @keyframes holo-scan {
    0% { left: -100%; opacity: 0; }
    50% { opacity: 0.6; }
    100% { left: 100%; opacity: 0; }
  }

  /* --- TEMAS POR TECNOLOGÍA --- */
  .card[data-id="react"] {
    --accent: #61dafb;
    --accent-glow: rgba(97, 218, 251, 0.25);
  }

  .card[data-id="javascript"] {
    --accent: #f7df1e;
    --accent-glow: rgba(247, 223, 30, 0.2);
  }

  .card[data-id="python"] {
    --accent: #3572A5;
    --accent-glow: rgba(53, 114, 165, 0.25);
  }

  .card[data-id="nodejs"] {
    --accent: #339933;
    --accent-glow: rgba(51, 153, 51, 0.25);
  }

  .card[data-id="html5"] {
    --accent: #e34f26;
    --accent-glow: rgba(227, 79, 38, 0.25);
  }

  .card[data-id="css3"] {
    --accent: #1572b6;
    --accent-glow: rgba(21, 114, 182, 0.25);
  }

  .card[data-id="mongodb"] {
    --accent: #47a248;
    --accent-glow: rgba(71, 162, 72, 0.25);
  }

  .card[data-id="git"] {
    --accent: #f05032;
    --accent-glow: rgba(240, 80, 50, 0.25);
  }

  .card[data-id="docker"] {
    --accent: #2496ed;
    --accent-glow: rgba(36, 150, 237, 0.25);
  }

  .card[data-id="aws"] {
    --accent: #ff9900;
    --accent-glow: rgba(255, 153, 0, 0.25);
  }

  .card[data-id="threejs"] {
    --accent: #000000;
    --accent-glow: rgba(0, 0, 0, 0.25);
  }

  .card[data-id="gsap"] {
    --accent: #88ce02;
    --accent-glow: rgba(136, 206, 2, 0.25);
  }

  /* --- PULSO SINCRONIZADO CON STATUS --- */
  .card[data-status="ONLINE"] .particle {
    animation-duration: 2s;
    animation-iteration-count: infinite;
  }

  .card[data-status="ACTIVE"] .particle {
    animation-duration: 1.2s;
    animation-iteration-count: infinite;
  }

  .card[data-status="STANDBY"] .particle {
    animation-duration: 4s;
    animation-iteration-count: infinite;
  }

  .card[data-status="ONLINE"] .energy-orbit {
    animation-duration: 4s;
  }

  .card[data-status="ACTIVE"] .energy-orbit {
    animation-duration: 2s;
  }

  .card[data-status="STANDBY"] .energy-orbit {
    animation-duration: 8s;
  }

  /* --- TOUCH TARGETS MÓVILES --- */
  .touch-splash {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
    pointer-events: none;
    z-index: 10;
    animation: touch-splash 0.6s ease-out;
  }

  @keyframes touch-splash {
    0% {
      transform: scale(0);
      opacity: 1;
    }
    100% {
      transform: scale(3);
      opacity: 0;
    }
  }

  /* --- ARCOS ELÉCTRICOS AL HOVER --- */
  .electric-arc {
    position: absolute;
    width: 2px;
    height: 2px;
    background: var(--accent);
    border-radius: 50%;
    pointer-events: none;
    z-index: 5;
  }

  .card:hover .electric-arc {
    animation: electric-arc-motion 1.2s ease-out;
  }

  @keyframes electric-arc-motion {
    0% {
      opacity: 0;
      transform: translate(0, 0) scale(0);
    }
    20% {
      opacity: 1;
      transform: translate(20px, -20px) scale(1);
    }
    80% {
      opacity: 0.8;
      transform: translate(40px, -40px) scale(0.8);
    }
    100% {
      opacity: 0;
      transform: translate(60px, -60px) scale(0);
    }
  }

  /* Barra de progreso circular */
  .progress-ring {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 40px;
    height: 40px;
    transform: rotate(-90deg);
  }

  .progress-ring-bg {
    fill: none;
    stroke: var(--edge);
    stroke-width: 3;
  }

  .progress-ring-fg {
    fill: none;
    stroke: var(--accent);
    stroke-width: 3;
    stroke-linecap: round;
    stroke-dasharray: 100;
    stroke-dashoffset: 100;
    transition: stroke-dashoffset 0.8s ease;
  }

  .card::before, .card::after {
    content: ""; position: absolute; inset: 0;
    border-radius: inherit; pointer-events: none;
    opacity: 0; transition: opacity 0.4s ease;
  }
  .card::before { box-shadow: inset 0 0 0 1.5px transparent; }
  .card::after {
    background: conic-gradient(from var(--angle), #E5E9F2, #B8C6E0, #8A9CB8, #B8C6E0, #E5E9F2);
    mix-blend-mode: overlay; filter: url(#holo-displacement) brightness(1.3) contrast(1.1);
  }
  .card:hover::before { box-shadow: inset 0 0 0 1.5px var(--accent); opacity: 1; transition-delay: 0.1s; }
  .card:hover::after { opacity: 0.6; }
  
  .card-content { position: relative; padding: 16px; height: 100%; display: flex; flex-direction: column; }
  .card-header { display: flex; justify-content: space-between; font-family: 'Roboto Mono', monospace; z-index: 2;}
  .card-id { font-size: 16px; font-weight: 500; color: var(--ink-header); }
  .card-type { font-size: 14px; color: var(--ink-sub); }
  
  .card-visuals { position: relative; flex-grow: 1; margin: 16px 0; display: grid; place-items: center; }
  
  .tech-icon-container img {
    width: 90px; height: 90px;
    opacity: 0.3; object-fit: contain;
    filter: drop-shadow(0 0 15px var(--accent-glow));
  }
  .card-footer { font-family: 'Roboto Mono', monospace; font-size: 11px; text-transform: uppercase; z-index: 2; }
  .card-footer-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .card-footer-row:last-child { border-bottom: none; }
  .status-value { font-weight: 700 !important; }
  .status-ONLINE { color: var(--status-online); } .status-ACTIVE { color: var(--status-active); } .status-STANDBY { color: var(--status-standby); }

  /* --- UI Controls --- */
  .ui { position: fixed; right: 2vw; top: 3vh; z-index: 10; display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 10px; }
  .btn {
    appearance: none; border: 1px solid var(--edge); border-radius: 6px; padding: 10px 18px;
    font-size: 12px; font-family: 'Roboto Mono', monospace; letter-spacing: .15em; text-transform: uppercase; color: var(--ink-sub);
    background: rgba(15, 18, 25, 0.3); backdrop-filter: blur(5px);
    cursor: pointer; transition: all .2s ease;
  }
  .btn:hover:not(:disabled) { color: var(--accent); border-color: var(--accent); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* --- MEJORA: ESTRUCTURA DEL MODAL PROFESIONAL --- */
  .holopanel { position: fixed; inset: 0; z-index: 200; display: grid; place-items: center; pointer-events: none; opacity: 0; }
  .holopanel.is-open { pointer-events: auto; opacity: 1; }
  .holopanel-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
  .holopanel-container {
    position: relative; width: min(1100px, 95vw); height: min(720px, 90vh);
    background: rgba(10, 12, 22, 0.6); border: 1px solid var(--edge-light); border-radius: 12px;
    backdrop-filter: blur(24px); display: flex; flex-direction: column; overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3); will-change: transform, opacity;
  }
  .holopanel-header { padding: 16px 24px; border-bottom: 1px solid var(--edge); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
  .holopanel-header h2 { margin: 0; font-size: 20px; font-weight: 500; font-family: 'Roboto Mono', monospace; color: var(--ink-header); }
  .holopanel-tabs { display: flex; gap: 8px; }
  .holopanel-tab { padding: 8px 16px; border-radius: 6px; font-size: 13px; font-family: 'Roboto Mono', monospace; color: var(--ink-sub); background: transparent; cursor: pointer; transition: all 0.2s ease; border: 1px solid transparent; }
  .holopanel-tab.is-active { color: var(--accent); border-color: var(--accent); background: var(--accent-glow); }
  
  .holopanel-body { flex-grow: 1; position: relative; }
  .holopanel-page { position: absolute; inset: 0; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
  .holopanel-page.is-active { opacity: 1; visibility: visible; }
  
  /* Layout de dos columnas en el modal */
  .modal-layout { display: flex; height: 100%; }
  .modal-sidebar {
    width: 300px; flex-shrink: 0;
    padding: 24px; border-right: 1px solid var(--edge);
    display: flex; flex-direction: column; align-items: center; text-align: center;
  }
  .modal-logo { width: 120px; height: 120px; object-fit: contain; margin-bottom: 24px; }
  .mastery-ring-container { position: relative; width: 160px; height: 160px; margin-bottom: 24px; }
  .mastery-ring-svg { position: absolute; inset: 0; transform: rotate(-90deg); }
  .mastery-ring-bg, .mastery-ring-fg { fill: none; stroke-width: 10; }
  .mastery-ring-bg { stroke: var(--edge); }
  .mastery-ring-fg { stroke: var(--accent); stroke-linecap: round; filter: drop-shadow(0 0 5px var(--accent-glow)); }
  .mastery-percentage { position: absolute; inset: 0; display: grid; place-items: center; font-size: 36px; font-weight: 700; font-family: 'Roboto Mono', monospace; color: var(--ink-header); }
  .sidebar-stat { font-family: 'Roboto Mono', monospace; }
  .sidebar-stat dt { text-transform: uppercase; font-size: 12px; color: var(--ink-sub); margin-bottom: 4px; }
  .sidebar-stat dd { font-size: 18px; font-weight: 500; margin: 0; }
  
  .modal-main-content { flex-grow: 1; padding: 24px; overflow-y: auto; }
  .modal-section { margin-bottom: 32px; }
  .modal-section h3 { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--ink-sub); margin: 0 0 16px; border-bottom: 1px solid var(--edge); padding-bottom: 8px; }
  .description-text { font-size: 16px; line-height: 1.7; color: var(--ink); }
  .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; }
  .metric-item dt { font-size: 12px; text-transform: uppercase; color: var(--ink-sub); margin-bottom: 8px; }
  .metric-item dd { font-size: 28px; font-weight: 500; font-family: 'Roboto Mono', monospace; color: var(--status-online); }

  .log-container { height: 100%; font-family: 'Roboto Mono', monospace; font-size: 13px; padding: 24px; overflow-y: auto; scroll-behavior: smooth; }
  .log-entry { margin-bottom: 8px; opacity: 0; animation: fadeIn 0.3s forwards; }
  @keyframes fadeIn { to { opacity: 1; } }

  .holopanel-close { position: absolute; top: 12px; right: 18px; z-index: 5; background: none; border: none; font-size: 28px; color: var(--ink-sub); cursor: pointer; transition: color 0.2s, transform 0.2s; }
  .holopanel-close:hover { color: var(--ink); transform: scale(1.1); }

  /* --- MEJORA #3: ANIMACIONES DE PARTÍCULAS --- */
  .particles-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
  }

  .particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: var(--accent);
    border-radius: 50%;
    opacity: 0;
    pointer-events: none;
  }

  .card.is-active .particle {
    animation: particle-float 3s ease-out infinite;
  }

  @keyframes particle-float {
    0% {
      opacity: 0;
      transform: translateY(0) scale(0);
    }
    20% {
      opacity: 1;
      transform: translateY(-20px) scale(1);
    }
    80% {
      opacity: 0.8;
      transform: translateY(-60px) scale(0.8);
    }
    100% {
      opacity: 0;
      transform: translateY(-100px) scale(0);
    }
  }

  /* Trazas de movimiento */
  .card-trail {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    background: linear-gradient(45deg, transparent, var(--accent-glow), transparent);
    opacity: 0;
    pointer-events: none;
    z-index: -1;
  }

  .card.is-active .card-trail {
    animation: trail-glow 2s ease-in-out infinite;
  }

  @keyframes trail-glow {
    0%, 100% { opacity: 0; transform: scale(1); }
    50% { opacity: 0.3; transform: scale(1.05); }
  }

  /* Efecto glitch para tecnologías en desarrollo */
  .card[data-status="STANDBY"]::after {
    animation: glitch-effect 4s ease-in-out infinite;
  }

  @keyframes glitch-effect {
    0%, 90%, 100% { transform: translate(0); }
    91% { transform: translate(-2px, 2px); }
    92% { transform: translate(2px, -2px); }
    93% { transform: translate(-1px, 1px); }
    94% { transform: translate(1px, -1px); }
  }

  /* --- MEJORA #4: PANEL DE ESTADÍSTICAS GLOBALES --- */
  .stats-panel {
    position: fixed;
    inset: 0;
    z-index: 150;
    display: grid;
    place-items: center;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .stats-panel.is-open {
    pointer-events: auto;
    opacity: 1;
  }

  .stats-container {
    width: min(900px, 95vw);
    height: min(600px, 85vh);
    background: rgba(10, 12, 22, 0.8);
    border: 1px solid var(--edge-light);
    border-radius: 12px;
    backdrop-filter: blur(20px);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.4);
  }

  .stats-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--edge);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .stats-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 500;
    font-family: 'Roboto Mono', monospace;
    color: var(--ink-header);
  }

  .stats-close {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--ink-sub);
    cursor: pointer;
    transition: color 0.2s;
  }

  .stats-close:hover {
    color: var(--ink);
  }

  .stats-content {
    flex-grow: 1;
    padding: 24px;
    overflow-y: auto;
  }

  .stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: rgba(15, 18, 25, 0.4);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
  }

  .stat-number {
    font-size: 32px;
    font-weight: 700;
    font-family: 'Roboto Mono', monospace;
    color: var(--accent);
    margin-bottom: 8px;
  }

  .stat-label {
    font-size: 12px;
    text-transform: uppercase;
    color: var(--ink-sub);
    letter-spacing: 0.1em;
  }

  .stats-charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  .chart-container {
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 20px;
  }

  .chart-container h4 {
    margin: 0 0 16px 0;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--ink-sub);
    letter-spacing: 0.1em;
  }

  .category-chart, .level-chart {
    height: 200px;
    display: flex;
    align-items: end;
    gap: 8px;
  }

  .chart-bar {
    flex: 1;
    background: var(--accent);
    border-radius: 2px 2px 0 0;
    transition: all 0.3s ease;
    position: relative;
  }

  .chart-bar:hover {
    background: var(--status-online);
    transform: scaleY(1.1);
  }

  .chart-bar::after {
    content: attr(data-label);
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    color: var(--ink-sub);
    white-space: nowrap;
  }

  /* --- MEJORA #6: INTERACTIVIDAD AVANZADA --- */
  .touch-indicator {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    border: 2px solid var(--accent);
    border-radius: 50%;
    background: rgba(137, 245, 255, 0.1);
    pointer-events: none;
    opacity: 0;
    z-index: 1000;
    transition: all 0.3s ease;
  }

  .touch-indicator.is-active {
    opacity: 1;
    animation: touch-pulse 0.6s ease-out;
  }

  @keyframes touch-pulse {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
  }

  .voice-command {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(10, 12, 22, 0.8);
    border: 1px solid var(--accent);
    border-radius: 20px;
    padding: 8px 16px;
    color: var(--accent);
    font-family: 'Roboto Mono', monospace;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }

  .voice-command.is-active {
    opacity: 1;
  }

  /* Indicadores de gestos */
  .gesture-hint {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(10, 12, 22, 0.8);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 12px;
    color: var(--ink-sub);
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    opacity: 0.7;
    transition: opacity 0.3s ease;
  }

  .gesture-hint:hover {
    opacity: 1;
  }

  .gesture-hint h4 {
    margin: 0 0 8px 0;
    color: var(--accent);
    font-size: 12px;
  }

  .gesture-hint ul {
    margin: 0;
    padding-left: 16px;
  }

  .gesture-hint li {
    margin-bottom: 4px;
  }

  /* --- MEJORA #8: INTEGRACIÓN DE DATOS --- */
  .data-sync {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(10, 12, 22, 0.8);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 12px;
    color: var(--ink-sub);
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }

  .data-sync.is-active {
    opacity: 1;
  }

  .data-sync.success {
    border-color: var(--status-online);
    color: var(--status-online);
  }

  .data-sync.error {
    border-color: #ff6b6b;
    color: #ff6b6b;
  }

  .github-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 10px;
    color: var(--status-online);
    font-family: 'Roboto Mono', monospace;
  }

  .tech-trend {
    position: absolute;
    bottom: 8px;
    left: 8px;
    font-size: 10px;
    color: var(--accent);
    font-family: 'Roboto Mono', monospace;
  }

  .tech-trend.up {
    color: var(--status-online);
  }

  .tech-trend.down {
    color: #ff6b6b;
  }

  /* --- ESTILOS PARA MODAL MEJORADO --- */
  .performance-grid {
    display: grid;
    gap: 16px;
    margin-top: 16px;
  }

  .performance-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
  }

  .performance-label {
    font-size: 12px;
    color: var(--ink-sub);
    text-transform: uppercase;
    min-width: 120px;
  }

  .performance-bar {
    flex-grow: 1;
    height: 8px;
    background: var(--edge);
    border-radius: 4px;
    overflow: hidden;
  }

  .performance-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--status-online));
    border-radius: 4px;
    transition: width 1s ease;
  }

  .performance-value {
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
    min-width: 40px;
    text-align: right;
  }

  /* --- NUEVAS MEJORAS DEL MODAL --- */
  .sidebar-ctas {
    margin-top: 24px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .cta-btn {
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 6px;
    padding: 8px 12px;
    color: var(--ink-sub);
    font-size: 11px;
    font-family: 'Roboto Mono', monospace;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .cta-btn:hover {
    background: var(--accent-glow);
    border-color: var(--accent);
    color: var(--accent);
    transform: translateY(-1px);
  }

  /* Benchmarks Styles */
  .benchmarks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 16px;
  }

  .benchmark-card {
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
  }

  .benchmark-card h4 {
    margin: 0 0 12px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .benchmark-chart {
    height: 120px;
    display: flex;
    align-items: end;
    justify-content: center;
    position: relative;
  }

  .benchmark-bar {
    width: 40px;
    background: linear-gradient(to top, var(--accent), var(--status-online));
    border-radius: 4px 4px 0 0;
    position: relative;
    transition: height 0.8s ease;
  }

  .benchmark-value {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    color: var(--accent);
    font-weight: 600;
  }

  /* Compatibility Styles */
  .browser-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }

  .browser-item {
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
    transition: all 0.2s ease;
  }

  .browser-item:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
  }

  .browser-icon {
    font-size: 24px;
    display: block;
    margin-bottom: 8px;
  }

  .browser-name {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--ink-header);
    margin-bottom: 4px;
  }

  .browser-version {
    display: block;
    font-size: 12px;
    color: var(--ink-sub);
    font-family: 'Roboto Mono', monospace;
  }

  /* Changelog Styles */
  .changelog-timeline {
    margin-top: 16px;
  }

  .changelog-entry {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
    margin-bottom: 12px;
    transition: all 0.2s ease;
  }

  .changelog-entry:hover {
    border-color: var(--accent);
    transform: translateX(4px);
  }

  .changelog-date {
    font-size: 12px;
    color: var(--ink-sub);
    font-family: 'Roboto Mono', monospace;
    min-width: 80px;
  }

  .changelog-content h4 {
    margin: 0 0 4px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
  }

  .changelog-content p {
    margin: 0;
    font-size: 13px;
    color: var(--ink);
  }

  /* Tech Grid Styles */
  .tech-grid, .stack-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 16px;
  }

  .tech-card, .stack-item {
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 16px;
  }

  .tech-card h4, .stack-item h4 {
    margin: 0 0 12px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .tech-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .tech-tag {
    background: rgba(137, 245, 255, 0.1);
    border: 1px solid var(--accent);
    color: var(--accent);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-family: 'Roboto Mono', monospace;
    transition: all 0.2s ease;
  }

  .tech-tag:hover {
    background: var(--accent);
    color: var(--bg);
    transform: translateY(-1px);
  }

  /* Experience Grid Styles */
  .achievements-grid, .experience-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 16px;
  }

  .achievement-card, .experience-item {
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 16px;
  }

  .achievement-card h4, .experience-item h4 {
    margin: 0 0 12px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .achievement-list, .learning-list, .future-list {
    margin: 0;
    padding-left: 16px;
    list-style: none;
  }

  .achievement-list li, .learning-list li, .future-list li {
    margin-bottom: 8px;
    font-size: 13px;
    color: var(--ink);
    position: relative;
    padding-left: 16px;
  }

  .achievement-list li::before, .learning-list li::before, .future-list li::before {
    content: "▸";
    position: absolute;
    left: 0;
    color: var(--accent);
    font-weight: bold;
  }

  /* Learning Grid Styles */
  .learning-grid, .future-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 16px;
  }

  .learning-item, .future-item {
    background: rgba(15, 18, 25, 0.3);
    border: 1px solid var(--edge);
    border-radius: 8px;
    padding: 16px;
  }

  .learning-item h4, .future-item h4 {
    margin: 0 0 12px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  /* Content Layouts */
  .technical-content, .experience-content, .future-content, .benchmarks-content, .compatibility-content, .changelog-content {
    padding: 24px;
    height: 100%;
    overflow-y: auto;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .tech-grid, .stack-grid, .achievements-grid, .experience-grid, .learning-grid, .future-grid, .benchmarks-grid, .browser-grid {
      grid-template-columns: 1fr;
    }
    
    .performance-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
    
    .performance-label {
      min-width: auto;
    }
    
    .performance-value {
      text-align: left;
    }
  }

  /* --- TOAST NOTIFICATIONS --- */
  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(10, 12, 22, 0.9);
    border: 1px solid var(--accent);
    border-radius: 8px;
    padding: 12px 16px;
    color: var(--accent);
    font-family: 'Roboto Mono', monospace;
    font-size: 12px;
    z-index: 10000;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .toast-success {
    border-color: var(--status-online);
    color: var(--status-online);
  }

  .toast-error {
    border-color: #ff6b6b;
    color: #ff6b6b;
  }

  .toast-info {
    border-color: var(--accent);
    color: var(--accent);
  }

  /* --- MEJORAS ADICIONALES --- */
  .card:hover .energy-orbit {
    animation-duration: 2s;
  }

  .card:hover .stack-corona {
    animation-duration: 6s;
  }

  .card:hover .electric-arc {
    animation-duration: 0.8s;
  }

  /* --- ANIMACIONES MEJORADAS --- */
  @keyframes particle-float {
    0% {
      opacity: 0;
      transform: translateY(0) scale(0) rotate(0deg);
    }
    20% {
      opacity: 1;
      transform: translateY(-20px) scale(1) rotate(180deg);
    }
    80% {
      opacity: 0.8;
      transform: translateY(-60px) scale(0.8) rotate(360deg);
    }
    100% {
      opacity: 0;
      transform: translateY(-100px) scale(0) rotate(720deg);
    }
  }

  /* --- MEJORAS DE ACCESIBILIDAD --- */
  .card:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 4px;
  }

  .btn:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  /* --- MEJORAS DE RENDIMIENTO --- */
  .card {
    will-change: transform, opacity, filter;
  }

  .particle {
    will-change: transform, opacity;
  }

  .energy-orbit {
    will-change: transform;
  }

  /* --- NUEVAS FUNCIONALIDADES AVANZADAS --- */
  
  /* --- RED DE SINERGIAS --- */
  .synergy-network {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }

  .synergy-line {
    position: absolute;
    background: linear-gradient(90deg, var(--accent-glow), var(--accent), var(--accent-glow));
    height: 2px;
    border-radius: 1px;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    transform-origin: left center;
  }

  .synergy-line.active {
    opacity: 0.6;
    animation: synergy-pulse 2s ease-in-out infinite;
  }

  .synergy-line.hover {
    opacity: 1;
    animation: synergy-glow 1s ease-in-out infinite;
  }

  @keyframes synergy-pulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
  }

  @keyframes synergy-glow {
    0%, 100% { opacity: 0.6; box-shadow: 0 0 5px var(--accent-glow); }
    50% { opacity: 1; box-shadow: 0 0 15px var(--accent-glow); }
  }

  /* --- SET BONUSES --- */
  .card.set-bonus {
    filter: hue-rotate(30deg) brightness(1.2);
  }

  .card.set-bonus::after {
    content: "";
    position: absolute;
    inset: -10px;
    border-radius: 16px;
    background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
    opacity: 0.3;
    animation: set-bonus-aura 3s ease-in-out infinite;
    z-index: -1;
  }

  @keyframes set-bonus-aura {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(1.05); }
  }

  /* --- CURSOR MAGNÉTICO CON RESORTE --- */
  .tech-icon-container {
    position: relative;
    display: grid;
    place-items: center;
    transition: transform 0.1s ease-out;
  }

  .tech-icon-container.magnetic {
    transition: none;
  }

  .tech-icon-container img {
    transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* --- DEPTH PARALLAX REAL --- */
  .card {
    perspective: 1000px;
  }

  .card-content {
    transform-style: preserve-3d;
  }

  .card-header {
    transform: translateZ(20px);
  }

  .tech-icon-container {
    transform: translateZ(40px);
  }

  .card-footer {
    transform: translateZ(10px);
  }

  .card-trail {
    transform: translateZ(-10px);
  }

  .mini-metrics {
    transform: translateZ(30px);
  }

  .mini-progress {
    transform: translateZ(15px);
  }

  /* --- CARGADOR DE ENERGÍA --- */
  .energy-charger {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 40px;
    height: 40px;
    z-index: 5;
  }

  .energy-charger svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
  }

  .energy-charger-bg {
    fill: none;
    stroke: var(--edge);
    stroke-width: 3;
  }

  .energy-charger-fill {
    fill: none;
    stroke: var(--accent);
    stroke-width: 3;
    stroke-linecap: round;
    stroke-dasharray: 100;
    stroke-dashoffset: 100;
    transition: stroke-dashoffset 0.8s ease;
  }

  .energy-charger.low .energy-charger-fill {
    stroke: #ff6b6b;
  }

  .energy-charger.charging .energy-charger-fill {
    animation: charging-pulse 1s ease-in-out infinite;
  }

  @keyframes charging-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* --- MENÚ RADIAL MÓVIL --- */
  .radial-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(10, 12, 22, 0.95) 0%, rgba(10, 12, 22, 0.8) 100%);
    border: 1px solid var(--accent);
    backdrop-filter: blur(20px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1000;
  }

  .radial-menu.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
  }

  .radial-menu-item {
    position: absolute;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(137, 245, 255, 0.1);
    border: 1px solid var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent);
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    transform: scale(0);
  }

  .radial-menu.active .radial-menu-item {
    transform: scale(1);
  }

  .radial-menu-item:hover {
    background: var(--accent);
    color: var(--bg);
    transform: scale(1.1);
  }

  .radial-menu-item:nth-child(1) { top: 20px; left: 50%; transform: translateX(-50%) scale(0); }
  .radial-menu-item:nth-child(2) { top: 50%; right: 20px; transform: translateY(-50%) scale(0); }
  .radial-menu-item:nth-child(3) { bottom: 20px; left: 50%; transform: translateX(-50%) scale(0); }
  .radial-menu-item:nth-child(4) { top: 50%; left: 20px; transform: translateY(-50%) scale(0); }

  .radial-menu.active .radial-menu-item:nth-child(1) { transform: translateX(-50%) scale(1); }
  .radial-menu.active .radial-menu-item:nth-child(2) { transform: translateY(-50%) scale(1); }
  .radial-menu.active .radial-menu-item:nth-child(3) { transform: translateX(-50%) scale(1); }
  .radial-menu.active .radial-menu-item:nth-child(4) { transform: translateY(-50%) scale(1); }

  /* --- EDGE-SWIPE PARA STATS --- */
  .edge-swipe-indicator {
    position: fixed;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    width: 20px;
    height: 100px;
    background: linear-gradient(90deg, transparent, var(--accent-glow));
    border-radius: 10px 0 0 10px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 100;
  }

  .edge-swipe-indicator.active {
    opacity: 0.6;
  }

  /* --- MODO DEV --- */
  .dev-mode {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(10, 12, 22, 0.9);
    border: 1px solid var(--accent);
    border-radius: 8px;
    padding: 8px 12px;
    color: var(--accent);
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }

  .dev-mode.active {
    opacity: 1;
  }

  /* --- MEJORAS DE INTERACCIÓN MÓVIL --- */
  @media (max-width: 768px) {
    .card {
      touch-action: manipulation;
    }

    .radial-menu {
      width: 250px;
      height: 250px;
    }

    .radial-menu-item {
      width: 60px;
      height: 60px;
      font-size: 20px;
    }
  }

  /* --- RESPONSIVE --- */
  @media (max-width: 768px) {
    .data-stream {
      width: 240px;
      left: calc(100% + 10px);
    }
  }

  /* --- INFO RAIL LATERAL --- */
  #info-rail {
    position: fixed;
    width: 320px;
    max-height: 70vh;
    overflow: auto;
    background: rgba(10, 12, 22, 0.75);
    border: 1px solid var(--accent);
    border-radius: 10px;
    padding: 14px 16px;
    font-family: 'Roboto Mono', monospace;
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
    pointer-events: auto;
    z-index: 1000;
    opacity: 0;
    transform: translateY(-4px);
    backdrop-filter: blur(12px);
    transition: all 0.3s ease-out;
  }

  #info-rail::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 10px;
    padding: 1px;
    background: linear-gradient(45deg, var(--accent), transparent, var(--accent));
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    opacity: 0.3;
  }

  #info-rail:hover::before {
    opacity: 0.6;
  }

  #info-rail .line {
    white-space: pre-wrap;
    margin: 6px 0;
    opacity: 0.9;
    position: relative;
  }

  #info-rail .line::before {
    content: '>';
    color: var(--accent);
    margin-right: 8px;
    opacity: 0.7;
  }

  #info-rail .caret {
    display: inline-block;
    width: 10px;
    height: 1.2em;
    background: var(--accent);
    margin-left: 4px;
    animation: blink 0.9s steps(1) infinite;
    box-shadow: 0 0 4px var(--accent);
  }

  @keyframes blink {
    50% { opacity: 0; }
  }

  #info-beam {
    position: fixed;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    transform-origin: left center;
    opacity: 0;
    pointer-events: none;
    z-index: 999;
    box-shadow: 0 0 8px var(--accent);
  }

  .bit {
    position: fixed;
    width: 3px;
    height: 3px;
    background: var(--accent);
    border-radius: 50%;
    pointer-events: none;
    opacity: 0;
    z-index: 999;
    box-shadow: 0 0 4px var(--accent);
  }

  /* --- MEJORAS AVANZADAS --- */
  .info-rail-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(137, 245, 255, 0.2);
  }

  .info-rail-title {
    font-weight: 700;
    color: var(--accent);
    font-size: 14px;
  }

  .info-rail-status {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--status-online);
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
  }

  .info-rail-metrics {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin: 12px 0;
  }

  .metric-item {
    background: rgba(137, 245, 255, 0.1);
    border: 1px solid rgba(137, 245, 255, 0.2);
    border-radius: 6px;
    padding: 8px;
    text-align: center;
  }

  .metric-value {
    font-size: 16px;
    font-weight: 700;
    color: var(--accent);
  }

  .metric-label {
    font-size: 10px;
    color: var(--ink-sub);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .info-rail-progress {
    margin: 12px 0;
  }

  .progress-bar {
    height: 4px;
    background: rgba(137, 245, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--status-online));
    border-radius: 2px;
    width: 0%;
    transition: width 0.8s ease-out;
    position: relative;
  }

  .progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer 2s ease-in-out infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .info-rail-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin: 12px 0;
  }

  .tag {
    background: rgba(137, 245, 255, 0.1);
    border: 1px solid var(--accent);
    color: var(--accent);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    opacity: 0;
    transform: translateY(10px);
  }

  .info-rail.active .tag {
    animation: fadeUp 0.3s ease-out forwards;
  }

  .info-rail.active .tag:nth-child(1) { animation-delay: 0.1s; }
  .info-rail.active .tag:nth-child(2) { animation-delay: 0.2s; }
  .info-rail.active .tag:nth-child(3) { animation-delay: 0.3s; }

  @keyframes fadeUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .info-rail-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    padding-top: 8px;
    border-top: 1px solid rgba(137, 245, 255, 0.2);
  }

  .action-btn {
    background: rgba(137, 245, 255, 0.1);
    border: 1px solid var(--accent);
    color: var(--accent);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    opacity: 0;
    transform: translateY(10px);
  }

  .action-btn:hover {
    background: var(--accent);
    color: var(--bg);
    box-shadow: 0 0 8px var(--accent);
  }

  .info-rail.active .action-btn {
    animation: fadeUp 0.3s ease-out forwards;
  }

  .info-rail.active .action-btn:nth-child(1) { animation-delay: 0.4s; }
  .info-rail.active .action-btn:nth-child(2) { animation-delay: 0.5s; }
  .info-rail.active .action-btn:nth-child(3) { animation-delay: 0.6s; }

  /* --- ANIMACIONES AVANZADAS --- */
  .info-rail-enter {
    animation: railEnter 0.4s ease-out forwards;
  }

  @keyframes railEnter {
    0% {
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
      filter: blur(4px);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
    }
  }

  .info-rail-exit {
    animation: railExit 0.3s ease-in forwards;
  }

  @keyframes railExit {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
    }
    100% {
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
      filter: blur(4px);
    }
  }

  /* --- EFECTOS AVANZADOS --- */
  .info-rail-glow {
    position: relative;
  }

  .info-rail-glow::after {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 12px;
    background: linear-gradient(45deg, var(--accent), transparent, var(--accent));
    background-size: 200% 200%;
    animation: glowPulse 3s ease-in-out infinite;
    z-index: -1;
    opacity: 0.3;
  }

  @keyframes glowPulse {
    0%, 100% { background-position: 0% 50%; opacity: 0.3; }
    50% { background-position: 100% 50%; opacity: 0.6; }
  }

  /* --- INTERACCIONES TÁCTILES --- */
  .info-rail-touch {
    touch-action: manipulation;
  }

  .info-rail-touch:active {
    transform: scale(0.98);
  }

  /* --- EFECTOS DE PARTÍCULAS AVANZADOS --- */
  .particle-trail {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
  }

  .particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: var(--accent);
    border-radius: 50%;
    opacity: 0;
    animation: particleFloat 2s ease-out infinite;
  }

  @keyframes particleFloat {
    0% {
      opacity: 0;
      transform: translateY(0) scale(0);
    }
    50% {
      opacity: 1;
      transform: translateY(-20px) scale(1);
    }
    100% {
      opacity: 0;
      transform: translateY(-40px) scale(0);
    }
  }

  /* --- EFECTOS DE SONIDO VISUALES --- */
  .sound-wave {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: var(--accent);
    opacity: 0;
    animation: soundWave 0.6s ease-out;
  }

  @keyframes soundWave {
    0% {
      opacity: 1;
      transform: translate(-50%, -50%) scale(0);
    }
    100% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(20);
    }
  }

  /* --- EFECTOS DE HOVER AVANZADOS --- */
  .action-btn:hover {
    background: var(--accent);
    color: var(--bg);
    box-shadow: 0 0 12px var(--accent);
    transform: translateY(-2px);
  }

  .action-btn:active {
    transform: translateY(0);
  }

  /* --- EFECTOS DE TEXTO AVANZADOS --- */
  .glitch-text {
    position: relative;
  }

  .glitch-text::before,
  .glitch-text::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
  }

  .glitch-text::before {
    animation: glitch-1 0.3s ease-out;
    color: #ff0000;
    transform: translate(-2px, 2px);
  }

  .glitch-text::after {
    animation: glitch-2 0.3s ease-out;
    color: #00ff00;
    transform: translate(2px, -2px);
  }

  @keyframes glitch-1 {
    0% { opacity: 0; }
    50% { opacity: 1; }
    100% { opacity: 0; }
  }

  @keyframes glitch-2 {
    0% { opacity: 0; }
    50% { opacity: 1; }
    100% { opacity: 0; }
  }

  /* --- EFECTOS DE ENERGÍA --- */
  .energy-field {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 10px;
    background: radial-gradient(circle at center, rgba(137, 245, 255, 0.1) 0%, transparent 70%);
    opacity: 0;
    animation: energyPulse 2s ease-in-out infinite;
  }

  @keyframes energyPulse {
    0%, 100% { opacity: 0; transform: scale(1); }
    50% { opacity: 0.3; transform: scale(1.05); }
  }

  /* --- PREFERENCIAS DE MOVIMIENTO REDUCIDO --- */
  @media (prefers-reduced-motion: reduce) {
    .info-rail-glow::after,
    .particle,
    .energy-field,
    .sound-wave,
    .status-indicator {
      animation: none !important;
    }
    
    .info-rail-enter,
    .info-rail-exit {
      animation: none !important;
      transition: opacity 0.2s ease-out;
    }
    
    .bit {
      display: none !important;
    }
  }

  /* --- OPTIMIZACIÓN DE LISTENERS --- */
  .info-rail-touch {
    touch-action: manipulation;
  }
</style>
</head>
<body>

  <svg style="position:absolute; width:0; height:0;">
    <filter id="holo-displacement">
      <feTurbulence type="fractalNoise" baseFrequency="0.08" numOctaves="3" seed="5" />
      <feDisplacementMap in="SourceGraphic" scale="10" />
    </filter>
  </svg>

  <div class="environment-overlay">
    <div class="floor-grid"></div>
  </div>
  
  <div id="info-rail" role="region" aria-live="polite" tabindex="-1" hidden></div>
  <div id="info-beam"></div>

  <div class="ui">
    <button class="btn" id="prev">ANTERIOR</button>
    <button class="btn" id="next">SIGUIENTE</button>
    <button class="btn" id="mute">SONIDO: ON</button>
    <button class="btn" id="stats-toggle">ESTADÍSTICAS</button>
  </div>

  <!-- --- MEJORA #4: PANEL DE ESTADÍSTICAS GLOBALES --- -->
  <div class="stats-panel" id="stats-panel">
    <div class="stats-container">
      <div class="stats-header">
        <h3>Dashboard de Habilidades</h3>
        <button class="stats-close" id="stats-close">&times;</button>
      </div>
      <div class="stats-content">
        <div class="stats-overview">
          <div class="stat-card">
            <div class="stat-number" id="total-skills">0</div>
            <div class="stat-label">Tecnologías</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-projects">0</div>
            <div class="stat-label">Proyectos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-commits">0</div>
            <div class="stat-label">Commits</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="avg-level">0%</div>
            <div class="stat-label">Promedio</div>
          </div>
        </div>
        <div class="stats-charts">
          <div class="chart-container">
            <h4>Distribución por Categoría</h4>
            <div class="category-chart" id="category-chart"></div>
          </div>
          <div class="chart-container">
            <h4>Nivel de Experiencia</h4>
            <div class="level-chart" id="level-chart"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="viewport">
    <div class="scene" id="scene"><div class="floor-grid"></div><div class="pipeline" id="pipeline"></div></div>
  </div>
  <div class="holopanel" id="holopanel" aria-hidden="true">
    <div class="holopanel-backdrop" data-flip-id="backdrop"></div>
    <div class="holopanel-container" id="holopanel-container"></div>
  </div>

  <!-- --- MEJORA #6: ELEMENTOS DE INTERACTIVIDAD AVANZADA --- -->
  <div class="touch-indicator" id="touch-indicator"></div>
  <div class="voice-command" id="voice-command">Escuchando...</div>
  
  <div class="gesture-hint">
    <h4>Controles</h4>
    <ul>
      <li>← → Navegar</li>
      <li>Enter Abrir</li>
      <li>Escape Cerrar</li>
      <li>V Comandos voz</li>
      <li>S Estadísticas</li>
    </ul>
  </div>

  <!-- --- MEJORA #8: ELEMENTOS DE INTEGRACIÓN DE DATOS --- -->
  <div class="data-sync" id="data-sync">
    <div>Sincronizando datos...</div>
  </div>

<script>
(() => {
  gsap.registerPlugin(Flip);
  const D = (a, b) => Math.random() * (b - a) + a;
  const R = (a, b) => Math.floor(D(a, b + 1));

  // --- MEJORA: BASE DE DATOS CON URLs DE LOGOS Y MÁS DATOS ---
  const SKILLS_DATA = [
    { 
      id: 'html5', 
      name: 'HTML5', 
      level: 95, 
      years: '5+', 
      category: 'Frontend', 
      description: 'Maestría en semántica web, accesibilidad y estándares modernos para la construcción de la espina dorsal de la web.',
      projects: 50, 
      commits: 12500, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg',
      // --- NUEVA INFORMACIÓN DETALLADA ---
      versions: ['HTML5', 'XHTML 1.1', 'HTML4'],
      frameworks: ['HTML Semántico', 'Microdatos', 'Schema.org'],
      libraries: ['Pug', 'Handlebars', 'EJS'],
      patterns: ['Basado en Componentes', 'Impulsado por Plantillas', 'Mejora Progresiva'],
      certifications: ['Especialista W3C HTML5', 'Fundamentos de Accesibilidad'],
      achievements: ['Puntuación 100% Lighthouse', 'Cumple WCAG 2.1 AA'],
      stack: ['CSS3', 'JavaScript', 'React', 'Next.js'],
      tools: ['VS Code', 'Emmet', 'Live Server', 'Herramientas de Desarrollo'],
      databases: ['LocalStorage', 'SessionStorage', 'IndexedDB'],
      performance: {
        lighthouse: 100,
        seo: 95,
        accessibility: 98,
        bestPractices: 100
      },
      learning: {
        resources: ['Documentación MDN', 'W3Schools', 'CSS-Tricks'],
        blogs: ['Smashing Magazine', 'A List Apart'],
        conferences: ['An Event Apart', 'Web Directions'],
        communities: ['Estándares Web', 'Proyecto A11y']
      },
      future: {
        trends: ['Componentes Web', 'Aplicaciones Web Progresivas', 'WebAssembly'],
        roadmap: ['Accesibilidad Avanzada', 'Rendimiento Web', 'Maestría en SEO'],
        emerging: ['WebGPU', 'API de Red Neuronal Web'],
        goals: ['Defensor de Estándares Web', 'Experto en Accesibilidad']
      },
      experience: {
        companies: ['Freelance', 'Startups', 'Empresas'],
        roles: ['Desarrollador Frontend', 'Diseñador UI/UX', 'Líder Técnico'],
        teams: ['Multifuncional', 'Remoto', 'Ágil'],
        methodologies: ['Ágil', 'Scrum', 'Design Thinking']
      }
    },
    { 
      id: 'css3', 
      name: 'CSS3', 
      level: 90, 
      years: '5+', 
      category: 'Frontend', 
      description: 'Diseño de interfaces fluidas y visualmente impactantes con animaciones avanzadas, Grid/Flexbox y preprocesadores como SASS.',
      projects: 50, 
      commits: 18300, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/css3/css3-original.svg',
      versions: ['CSS3', 'CSS2.1', 'CSS1'],
      frameworks: ['Tailwind CSS', 'Bootstrap', 'Material-UI'],
      libraries: ['Sass', 'Less', 'Stylus', 'PostCSS'],
      patterns: ['BEM', 'SMACSS', 'ITCSS', 'Diseño Atómico'],
      certifications: ['Especialista CSS Grid', 'Animaciones CSS Avanzadas'],
      achievements: ['Premios de Diseño CSS', 'Reconocimiento Awwwards'],
      stack: ['HTML5', 'JavaScript', 'React', 'Vue.js'],
      tools: ['VS Code', 'Compilador Sass', 'Autoprefixer', 'PurgeCSS'],
      databases: ['CSS-en-JS', 'Variables CSS', 'Propiedades Personalizadas'],
      performance: {
        lighthouse: 95,
        seo: 90,
        accessibility: 92,
        bestPractices: 95
      },
      learning: {
        resources: ['CSS-Tricks', 'Sara Soueidan', 'Lea Verou'],
        blogs: ['CSS Weekly', 'Smashing Magazine'],
        conferences: ['CSS Conf', 'An Event Apart'],
        communities: ['Grupo de Trabajo CSS', 'Comunidad CSS-Tricks']
      },
      future: {
        trends: ['Consultas de Contenedor CSS', 'CSS Houdini', 'CSS Grid Nivel 2'],
        roadmap: ['Animaciones Avanzadas', 'Arquitectura CSS', 'Rendimiento'],
        emerging: ['API de Pintura CSS', 'API de Diseño CSS'],
        goals: ['Experto en CSS', 'Especialista en Sistemas de Diseño']
      },
      experience: {
        companies: ['Agencias de Diseño', 'Empresas de Producto', 'Consultoría'],
        roles: ['Desarrollador CSS', 'Desarrollador UI', 'Líder de Sistema de Diseño'],
        teams: ['Diseño', 'Frontend', 'Producto'],
        methodologies: ['Sistemas de Diseño', 'Impulsado por Componentes', 'Diseño Atómico']
      }
    },
    { 
      id: 'javascript', 
      name: 'JavaScript', 
      level: 88, 
      years: '4+', 
      category: 'Frontend', 
      description: 'Creación de lógica interactiva compleja y manipulación dinámica del DOM utilizando ES6+, async/await y APIs modernas.',
      projects: 45, 
      commits: 25000, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg',
      versions: ['ES2022', 'ES2021', 'ES2020', 'ES6+'],
      frameworks: ['React', 'Vue.js', 'Angular', 'Svelte'],
      libraries: ['Lodash', 'Axios', 'Moment.js', 'Chart.js'],
      patterns: ['Patrón Módulo', 'Patrón Observador', 'Patrón Fábrica'],
      certifications: ['Algoritmos JavaScript', 'Especialista ES6+'],
      achievements: ['Contribuciones Open Source', 'Optimizaciones de Rendimiento'],
      stack: ['HTML5', 'CSS3', 'Node.js', 'TypeScript'],
      tools: ['VS Code', 'Webpack', 'Babel', 'ESLint'],
      databases: ['MongoDB', 'Firebase', 'Supabase'],
      performance: {
        lighthouse: 92,
        seo: 88,
        accessibility: 85,
        bestPractices: 90
      },
      learning: {
        resources: ['JavaScript Eloquente', 'No Conoces JS', 'MDN'],
        blogs: ['JavaScript Weekly', '2ality'],
        conferences: ['JSConf', 'NodeConf', 'React Conf'],
        communities: ['Comunidad JavaScript', 'Fundación Node.js']
      },
      future: {
        trends: ['WebAssembly', 'Deno', 'Bun', 'Computación Edge'],
        roadmap: ['Maestría en TypeScript', 'Optimización de Rendimiento', 'Testing'],
        emerging: ['Web Workers', 'Service Workers', 'APIs Web'],
        goals: ['Experto en JavaScript', 'Especialista en Rendimiento']
      },
      experience: {
        companies: ['Startups Tecnológicas', 'E-commerce', 'Fintech'],
        roles: ['Desarrollador JavaScript', 'Desarrollador Full Stack', 'Líder Técnico'],
        teams: ['Ingeniería', 'Producto', 'Plataforma'],
        methodologies: ['TDD', 'BDD', 'Ágil', 'DevOps']
      }
    },
    { 
      id: 'react', 
      name: 'React', 
      level: 85, 
      years: '3+', 
      category: 'Frontend', 
      description: 'Desarrollo de Single Page Applications (SPAs) y renderizado del lado del servidor (SSR) con Next.js, utilizando Hooks y Context API.',
      projects: 25, 
      commits: 32000, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/react/react-original.svg',
      versions: ['React 18', 'React 17', 'React 16'],
      frameworks: ['Next.js', 'Gatsby', 'Create React App'],
      libraries: ['Redux', 'Zustand', 'React Query', 'Framer Motion'],
      patterns: ['Patrón Hooks', 'Render Props', 'Componentes de Orden Superior'],
      certifications: ['Certificación Desarrollador React', 'Especialista Next.js'],
      achievements: ['Optimizaciones de Rendimiento', 'Biblioteca de Componentes'],
      stack: ['TypeScript', 'Node.js', 'MongoDB', 'Vercel'],
      tools: ['VS Code', 'React DevTools', 'Storybook', 'Jest'],
      databases: ['Firebase', 'Supabase', 'PlanetScale'],
      performance: {
        lighthouse: 88,
        seo: 85,
        accessibility: 82,
        bestPractices: 90
      },
      learning: {
        resources: ['Documentación React', 'Kent C. Dodds', 'Josh Comeau'],
        blogs: ['Overreacted', 'Blog de React'],
        conferences: ['React Conf', 'React Summit'],
        communities: ['Comunidad React', 'Reactiflux']
      },
      future: {
        trends: ['Componentes de Servidor React', 'Características Concurrentes', 'Suspense'],
        roadmap: ['Patrones Avanzados', 'Rendimiento', 'Testing'],
        emerging: ['React Native', 'React Three Fiber'],
        goals: ['Experto en React', 'Especialista en Rendimiento']
      },
      experience: {
        companies: ['Empresas SaaS', 'E-commerce', 'Redes Sociales'],
        roles: ['Desarrollador React', 'Líder Frontend', 'Ingeniero UI'],
        teams: ['Frontend', 'Producto', 'Plataforma'],
        methodologies: ['Impulsado por Componentes', 'Sistemas de Diseño', 'Ágil']
      }
    },
    { 
      id: 'threejs', 
      name: 'Three.js', 
      level: 80, 
      years: '2+', 
      category: 'Frontend', 
      description: 'Construcción de experiencias 3D inmersivas y visualizaciones de datos en el navegador a través de WebGL y shaders.',
      projects: 10, 
      commits: 8500, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/threejs/threejs-original.svg',
      versions: ['Three.js r150', 'Three.js r140', 'Three.js r130'],
      frameworks: ['React Three Fiber', 'Vue Three', 'Angular Three'],
      libraries: ['GSAP', 'Cannon.js', 'Stats.js', 'OrbitControls'],
      patterns: ['Grafo de Escena', 'Sistema de Materiales', 'Instanciación de Geometría'],
      certifications: ['Fundamentos WebGL', 'Programación de Gráficos 3D'],
      achievements: ['Experiencias 3D Interactivas', 'Optimizaciones de Rendimiento'],
      stack: ['WebGL', 'GLSL', 'JavaScript', 'React'],
      tools: ['Editor Three.js', 'Blender', 'Inspector WebGL'],
      databases: ['WebGL', 'IndexedDB', 'Web Workers'],
      performance: {
        lighthouse: 75,
        seo: 70,
        accessibility: 65,
        bestPractices: 80
      },
      learning: {
        resources: ['Documentación Three.js', 'Fundamentos WebGL', 'Shaders'],
        blogs: ['Blog Three.js', 'WebGL Insights'],
        conferences: ['Meetup WebGL', 'Programación de Gráficos'],
        communities: ['Comunidad Three.js', 'Comunidad WebGL']
      },
      future: {
        trends: ['WebGPU', 'WebXR', 'Ray Tracing en Tiempo Real'],
        roadmap: ['Shaders Avanzados', 'Rendimiento', 'VR/AR'],
        emerging: ['WebAssembly', 'Web Workers'],
        goals: ['Experto en Gráficos 3D', 'Especialista VR/AR']
      },
      experience: {
        companies: ['Gaming', 'Arquitectura', 'Educación'],
        roles: ['Desarrollador 3D', 'Programador de Gráficos', 'Desarrollador Creativo'],
        teams: ['Creativo', 'Ingeniería', 'Diseño'],
        methodologies: ['Programación Creativa', 'Diseño Interactivo', 'Ágil']
      }
    },
    { 
      id: 'gsap', 
      name: 'GSAP', 
      level: 85, 
      years: '2+', 
      category: 'Frontend', 
      description: 'Orquestación de animaciones complejas de alto rendimiento para micro-interacciones, transiciones de página y efectos visuales avanzados.',
      projects: 30, 
      commits: 5000, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/gsap/gsap-original.svg',
      versions: ['GSAP 3.12', 'GSAP 3.11', 'GSAP 3.10'],
      frameworks: ['React', 'Vue.js', 'Angular', 'Vanilla JS'],
      libraries: ['ScrollTrigger', 'MorphSVG', 'DrawSVG', 'MotionPath'],
      patterns: ['Orquestación de Timeline', 'Funciones de Easing', 'Optimización de Rendimiento'],
      certifications: ['Desarrollador Certificado GSAP', 'Especialista en Animación'],
      achievements: ['Animaciones Suaves 60fps', 'Interacciones Ganadoras de Premios'],
      stack: ['JavaScript', 'CSS3', 'SVG', 'Canvas'],
      tools: ['GSAP DevTools', 'Chrome DevTools', 'Monitor de Rendimiento'],
      databases: ['LocalStorage', 'SessionStorage'],
      performance: {
        lighthouse: 90,
        seo: 85,
        accessibility: 80,
        bestPractices: 88
      },
      learning: {
        resources: ['Documentación GSAP', 'Foros GreenSock', 'CodePen'],
        blogs: ['Blog GreenSock', 'CSS-Tricks'],
        conferences: ['CSS Conf', 'An Event Apart'],
        communities: ['Comunidad GreenSock', 'Comunidad de Animación']
      },
      future: {
        trends: ['API de Animaciones Web', 'CSS Houdini', 'Diseño de Movimiento'],
        roadmap: ['Easing Avanzado', 'Rendimiento', 'Accesibilidad'],
        emerging: ['Web Workers', 'Canvas Offscreen'],
        goals: ['Experto en Animación', 'Especialista en Diseño de Movimiento']
      },
      experience: {
        companies: ['Agencias Creativas', 'Empresas de Producto', 'Entretenimiento'],
        roles: ['Desarrollador de Animación', 'Desarrollador Creativo', 'Diseñador de Movimiento'],
        teams: ['Creativo', 'Frontend', 'Diseño'],
        methodologies: ['Diseño de Movimiento', 'Programación Creativa', 'Ágil']
      }
    },
    { 
      id: 'nodejs', 
      name: 'Node.js', 
      level: 85, 
      years: '3+', 
      category: 'Backend', 
      description: 'Arquitectura de servidores eficientes y escalables, APIs REST y comunicación en tiempo real con WebSockets.',
      projects: 20, 
      commits: 19800, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/nodejs/nodejs-original.svg',
      versions: ['Node.js 18', 'Node.js 16', 'Node.js 14'],
      frameworks: ['Express.js', 'Fastify', 'Koa', 'NestJS'],
      libraries: ['Socket.io', 'JWT', 'Multer', 'Cors'],
      patterns: ['MVC', 'API REST', 'Microservicios', 'Impulsado por Eventos'],
      certifications: ['Desarrollador Node.js', 'Arquitectura Backend'],
      achievements: ['APIs de Alto Rendimiento', 'Arquitectura Escalable'],
      stack: ['MongoDB', 'PostgreSQL', 'Redis', 'Docker'],
      tools: ['VS Code', 'Postman', 'Docker', 'PM2'],
      databases: ['MongoDB', 'PostgreSQL', 'Redis', 'MySQL'],
      performance: {
        lighthouse: 85,
        seo: 80,
        accessibility: 75,
        bestPractices: 88
      },
      learning: {
        resources: ['Documentación Node.js', 'Guía Express.js', 'Patrones de Diseño Node.js'],
        blogs: ['Blog Node.js', 'Blog Express.js'],
        conferences: ['NodeConf', 'JSConf'],
        communities: ['Comunidad Node.js', 'Comunidad Express.js']
      },
      future: {
        trends: ['Deno', 'Bun', 'Computación Edge', 'Serverless'],
        roadmap: ['Microservicios', 'Rendimiento', 'Seguridad'],
        emerging: ['WebAssembly', 'Funciones Edge'],
        goals: ['Experto Backend', 'Especialista en Arquitectura']
      },
      experience: {
        companies: ['SaaS', 'E-commerce', 'Fintech'],
        roles: ['Desarrollador Backend', 'Desarrollador Full Stack', 'Ingeniero DevOps'],
        teams: ['Backend', 'Plataforma', 'Infraestructura'],
        methodologies: ['Ágil', 'DevOps', 'Microservicios']
      }
    },
    { 
      id: 'python', 
      name: 'Python', 
      level: 80, 
      years: '3+', 
      category: 'Backend', 
      description: 'Desarrollo de APIs con Django/Flask, automatización de tareas y scripts para procesamiento de datos a gran escala.',
      projects: 18, 
      commits: 15400, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg',
      versions: ['Python 3.11', 'Python 3.10', 'Python 3.9'],
      frameworks: ['Django', 'Flask', 'FastAPI', 'Pyramid'],
      libraries: ['Pandas', 'NumPy', 'Requests', 'Beautiful Soup'],
      patterns: ['MVC', 'API REST', 'Procesamiento de Datos', 'Automatización'],
      certifications: ['Desarrollador Python', 'Especialista Django'],
      achievements: ['Pipelines de Procesamiento de Datos', 'Scripts de Automatización'],
      stack: ['PostgreSQL', 'Redis', 'Celery', 'Docker'],
      tools: ['PyCharm', 'VS Code', 'Jupyter', 'Docker'],
      databases: ['PostgreSQL', 'MySQL', 'MongoDB', 'Redis'],
      performance: {
        lighthouse: 80,
        seo: 75,
        accessibility: 70,
        bestPractices: 85
      },
      learning: {
        resources: ['Documentación Python', 'Real Python', 'Documentación Django'],
        blogs: ['Blog Python', 'Blog Django'],
        conferences: ['PyCon', 'DjangoCon'],
        communities: ['Comunidad Python', 'Comunidad Django']
      },
      future: {
        trends: ['FastAPI', 'Python Asíncrono', 'Ciencia de Datos', 'IA/ML'],
        roadmap: ['Patrones Avanzados', 'Rendimiento', 'Testing'],
        emerging: ['WebAssembly', 'Computación Edge'],
        goals: ['Experto en Python', 'Especialista en Ciencia de Datos']
      },
      experience: {
        companies: ['Ciencia de Datos', 'E-commerce', 'Automatización'],
        roles: ['Desarrollador Python', 'Ingeniero de Datos', 'Desarrollador Backend'],
        teams: ['Backend', 'Datos', 'Plataforma'],
        methodologies: ['Ágil', 'Impulsado por Datos', 'DevOps']
      }
    },
    { 
      id: 'mongodb', 
      name: 'MongoDB', 
      level: 75, 
      years: '2+', 
      category: 'Backend', 
      description: 'Modelado de datos flexible NoSQL, optimización de consultas con índices y agregaciones complejas para alta escalabilidad.',
      projects: 12, 
      commits: 6700, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/mongodb/mongodb-original-wordmark.svg',
      versions: ['MongoDB 6.0', 'MongoDB 5.0', 'MongoDB 4.4'],
      frameworks: ['Mongoose', 'Driver MongoDB', 'MongoDB Atlas'],
      libraries: ['Pipeline de Agregación', 'Change Streams', 'GridFS'],
      patterns: ['Modelado de Documentos', 'Estrategias de Indexación', 'Sharding'],
      certifications: ['Desarrollador MongoDB', 'Administrador de Base de Datos'],
      achievements: ['Consultas de Alto Rendimiento', 'Arquitectura Escalable'],
      stack: ['Node.js', 'Express.js', 'React', 'Docker'],
      tools: ['MongoDB Compass', 'Studio 3T', 'Robo 3T'],
      databases: ['MongoDB Atlas', 'MongoDB Cloud', 'MongoDB Local'],
      performance: {
        lighthouse: 75,
        seo: 70,
        accessibility: 65,
        bestPractices: 80
      },
      learning: {
        resources: ['Documentación MongoDB', 'Universidad MongoDB', 'Blog MongoDB'],
        blogs: ['Blog MongoDB', 'Comunidad MongoDB'],
        conferences: ['MongoDB World', 'MongoDB.local'],
        communities: ['Comunidad MongoDB', 'Foros MongoDB']
      },
      future: {
        trends: ['MongoDB Atlas', 'Serverless', 'Computación Edge'],
        roadmap: ['Agregaciones Avanzadas', 'Rendimiento', 'Seguridad'],
        emerging: ['GraphQL', 'Analytics en Tiempo Real'],
        goals: ['Experto en Base de Datos', 'Especialista NoSQL']
      },
      experience: {
        companies: ['SaaS', 'E-commerce', 'Analytics'],
        roles: ['Desarrollador de Base de Datos', 'Desarrollador Backend', 'Ingeniero de Datos'],
        teams: ['Backend', 'Datos', 'Plataforma'],
        methodologies: ['Ágil', 'Impulsado por Datos', 'DevOps']
      }
    },
    { 
      id: 'git', 
      name: 'Git', 
      level: 90, 
      years: '4+', 
      category: 'DevOps', 
      description: 'Gestión experta del control de versiones, estrategias de branching (Git Flow) e integración en flujos de CI/CD.',
      projects: 100, 
      commits: 50000, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/git/git-original.svg',
      versions: ['Git 2.40', 'Git 2.39', 'Git 2.38'],
      frameworks: ['GitHub', 'GitLab', 'Bitbucket', 'Azure DevOps'],
      libraries: ['Git Hooks', 'Git Submodules', 'Git LFS'],
      patterns: ['Git Flow', 'Desarrollo Basado en Tronco', 'Ramas de Características'],
      certifications: ['Certificado GitHub', 'Certificado GitLab'],
      achievements: ['Contribuciones Open Source', 'Colaboración en Equipo'],
      stack: ['GitHub Actions', 'GitLab CI', 'Jenkins', 'Docker'],
      tools: ['VS Code', 'GitKraken', 'SourceTree', 'Git Bash'],
      databases: ['Base de Datos Git', 'Git LFS'],
      performance: {
        lighthouse: 95,
        seo: 90,
        accessibility: 85,
        bestPractices: 95
      },
      learning: {
        resources: ['Documentación Git', 'Guías GitHub', 'Documentación GitLab'],
        blogs: ['Blog GitHub', 'Blog GitLab'],
        conferences: ['GitHub Universe', 'GitLab Commit'],
        communities: ['Comunidad GitHub', 'Comunidad GitLab']
      },
      future: {
        trends: ['GitHub Copilot', 'Código Impulsado por IA', 'Automatización'],
        roadmap: ['Flujos de Trabajo Avanzados', 'Seguridad', 'Rendimiento'],
        emerging: ['GitOps', 'Infraestructura como Código'],
        goals: ['Experto DevOps', 'Especialista en Automatización']
      },
      experience: {
        companies: ['Todas las Industrias', 'Open Source', 'Empresas'],
        roles: ['Ingeniero DevOps', 'Ingeniero de Software', 'Líder Técnico'],
        teams: ['Ingeniería', 'DevOps', 'Plataforma'],
        methodologies: ['Ágil', 'DevOps', 'GitOps']
      }
    },
    { 
      id: 'docker', 
      name: 'Docker', 
      level: 75, 
      years: '2+', 
      category: 'DevOps', 
      description: 'Creación de entornos de desarrollo y producción consistentes a través de la containerización de microservicios.',
      projects: 15, 
      commits: 4500, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/docker/docker-original.svg',
      versions: ['Docker 24.0', 'Docker 23.0', 'Docker 22.0'],
      frameworks: ['Docker Compose', 'Docker Swarm', 'Kubernetes'],
      libraries: ['Docker SDK', 'Docker API', 'Docker CLI'],
      patterns: ['Microservicios', 'Orquestación de Contenedores', 'Service Mesh'],
      certifications: ['Asociado Certificado Docker', 'Certificado Kubernetes'],
      achievements: ['Aplicaciones Containerizadas', 'Pipelines CI/CD'],
      stack: ['Kubernetes', 'Jenkins', 'GitHub Actions', 'AWS'],
      tools: ['Docker Desktop', 'Portainer', 'Lens', 'K9s'],
      databases: ['Volúmenes Docker', 'Almacenamiento Persistente'],
      performance: {
        lighthouse: 80,
        seo: 75,
        accessibility: 70,
        bestPractices: 85
      },
      learning: {
        resources: ['Documentación Docker', 'Documentación Kubernetes', 'Docker Hub'],
        blogs: ['Blog Docker', 'Blog Kubernetes'],
        conferences: ['DockerCon', 'KubeCon'],
        communities: ['Comunidad Docker', 'Comunidad Kubernetes']
      },
      future: {
        trends: ['Kubernetes', 'Service Mesh', 'Nativo en la Nube'],
        roadmap: ['Orquestación Avanzada', 'Seguridad', 'Rendimiento'],
        emerging: ['WebAssembly', 'Computación Edge'],
        goals: ['Experto DevOps', 'Especialista Nativo en la Nube']
      },
      experience: {
        companies: ['Proveedores de Nube', 'Empresas', 'Startups'],
        roles: ['Ingeniero DevOps', 'Ingeniero de Plataforma', 'SRE'],
        teams: ['DevOps', 'Plataforma', 'Infraestructura'],
        methodologies: ['DevOps', 'SRE', 'Ágil']
      }
    },
    { 
      id: 'aws', 
      name: 'AWS', 
      level: 70, 
      years: '2+', 
      category: 'DevOps', 
      description: 'Despliegue y gestión de infraestructura en la nube, utilizando servicios como S3, EC2, Lambda y CloudFront.',
      projects: 10, 
      commits: 3000, 
      logoUrl: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/amazonwebservices/amazonwebservices-original-wordmark.svg',
      versions: ['AWS SDK v3', 'AWS CLI v2', 'AWS CDK'],
      frameworks: ['Serverless Framework', 'Terraform', 'CloudFormation'],
      libraries: ['AWS SDK', 'Boto3', 'AWS CDK', 'Serverless'],
      patterns: ['Serverless', 'Microservicios', 'Impulsado por Eventos', 'Nativo en la Nube'],
      certifications: ['Arquitecto de Soluciones AWS', 'Desarrollador AWS'],
      achievements: ['Infraestructura en la Nube', 'Optimización de Costos'],
      stack: ['EC2', 'S3', 'Lambda', 'CloudFront', 'RDS'],
      tools: ['Consola AWS', 'AWS CLI', 'CloudFormation', 'Terraform'],
      databases: ['RDS', 'DynamoDB', 'ElastiCache', 'Redshift'],
      performance: {
        lighthouse: 75,
        seo: 70,
        accessibility: 65,
        bestPractices: 80
      },
      learning: {
        resources: ['Documentación AWS', 'Entrenamiento AWS', 'Blog AWS'],
        blogs: ['Blog AWS', 'Blog Serverless'],
        conferences: ['AWS re:Invent', 'AWS Summit'],
        communities: ['Comunidad AWS', 'Comunidad Serverless']
      },
      future: {
        trends: ['Serverless', 'Computación Edge', 'Servicios IA/ML'],
        roadmap: ['Servicios Avanzados', 'Seguridad', 'Optimización de Costos'],
        emerging: ['Graviton', 'Outposts', 'Zonas Locales'],
        goals: ['Experto en Nube', 'Especialista DevOps']
      },
      experience: {
        companies: ['Proveedores de Nube', 'Empresas', 'Startups'],
        roles: ['Ingeniero de Nube', 'Ingeniero DevOps', 'Arquitecto de Soluciones'],
        teams: ['Nube', 'DevOps', 'Infraestructura'],
        methodologies: ['DevOps', 'Nativo en la Nube', 'Ágil']
      }
    }
  ];

  const GAP_X = 150, STEP_Z = -80, BASE_Y = -40;
  const scene = document.getElementById('scene');
  const pipeline = document.getElementById('pipeline');
  const btnNext = document.getElementById('next');
  const btnPrev = document.getElementById('prev');
  const btnMute = document.getElementById('mute');
  const holopanel = document.getElementById('holopanel');
  const holopanelContainer = document.getElementById('holopanel-container');
  const backdrop = document.querySelector('.holopanel-backdrop');
  
  // --- MEJORA #4: ELEMENTOS DE ESTADÍSTICAS ---
  const statsPanel = document.getElementById('stats-panel');
  const statsToggle = document.getElementById('stats-toggle');
  const statsClose = document.getElementById('stats-close');
  
  // --- MEJORA #6: ELEMENTOS DE INTERACTIVIDAD ---
  const touchIndicator = document.getElementById('touch-indicator');
  const voiceCommand = document.getElementById('voice-command');
  
  // --- MEJORA #8: ELEMENTOS DE DATOS ---
  const dataSync = document.getElementById('data-sync');
  
  const soundEngine = { /* ... (código de audio sin cambios) ... */
    isMuted: false, sounds: {},
    init() {
      this.sounds.click = new Audio("data:audio/mp3;base64,UklGRlIAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAP///wD//wD//wH/Af8B/wH/Av8C/wL/A/8E/wX/Bv8H/wg/CT8K/wz/Df8O/xH/Ev8U/xb/Gf8d/yH/J/8s/zT/Ov9E/0v/Uf9j/2v/fv+G/5T/r//F/9//8f/x/+f/3//b/9r/2P/X/9b/1v/Y/9n/3P/g/+P/6f/u//P///8A");
      this.sounds.whoosh = new Audio("data:audio/mp3;base64,UklGRlYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YVIBAAD//wD//wD//wD//wD//wD//wD//wH/Af8A/wD/AP8A/wD/AP8A/wD/AP8B/wH/AgAC/wL/A/8E/wX/B/8J/w3/Ef8X/x//If8p/zH/Of9H/1L/Yv9w/3//jP+h/6z/vf/G/9D/2v/g/+b/9f/+/+H/5v/q/+v/6//r/+v/6v/q/+n/6P/o/+b/5f/l/+X/5v/o/+r/7f/x//f//f/z//L/8v/y//L/8//3//sA//8BAgIFAAcJDA8QExQWFxgZHB0gIiQlJikqKy4vMDEyNDU2ODk6Ozw9PkBBQkNERUZISUpMTU5PUFFTVFVWV1haXF1eX2BhYmNkZWVmZ2hpamtsbW5vcHFyc3R1dnd4eXp7fH1+f4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/AA==");
      this.sounds.shine = new Audio("data:audio/mp3;base64,UklGRkIAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQgAAAAA//8A/wEAAf8A/wD/AP8A/wD/AP8A/wH/AP8B/wH/AP8A/wH/Af8B/wH/AgAC/wIAAv8B/wH/Af8A/wD/AP8A/wD//P/8//z//P/8//3//f/9//3//f/9//3//f/9//7//v/+//7//v/+/wD/AP8A/wL/A/8E/wX/B/8K/w4/ET8YPxw/Ii8pLzMvOT9GPlA/WUBiQG5AfoCLhKOErYS1hLiFu4a8iL6LwZPGls+W15vbl+GV5Zrrlu6d+aMA");
      this.sounds.open = new Audio("data:audio/mp3;base64,UklGRkgAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAAZGF0YQQAAAAA8v/y//X/9v/5//v//P8A/gH/A/8G/wz/Ef8Y/x8/JT8q/zI/O/9D/0//W/9p/3j/hP+O/5b/ov+z/7//yP/V/97/6f/z//z/7v/p/+f/5v/n/+j/6v/t/+7/7//w//H/8v/z//T/9f/2//f/9//4//j/+f/6//r/+//8//z//f/9//z//f/+/wD/AQMCBwUJCw0PEhMUFhcZHB4gIiMmJygqLDI0Nz4/RElPUlhaXmJnam9ydnp/gYWKjpSXmJ2foqeoq62ztbe8vb/Cys7V2Nre4ufq7vL3+v8A");
      Object.values(this.sounds).forEach(s => { s.volume = 0.3; }); this.sounds.shine.volume = 0.1; this.sounds.open.volume = 0.4;
    },
    play(name) { if (!this.isMuted && this.sounds[name]) { this.sounds[name].currentTime = 0; this.sounds[name].play().catch(e=> {}); } },
    toggleMute() { this.isMuted = !this.isMuted; btnMute.textContent = `SONIDO: ${this.isMuted ? 'OFF' : 'ON'}`; }
  };
  soundEngine.init();

  const cards = [];
  let activeModalAnimations = null;
  let isPanelOpen = false;
  let isStatsOpen = false;
  let isVoiceActive = false;

  // --- MEJORA #8: DATOS EXTERNOS ---
  const TECH_TRENDS = {
    'react': { trend: 'up', popularity: 85 },
    'javascript': { trend: 'up', popularity: 92 },
    'python': { trend: 'up', popularity: 88 },
    'nodejs': { trend: 'up', popularity: 78 },
    'html5': { trend: 'stable', popularity: 95 },
    'css3': { trend: 'stable', popularity: 90 }
  };

  const nodes = SKILLS_DATA.map(skill => ({
      ...skill, status: ["ONLINE", "ACTIVE", "STANDBY"][R(0, 2)],
      logs: Array.from({ length: R(5, 10) }, () => `${new Date(Date.now() - R(1000, 60000)).toLocaleTimeString()} | Update Synced...`),
      trend: TECH_TRENDS[skill.id]?.trend || 'stable',
      popularity: TECH_TRENDS[skill.id]?.popularity || 70
  }));

  nodes.forEach((node, i) => {
    const card = document.createElement('div');
    card.className = 'card'; card.dataset.id = node.id; card.dataset.flipId = `card-${i}`; card.dataset.status = node.status;
    gsap.set(card, { x: i * GAP_X, y: BASE_Y, z: i * STEP_Z });

    // --- MEJORA #1: BARRAS DE PROGRESO CIRCULARES ---
    const progressRing = `
      <svg class="progress-ring" viewBox="0 0 100 100">
        <circle class="progress-ring-bg" cx="50" cy="50" r="45"></circle>
        <circle class="progress-ring-fg" cx="50" cy="50" r="45" 
                stroke-dasharray="${2 * Math.PI * 45}" 
                stroke-dashoffset="${2 * Math.PI * 45 * (1 - node.level / 100)}"></circle>
      </svg>
    `;

    // --- MEJORA #3: CONTENEDOR DE PARTÍCULAS ---
    const particlesContainer = `
      <div class="particles-container">
        ${Array.from({length: 8}, (_, j) => 
          `<div class="particle" style="left: ${20 + j * 8}%; top: ${30 + (j % 3) * 20}%; animation-delay: ${j * 0.2}s;"></div>`
        ).join('')}
      </div>
    `;

    // --- NUEVA MEJORA: MINI-CHIPS Y SPARKLINES ---
    const sparkPath = (node) => {
      const points = [];
      const maxPoints = 15;
      for (let i = 0; i < maxPoints; i++) {
        const x = (i / (maxPoints - 1)) * 100;
        const y = 50 + Math.sin(i * 0.5 + node.level * 0.1) * 20 + Math.random() * 10;
        points.push(`${x},${y}`);
      }
      return `M ${points.join(' L ')}`;
    };

    const miniMetrics = `
      <div class="mini-metrics">
        <span class="chip">PRJ ${node.projects}</span>
        <span class="chip">COM ${node.commits.toLocaleString()}</span>
        <svg class="spark" viewBox="0 0 100 24">
          <path d="${sparkPath(node)}"/>
        </svg>
      </div>
    `;

    // --- NUEVA MEJORA: ÓRBITAS DE ENERGÍA ---
    const energyOrbits = `
      <div class="energy-orbit"></div>
    `;

    // --- NUEVA MEJORA: CORONA DE STACK ---
    const stackCorona = node.stack && node.stack.length > 0 ? `
      <div class="stack-corona">
        ${node.stack.slice(0, 6).map((tech, j) => {
          const angle = (j / node.stack.length) * 360;
          const radius = 60;
          const x = 50 + radius * Math.cos(angle * Math.PI / 180);
          const y = 50 + radius * Math.sin(angle * Math.PI / 180);
          return `<div class="stack-icon" style="left: ${x}%; top: ${y}%; animation-delay: ${j * 0.5}s;"></div>`;
        }).join('')}
      </div>
    ` : '';

    // --- NUEVA MEJORA: MINI-BARRAS DE PROGRESO ---
    const miniProgress = `
      <div class="mini-progress">
        <div class="mini-bar">
          <div class="mini-bar-fill" style="width: ${node.level}%"></div>
        </div>
        <div class="mini-bar">
          <div class="mini-bar-fill" style="width: ${parseInt(node.years) * 20}%"></div>
        </div>
        <div class="mini-bar">
          <div class="mini-bar-fill" style="width: ${node.popularity || 70}%"></div>
        </div>
      </div>
    `;

    // --- NUEVA MEJORA: ARCOS ELÉCTRICOS ---
    const electricArcs = `
      ${Array.from({length: 4}, (_, j) => 
        `<div class="electric-arc" style="left: ${25 + j * 15}%; top: ${40 + (j % 2) * 20}%; animation-delay: ${j * 0.3}s;"></div>`
      ).join('')}
    `;

    // --- NUEVA MEJORA: HOLO-SCAN ---
    const holoScan = `
      <div class="holo-scan"></div>
    `;

    // --- NUEVA MEJORA: CARGADOR DE ENERGÍA ---
    const energyCharger = `
      <div class="energy-charger" data-energy="100">
        <svg viewBox="0 0 100 100">
          <circle class="energy-charger-bg" cx="50" cy="50" r="45"></circle>
          <circle class="energy-charger-fill" cx="50" cy="50" r="45" 
                  stroke-dasharray="${2 * Math.PI * 45}" 
                  stroke-dashoffset="${2 * Math.PI * 45 * 0.2}"></circle>
        </svg>
      </div>
    `;

    // --- MEJORA #8: BADGES DE TENDENCIAS ---
    const trendBadge = node.trend !== 'stable' ? 
      `<div class="tech-trend ${node.trend}">${node.trend === 'up' ? '↗' : '↘'} ${node.popularity}%</div>` : '';

    card.innerHTML = `
      ${progressRing}
      ${particlesContainer}
      <div class="card-trail"></div>
      ${holoScan}
      <div class="card-content" data-flip-id="content-${i}">
        <div class="card-header"><div class="card-id">${node.name}</div><div class="card-type">${node.category}</div></div>
        <div class="card-visuals">
          <div class="tech-icon-container">
            <img src="${node.logoUrl}" alt="${node.name} logo">
            ${energyOrbits}
            ${stackCorona}
          </div>
        </div>
        <div class="card-footer">
          <div class="card-footer-row"><span>STATUS</span><span class="status-value status-${node.status}">${node.status}</span></div>
          <div class="card-footer-row"><span>DOMINIO</span><span>${node.level}%</span></div>
          <div class="card-footer-row"><span>AÑOS</span><span>${node.years}</span></div>
        </div>
      </div>
      <div class="card-fader" data-flip-id="fader-${i}"></div>
      ${trendBadge}
      ${miniMetrics}
      ${miniProgress}
      ${electricArcs}
      ${energyCharger}
    `;
    
    pipeline.appendChild(card); cards.push(card);
    
    // --- NUEVA MEJORA: EVENTOS MEJORADOS ---
    card.addEventListener('mouseenter', () => { 
      soundEngine.play('shine'); 
      scene.classList.add('is-card-hovered');
      
      // Activar partículas al hover
      const particles = card.querySelectorAll('.particle');
      particles.forEach(particle => {
        particle.style.animationPlayState = 'running';
      });

      // Activar sinergias
      activateSynergies(card);
    });
    
    card.addEventListener('mouseleave', () => {
      scene.classList.remove('is-card-hovered');
      
      // Pausar partículas al salir
      const particles = card.querySelectorAll('.particle');
      particles.forEach(particle => {
        particle.style.animationPlayState = 'paused';
      });

      // Desactivar sinergias
      deactivateSynergies();
    });
    
    // --- NUEVA MEJORA: TILT MAGNÉTICO OPTIMIZADO ---
    let tiltRAF = 0;
    card.addEventListener('mousemove', (e) => {
      if (tiltRAF) return;
      
      tiltRAF = requestAnimationFrame(() => {
        tiltRAF = 0;
        const rect = card.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const deltaX = e.clientX - centerX;
        const deltaY = e.clientY - centerY;
        
        // Calcular tilt con guardas
        const distance = Math.hypot(deltaX, deltaY) || 1; // evita división por 0
        const tiltX = (deltaY / rect.height) * 10;
        const tiltY = (deltaX / rect.width) * 10;
        
        card.style.setProperty('--tilt-x', `${tiltX}deg`);
        card.style.setProperty('--tilt-y', `${tiltY}deg`);
        card.style.setProperty('--angle', `${Math.atan2(deltaY, deltaX) * (180/Math.PI) + 180}deg`);

        // Cursor magnético con resorte optimizado
        const iconContainer = card.querySelector('.tech-icon-container');
        if (iconContainer) {
          const icon = iconContainer.querySelector('img');
          if (icon) {
            const maxDistance = 50;
            const strength = Math.min(distance / maxDistance, 1);
            
            const moveX = (deltaX / distance) * strength * 10;
            const moveY = (deltaY / distance) * strength * 10;
            
            icon.style.transform = `translate(${moveX}px, ${moveY}px)`;
          }
        }
      });
    });
    
    // --- NUEVA MEJORA: TOUCH TARGETS MÓVILES ---
    card.addEventListener('pointerdown', (e) => {
      const splash = document.createElement('div');
      splash.className = 'touch-splash';
      splash.style.left = (e.clientX - card.getBoundingClientRect().left) + 'px';
      splash.style.top = (e.clientY - card.getBoundingClientRect().top) + 'px';
      splash.style.width = '20px';
      splash.style.height = '20px';
      card.appendChild(splash);
      
      setTimeout(() => {
        if (splash.parentNode) {
          splash.parentNode.removeChild(splash);
        }
      }, 600);

      // Long press para menú radial
      longPressTimer = setTimeout(() => {
        showRadialMenu(e.clientX, e.clientY);
      }, 500);
    });

    card.addEventListener('pointerup', () => {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      }
    });

    card.addEventListener('pointerleave', () => {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      }
    });
    
    card.addEventListener('click', (e) => { 
      e.stopPropagation();
      if (i !== active) {
        setActive(i);
      } else {
        toggleInfoRail(i);
      }
    });
  });

  let active = 0;
  function setActive(idx, instant = false) {
    active = Math.max(0, Math.min(idx, nodes.length - 1));
    if (!instant) soundEngine.play('whoosh');
    gsap.to(pipeline, { x: -(active * GAP_X), z: -(active * STEP_Z), duration: instant ? 0 : 0.8, ease: 'power3.inOut' });
    cards.forEach((c, i) => c.classList.toggle('is-active', i === active));
    btnPrev.disabled = (active === 0); btnNext.disabled = (active === nodes.length - 1);
    
    // Actualizar sinergias después del movimiento
    setTimeout(() => {
      updateAllSynergyLines();
    }, instant ? 0 : 800);
  }

  let logInterval;
  function openPanel(index) {
    if (isPanelOpen) return;
    isPanelOpen = true; soundEngine.play('open');
    const card = cards[index]; const node = nodes[index];
    
    // Consumir energía al abrir panel
    consumeEnergy(card);
    
    // Añadir a tarjetas abiertas para set bonus
    openCards.add(node.id);
    checkSetBonus();
    
    holopanelContainer.innerHTML = `
      <button class="holopanel-close" id="holopanel-close-inner">&times;</button>
      <div class="holopanel-header">
        <h2 data-flip-id="id-${index}">${node.name} &mdash; ${node.category}</h2>
        <div class="holopanel-tabs">
          <button class="holopanel-tab is-active" data-tab="overview">Resumen</button>
          <button class="holopanel-tab" data-tab="technical">Técnico</button>
          <button class="holopanel-tab" data-tab="experience">Experiencia</button>
          <button class="holopanel-tab" data-tab="benchmarks">Benchmarks</button>
          <button class="holopanel-tab" data-tab="compatibility">Compatibilidad</button>
          <button class="holopanel-tab" data-tab="future">Futuro</button>
          <button class="holopanel-tab" data-tab="changelog">Changelog</button>
          <button class="holopanel-tab" data-tab="logs">Registros</button>
        </div>
      </div>
      <div class="holopanel-body">
        <!-- Overview Page -->
        <div id="page-overview" class="holopanel-page is-active">
          <div class="modal-layout">
            <aside class="modal-sidebar">
              <img src="${node.logoUrl}" class="modal-logo" alt="${node.name} logo"/>
              <div class="mastery-ring-container">
                <svg class="mastery-ring-svg" viewBox="0 0 100 100">
                  <circle class="mastery-ring-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="mastery-ring-fg" cx="50" cy="50" r="45"></circle>
                </svg>
                <div class="mastery-percentage">0%</div>
              </div>
              <dl class="sidebar-stat"><dt>Experiencia</dt><dd>${node.years}</dd></dl>
              <dl class="sidebar-stat"><dt>Proyectos</dt><dd>${node.projects}</dd></dl>
              <dl class="sidebar-stat"><dt>Commits</dt><dd>${node.commits.toLocaleString()}</dd></dl>
              
              <!-- NUEVA MEJORA: PANEL LATERAL CON CTAs --- -->
              <div class="sidebar-ctas">
                <button class="cta-btn" onclick="window.open('https://docs.example.com/${node.id}', '_blank')">
                  <span>📚</span> Docs
                </button>
                <button class="cta-btn" onclick="window.open('https://github.com/example/${node.id}', '_blank')">
                  <span>🔗</span> Repo
                </button>
                <button class="cta-btn" onclick="copySnippet('${node.id}')">
                  <span>📋</span> Snippet
                </button>
                <button class="cta-btn" onclick="openDemo('${node.id}')">
                  <span>🎯</span> Demo
                </button>
              </div>
            </aside>
            <main class="modal-main-content">
              <section class="modal-section">
                <h3>Descripción</h3>
                <p class="description-text">${node.description}</p>
              </section>
              <section class="modal-section">
                <h3>Métricas de Rendimiento</h3>
                <div class="performance-grid">
                  <div class="performance-item">
                    <span class="performance-label">Lighthouse</span>
                    <div class="performance-bar">
                      <div class="performance-fill" style="width: ${node.performance.lighthouse}%"></div>
                    </div>
                    <span class="performance-value">${node.performance.lighthouse}%</span>
                  </div>
                  <div class="performance-item">
                    <span class="performance-label">SEO</span>
                    <div class="performance-bar">
                      <div class="performance-fill" style="width: ${node.performance.seo}%"></div>
                    </div>
                    <span class="performance-value">${node.performance.seo}%</span>
                  </div>
                  <div class="performance-item">
                    <span class="performance-label">Accesibilidad</span>
                    <div class="performance-bar">
                      <div class="performance-fill" style="width: ${node.performance.accessibility}%"></div>
                    </div>
                    <span class="performance-value">${node.performance.accessibility}%</span>
                  </div>
                  <div class="performance-item">
                    <span class="performance-label">Mejores Prácticas</span>
                    <div class="performance-bar">
                      <div class="performance-fill" style="width: ${node.performance.bestPractices}%"></div>
                    </div>
                    <span class="performance-value">${node.performance.bestPractices}%</span>
                  </div>
                </div>
              </section>
            </main>
          </div>
        </div>

        <!-- Technical Page -->
        <div id="page-technical" class="holopanel-page">
          <div class="technical-content">
            <section class="modal-section">
              <h3>Información Técnica</h3>
              <div class="tech-grid">
                <div class="tech-card">
                  <h4>Versiones Utilizadas</h4>
                  <div class="tech-tags">
                    ${node.versions.map(v => `<span class="tech-tag">${v}</span>`).join('')}
                  </div>
                </div>
                <div class="tech-card">
                  <h4>Frameworks</h4>
                  <div class="tech-tags">
                    ${node.frameworks.map(f => `<span class="tech-tag">${f}</span>`).join('')}
                  </div>
                </div>
                <div class="tech-card">
                  <h4>Librerías</h4>
                  <div class="tech-tags">
                    ${node.libraries.map(l => `<span class="tech-tag">${l}</span>`).join('')}
                  </div>
                </div>
                <div class="tech-card">
                  <h4>Patrones de Diseño</h4>
                  <div class="tech-tags">
                    ${node.patterns.map(p => `<span class="tech-tag">${p}</span>`).join('')}
                  </div>
                </div>
              </div>
            </section>
            <section class="modal-section">
              <h3>Stack Tecnológico</h3>
              <div class="stack-grid">
                <div class="stack-item">
                  <h4>Herramientas</h4>
                  <div class="tech-tags">
                    ${node.tools.map(t => `<span class="tech-tag">${t}</span>`).join('')}
                  </div>
                </div>
                <div class="stack-item">
                  <h4>Bases de Datos</h4>
                  <div class="tech-tags">
                    ${node.databases.map(d => `<span class="tech-tag">${d}</span>`).join('')}
                  </div>
                </div>
                <div class="stack-item">
                  <h4>Tecnologías Relacionadas</h4>
                  <div class="tech-tags">
                    ${node.stack.map(s => `<span class="tech-tag">${s}</span>`).join('')}
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- Experience Page -->
        <div id="page-experience" class="holopanel-page">
          <div class="experience-content">
            <section class="modal-section">
              <h3>Certificaciones y Logros</h3>
              <div class="achievements-grid">
                <div class="achievement-card">
                  <h4>Certificaciones</h4>
                  <ul class="achievement-list">
                    ${node.certifications.map(c => `<li>${c}</li>`).join('')}
                  </ul>
                </div>
                <div class="achievement-card">
                  <h4>Logros Destacados</h4>
                  <ul class="achievement-list">
                    ${node.achievements.map(a => `<li>${a}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </section>
            <section class="modal-section">
              <h3>Experiencia Profesional</h3>
              <div class="experience-grid">
                <div class="experience-item">
                  <h4>Empresas</h4>
                  <div class="tech-tags">
                    ${node.experience.companies.map(c => `<span class="tech-tag">${c}</span>`).join('')}
                  </div>
                </div>
                <div class="experience-item">
                  <h4>Roles</h4>
                  <div class="tech-tags">
                    ${node.experience.roles.map(r => `<span class="tech-tag">${r}</span>`).join('')}
                  </div>
                </div>
                <div class="experience-item">
                  <h4>Metodologías</h4>
                  <div class="tech-tags">
                    ${node.experience.methodologies.map(m => `<span class="tech-tag">${m}</span>`).join('')}
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- Benchmarks Page -->
        <div id="page-benchmarks" class="holopanel-page">
          <div class="benchmarks-content">
            <section class="modal-section">
              <h3>Benchmarks de Rendimiento</h3>
              <div class="benchmarks-grid">
                <div class="benchmark-card">
                  <h4>Velocidad de Carga</h4>
                  <div class="benchmark-chart">
                    <div class="benchmark-bar" style="height: ${node.performance.lighthouse}%">
                      <span class="benchmark-value">${node.performance.lighthouse}ms</span>
                    </div>
                  </div>
                </div>
                <div class="benchmark-card">
                  <h4>Optimización</h4>
                  <div class="benchmark-chart">
                    <div class="benchmark-bar" style="height: ${node.performance.bestPractices}%">
                      <span class="benchmark-value">${node.performance.bestPractices}%</span>
                    </div>
                  </div>
                </div>
                <div class="benchmark-card">
                  <h4>Eficiencia</h4>
                  <div class="benchmark-chart">
                    <div class="benchmark-bar" style="height: ${node.performance.seo}%">
                      <span class="benchmark-value">${node.performance.seo}%</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- Compatibility Page -->
        <div id="page-compatibility" class="holopanel-page">
          <div class="compatibility-content">
            <section class="modal-section">
              <h3>Compatibilidad de Navegadores</h3>
              <div class="browser-grid">
                <div class="browser-item">
                  <span class="browser-icon">🌐</span>
                  <span class="browser-name">Chrome</span>
                  <span class="browser-version">${node.versions[0] || 'Latest'}</span>
                </div>
                <div class="browser-item">
                  <span class="browser-icon">🦊</span>
                  <span class="browser-name">Firefox</span>
                  <span class="browser-version">${node.versions[0] || 'Latest'}</span>
                </div>
                <div class="browser-item">
                  <span class="browser-icon">🦁</span>
                  <span class="browser-name">Safari</span>
                  <span class="browser-version">${node.versions[0] || 'Latest'}</span>
                </div>
                <div class="browser-item">
                  <span class="browser-icon">⚡</span>
                  <span class="browser-name">Edge</span>
                  <span class="browser-version">${node.versions[0] || 'Latest'}</span>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- Future Page -->
        <div id="page-future" class="holopanel-page">
          <div class="future-content">
            <section class="modal-section">
              <h3>Recursos de Aprendizaje</h3>
              <div class="learning-grid">
                <div class="learning-item">
                  <h4>Recursos Principales</h4>
                  <ul class="learning-list">
                    ${node.learning.resources.map(r => `<li>${r}</li>`).join('')}
                  </ul>
                </div>
                <div class="learning-item">
                  <h4>Blogs y Comunidades</h4>
                  <ul class="learning-list">
                    ${node.learning.blogs.map(b => `<li>${b}</li>`).join('')}
                  </ul>
                </div>
                <div class="learning-item">
                  <h4>Conferencias</h4>
                  <ul class="learning-list">
                    ${node.learning.conferences.map(c => `<li>${c}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </section>
            <section class="modal-section">
              <h3>Visión de Futuro</h3>
              <div class="future-grid">
                <div class="future-item">
                  <h4>Tendencias Actuales</h4>
                  <div class="tech-tags">
                    ${node.future.trends.map(t => `<span class="tech-tag">${t}</span>`).join('')}
                  </div>
                </div>
                <div class="future-item">
                  <h4>Roadmap Personal</h4>
                  <ul class="future-list">
                    ${node.future.roadmap.map(r => `<li>${r}</li>`).join('')}
                  </ul>
                </div>
                <div class="future-item">
                  <h4>Tecnologías Emergentes</h4>
                  <div class="tech-tags">
                    ${node.future.emerging.map(e => `<span class="tech-tag">${e}</span>`).join('')}
                  </div>
                </div>
                <div class="future-item">
                  <h4>Objetivos</h4>
                  <ul class="future-list">
                    ${node.future.goals.map(g => `<li>${g}</li>`).join('')}
                  </ul>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- Changelog Page -->
        <div id="page-changelog" class="holopanel-page">
          <div class="changelog-content">
            <section class="modal-section">
              <h3>Historial de Cambios</h3>
              <div class="changelog-timeline">
                ${Array.from({length: 10}, (_, j) => {
                  const date = new Date(Date.now() - j * 86400000);
                  const changes = ['Mejora de rendimiento', 'Nueva funcionalidad', 'Corrección de bugs', 'Actualización de dependencias'][j % 4];
                  return `
                    <div class="changelog-entry">
                      <div class="changelog-date">${date.toLocaleDateString()}</div>
                      <div class="changelog-content">
                        <h4>v${node.versions[0] || '1.0'}.${j + 1}</h4>
                        <p>${changes}</p>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </section>
          </div>
        </div>

        <!-- Logs Page -->
        <div id="page-logs" class="holopanel-page">
          <div class="log-container">${node.logs.map(log => `<div class="log-entry">${log}</div>`).join('')}</div>
        </div>
      </div>`;
    
    const state = Flip.getState([card.querySelector('.card-content'), backdrop]);
    holopanel.classList.add('is-open'); scene.classList.add('is-panel-open'); card.classList.add('card-fader');
    
    Flip.from(state, {
      duration: 0.6, ease: 'power2.inOut', absolute: true,
      onComplete: () => {
        // --- MEJORA: ANIMACIONES DE DATOS AL ABRIR EL MODAL ---
        const ringFg = holopanelContainer.querySelector('.mastery-ring-fg');
        const percentageText = holopanelContainer.querySelector('.mastery-percentage');
        const animatedNumbers = holopanelContainer.querySelectorAll('.animated-number');
        const radius = ringFg.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        
        activeModalAnimations = gsap.timeline({ delay: 0.2 });
        
        activeModalAnimations.fromTo(ringFg, 
          { strokeDasharray: circumference, strokeDashoffset: circumference },
          { strokeDashoffset: circumference * (1 - node.level / 100), duration: 1.2, ease: 'power2.out' }
        );
        
        activeModalAnimations.to({ val: 0 }, {
          val: node.level, duration: 1.2, ease: 'power2.out',
          onUpdate: function() { percentageText.textContent = `${Math.round(this.targets()[0].val)}%`; }
        }, '<');
        
        animatedNumbers.forEach(el => {
          activeModalAnimations.from(el, {
            textContent: 0, duration: 1, ease: 'power1.inOut',
            snap: { textContent: 1 },
            onUpdate: function() {
              this.targets()[0].textContent = parseInt(this.targets()[0].textContent).toLocaleString('en-US');
            }
          }, "-=0.8");
        });

        // Lógica de logs y pestañas
        const logContainer = document.querySelector('.log-container');
        logContainer.scrollTop = logContainer.scrollHeight;
        logInterval = setInterval(() => { /* ... (log interval sin cambios) ... */ }, 3000);
      }
    });

    const tabs = holopanelContainer.querySelectorAll('.holopanel-tab');
    const pages = holopanelContainer.querySelectorAll('.holopanel-page');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const targetPage = document.getElementById(`page-${tab.dataset.tab}`);
        tabs.forEach(t => t.classList.remove('is-active')); 
        tab.classList.add('is-active');
        pages.forEach(p => p.classList.remove('is-active')); 
        targetPage.classList.add('is-active');
        
        // Animar las barras de rendimiento cuando se abre la página overview
        if (tab.dataset.tab === 'overview') {
          setTimeout(() => {
            const performanceFills = targetPage.querySelectorAll('.performance-fill');
            performanceFills.forEach(fill => {
              const width = fill.style.width;
              fill.style.width = '0%';
              setTimeout(() => {
                fill.style.width = width;
              }, 100);
            });
          }, 300);
        }
      });
    });

    document.getElementById('holopanel-close-inner').addEventListener('click', () => closePanel(index));
  }

  function closePanel(index) {
    if (!isPanelOpen) return;
    isPanelOpen = false; clearInterval(logInterval);
    if (activeModalAnimations) activeModalAnimations.kill(); // Detener animaciones del modal
    const card = cards[index];
    const node = nodes[index];
    
    // Remover de tarjetas abiertas
    openCards.delete(node.id);
    checkSetBonus();
    
    const state = Flip.getState([holopanelContainer, backdrop], { props: "opacity, transform" });
    holopanel.classList.remove('is-open');
    Flip.to(state, {
      duration: 0.4, ease: 'power2.in', scale: true,
      onComplete: () => {
        holopanelContainer.innerHTML = '';
        scene.classList.remove('is-panel-open');
        card.classList.remove('card-fader');
      }
    });
  }

  btnNext.addEventListener('click', () => { soundEngine.play('click'); setActive(active + 1); });
  btnPrev.addEventListener('click', () => { soundEngine.play('click'); setActive(active - 1); });
  btnMute.addEventListener('click', () => soundEngine.toggleMute());
  backdrop.addEventListener('click', () => closePanel(active));

  // --- MEJORA #4: FUNCIONES DE ESTADÍSTICAS ---
  function updateStats() {
    const totalSkills = nodes.length;
    const totalProjects = nodes.reduce((sum, node) => sum + node.projects, 0);
    const totalCommits = nodes.reduce((sum, node) => sum + node.commits, 0);
    const avgLevel = Math.round(nodes.reduce((sum, node) => sum + node.level, 0) / totalSkills);

    document.getElementById('total-skills').textContent = totalSkills;
    document.getElementById('total-projects').textContent = totalProjects.toLocaleString();
    document.getElementById('total-commits').textContent = totalCommits.toLocaleString();
    document.getElementById('avg-level').textContent = `${avgLevel}%`;

    // Gráfico de categorías
    const categoryChart = document.getElementById('category-chart');
    const categories = {};
    nodes.forEach(node => {
      categories[node.category] = (categories[node.category] || 0) + 1;
    });

    categoryChart.innerHTML = Object.entries(categories).map(([cat, count]) => 
      `<div class="chart-bar" style="height: ${(count / totalSkills) * 100}%;" data-label="${cat}"></div>`
    ).join('');

    // Gráfico de niveles
    const levelChart = document.getElementById('level-chart');
    const levels = { '90-100': 0, '80-89': 0, '70-79': 0, '60-69': 0 };
    nodes.forEach(node => {
      if (node.level >= 90) levels['90-100']++;
      else if (node.level >= 80) levels['80-89']++;
      else if (node.level >= 70) levels['70-79']++;
      else levels['60-69']++;
    });

    levelChart.innerHTML = Object.entries(levels).map(([range, count]) => 
      `<div class="chart-bar" style="height: ${(count / totalSkills) * 100}%;" data-label="${range}"></div>`
    ).join('');
  }

  function toggleStats() {
    isStatsOpen = !isStatsOpen;
    if (isStatsOpen) {
      statsPanel.classList.add('is-open');
      updateStats();
      soundEngine.play('open');
    } else {
      statsPanel.classList.remove('is-open');
      soundEngine.play('click');
    }
  }

  // --- MEJORA #6: FUNCIONES DE INTERACTIVIDAD AVANZADA ---
  function showTouchIndicator(x, y) {
    touchIndicator.style.left = x + 'px';
    touchIndicator.style.top = y + 'px';
    touchIndicator.classList.add('is-active');
    setTimeout(() => touchIndicator.classList.remove('is-active'), 600);
  }

  function toggleVoiceCommands() {
    isVoiceActive = !isVoiceActive;
    voiceCommand.classList.toggle('is-active', isVoiceActive);
    
    if (isVoiceActive) {
      voiceCommand.textContent = 'Escuchando...';
      // Simulación de reconocimiento de voz
      setTimeout(() => {
        if (isVoiceActive) {
          voiceCommand.textContent = 'Comando: "Siguiente"';
          setTimeout(() => {
            if (isVoiceActive) {
              setActive(active + 1);
              voiceCommand.classList.remove('is-active');
              isVoiceActive = false;
            }
          }, 1000);
        }
      }, 2000);
    }
  }

  // Gestos táctiles
  let touchStartX = 0;
  let touchStartY = 0;

  document.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
    showTouchIndicator(touchStartX, touchStartY);
  });

  document.addEventListener('touchend', (e) => {
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    const deltaX = touchEndX - touchStartX;
    const deltaY = touchEndY - touchStartY;

    if (Math.abs(deltaX) > Math.abs(deltaY)) {
      if (deltaX > 50 && !btnPrev.disabled) setActive(active - 1);
      else if (deltaX < -50 && !btnNext.disabled) setActive(active + 1);
    } else {
      if (deltaY < -50) openPanel(active);
    }
  });

  // --- MEJORA #8: FUNCIONES DE INTEGRACIÓN DE DATOS ---
  function syncExternalData() {
    dataSync.classList.add('is-active');
    dataSync.innerHTML = '<div>Sincronizando con GitHub...</div>';

    // Simulación de sincronización con APIs externas
    setTimeout(() => {
      dataSync.classList.add('success');
      dataSync.innerHTML = '<div>✓ Datos actualizados</div>';
      
      // Simular actualización de datos
      nodes.forEach(node => {
        if (TECH_TRENDS[node.id]) {
          node.popularity = TECH_TRENDS[node.id].popularity;
          node.trend = TECH_TRENDS[node.id].trend;
        }
      });

      setTimeout(() => {
        dataSync.classList.remove('is-active', 'success');
      }, 3000);
    }, 2000);
  }

  // Event listeners adicionales
  statsToggle.addEventListener('click', toggleStats);
  statsClose.addEventListener('click', toggleStats);
  
  window.addEventListener('keydown', (e) => {
    if (isPanelOpen) { if (e.key === 'Escape') closePanel(active); return; }
    if (isStatsOpen) { if (e.key === 'Escape') toggleStats(); return; }
    
    if (e.code === 'ArrowRight' && !btnNext.disabled) setActive(active + 1);
    if (e.code === 'ArrowLeft' && !btnPrev.disabled) setActive(active - 1);
    if (e.key === 'Enter') openPanel(active);
    if (e.key.toLowerCase() === 'v') toggleVoiceCommands();
    if (e.key.toLowerCase() === 's') toggleStats();
    if (e.key.toLowerCase() === 'r') syncExternalData();
  });
  
  let mouseX = 0, mouseY = 0;
  window.addEventListener('mousemove', (e) => {
    mouseX = (e.clientX / window.innerWidth - 0.5); mouseY = (e.clientY / window.innerHeight - 0.5);
  }, { passive: true });

  gsap.ticker.add(() => {
    gsap.to(scene, { rotationX: 25 + mouseY * 10, rotationY: -20 + mouseX * 15, duration: 1, ease: 'power1.out' });
  });
  
  setActive(Math.floor(nodes.length / 2), true);

  // --- INICIALIZACIÓN DE NUEVAS FUNCIONALIDADES ---
  
  // Sincronización inicial de datos
  setTimeout(() => {
    syncExternalData();
  }, 1000);

  // Animación de partículas para tarjetas activas
  setInterval(() => {
    cards.forEach((card, i) => {
      if (i === active) {
        const particles = card.querySelectorAll('.particle');
        particles.forEach(particle => {
          particle.style.animationDelay = `${Math.random() * 2}s`;
        });
      }
    });
  }, 3000);

  // Actualización automática de estadísticas
  setInterval(() => {
    if (isStatsOpen) {
      updateStats();
    }
  }, 5000);

  // --- NUEVAS FUNCIONES PARA EL MODAL ---
  function copySnippet(techId) {
    const node = nodes.find(n => n.id === techId);
    if (!node) return;
    
    const snippet = `// ${node.name} - ${node.category}
// Nivel: ${node.level}% | Experiencia: ${node.years}
// Proyectos: ${node.projects} | Commits: ${node.commits.toLocaleString()}

// Ejemplo de uso básico
console.log('${node.name} está activo');`;
    
    navigator.clipboard.writeText(snippet).then(() => {
      showToast('Snippet copiado al portapapeles', 'success');
    }).catch(() => {
      showToast('Error al copiar snippet', 'error');
    });
  }

  function openDemo(techId) {
    const node = nodes.find(n => n.id === techId);
    if (!node) return;
    
    // Simular apertura de demo
    showToast(`Abriendo demo de ${node.name}...`, 'info');
    setTimeout(() => {
      window.open(`https://demo.example.com/${techId}`, '_blank');
    }, 1000);
  }

  function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    toast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(10, 12, 22, 0.9);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 12px 16px;
      color: var(--accent);
      font-family: 'Roboto Mono', monospace;
      font-size: 12px;
      z-index: 10000;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
    `;
    
    document.body.appendChild(toast);
    
    // Animar entrada
    setTimeout(() => {
      toast.style.opacity = '1';
      toast.style.transform = 'translateX(0)';
    }, 100);
    
    // Remover después de 3 segundos
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, 3000);
  }

  // --- MEJORA: COMANDOS DE VOZ MEJORADOS ---
  function setupVoiceCommands() {
    const commands = {
      'abrir': (tech) => {
        const techNode = nodes.find(n => n.name.toLowerCase().includes(tech.toLowerCase()));
        if (techNode) {
          const index = nodes.indexOf(techNode);
          setActive(index);
          openPanel(index);
          showToast(`Abriendo ${techNode.name}`, 'success');
        } else {
          showToast(`Tecnología ${tech} no encontrada`, 'error');
        }
      },
      'siguiente': () => {
        if (!btnNext.disabled) {
          setActive(active + 1);
          showToast('Siguiente tecnología', 'info');
        }
      },
      'anterior': () => {
        if (!btnPrev.disabled) {
          setActive(active - 1);
          showToast('Tecnología anterior', 'info');
        }
      },
      'estadísticas': () => {
        toggleStats();
        showToast('Panel de estadísticas', 'info');
      }
    };

    // Simulación de reconocimiento de voz
    window.voiceCommands = commands;
  }

  // --- MEJORA: ANIMACIONES DE BARRAS MEJORADAS ---
  function animateBars(container) {
    const bars = container.querySelectorAll('.performance-fill, .benchmark-bar');
    bars.forEach((bar, index) => {
      const width = bar.style.width || bar.style.height;
      bar.style.width = '0%';
      bar.style.height = '0%';
      
      setTimeout(() => {
        bar.style.width = width;
        bar.style.height = width;
      }, index * 100);
    });
  }

  // --- MEORA: MASTERY RING RESPIRATORIO ---
  function setupBreathingRing() {
    setInterval(() => {
      const rings = document.querySelectorAll('.mastery-ring-fg');
      rings.forEach(ring => {
        const currentOffset = parseFloat(ring.style.strokeDashoffset || 0);
        const newOffset = currentOffset + (Math.random() - 0.5) * 10;
        ring.style.strokeDashoffset = newOffset;
      });
    }, 3000);
  }

  // --- NUEVAS FUNCIONALIDADES AVANZADAS ---

  // --- RED DE SINERGIAS ---
  const synergyConnections = [
    { from: 'react', to: 'javascript', strength: 0.9 },
    { from: 'react', to: 'typescript', strength: 0.8 },
    { from: 'javascript', to: 'nodejs', strength: 0.7 },
    { from: 'python', to: 'django', strength: 0.8 },
    { from: 'html5', to: 'css3', strength: 0.9 },
    { from: 'css3', to: 'javascript', strength: 0.6 },
    { from: 'nodejs', to: 'mongodb', strength: 0.7 },
    { from: 'docker', to: 'aws', strength: 0.6 },
    { from: 'git', to: 'github', strength: 0.8 },
    { from: 'threejs', to: 'javascript', strength: 0.7 },
    { from: 'gsap', to: 'javascript', strength: 0.6 }
  ];

  function createSynergyNetwork() {
    const network = document.createElement('div');
    network.className = 'synergy-network';
    pipeline.appendChild(network);

    synergyConnections.forEach(connection => {
      const fromCard = cards.find(card => card.dataset.id === connection.from);
      const toCard = cards.find(card => card.dataset.id === connection.to);
      
      if (fromCard && toCard) {
        const line = document.createElement('div');
        line.className = 'synergy-line';
        line.dataset.from = connection.from;
        line.dataset.to = connection.to;
        line.dataset.strength = connection.strength;
        network.appendChild(line);
        
        updateSynergyLine(line, fromCard, toCard, connection.strength);
      }
    });
  }

  function updateSynergyLine(line, fromCard, toCard, strength) {
    const fromRect = fromCard.getBoundingClientRect();
    const toRect = toCard.getBoundingClientRect();
    const pipelineRect = pipeline.getBoundingClientRect();

    const fromX = fromRect.left + fromRect.width / 2 - pipelineRect.left;
    const fromY = fromRect.top + fromRect.height / 2 - pipelineRect.top;
    const toX = toRect.left + toRect.width / 2 - pipelineRect.left;
    const toY = toRect.top + toRect.height / 2 - pipelineRect.top;

    const distance = Math.sqrt((toX - fromX) ** 2 + (toY - fromY) ** 2);
    const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;

    line.style.width = `${distance}px`;
    line.style.left = `${fromX}px`;
    line.style.top = `${fromY}px`;
    line.style.transform = `rotate(${angle}deg)`;
    line.style.opacity = strength * 0.3;
  }

  function activateSynergies(card) {
    const cardId = card.dataset.id;
    const lines = document.querySelectorAll('.synergy-line');
    
    lines.forEach(line => {
      if (line.dataset.from === cardId || line.dataset.to === cardId) {
        line.classList.add('hover');
      } else {
        line.classList.remove('hover');
      }
    });
  }

  function deactivateSynergies() {
    const lines = document.querySelectorAll('.synergy-line');
    lines.forEach(line => {
      line.classList.remove('hover');
    });
  }

  function updateAllSynergyLines() {
    const lines = document.querySelectorAll('.synergy-line');
    lines.forEach(line => {
      const fromCard = cards.find(card => card.dataset.id === line.dataset.from);
      const toCard = cards.find(card => card.dataset.id === line.dataset.to);
      const strength = parseFloat(line.dataset.strength);
      
      if (fromCard && toCard) {
        updateSynergyLine(line, fromCard, toCard, strength);
      }
    });
  }

  // --- SET BONUSES ---
  let openCards = new Set();

  function checkSetBonus() {
    const categories = {};
    openCards.forEach(cardId => {
      const node = nodes.find(n => n.id === cardId);
      if (node) {
        categories[node.category] = (categories[node.category] || 0) + 1;
      }
    });

    // Aplicar bonus si hay 2+ tarjetas del mismo stack
    Object.entries(categories).forEach(([category, count]) => {
      if (count >= 2) {
        cards.forEach(card => {
          const node = nodes.find(n => n.id === card.dataset.id);
          if (node && node.category === category) {
            card.classList.add('set-bonus');
          }
        });
      }
    });
  }

  // --- CARGADOR DE ENERGÍA ---
  function setupEnergyChargers() {
    const chargers = document.querySelectorAll('.energy-charger');
    
    chargers.forEach(charger => {
      let energy = 100;
      const fill = charger.querySelector('.energy-charger-fill');
      
      // Observador de intersección para recarga
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && energy < 100) {
            charger.classList.add('charging');
            rechargeEnergy(charger, fill);
          } else {
            charger.classList.remove('charging');
          }
        });
      }, { threshold: 0.5 });

      observer.observe(charger);
    });
  }

  function rechargeEnergy(charger, fill) {
    let energy = parseInt(charger.dataset.energy) || 0;
    const interval = setInterval(() => {
      energy = Math.min(energy + 2, 100);
      charger.dataset.energy = energy;
      
      const circumference = 2 * Math.PI * 45;
      const offset = circumference * (1 - energy / 100);
      fill.style.strokeDashoffset = offset;
      
      if (energy >= 100) {
        clearInterval(interval);
        charger.classList.remove('charging');
      }
    }, 100);
  }

  function consumeEnergy(card) {
    const charger = card.querySelector('.energy-charger');
    if (charger) {
      let energy = parseInt(charger.dataset.energy) || 100;
      energy = Math.max(energy - 20, 0);
      charger.dataset.energy = energy;
      
      const fill = charger.querySelector('.energy-charger-fill');
      const circumference = 2 * Math.PI * 45;
      const offset = circumference * (1 - energy / 100);
      fill.style.strokeDashoffset = offset;
      
      if (energy < 30) {
        charger.classList.add('low');
      } else {
        charger.classList.remove('low');
      }
    }
  }

  // --- MENÚ RADIAL MÓVIL ---
  let radialMenu = null;
  let longPressTimer = null;

  function setupRadialMenu() {
    radialMenu = document.createElement('div');
    radialMenu.className = 'radial-menu';
    radialMenu.innerHTML = `
      <div class="radial-menu-item" data-action="open">📖</div>
      <div class="radial-menu-item" data-action="compare">⚖️</div>
      <div class="radial-menu-item" data-action="docs">📚</div>
      <div class="radial-menu-item" data-action="demo">🎯</div>
    `;
    document.body.appendChild(radialMenu);

    // Event listeners para menú radial
    radialMenu.addEventListener('click', (e) => {
      const action = e.target.dataset.action;
      if (action) {
        handleRadialAction(action);
        hideRadialMenu();
      }
    });
  }

  function showRadialMenu(x, y) {
    radialMenu.style.left = x + 'px';
    radialMenu.style.top = y + 'px';
    radialMenu.classList.add('active');
  }

  function hideRadialMenu() {
    radialMenu.classList.remove('active');
  }

  function handleRadialAction(action) {
    const activeCard = cards[active];
    const node = nodes[active];
    
    switch (action) {
      case 'open':
        openPanel(active);
        break;
      case 'compare':
        showToast('Modo comparación activado', 'info');
        break;
      case 'docs':
        window.open(`https://docs.example.com/${node.id}`, '_blank');
        break;
      case 'demo':
        window.open(`https://demo.example.com/${node.id}`, '_blank');
        break;
    }
  }

  // --- EDGE-SWIPE PARA STATS ---
  function setupEdgeSwipe() {
    const indicator = document.createElement('div');
    indicator.className = 'edge-swipe-indicator';
    document.body.appendChild(indicator);

    let startX = 0;
    let startY = 0;

    document.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });

    document.addEventListener('touchmove', (e) => {
      const currentX = e.touches[0].clientX;
      const currentY = e.touches[0].clientY;
      const deltaX = currentX - startX;
      const deltaY = currentY - startY;

      // Detectar swipe desde el borde derecho
      if (startX > window.innerWidth - 50 && deltaX < -50 && Math.abs(deltaY) < 100) {
        indicator.classList.add('active');
        setTimeout(() => {
          toggleStats();
          indicator.classList.remove('active');
        }, 300);
      }
    });
  }

  // --- MODO DEV ---
  let devMode = false;

  function setupDevMode() {
    const devIndicator = document.createElement('div');
    devIndicator.className = 'dev-mode';
    devIndicator.innerHTML = 'DEV MODE';
    document.body.appendChild(devIndicator);

    // Tap con dos dedos para activar modo dev
    let touchCount = 0;
    let touchTimer = null;

    document.addEventListener('touchstart', (e) => {
      touchCount++;
      if (touchCount === 2) {
        clearTimeout(touchTimer);
        devMode = !devMode;
        devIndicator.classList.toggle('active', devMode);
        showToast(`Modo Dev ${devMode ? 'activado' : 'desactivado'}`, 'info');
        touchCount = 0;
      } else {
        touchTimer = setTimeout(() => {
          touchCount = 0;
        }, 300);
      }
    });
  }

  // --- DEPTH PARALLAX ---
  function setupDepthParallax() {
    document.addEventListener('mousemove', (e) => {
      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        const deltaX = (e.clientX - centerX) / window.innerWidth;
        const deltaY = (e.clientY - centerY) / window.innerHeight;
        
        // Aplicar parallax a diferentes capas
        const header = card.querySelector('.card-header');
        const iconContainer = card.querySelector('.tech-icon-container');
        const footer = card.querySelector('.card-footer');
        const metrics = card.querySelector('.mini-metrics');
        const progress = card.querySelector('.mini-progress');
        
        if (header) header.style.transform = `translateZ(20px) translateX(${deltaX * 5}px) translateY(${deltaY * 5}px)`;
        if (iconContainer) iconContainer.style.transform = `translateZ(40px) translateX(${deltaX * 10}px) translateY(${deltaY * 10}px)`;
        if (footer) footer.style.transform = `translateZ(10px) translateX(${deltaX * 3}px) translateY(${deltaY * 3}px)`;
        if (metrics) metrics.style.transform = `translateZ(30px) translateX(${deltaX * 8}px) translateY(${deltaY * 8}px)`;
        if (progress) progress.style.transform = `translateZ(15px) translateX(${deltaX * 4}px) translateY(${deltaY * 4}px)`;
      });
    });
  }

  // --- INICIALIZACIÓN DE NUEVAS FUNCIONALIDADES ---
  function initializeAdvancedFeatures() {
    createSynergyNetwork();
    setupEnergyChargers();
    setupRadialMenu();
    setupEdgeSwipe();
    setupDevMode();
    setupDepthParallax();
  }

  // Inicializar nuevas funcionalidades
  setupVoiceCommands();
  setupBreathingRing();
  initializeAdvancedFeatures();

  console.log('🚀 HUD Mejorado Cargado con Éxito!');
  console.log('✨ Nuevas Funcionalidades:');
  console.log('   • Indicadores de Progreso Visual');
  console.log('   • Animaciones de Partículas');
  console.log('   • Panel de Estadísticas Globales');
  console.log('   • Interactividad Avanzada (Gestos/Voz)');
  console.log('   • Integración de Datos Externos');
  console.log('   • Mini-chips y Sparklines');
  console.log('   • Órbitas de Energía');
  console.log('   • Corona de Stack');
  console.log('   • Bloom Espectral');
  console.log('   • Tilt Magnético y Holo-scan');
  console.log('   • Temas por Tecnología');
  console.log('   • Touch Targets Móviles');
  console.log('   • Arcos Eléctricos');
  console.log('   • Modal Mejorado con Nuevas Pestañas');
  console.log('   • Comandos de Voz Avanzados');
  console.log('   • Anillo Respiratorio');
  console.log('   🆕 RED DE SINERGIAS - Líneas que conectan tecnologías afines');
  console.log('   🆕 SET BONUSES - Aura global cuando se abren 2-3 tarjetas del mismo stack');
  console.log('   🆕 CURSOR MAGNÉTICO - Ícono sigue al puntero con física de resorte');
  console.log('   🆕 DEPTH PARALLAX - Capas internas con diferentes translateZ');
  console.log('   🆕 CARGADOR DE ENERGÍA - Depósito que se vacía/recarga');
  console.log('   🆕 MENÚ RADIAL MÓVIL - Long-press para acciones rápidas');
  console.log('   🆕 EDGE-SWIPE - Swipe desde borde para abrir stats');
  console.log('   🆕 MODO DEV - Tap con dos dedos para modo desarrollador');
  console.log('   🆕 INFO RAIL LATERAL - Panel lateral con datos y animaciones');

  // --- INFO RAIL LATERAL ---
  let railOpenFor = null;
  const rail = document.getElementById('info-rail');
  const beam = document.getElementById('info-beam');

  function toggleInfoRail(i) {
    if (railOpenFor === i) {
      hideInfoRail();
    } else {
      showInfoRail(i);
    }
  }

  function showInfoRail(i) {
    const card = cards[i];
    const node = nodes[i];
    railOpenFor = i;

    // Efecto de sonido
    if (soundEngine) {
      soundEngine.play('open');
    }

    // Posicionar rail a la derecha o izquierda de la tarjeta
    const r = card.getBoundingClientRect();
    const gap = 16;
    const width = 320;
    const rightSide = r.right + width + gap < innerWidth;
    const left = rightSide ? (r.right + gap) : (r.left - width - gap);
    const top = Math.max(20, r.top);

    rail.style.left = left + 'px';
    rail.style.top = top + 'px';
    
    // Contenido mejorado del InfoRail con más información
    rail.innerHTML = `
      <div class="energy-field"></div>
      <div class="info-rail-header">
        <div class="info-rail-title glitch-text" data-text="${node.name} — ${node.category}">${node.name} — ${node.category}</div>
        <div class="info-rail-status">
          <div class="status-indicator"></div>
          <span style="font-size: 10px; color: var(--ink-sub);">${node.status}</span>
        </div>
      </div>
      
      <div class="info-rail-metrics">
        <div class="metric-item">
          <div class="metric-value">${node.level}%</div>
          <div class="metric-label">Nivel</div>
        </div>
        <div class="metric-item">
          <div class="metric-value">${node.years}</div>
          <div class="metric-label">Años</div>
        </div>
        <div class="metric-item">
          <div class="metric-value">${node.projects}</div>
          <div class="metric-label">Proyectos</div>
        </div>
        <div class="metric-item">
          <div class="metric-value">${(node.commits / 1000).toFixed(1)}k</div>
          <div class="metric-label">Commits</div>
        </div>
      </div>
      
      <div class="info-rail-progress">
        <div style="font-size: 10px; color: var(--ink-sub); margin-bottom: 4px;">PROGRESO</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${node.level}%"></div>
        </div>
      </div>
      
      <div class="info-rail-tags">
        ${node.frameworks ? node.frameworks.slice(0, 3).map(framework => 
          `<div class="tag">${framework}</div>`
        ).join('') : '<div class="tag">Development</div>'}
      </div>
      
      <div id="typer"></div>
      
      <div class="info-rail-actions">
        <button class="action-btn" onclick="openDocs('${node.id}')">📚 Docs</button>
        <button class="action-btn" onclick="openRepo('${node.id}')">🔗 Repo</button>
        <button class="action-btn" onclick="copySnippet('${node.id}')">📋 Snippet</button>
      </div>
      
      <div class="particle-trail"></div>
    `;
    
    rail.hidden = false;
    rail.classList.add('active', 'info-rail-enter', 'info-rail-glow', 'info-rail-touch');

    // Conector (beam) mejorado con efecto de energía
    const startX = r.left + r.width / 2;
    const startY = r.top + r.height / 2;
    const endX = rightSide ? left : left + width;
    const endY = top + 20;
    const dx = endX - startX;
    const dy = endY - startY;
    const dist = Math.hypot(dx, dy);
    const angle = Math.atan2(dy, dx) * 180 / Math.PI;
    
    Object.assign(beam.style, {
      left: startX + 'px',
      top: startY + 'px',
      width: dist + 'px',
      transform: `rotate(${angle}deg)`
    });
    
    gsap.fromTo(beam, 
      { scaleX: 0, opacity: 0 },
      { scaleX: 1, opacity: 0.6, duration: 0.35, ease: 'power2.out' }
    );

    // Bits "viajando" mejorados con pool optimizado
    flyBits(startX, startY, endX, endY);

    // Typewriter mejorado con efectos de glitch
    typeLines([
      `Especialidad: ${node.category}`,
      `Profesión: ${node.experience?.roles?.[0] || 'Frontend Dev'}`,
      `Versión: ${node.versions ? node.versions[0] : 'Latest'}`,
      `Licencia: MIT`,
      `Rendimiento: ${node.performance?.lighthouse || 85}%`
    ], document.getElementById('typer'));

    // Animar entrada del rail con timeline optimizada
    const tl = gsap.timeline();
    
    tl.fromTo(rail, 
      { opacity: 0, y: -20, scale: 0.95, filter: 'blur(4px)' },
      { opacity: 1, y: 0, scale: 1, filter: 'blur(0px)', duration: 0.4, ease: 'power2.out' }
    )
    .fromTo('.metric-item', 
      { opacity: 0, y: 20, scale: 0.8 },
      { opacity: 1, y: 0, scale: 1, duration: 0.3, stagger: 0.1, ease: 'back.out(1.7)' },
      '-=0.2'
    )
    .fromTo('.progress-fill', 
      { width: '0%' },
      { width: `${node.level}%`, duration: 0.8, ease: 'power2.out' },
      '-=0.1'
    )
    .fromTo('.tag', 
      { opacity: 0, y: 10, scale: 0.8 },
      { opacity: 1, y: 0, scale: 1, duration: 0.2, stagger: 0.1, ease: 'back.out(1.7)' },
      '-=0.6'
    )
    .fromTo('.action-btn', 
      { opacity: 0, y: 10, scale: 0.8 },
      { opacity: 1, y: 0, scale: 1, duration: 0.2, stagger: 0.1, ease: 'back.out(1.7)' },
      '-=0.4'
    );

    // Efecto de partículas continuas
    startParticleSystem(rail);

    // Efecto de sonido visual
    createSoundWave(rail);

    // Focus para accesibilidad
    rail.focus();
  }

  function hideInfoRail() {
    railOpenFor = null;
    rail.classList.add('info-rail-exit');
    
    // Efecto de sonido al cerrar
    if (soundEngine) {
      soundEngine.play('close');
    }

    // Efecto de energía al cerrar
    createEnergyPulse(rail);
    
    gsap.to('#info-beam', { opacity: 0, duration: 0.2 });
    gsap.to('#info-rail', { 
      opacity: 0, 
      y: -20,
      scale: 0.95,
      filter: 'blur(4px)',
      duration: 0.3, 
      ease: 'power2.in',
      onComplete() {
        rail.hidden = true;
        rail.classList.remove('active', 'info-rail-enter', 'info-rail-exit', 'info-rail-glow', 'info-rail-touch');
        rail.style.opacity = '';
        rail.style.transform = '';
        rail.style.filter = '';
      }
    });
  }

  // Funciones de acción para los botones
  function openDocs(techId) {
    const docsUrl = `https://docs.example.com/${techId}`;
    window.open(docsUrl, '_blank');
    showToast(`📚 Abriendo documentación de ${techId}`, 'info');
  }

  function openRepo(techId) {
    const repoUrl = `https://github.com/example/${techId}`;
    window.open(repoUrl, '_blank');
    showToast(`🔗 Abriendo repositorio de ${techId}`, 'info');
  }

  function copySnippet(techId) {
    const snippet = `// ${techId} snippet
import { ${techId} } from '${techId}';

const component = new ${techId}();
component.init();`;
    
    navigator.clipboard.writeText(snippet).then(() => {
      showToast(`📋 Snippet de ${techId} copiado al portapapeles`, 'success');
    }).catch(() => {
      showToast(`❌ Error al copiar snippet`, 'error');
    });
  }

  // Cerrar al hacer click fuera o ESC
  document.addEventListener('click', e => {
    if (railOpenFor !== null && !rail.contains(e.target) && !cards[railOpenFor].contains(e.target)) {
      hideInfoRail();
    }
  });
  
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && railOpenFor !== null) {
      hideInfoRail();
    }
  });

  // Interacciones táctiles avanzadas optimizadas
  rail.addEventListener('touchstart', (e) => {
    e.preventDefault();
    rail.style.transform = 'scale(0.98)';
  }, { passive: false });

  rail.addEventListener('touchend', (e) => {
    e.preventDefault();
    rail.style.transform = 'scale(1)';
  }, { passive: false });

  // Efectos de hover avanzados
  rail.addEventListener('mouseenter', () => {
    if (railOpenFor !== null) {
      rail.classList.add('info-rail-glow');
      createEnergyPulse(rail);
    }
  });

  rail.addEventListener('mouseleave', () => {
    if (railOpenFor !== null) {
      rail.classList.remove('info-rail-glow');
    }
  });

  // --- INICIALIZACIÓN DE NUEVAS FUNCIONALIDADES ---
})();

async function typeLines(lines, mount) {
  mount.innerHTML = '';
  for (const text of lines) {
    const line = document.createElement('div');
    line.className = 'line';
    mount.appendChild(line);
    await typeLine(text, line);
  }
  const caret = document.createElement('span');
  caret.className = 'caret';
  mount.appendChild(caret);
}

function typeLine(text, el, speed = 18) {
  return new Promise(res => {
    let i = 0;
    const id = setInterval(() => {
      el.textContent = text.slice(0, ++i);
      if (i >= text.length) {
        clearInterval(id);
        setTimeout(res, 80);
      }
    }, speed);
  });
}

// --- CONTROL DE PARTÍCULAS CONTINUO OPTIMIZADO ---
let particleInterval = null;
let currentParticleRail = null;

function startParticleSystem(rail) {
  // Limpiar interval anterior si existe
  if (particleInterval) {
    clearInterval(particleInterval);
  }

  currentParticleRail = rail;
  const particleTrail = rail.querySelector('.particle-trail');
  if (!particleTrail) return;

  const createParticle = () => {
    if (currentParticleRail !== rail || !rail.classList.contains('active')) {
      clearInterval(particleInterval);
      particleInterval = null;
      return;
    }

    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.top = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 2 + 's';
    particleTrail.appendChild(particle);

    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }, 2000);
  };

  // Crear partículas cada 500ms
  particleInterval = setInterval(createParticle, 500);

  // Limpiar después de 10 segundos
  setTimeout(() => {
    if (particleInterval) {
      clearInterval(particleInterval);
      particleInterval = null;
    }
  }, 10000);
}

function createSoundWave(rail) {
  const soundWave = document.createElement('div');
  soundWave.className = 'sound-wave';
  rail.appendChild(soundWave);

  setTimeout(() => {
    if (soundWave.parentNode) {
      soundWave.parentNode.removeChild(soundWave);
    }
  }, 600);
}

function addGlitchEffect(element) {
  element.classList.add('glitch-text');
  setTimeout(() => {
    element.classList.remove('glitch-text');
  }, 300);
}

function createEnergyPulse(rail) {
  const energyPulse = document.createElement('div');
  energyPulse.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    border-radius: 10px;
    background: radial-gradient(circle at center, rgba(137, 245, 255, 0.2) 0%, transparent 70%);
    opacity: 0;
    animation: energyPulse 1s ease-out;
    pointer-events: none;
  `;
  rail.appendChild(energyPulse);

  setTimeout(() => {
    if (energyPulse.parentNode) {
      energyPulse.parentNode.removeChild(energyPulse);
    }
  }, 1000);
}

// --- UNIFICACIÓN DE INTERACCIONES ---
// Teclado
window.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && active !== null) {
    toggleInfoRail(active);
  }
});

// Gestos (swipe up)
document.addEventListener('touchmove', (e) => {
  if (railOpenFor !== null) return;
  
  const touch = e.touches[0];
  const deltaY = touch.clientY - (touch.startY || touch.clientY);
  
  if (deltaY < -50 && active !== null) {
    toggleInfoRail(active);
  }
});

// --- POOL DE BITS OPTIMIZADO ---
const BIT_POOL = Array.from({length: 24}, () => {
  const el = document.createElement('div');
  el.className = 'bit';
  el.style.transform = 'translate3d(0,0,0)';
  el.style.opacity = '0';
  el.style.pointerEvents = 'none';
  document.body.appendChild(el);
  return el;
});

function flyBits(startX, startY, endX, endY) {
  BIT_POOL.forEach((b, k) => {
    gsap.set(b, { x: startX, y: startY, opacity: 0 });
    gsap.to(b, {
      x: endX + (Math.random() * 40 - 20),
      y: endY + (Math.random() * 60 - 10),
      opacity: 1,
      duration: 0.7,
      delay: k * 0.02,
      ease: 'power2.out',
      onComplete: () => {
        gsap.set(b, { opacity: 0 });
      }
    });
  });
}

// --- MANEJO DE RESIZE ---
window.addEventListener('resize', () => {
  if (railOpenFor !== null) {
    const card = cards[railOpenFor];
    const node = nodes[railOpenFor];
    const r = card.getBoundingClientRect();
    const gap = 16;
    const width = 320;
    const rightSide = r.right + width + gap < innerWidth;
    const left = rightSide ? (r.right + gap) : (r.left - width - gap);
    const top = Math.max(20, r.top);

    rail.style.left = left + 'px';
    rail.style.top = top + 'px';
  }
});
</script>
</body>
</html>