// Traducciones
        const translations = {
            es: {
                nav: {
                    sobreMi: "Sobre MÃ­",
                    "sobreMi.sub1": "Certificaciones",
                    "sobreMi.sub2": "CV / Resume",
                    experiencia: "Experiencia",
                    "experiencia.sub1": "Proyectos",
                    "experiencia.sub2": "Stack TecnolÃ³gico",
                    stack: "Stack",
                    proyectos: "Proyectos",
                    servicios: "Servicios",
                    contacto: "Contacto"
                },
                menu: {
                    status: "SYSTEM MENU: ONLINE"
                },
                hero: {
                    status: "v3.0.0 // SYSTEM ONLINE",
                    titulo: "INGENIERO <br> <span style=\"opacity: 0.5;\">FULL-STACK</span>",
                    subtitulo: "Construyo <strong>dApps Web3</strong>, <strong>herramientas con IA</strong> y <strong>experiencias 3D</strong> para startups y estudios creativos que buscan diferenciarse.",
                    btnContacto: "Iniciar Proyecto",
                    btnProyectos: "Ver Proyectos",
                    btnCV: "CV / Resume",
                    cta: "Â¿Tienes un proyecto que necesita ejecuciÃ³n tÃ©cnica sÃ³lida? <a href=\"#contacto\" style=\"color: var(--accent-primary); text-decoration: underline;\">Agendemos una llamada</a> o <a href=\"mailto:contacto@inmortal.dev\" style=\"color: var(--accent-primary); text-decoration: underline;\">escrÃ­beme directamente</a>.",
                    stats: {
                        proyectos: "PROYECTOS",
                        experiencia: "AÃ‘OS EXP.",
                        futurista: "FUTURISTA"
                    }
                },
                about: {
                    titulo: "Sobre MÃ­",
                    descripcion: "MÃ¡s que escribir cÃ³digo, construyo ecosistemas. Mi pasiÃ³n reside en la intersecciÃ³n entre el diseÃ±o minimalista y la ingenierÃ­a robusta.",
                    descripcion2: "Actualmente enfocado en desarrollar webs 3D interactivas con Three.js, Python y tecnologÃ­as modernas para crear experiencias inmersivas.",
                    perfil: "Perfil del Sistema",
                    especialidades: "Frontend | Backend | Web3 | IA",
                    rolActual: "// Rol actual",
                    rolActualTexto: "Ingeniero Fullâ€‘Stack centrado en experiencias Web3, IA aplicada y entornos 3D para productos digitales y marcas futuristas.",
                    queHago: "// QuÃ© hago",
                    queHagoTexto: "Conecto diseÃ±o y arquitectura: desde el concepto visual hasta la infraestructura en producciÃ³n, cuidando rendimiento, seguridad y experiencia de usuario.",
                    comoTrabajo: "// CÃ³mo trabajo",
                    comoTrabajoTexto: "Proceso iterativo, obsesiÃ³n por el detalle \"pixelâ€‘perfect\", comunicaciÃ³n clara y enfoque en entregar valor rÃ¡pido sin perder calidad tÃ©cnica.",
                    loQueBusco: "// Lo que busco",
                    loQueBuscoTexto: "Colaborar con equipos que quieran construir productos diferenciales: dashboards Web3, herramientas creativas con IA y experiencias 3D memorables."
                },
                experience: {
                    titulo: "Experiencia",
                    exp1: {
                        fecha: "2023 - PRESENTE",
                        titulo: "Ingeniero Full-Stack Senior",
                        empresa: "ConsultorÃ­a Web3 & IA"
                    },
                    exp2: {
                        fecha: "2021 - 2023",
                        titulo: "Frontend Developer",
                        empresa: "Creative Studio Agency"
                    }
                },
                stack: {
                    titulo: "Arsenal TecnolÃ³gico",
                    subtitulo: "// TECH_STACK_V3.0 // LOADED",
                    frontend: "FRONTEND",
                    backend: "BACKEND",
                    web3: "WEB3 & AI"
                },
                projects: {
                    titulo: "Proyectos Destacados",
                    subtitulo: "// HOVER TO INSPECT DATA",
                    clickAbrir: "CLICK PARA ABRIR",
                    proj1: {
                        categoria: "TYPE: WEB3 / DEFI",
                        titulo: "EcoVerse DEX",
                        descripcion: "Plataforma de intercambio descentralizado con auditorÃ­a automatizada por IA."
                    },
                    proj2: {
                        categoria: "TYPE: AI / SAAS",
                        titulo: "Neural Studio",
                        descripcion: "Generador de assets para videojuegos utilizando Stable Diffusion API."
                    },
                    proj3: {
                        categoria: "TYPE: WEBGL / 3D",
                        titulo: "Metaverse Core",
                        descripcion: "Motor de renderizado ligero para experiencias VR en el navegador."
                    }
                },
                results: {
                    titulo: "Resultados Medibles",
                    subtitulo: "// IMPACTO REAL EN PROYECTOS"
                },
                services: {
                    titulo: "Servicios",
                    serv1: {
                        titulo: "Desarrollo Web3",
                        descripcion: "ConstrucciÃ³n de dApps, smart contracts y ecosistemas descentralizados."
                    },
                    serv2: {
                        titulo: "IA Generativa",
                        descripcion: "IntegraciÃ³n de modelos de IA para automatizaciÃ³n y generaciÃ³n de contenido."
                    },
                    serv3: {
                        titulo: "Experiencias 3D",
                        descripcion: "Desarrollo de interfaces inmersivas con Three.js y WebGL."
                    }
                },
                contact: {
                    subtitulo: "INICIAR PROTOCOLO DE CONEXIÃ“N",
                    titulo: "Trabajemos Juntos",
                    descripcion: "Â¿Tienes un proyecto visionario? Estoy listo para construir el futuro contigo.",
                    form: {
                        nombre: "Nombre / Entidad",
                        email: "Email de Contacto",
                        mensaje: "Detalles de la MisiÃ³n",
                        enviar: "Enviar TransmisiÃ³n",
                        errorCampos: "COMPLETA TODOS LOS CAMPOS",
                        transmitiendo: "TRANSMITIENDO...",
                        mensajeRecibido: "âœ“ MENSAJE RECIBIDO",
                        mensajeSimulado: "âœ“ MENSAJE RECIBIDO (SIMULADO)",
                        errorConexion: "âœ— ERROR DE CONEXIÃ“N"
                    }
                },
                cv: {
                    titulo: "EXPEDIENTE DEL SISTEMA",
                    subtitulo: "// PERSONNEL_FILE_V3.enc",
                    acceso: "ACCESO A ARCHIVO",
                    descargar: "DESCARGAR DATOS (PDF)",
                    metricas: "MÃ‰TRICAS DE RENDIMIENTO",
                    btn: {
                        normal: "ACCEDER A ARCHIVO ENCRIPTADO [PDF]",
                        hover: "DESENCRIPTANDO... DESCARGAR"
                    },
                    skills: {
                        sincronizacion: "SincronizaciÃ³n Neural",
                        resolucion: "ResoluciÃ³n de Conflictos",
                        adaptabilidad: "Adaptabilidad de Entorno",
                        optimizaciÃ³n: "OptimizaciÃ³n de Recursos",
                        comunicacion: "ComunicaciÃ³n TÃ©cnica",
                        liderazgo: "Liderazgo de Equipo"
                    }
                },
                footer: {
                    tagline: "Fullâ€‘Stack Engineering â€¢ Web3 â€¢ IA",
                    status: "v3.0.0 // SYSTEM ONLINE",
                    update: "Last update: 2026",
                    nav: {
                        titulo: "Mapa del Sitio",
                        inicio: "Inicio",
                        sobreMi: "Sobre MÃ­",
                        experiencia: "Experiencia",
                        stack: "Stack TecnolÃ³gico",
                        proyectos: "Proyectos Destacados",
                        servicios: "Servicios",
                        contacto: "Contacto / Iniciar ConexiÃ³n"
                    },
                    contact: {
                        titulo: "Contacto RÃ¡pido",
                        email: "contacto@inmortal.dev",
                        ubicacion: "Ciudad, PaÃ­s"
                    },
                    tech: {
                        titulo: "Currently building with:"
                    },
                    copyright: "Â© 2026 INMORTAL_OS. DiseÃ±ado y desarrollado por INMORTAL_OS.",
                    'copyright-short': "Â© 2026 INMORTAL_OS",
                    legal: {
                        privacy: "PolÃ­tica de Privacidad",
                        terms: "TÃ©rminos de Uso"
                    }
                },
                codepen: {
                    clickExpandir: "â†’ CLICK PARA EXPANDIR"
                }
            },
            en: {
                nav: {
                    sobreMi: "About",
                    "sobreMi.sub1": "Certifications",
                    "sobreMi.sub2": "CV / Resume",
                    experiencia: "Experience",
                    "experiencia.sub1": "Projects",
                    "experiencia.sub2": "Tech Stack",
                    stack: "Stack",
                    proyectos: "Projects",
                    servicios: "Services",
                    contacto: "Contact"
                },
                menu: {
                    status: "SYSTEM MENU: ONLINE"
                },
                hero: {
                    status: "v3.0.0 // SYSTEM ONLINE",
                    titulo: "Full-Stack Engineer<br><span style=\"opacity: 0.5; font-size: 0.85em;\">Digital Products Architect</span>",
                    subtitulo: "I build <strong>Web3 dApps</strong>, <strong>AI-powered tools</strong> and <strong>3D experiences</strong> for startups and creative studios looking to stand out.",
                    btnContacto: "Start Project",
                    btnProyectos: "View Projects",
                    btnCV: "CV / Resume",
                    cta: "Do you have a project that needs solid technical execution? <a href=\"#contacto\" style=\"color: var(--accent-primary); text-decoration: underline;\">Schedule a call</a> or <a href=\"mailto:contacto@inmortal.dev\" style=\"color: var(--accent-primary); text-decoration: underline;\">write me directly</a>.",
                    stats: {
                        proyectos: "PROJECTS",
                        experiencia: "YEARS EXP.",
                        futurista: "FUTURISTIC"
                    }
                },
                about: {
                    titulo: "About Me",
                    descripcion: "More than writing code, I build ecosystems. My passion lies at the intersection of minimalist design and robust engineering.",
                    descripcion2: "Currently focused on developing interactive 3D web experiences with Three.js, Python and modern technologies to create immersive experiences.",
                    perfil: "System Profile",
                    especialidades: "Frontend | Backend | Web3 | AI",
                    rolActual: "// Current Role",
                    rolActualTexto: "Fullâ€‘Stack Engineer focused on Web3 experiences, applied AI and 3D environments for digital products and futuristic brands.",
                    queHago: "// What I Do",
                    queHagoTexto: "I connect design and architecture: from visual concept to production infrastructure, caring for performance, security and user experience.",
                    comoTrabajo: "// How I Work",
                    comoTrabajoTexto: "Iterative process, obsession with \"pixelâ€‘perfect\" detail, clear communication and focus on delivering value quickly without losing technical quality.",
                    loQueBusco: "// What I'm Looking For",
                    loQueBuscoTexto: "Collaborate with teams that want to build differential products: Web3 dashboards, creative tools with AI and memorable 3D experiences."
                },
                experience: {
                    titulo: "Experience",
                    exp1: {
                        fecha: "2023 - PRESENT",
                        titulo: "Senior Full-Stack Engineer",
                        empresa: "Web3 & AI Consulting"
                    },
                    exp2: {
                        fecha: "2021 - 2023",
                        titulo: "Frontend Developer",
                        empresa: "Creative Studio Agency"
                    }
                },
                stack: {
                    titulo: "Tech Arsenal",
                    subtitulo: "// TECH_STACK_V3.0 // LOADED",
                    frontend: "FRONTEND",
                    backend: "BACKEND",
                    web3: "WEB3 & AI"
                },
                projects: {
                    titulo: "Featured Projects",
                    subtitulo: "// HOVER TO INSPECT DATA",
                    clickAbrir: "CLICK TO OPEN",
                    proj1: {
                        categoria: "TYPE: WEB3 / DEFI",
                        titulo: "EcoVerse DEX",
                        descripcion: "Decentralized exchange platform with AI-automated auditing."
                    },
                    proj2: {
                        categoria: "TYPE: AI / SAAS",
                        titulo: "Neural Studio",
                        descripcion: "Game asset generator using Stable Diffusion API."
                    },
                    proj3: {
                        categoria: "TYPE: WEBGL / 3D",
                        titulo: "Metaverse Core",
                        descripcion: "Lightweight rendering engine for VR experiences in the browser."
                    }
                },
                results: {
                    titulo: "Measurable Results"
                },
                services: {
                    titulo: "Services",
                    serv1: {
                        titulo: "Web3 Development",
                        descripcion: "Building dApps, smart contracts and decentralized ecosystems."
                    },
                    serv2: {
                        titulo: "Generative AI",
                        descripcion: "Integration of AI models for automation and content generation."
                    },
                    serv3: {
                        titulo: "3D Experiences",
                        descripcion: "Development of immersive interfaces with Three.js and WebGL."
                    }
                },
                contact: {
                    subtitulo: "INITIATE CONNECTION PROTOCOL",
                    titulo: "Let's Work Together",
                    descripcion: "Do you have a visionary project? I'm ready to build the future with you.",
                    form: {
                        nombre: "Name / Entity",
                        email: "Contact Email",
                        mensaje: "Mission Details",
                        enviar: "Send Transmission",
                        errorCampos: "COMPLETE ALL FIELDS",
                        transmitiendo: "TRANSMITTING...",
                        mensajeRecibido: "âœ“ MESSAGE RECEIVED",
                        mensajeSimulado: "âœ“ MESSAGE RECEIVED (SIMULATED)",
                        errorConexion: "âœ— CONNECTION ERROR"
                    }
                },
                cv: {
                    titulo: "SYSTEM FILE",
                    subtitulo: "// PERSONNEL_FILE_V3.enc",
                    acceso: "ACCESS FILE",
                    descargar: "DOWNLOAD DATA (PDF)",
                    metricas: "PERFORMANCE METRICS",
                    btn: {
                        normal: "ACCESS ENCRYPTED FILE [PDF]",
                        hover: "DECRYPTING... DOWNLOAD"
                    },
                    skills: {
                        sincronizacion: "Neural Synchronization",
                        resolucion: "Conflict Resolution",
                        adaptabilidad: "Environment Adaptability",
                        optimizaciÃ³n: "Resource Optimization",
                        comunicacion: "Technical Communication",
                        liderazgo: "Team Leadership"
                    }
                },
                footer: {
                    tagline: "Fullâ€‘Stack Engineering â€¢ Web3 â€¢ AI",
                    status: "v3.0.0 // SYSTEM ONLINE",
                    update: "Last update: 2026",
                    nav: {
                        titulo: "Site Map",
                        inicio: "Home",
                        sobreMi: "About",
                        experiencia: "Experience",
                        stack: "Tech Stack",
                        proyectos: "Featured Projects",
                        servicios: "Services",
                        contacto: "Contact / Initiate Connection"
                    },
                    contact: {
                        titulo: "Quick Contact",
                        email: "contacto@inmortal.dev",
                        ubicacion: "City, Country"
                    },
                    tech: {
                        titulo: "Currently building with:"
                    },
                    copyright: "Â© 2026 INMORTAL_OS. Designed and developed by INMORTAL_OS.",
                    'copyright-short': "Â© 2026 INMORTAL_OS",
                    legal: {
                        privacy: "Privacy Policy",
                        terms: "Terms of Use"
                    }
                },
                codepen: {
                    demo: "CodePen Demo",
                    badge: "â— INTERACTIVE DEMO",
                    clickExpandir: "â†’ CLICK TO EXPAND"
                }
            }
        };

        // Funciones de idioma
        function toggleLanguage(lang) {
            setLanguage(lang);
        }

        function setLanguage(lang) {
            document.documentElement.setAttribute('lang', lang);
            localStorage.setItem('preferredLanguage', lang);
            
            // Actualizar UI de botones
            document.querySelectorAll('.lang-toggle span').forEach(span => {
                span.classList.remove('active-lang');
            });
            document.querySelectorAll('.lang-toggle').forEach(toggle => {
                const spans = toggle.querySelectorAll('span');
                if (lang === 'es') {
                    spans[0].classList.add('active-lang');
                } else {
                    spans[1].classList.add('active-lang');
                }
            });
            
            updateContent(lang);
        }

        function updateContent(lang) {
            const langData = translations[lang];
            
            // Actualizar elementos con data-i18n
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const keys = key.split('.');
                let value = langData;
                
                for (const k of keys) {
                    if (value && value[k]) {
                        value = value[k];
                    } else {
                        value = null;
                        break;
                    }
                }
                
                if (value) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = value;
                    } else {
                        element.innerHTML = value;
                    }
                }
            });
            
            // Actualizar placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const keys = key.split('.');
                let value = langData;
                
                for (const k of keys) {
                    if (value && value[k]) {
                        value = value[k];
                    } else {
                        value = null;
                        break;
                    }
                }
                
                if (value) {
                    element.placeholder = value;
                }
            });
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            // Filtrar errores de Origin Trial de CodePen (inofensivos, provienen del contenido del iframe)
            const originalError = console.error;
            console.error = function(...args) {
                const message = args.join(' ');
                // Suprimir errores de Origin Trial de CodePen
                if (message.includes('Origin trial controlled feature not enabled') && 
                    (message.includes('language-model') || message.includes('rewriter') || message.includes('writer'))) {
                    return; // No mostrar estos errores inofensivos
                }
                originalError.apply(console, args);
            };

            // Cargar idioma guardado o usar espaÃ±ol por defecto
            const savedLang = localStorage.getItem('preferredLanguage') || 'es';
            setLanguage(savedLang);
            
            // Scroll Reveal
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('revealed');
                    }
                });
            }, observerOptions);
            
            document.querySelectorAll('.reveal-section').forEach(section => {
                observer.observe(section);
            });
            
            // Form Submit - Con envÃ­o real al backend
            document.getElementById('contactForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const form = e.target;
                const btn = form.querySelector('button');
                const original = btn.innerText;
                const currentLang = document.documentElement.getAttribute('lang');
                
                // Obtener datos del formulario
                const formData = new FormData(form);
                const nombre = formData.get('nombre') || form.querySelector('input[type="text"]').value;
                const email = formData.get('email') || form.querySelector('input[type="email"]').value;
                const mensaje = formData.get('mensaje') || form.querySelector('textarea').value;
                
                // ValidaciÃ³n bÃ¡sica
                const langData = translations[currentLang];
                if (!nombre || !email || !mensaje) {
                    btn.innerText = langData.contact.form.errorCampos;
                    btn.style.backgroundColor = "#ef4444";
                    setTimeout(() => {
                        btn.innerText = original;
                        btn.style.backgroundColor = "";
                    }, 2000);
                    return;
                }
                
                // Estado: Enviando
                btn.disabled = true;
                btn.innerText = langData.contact.form.transmitiendo;
                btn.style.backgroundColor = "#fff";
                btn.style.color = "#000";
                
                try {
                    // URL del backend (cambia segÃºn tu entorno)
                    // Para desarrollo local: 'http://localhost:3000/contacto'
                    // Para producciÃ³n: 'https://inmortal-backend.onrender.com/contacto'
                    const backendUrl = 'http://localhost:3000/contacto'; // âš ï¸ CAMBIA ESTA URL segÃºn tu entorno
                    
                    // Intentar conectar con timeout de 3 segundos
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000);
                    
                    const response = await fetch(backendUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            nombre: nombre,
                            email: email,
                            mensaje: mensaje,
                            proyecto: 'Portfolio Contact' // Opcional
                        }),
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        // Ã‰xito - Backend funcionando
                        btn.innerText = langData.contact.form.mensajeRecibido;
                        btn.style.backgroundColor = "#10b981";
                        btn.style.color = "#fff";
                        
                        // Resetear formulario despuÃ©s de 2 segundos
                        setTimeout(() => {
                            btn.innerText = original;
                            btn.style.backgroundColor = "";
                            btn.style.color = "";
                            btn.disabled = false;
                            form.reset();
                        }, 2000);
                    } else {
                        // Error del servidor - usar modo simulaciÃ³n
                        throw new Error(data.error || 'Error al enviar el mensaje');
                    }
                    
                } catch (error) {
                    // Si es error de conexiÃ³n (backend no disponible), usar modo simulaciÃ³n
                    if (error.name === 'AbortError' || error.message.includes('Failed to fetch') || error.message.includes('ERR_CONNECTION_REFUSED')) {
                        // Modo desarrollo: descomentar para debug
                        // if (window.location.hostname === 'localhost') {
                        //     console.log('ðŸ”§ Backend no disponible - Modo simulaciÃ³n activado');
                        //     console.log('ðŸ“ Datos del formulario:', { nombre, email, mensaje });
                        // }
                        
                        // Simular envÃ­o exitoso
                        setTimeout(() => {
                            btn.innerText = langData.contact.form.mensajeSimulado;
                            btn.style.backgroundColor = "#10b981";
                            btn.style.color = "#fff";
                            
                            setTimeout(() => {
                                btn.innerText = original;
                                btn.style.backgroundColor = "";
                                btn.style.color = "";
                                btn.disabled = false;
                                form.reset();
                            }, 2000);
                        }, 1500);
                    } else {
                        // Otro tipo de error - Solo log en desarrollo
                        if (window.location.hostname === 'localhost') {
                            console.error('Error enviando formulario:', error);
                        }
                        btn.innerText = langData.contact.form.errorConexion;
                        btn.style.backgroundColor = "#ef4444";
                        btn.style.color = "#fff";
                        
                        setTimeout(() => {
                            btn.innerText = original;
                            btn.style.backgroundColor = "";
                            btn.style.color = "";
                            btn.disabled = false;
                        }, 3000);
                    }
                }
            });
            
            // Detectar scroll en el carrusel de Servicios (optimizado - handler Ãºnico)
            const servicesGrid = document.getElementById('services-grid');
            if (servicesGrid) {
                let hasScrolled = false;
                const serviciosSection = document.getElementById('servicios');
                const swipeIndicator = document.querySelector('.services-swipe-indicator');
                
                // Handler Ãºnico que maneja ambas lÃ³gicas
                const handleServicesScroll = () => {
                    // Detectar primer scroll
                    if (!hasScrolled && servicesGrid.scrollLeft > 10) {
                        hasScrolled = true;
                        servicesGrid.classList.add('scrolled');
                        
                        // Ocultar el indicador de deslizamiento
                        if (swipeIndicator) {
                            swipeIndicator.style.opacity = '0';
                            swipeIndicator.style.transition = 'opacity 0.5s ease';
                        }
                    }
                    
                    // Detectar cuando se llega al final del scroll
                    const isAtEnd = servicesGrid.scrollLeft + servicesGrid.clientWidth >= servicesGrid.scrollWidth - 10;
                    if (serviciosSection && isAtEnd) {
                        serviciosSection.classList.add('scrolled');
                    }
                };
                
                // Un solo event listener con throttling
                let scrollTimeout;
                servicesGrid.addEventListener('scroll', () => {
                    if (scrollTimeout) return;
                    scrollTimeout = requestAnimationFrame(() => {
                        handleServicesScroll();
                        scrollTimeout = null;
                    });
                }, { passive: true });
            }
            
            // Detectar scroll en el carrusel de Resultados Medibles (optimizado - handler Ãºnico)
            const resultsGrid = document.getElementById('results-grid');
            if (resultsGrid) {
                let hasScrolledResults = false;
                const resultsSection = document.querySelector('.results-section');
                const swipeIndicator = document.querySelector('.results-swipe-indicator');
                
                // Handler Ãºnico que maneja ambas lÃ³gicas
                const handleResultsScroll = () => {
                    // Detectar primer scroll
                    if (!hasScrolledResults && resultsGrid.scrollLeft > 10) {
                        hasScrolledResults = true;
                        resultsGrid.classList.add('scrolled');
                        
                        // Ocultar el indicador de deslizamiento
                        if (swipeIndicator) {
                            swipeIndicator.style.opacity = '0';
                            swipeIndicator.style.transition = 'opacity 0.5s ease';
                        }
                    }
                    
                    // Detectar cuando se llega al final del scroll
                    const isAtEnd = resultsGrid.scrollLeft + resultsGrid.clientWidth >= resultsGrid.scrollWidth - 10;
                    if (resultsSection && isAtEnd) {
                        resultsSection.classList.add('scrolled');
                    }
                };
                
                // Un solo event listener con throttling
                let scrollTimeout;
                resultsGrid.addEventListener('scroll', () => {
                    if (scrollTimeout) return;
                    scrollTimeout = requestAnimationFrame(() => {
                        handleResultsScroll();
                        scrollTimeout = null;
                    });
                }, { passive: true });
            }

            // NUEVA LÃ“GICA: Sistema de MenÃº MÃ³vil
            const menuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu-overlay');

            const toggleMenu = () => {
                document.body.classList.toggle('menu-open');
            };
            
            // Abrir/Cerrar al hacer click en el botÃ³n
            if (menuToggle) {
                menuToggle.addEventListener('click', toggleMenu);
            }

            // Sistema de submenÃºs colapsables
            if (mobileMenu) {
                // Manejar clics en enlaces con submenÃºs
                mobileMenu.querySelectorAll('.system-menu-link.has-submenu').forEach(link => {
                    link.addEventListener('click', (e) => {
                        const submenuId = link.getAttribute('data-submenu');
                        const submenu = document.getElementById(submenuId);
                        
                        if (submenu) {
                            // Toggle del submenÃº
                            const isExpanded = submenu.classList.contains('expanded');
                            
                            // Si el submenÃº ya estÃ¡ expandido, permitir navegaciÃ³n normal
                            if (isExpanded) {
                                // Navegar normalmente y cerrar el menÃº
                                setTimeout(() => {
                                    toggleMenu();
                                    // Cerrar todos los submenÃºs al cerrar el menÃº
                                    mobileMenu.querySelectorAll('.submenu-container').forEach(menu => {
                                        menu.classList.remove('expanded');
                                    });
                                    mobileMenu.querySelectorAll('.system-menu-link.has-submenu').forEach(menuLink => {
                                        menuLink.classList.remove('expanded');
                                    });
                                }, 100);
                                return; // Permitir navegaciÃ³n normal
                            }
                            
                            // Si el submenÃº estÃ¡ cerrado, prevenir navegaciÃ³n y expandir
                            e.preventDefault();
                            
                            // Cerrar todos los submenÃºs primero
                            mobileMenu.querySelectorAll('.submenu-container').forEach(menu => {
                                menu.classList.remove('expanded');
                            });
                            mobileMenu.querySelectorAll('.system-menu-link.has-submenu').forEach(menuLink => {
                                menuLink.classList.remove('expanded');
                            });
                            
                            // Abrir el submenÃº seleccionado
                            submenu.classList.add('expanded');
                            link.classList.add('expanded');
                        }
                    });
                });

                // Cerrar menÃº al hacer click en enlaces sin submenÃºs o en submenÃºs
                mobileMenu.querySelectorAll('.system-menu-link:not(.has-submenu), .submenu-link').forEach(link => {
                    link.addEventListener('click', () => {
                        // PequeÃ±o delay para permitir la navegaciÃ³n antes de cerrar
                        setTimeout(() => {
                            toggleMenu();
                            // Cerrar todos los submenÃºs al cerrar el menÃº
                            mobileMenu.querySelectorAll('.submenu-container').forEach(menu => {
                                menu.classList.remove('expanded');
                            });
                            mobileMenu.querySelectorAll('.system-menu-link.has-submenu').forEach(menuLink => {
                                menuLink.classList.remove('expanded');
                            });
                        }, 100);
                    });
                });

                // Cerrar al hacer click fuera del overlay
                mobileMenu.addEventListener('click', (e) => {
                    if (e.target === mobileMenu) {
                        toggleMenu();
                        // Cerrar todos los submenÃºs
                        mobileMenu.querySelectorAll('.submenu-container').forEach(menu => {
                            menu.classList.remove('expanded');
                        });
                        mobileMenu.querySelectorAll('.system-menu-link.has-submenu').forEach(menuLink => {
                            menuLink.classList.remove('expanded');
                        });
                    }
                });
            }

            // Sistema de Modal CodePen
            const codepenPanel = document.getElementById('codepen-preview-panel');
            const codepenModal = document.getElementById('codepen-modal-overlay');
            const codepenClose = document.getElementById('codepen-modal-close');

            if (codepenPanel && codepenModal && codepenClose) {
                // Abrir modal al hacer clic en el panel
                codepenPanel.addEventListener('click', () => {
                    codepenModal.classList.add('active');
                    document.body.style.overflow = 'hidden'; // Prevenir scroll del body
                });

                // Cerrar modal
                const closeModal = () => {
                    codepenModal.classList.remove('active');
                    document.body.style.overflow = ''; // Restaurar scroll
                };

                codepenClose.addEventListener('click', closeModal);

                // Cerrar al hacer clic fuera del contenedor
                codepenModal.addEventListener('click', (e) => {
                    if (e.target === codepenModal) {
                        closeModal();
                    }
                });

                // Cerrar con tecla ESC
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && codepenModal.classList.contains('active')) {
                        closeModal();
                    }
                });
            }

            // Sistema de NavegaciÃ³n al Panel (Todos los paneles)
            const panelCards = document.querySelectorAll('.panel-clickable');
            
            // Crear overlay de transiciÃ³n (compartido para todos)
            const transitionOverlay = document.createElement('div');
            transitionOverlay.className = 'page-transition-overlay';
            document.body.appendChild(transitionOverlay);

            panelCards.forEach(panelCard => {
                // OptimizaciÃ³n: usar passive listener donde sea posible
                panelCard.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    const panelUrl = panelCard.getAttribute('data-panel-url');
                    
                    // Si no hay URL, no hacer nada
                    if (!panelUrl || panelUrl === '#') return;
                    
                    // Obtener posiciÃ³n del card en la pantalla para la animaciÃ³n
                    const rect = panelCard.getBoundingClientRect();
                    const cardCenterX = rect.left + rect.width / 2;
                    const cardCenterY = rect.top + rect.height / 2;
                    
                    // Guardar posiciÃ³n en el overlay para la animaciÃ³n de entrada en panel.html
                    sessionStorage.setItem('panelOrigin', JSON.stringify({
                        x: cardCenterX,
                        y: cardCenterY,
                        width: rect.width,
                        height: rect.height
                    }));
                    
                    // Usar requestAnimationFrame para mejor sincronizaciÃ³n
                    requestAnimationFrame(() => {
                        // AÃ±adir clase de animaciÃ³n al card
                        panelCard.classList.add('navigating');
                        
                        // Activar overlay de transiciÃ³n en el siguiente frame
                        requestAnimationFrame(() => {
                            transitionOverlay.classList.add('active');
                            
                            // Pre-cargar el recurso si es posible
                            if (panelUrl.endsWith('.html')) {
                                const link = document.createElement('link');
                                link.rel = 'prefetch';
                                link.href = panelUrl;
                                document.head.appendChild(link);
                            }
                            
                            // Navegar despuÃ©s de la animaciÃ³n
                            setTimeout(() => {
                                // Limpiar will-change para mejor rendimiento
                                panelCard.style.willChange = 'auto';
                                window.location.href = panelUrl;
                            }, 500);
                        });
                    });
                }, { passive: false });
            });

        });
